(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-838dbece"],{"3fa5":function(t,e,s){"use strict";s.d(e,"b",function(){return a}),s.d(e,"a",function(){return n});var i=s("5c96");function a(t){"add"===t&&Object(i["Message"])({message:"已新增",type:"success"}),"edit"===t&&Object(i["Message"])({message:"已儲存",type:"success"})}function n(){Object(i["Message"])({message:"已刪除",type:"success"})}},"7d95":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[0!==t.commentList.length?s("div",{class:t.$style.CommentSection},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingFetchList,expression:"tryingFetchList"}],class:t.$style.comment},t._l(t.commentList,function(e){return s("div",{key:e.id,staticClass:"comment__item"},[s("div",{staticClass:"comment__head"},[s("div",[s("h4",{staticClass:"comment__title"},[t._v("新增備註 - "+t._s(e.creator.name))]),e.orderNo?s("div",{staticClass:"comment__tip text-muted"},[t._v("訂單編號："+t._s(e.orderNo))]):t._e(),s("div",{staticClass:"comment__tip text-muted"},[t._v(t._s(t._f("formatDate")(e.updatedAt,"dateTime")))])]),s("div",{staticClass:"comment__btn-group"},[t.isOwer||t.userId===e.creator.id?s("el-button",{staticClass:"is-round",staticStyle:{cursor:"pointer"},attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(s){return t.openEdit("edit",e)}}},[s("BaseIcon",{attrs:{name:"edit"}})],1):t._e(),s("el-button",{staticClass:"is-round",staticStyle:{cursor:"pointer"},attrs:{type:"success",plain:"",size:"mini"},on:{click:function(s){return t.openSendDialog(e.id)}}},[s("BaseIcon",{attrs:{name:"share"}})],1)],1)]),e.images.length>0?s("div",{staticClass:"comment__img"},t._l(e.images,function(e){return s("div",{key:e,staticClass:"comment__img__item",staticStyle:{cursor:"pointer"},on:{click:function(s){return t.handlePreview(e)}}},[s("img",{attrs:{src:e,alt:""}})])}),0):t._e(),e.questions?s("div",[e.questions.afterOrder.length>0?s("div",{staticStyle:{"margin-bottom":"20px","line-height":"1.5"}},[t._v("美容後問題：\n            "+t._s(t.afterOrder(e.questions))+"\n          ")]):t._e(),e.questions.handle.length>0?s("div",{staticStyle:{"margin-bottom":"20px","line-height":"1.5"}},[t._v("善後處理：\n            "+t._s(e.questions.handle.join("，"))+"\n          ")]):t._e()]):t._e(),s("div",{staticClass:"comment__content",domProps:{textContent:t._s(e.content)}})])}),0),s("el-dialog",{attrs:{visible:t.dialogSendVisible,width:"600px",title:"選擇發送方式",top:"0","append-to-body":""},on:{"update:visible":function(e){t.dialogSendVisible=e}}},[s("div",{class:t.$style["share__buttons"],staticStyle:{cursor:"pointer"}},[s("div",{class:t.$style["share__button"],on:{click:function(e){return t.tryToSendComment(t.commentId)}}},[s("el-button",{attrs:{type:"text"}},[s("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"sms"}})],1),s("div",{class:t.$style["share__label"]},[t._v("簡訊")])],1),s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryToGetLink,expression:"tryToGetLink"}],class:t.$style["share__button"],staticStyle:{cursor:"pointer"}},[s("el-button",{attrs:{type:"text"},on:{click:t.copyShareLink}},[s("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"copy"}})],1),s("div",{class:t.$style["share__label"]},[t._v("複製連結")])],1)])]),s("el-dialog",{attrs:{visible:t.dialogImgVisible,width:"800px",top:"0","append-to-body":""},on:{"update:visible":function(e){t.dialogImgVisible=e}}},[s("img",{attrs:{width:"100%",src:t.dialogImageUrl}})])],1):s("div",[s("p",[t._v("還沒有寵物備註")])]),s("el-drawer",{ref:"drawer",staticClass:"no-header mobile",attrs:{visible:t.drawerVisible,"append-to-body":"",size:t.$root.isSmallDevice?"100%":"50%","destroy-on-close":""},on:{"update:visible":function(e){t.drawerVisible=e}}},[s("el-page-header",{attrs:{content:"new"===t.mode?"新增寵物備註":"編輯寵物備註"},on:{back:t.handleDrawerClosed}}),s("el-divider"),s("div",{class:t.$style.CommentSection},[s("el-form",{ref:"form",attrs:{model:t.submitData,rules:t.submitRules,"label-position":"top","validate-on-rule-change":!1}},[s("el-form-item",{attrs:{label:""}},[s("ImageUpload",{ref:"upload",class:t.$style.upload,attrs:{"trying-save":t.tryingSave,"file-list":t.fileList,"show-upload":!0},on:{"update:tryingSave":function(e){t.tryingSave=e},"update:trying-save":function(e){t.tryingSave=e},updateFileList:t.updateFileList},model:{value:t.submitData.images,callback:function(e){t.$set(t.submitData,"images",e)},expression:"submitData.images"}})],1),s("el-form-item",{attrs:{label:"美容後問題"}},[s("el-checkbox-group",{model:{value:t.submitData.questions.afterOrder,callback:function(e){t.$set(t.submitData.questions,"afterOrder",e)},expression:"submitData.questions.afterOrder"}},[s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"正常"}},[t._v("正常")]),s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"皮膚病"}},[t._v("皮膚病")]),s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"指甲流血"}},[t._v("指甲流血")]),s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"剃傷"}},[t._v("剃傷")]),s("div",{staticClass:"inline-ck"},[s("el-checkbox",{staticClass:"sp-ck",attrs:{label:"跳蚤"}},[t._v("跳蚤 ")]),s("div",{staticClass:"inline-ck-item"},[s("div",{staticClass:"is-show",staticStyle:{"padding-right":"20px"}},[t._v("( ")]),s("el-radio",{attrs:{label:"少量"},model:{value:t.submitData.questions.afterOrderOption[0],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,0,e)},expression:"submitData.questions.afterOrderOption[0]"}},[t._v("少量")]),s("el-radio",{attrs:{label:"多量"},model:{value:t.submitData.questions.afterOrderOption[0],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,0,e)},expression:"submitData.questions.afterOrderOption[0]"}},[t._v("多量")]),s("div",{staticClass:"is-show"},[t._v(" )")])],1)],1),s("div",{staticClass:"inline-ck"},[s("el-checkbox",{staticClass:"sp-ck",attrs:{label:"璧蝨"}},[t._v("璧蝨 ")]),s("div",{staticClass:"inline-ck-item"},[s("div",{staticClass:"is-show",staticStyle:{"padding-right":"20px"}},[t._v("( ")]),s("el-radio",{attrs:{label:"少量"},model:{value:t.submitData.questions.afterOrderOption[1],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,1,e)},expression:"submitData.questions.afterOrderOption[1]"}},[t._v("少量")]),s("el-radio",{attrs:{label:"多量"},model:{value:t.submitData.questions.afterOrderOption[1],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,1,e)},expression:"submitData.questions.afterOrderOption[1]"}},[t._v("多量")]),s("div",{staticClass:"is-show"},[t._v(" )")])],1)],1),s("div",{staticClass:"inline-ck"},[s("el-checkbox",{staticClass:"sp-ck",attrs:{label:"耳炎"}},[t._v("耳炎")]),s("div",{staticClass:"inline-ck-item"},[s("div",{staticClass:"is-show",staticStyle:{"padding-right":"20px"}},[t._v("( ")]),s("el-radio",{attrs:{label:"輕微"},model:{value:t.submitData.questions.afterOrderOption[2],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,2,e)},expression:"submitData.questions.afterOrderOption[2]"}},[t._v("輕微")]),s("el-radio",{attrs:{label:"嚴重"},model:{value:t.submitData.questions.afterOrderOption[2],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,2,e)},expression:"submitData.questions.afterOrderOption[2]"}},[t._v("嚴重")]),s("div",{staticClass:"is-show"},[t._v(" )")])],1)],1),s("div",{staticClass:"inline-ck"},[s("el-checkbox",{staticClass:"sp-ck",attrs:{label:"耳疥"}},[t._v("耳疥 ")]),s("div",{staticClass:"inline-ck-item"},[s("div",{staticClass:"is-show",staticStyle:{"padding-right":"20px"}},[t._v("( ")]),s("el-radio",{attrs:{label:"輕微"},model:{value:t.submitData.questions.afterOrderOption[3],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,3,e)},expression:"submitData.questions.afterOrderOption[3]"}},[t._v("輕微")]),s("el-radio",{attrs:{label:"嚴重"},model:{value:t.submitData.questions.afterOrderOption[3],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,3,e)},expression:"submitData.questions.afterOrderOption[3]"}},[t._v("嚴重")]),s("div",{staticClass:"is-show"},[t._v(" )")])],1)],1),s("div",{staticClass:"inline-ck"},[s("el-checkbox",{staticClass:"sp-ck",attrs:{label:"眼睛"}},[t._v("眼睛")]),s("el-checkbox-group",{staticClass:"inline-ck-item",model:{value:t.submitData.questions.afterOrderOption[4],callback:function(e){t.$set(t.submitData.questions.afterOrderOption,4,e)},expression:"submitData.questions.afterOrderOption[4]"}},[s("div",{staticClass:"is-show",staticStyle:{"padding-right":"20px"}},[t._v("( ")]),s("el-checkbox",{attrs:{label:"紅眼"}},[t._v("紅眼")]),s("el-checkbox",{attrs:{label:"分泌物"}},[t._v("分泌物")]),s("el-checkbox",{attrs:{label:"毛渣凝塊"}},[t._v("毛渣凝塊")]),s("el-checkbox",{attrs:{label:"闔眼"}},[t._v("闔眼")]),s("div",{staticClass:"is-show",staticStyle:{"padding-left":"25px"}},[t._v(" )")])],1)],1)],1)],1),s("el-form-item",{attrs:{label:"善後處理"}},[s("el-checkbox-group",{model:{value:t.submitData.questions.handle,callback:function(e){t.$set(t.submitData.questions,"handle",e)},expression:"submitData.questions.handle"}},[s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"已上藥"}},[t._v("已上藥")]),s("el-checkbox",{staticClass:"sp-ck",staticStyle:{width:"50%"},attrs:{label:"經醫師看診"}},[t._v("經醫師看診")])],1)],1),s("el-form-item",{attrs:{label:"備註",prop:"content"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.submitData.content,callback:function(e){t.$set(t.submitData,"content",e)},expression:"submitData.content"}})],1)],1),s("div",{staticClass:"btn-group-inline"},[s("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.handleDrawerClosed}},[t._v("取消")]),s("el-button",{staticClass:"is-round",attrs:{loading:t.tryingSave,disabled:t.tryingSave,type:"primary"},on:{click:t.handleSave}},[t._v("儲存")])],1)],1)],1)],1)},a=[],n=s("f210"),r=s("4795"),o=s.n(r),l=s("cb0c"),c=s("a315"),u=s("7e02"),d=s("3fa5"),m=s("6bea"),h={components:{ImageUpload:function(){return Object(c["a"])(s.e("chunk-2b422df4").then(s.bind(null,"9529")))}},filters:{formatDate:m["a"],genderFilter:u["h"]},props:{pet:{type:Number,default:null},order:{type:Object,default:function(){}},type:{type:String,default:""}},data:function(){return{commentList:[],submitData:{images:[],content:"",uuid:"",questions:{afterOrderOption:[null,null,null,null,[]],afterOrder:[],handle:[]}},mode:"new",shareLink:"",commentId:"",fileList:[],drawerVisible:!1,dialogSendVisible:!1,dialogImgVisible:!1,tryingFetchList:!1,tryingSave:!1,tryToGetLink:!1,dialogImageUrl:"",listOrderId:""}},computed:{orderId:function(){return this.order.id},submitRules:function(){return{content:[{required:0===this.fileList.length,message:"請填寫備註或上傳圖片"}]}},isOwer:function(){return this.$store.state.auth.currentUser.groups.includes(7)},userId:function(){return this.$store.state.auth.currentUser.id}},watch:{},created:function(){this.tryToFetchList()},methods:{afterOrder:function(t){var e=[];return t.afterOrder.forEach(function(s){if("正常"===s&&e.push("正常"),"皮膚病"===s&&e.push("皮膚病"),"指甲流血"===s&&e.push("指甲流血"),"剃傷"===s&&e.push("剃傷"),"跳蚤"===s){var i="";i=t.afterOrderOption[0]?"跳蚤(".concat(t.afterOrderOption[0],")"):"跳蚤",e.push(i)}if("璧蝨"===s){var a="";a=t.afterOrderOption[1]?"璧蝨(".concat(t.afterOrderOption[1],")"):"璧蝨",e.push(a)}if("耳炎"===s){var n="";n=t.afterOrderOption[2]?"耳炎(".concat(t.afterOrderOption[2],")"):"耳炎",e.push(n)}if("耳疥"===s){var r="";r=t.afterOrderOption[3]?"耳疥(".concat(t.afterOrderOption[3],")"):"耳疥",e.push(r)}if("眼睛"===s){var o="";o=t.afterOrderOption[4].length>0?"眼睛(".concat(t.afterOrderOption[4].join(","),")"):"眼睛",e.push(o)}}),e.join("，")},tryToFetchList:function(){var t=Object(l["a"])(o.a.mark(function t(e){var s;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return s={paginate:0},"order"===this.type?s["orderId"]=this.orderId:"pet"===this.type&&(s["petId"]=this.pet),t.prev=2,this.tryingFetchList=!0,t.next=6,this.$store.dispatch("petComment/fetchList",s);case 6:this.commentList=t.sent,t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](2);case 11:return t.prev=11,this.tryingFetchList=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[2,9,11,14]])}));return function(e){return t.apply(this,arguments)}}(),handleDrawerClosed:function(){this.$refs.drawer.handleClose()},handleSave:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,s,i,a,r,l;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.form.validate();case 2:if(e="",e=this.order?this.orderId:this.listOrderId,t.prev=4,s={},i=[],this.fileList.forEach(function(t){-1===t.url.indexOf("blob")&&i.push(t.url)}),0!==this.$refs.upload.cacheList.length){t.next=12;break}s=this.submitData.uuid?{orderNo:e,uuid:this.submitData.uuid,images:i,questions:this.submitData.questions,content:this.submitData.content}:{orderNo:e,images:i,questions:this.submitData.questions,content:this.submitData.content},t.next=18;break;case 12:return t.next=14,this.$refs.upload.handleUpload();case 14:a=t.sent,r=new Set(i.concat(Object(n["a"])(a))),l=Object(n["a"])(r),s=this.submitData.uuid?{orderNo:e,images:l,questions:this.submitData.questions,uuid:this.submitData.uuid,content:this.submitData.content}:{orderNo:e,images:l,questions:this.submitData.questions,content:this.submitData.content};case 18:return this.tryingSave=!0,t.next=21,this.$store.dispatch("petComment/store",s);case 21:this.submitData.uuid?Object(d["b"])("edit"):Object(d["b"])("add"),this.drawerVisible=!1,this.tryToFetchList(),this.$emit("emitFetch"),t.next=29;break;case 27:t.prev=27,t.t0=t["catch"](4);case 29:return t.prev=29,this.tryingSave=!1,t.finish(29);case 32:case"end":return t.stop()}},t,this,[[4,27,29,32]])}));return function(){return t.apply(this,arguments)}}(),openEdit:function(t,e){var s=this;"edit"===t?(this.mode="edit",this.drawerVisible=!0,this.order||(this.listOrderId=e.orderNo),this.$nextTick(function(){s.submitData.images=e.images,s.submitData.content=e.content,s.submitData.uuid=e.id,e.questions?s.submitData.questions=e.questions:s.submitData.questions={afterOrderOption:[null,null,null,null,[]],afterOrder:[],handle:[]},s.tryToGetFileList(s.submitData.images)})):(this.mode="new",this.drawerVisible=!0,this.$nextTick(function(){s.submitData.uuid="",s.submitData.images=[],s.submitData.content="",s.submitData.questions={afterOrderOption:[null,null,null,null,[]],afterOrder:[],handle:[]},s.tryToGetFileList([])}))},tryToGetFileList:function(t){0===t.length?this.fileList=[]:this.fileList=t.map(function(t){return{url:t}})},updateFileList:function(t){this.fileList=Object(n["a"])(this.fileList).concat([t])},tryToSendComment:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$confirm("確定要發送簡訊","提示",{confirmButtonText:"確定",showCancelButton:!0,type:"warning",center:!0});case 3:return t.next=5,this.$store.dispatch("petComment/sendComment",{uuid:e});case 5:this.$message({message:"發送成功！",type:"success"}),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:return t.prev=10,this.dialogSendVisible=!1,t.finish(10);case 13:case"end":return t.stop()}},t,this,[[0,8,10,13]])}));return function(e){return t.apply(this,arguments)}}(),handlePreview:function(t){this.dialogImageUrl=t,this.dialogImgVisible=!0},openSendDialog:function(t){this.dialogSendVisible=!0,this.commentId=t,this.tryToGetShareLink(t)},tryToGetShareLink:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryToGetLink=!0,t.next=3,this.$store.dispatch("petComment/getLink",{uuid:e});case 3:this.shareLink=t.sent,this.tryToGetLink=!1;case 5:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),copyShareLink:function(){var t=document.createElement("INPUT");document.body.appendChild(t),t.setAttribute("value",this.shareLink),t.select(),document.execCommand("copy"),document.body.removeChild(t),this.$message("連結複製成功")}}},p=h,b=s("962a"),f=s("2877");function v(t){this["$style"]=b["default"].locals||b["default"]}var _=Object(f["a"])(p,i,a,!1,v,null,null);e["default"]=_.exports},"856f":function(t,e,s){t.exports={slide:"PetCommentList_slide_9gk-T","slide-reverse":"PetCommentList_slide-reverse_22fnL",CommentSection:"PetCommentList_CommentSection_2mbLO",comment:"PetCommentList_comment_2kGJI",share__buttons:"PetCommentList_share__buttons_3g_DM",share__button:"PetCommentList_share__button_1el5R",share__icon:"PetCommentList_share__icon_27cba",share__label:"PetCommentList_share__label_3uBdj"}},"962a":function(t,e,s){"use strict";var i=s("856f"),a=s.n(i);e["default"]=a.a}}]);
//# sourceMappingURL=chunk-838dbece.763ee206.js.map