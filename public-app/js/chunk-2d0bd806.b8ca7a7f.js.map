{"version":3,"sources":["webpack:///./src/router/views/schedule/components/MemberOrdersPrepaid.vue?dbd1","webpack:///src/router/views/schedule/components/MemberOrdersPrepaid.vue","webpack:///./src/router/views/schedule/components/MemberOrdersPrepaid.vue?3c7c","webpack:///./src/router/views/schedule/components/MemberOrdersPrepaid.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","directives","name","rawName","value","expression","modifiers","fullscreen","lock","attrs","element-loading-text","data","loadedOrders","default-sort","prop","order","row-class-name","calcRowClassName","on","row-click","tryToGetOrder","sort-change","sortChange","label","min-width","sortable","scopedSlots","_u","key","fn","ref","row","_v","_s","_f","created","prepaidTitle","total","times","used","current-page","currentPage","update:currentPage","$event","update:current-page","visible","drawerVisible","append-to-body","size","$root","isSmallDevice","update:visible","slot","default-value","drawerOrderData","update:defaultValue","update:default-value","update","tryToSearchOrder","staticRenderFns","MemberOrdersPrepaidvue_type_script_lang_js_","components","PortalTarget","portal_vue_common","BaseStateLabel","Object","lazyload_component","__webpack_require__","e","then","bind","OrderDetail","filters","orderStatusFilter","filter_value_to_text","orderSourceFilter","orderPaymentMethodFilter","formatDate","format_date","mixins","pagination","props","memberInfoId","type","String","default","tryingToGetOrder","filterData","order_by","watch","handler","immediate","methods","_ref","orderStatus","status","orderUsedStatus","groupSize","usedSize","_tryToGetOrder","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","$store","dispatch","id","sent","stop","_x","apply","arguments","_tryToSearchOrder","_callee2","_ref2","items","_this","_context2","assign","memberId","paymentMethod","pageQuery","$nextTick","$refs","updateTotal","_ref3","column","components_MemberOrdersPrepaidvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/chunk-2d0bd806.b8ca7a7f.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:\"el-table-wrapper\"},[_c('el-table',{directives:[{name:\"loading\",rawName:\"v-loading.fullscreen.lock\",value:(_vm.tryingToGetOrder),expression:\"tryingToGetOrder\",modifiers:{\"fullscreen\":true,\"lock\":true}}],attrs:{\"element-loading-text\":\"取得訂單資訊中\",\"data\":_vm.loadedOrders,\"default-sort\":{ prop: 'date', order: 'descending' },\"row-class-name\":_vm.calcRowClassName},on:{\"row-click\":_vm.tryToGetOrder,\"sort-change\":_vm.sortChange}},[_c('el-table-column',{attrs:{\"label\":\"#訂單編號\",\"prop\":\"created_at\",\"min-width\":\"160\",\"sortable\":\"custom\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar row = ref.row;\nreturn [_c('div',[_vm._v(_vm._s((\"#\" + (row.orderNo))))]),_c('div',[_vm._v(_vm._s(_vm._f(\"formatDate\")(row.created,'dateTime')))])]}}])}),_c('el-table-column',{attrs:{\"min-width\":\"150\",\"label\":\"包月方案/次數與期限\"},scopedSlots:_vm._u([{key:\"default\",fn:function(ref){\nvar row = ref.row;\nreturn [_c('div',[_c('b',[_vm._v(_vm._s(row.prepaidTitle))])]),_c('div',[_vm._v(\"$\"+_vm._s(row.total))]),_c('div',[_c('b',[_vm._v(\"剩餘：\"+_vm._s(row.times - row.used)+\" / \"+_vm._s(row.times))])])]}}])})],1)],1),_c('BasePagination',{ref:\"pagination\",attrs:{\"current-page\":_vm.currentPage},on:{\"update:currentPage\":function($event){_vm.currentPage=$event},\"update:current-page\":function($event){_vm.currentPage=$event}}}),_c('el-drawer',{attrs:{\"visible\":_vm.drawerVisible,\"append-to-body\":\"\",\"size\":_vm.$root.isSmallDevice ? '100%' : '50%'},on:{\"update:visible\":function($event){_vm.drawerVisible=$event}}},[_c('PortalTarget',{attrs:{\"slot\":\"title\",\"name\":\"drawer-prepaid-header\"},slot:\"title\"}),_c('OrderDetail',{ref:\"orderDetail\",attrs:{\"default-value\":_vm.drawerOrderData},on:{\"update:defaultValue\":function($event){_vm.drawerOrderData=$event},\"update:default-value\":function($event){_vm.drawerOrderData=$event},\"update\":_vm.tryToSearchOrder}})],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport lazyLoadComponent from '@router/lazyload-component'\nimport {\n  orderStatusFilter,\n  orderSourceFilter,\n  orderPaymentMethodFilter,\n} from '@utils/filter-value-to-text'\nimport formatDate from '@utils/format-date'\nimport pageMixin from '@src/mixins/pagination'\nimport { PortalTarget } from 'portal-vue'\n\nexport default {\n  components: {\n    PortalTarget,\n    BaseStateLabel: () =>\n      lazyLoadComponent(import('@components/BaseStateLabel')),\n    OrderDetail: () =>\n      lazyLoadComponent(import('@components/PrepaidOrderDetail')),\n  },\n  filters: {\n    orderStatusFilter,\n    orderSourceFilter,\n    orderPaymentMethodFilter,\n    formatDate,\n  },\n  mixins: [pageMixin],\n  props:{\n    memberInfoId:{\n      type:String,\n      default:''\n    }\n  },\n  data() {\n    return {\n      loadedOrders: [],\n      tryingToGetOrder: false,\n      drawerVisible: false,\n      drawerOrderData: '',\n      filterData:{\n        order_by:'created_at',\n        order:'desc'\n      }\n    }\n  },\n\n  watch: {\n    currentPage: {\n      handler: 'tryToSearchOrder',\n      immediate: true,\n    },\n  },\n  methods: {\n    calcRowClassName({ row }) {\n      const orderStatus = row.status\n      const orderUsedStatus = row.groupSize / row.usedSize\n\n      if (orderStatus === 0) return 'order--canceled'\n      if (orderUsedStatus === 1) return 'order--used'\n    },\n    async tryToGetOrder(row) {\n      this.tryingToGetOrder = true\n      this.drawerOrderData = await this.$store.dispatch(\n        'prepaid/fetchOrderSingle',\n        row.id\n      )\n      this.tryingToGetOrder = false\n      this.drawerVisible = true\n    },\n    async tryToSearchOrder() {\n      const { items, total } = await this.$store.dispatch(\n        'prepaid/fetchOrders',\n        Object.assign(\n          { \n            memberId: this.memberInfoId, \n            paymentMethod: 'All' ,\n            order_by:this.filterData.order_by,\n            order:this.filterData.order,\n          },\n          this.pageQuery\n        )\n      )\n      this.loadedOrders = items\n      this.$nextTick(() => {\n        this.$refs.pagination.updateTotal(total)\n      })\n    },\n     sortChange({column, prop, order}){\n      if(order){\n  \n        this.filterData.order_by = prop\n        this.filterData.order = order==='ascending'?'asc':'desc'\n        this.currentPage=1\n        this.tryToSearchOrder()\n      }\n      // console.log(column, prop, order)\n    }\n  },\n}\n</script>\n\n<template>\n  <div>\n    <div class=\"el-table-wrapper\">\n    <el-table\n      v-loading.fullscreen.lock=\"tryingToGetOrder\"\n      element-loading-text=\"取得訂單資訊中\"\n      :data=\"loadedOrders\"\n      :default-sort=\"{ prop: 'date', order: 'descending' }\"\n      :row-class-name=\"calcRowClassName\"\n      @row-click=\"tryToGetOrder\"\n       @sort-change=\"sortChange\"\n    >\n      <el-table-column v-slot=\"{ row }\" label=\"#訂單編號\" prop=\"created_at\" min-width=\"160\" sortable=\"custom\">\n        <div>{{ `#${row.orderNo}` }}</div>\n        <div>{{ row.created | formatDate('dateTime') }}</div>\n      </el-table-column>\n\n\n      <el-table-column v-slot=\"{ row }\" min-width=\"150\" label=\"包月方案/次數與期限\">\n        <div>\n          <b>{{ row.prepaidTitle }}</b>\n          \n        </div>\n        <div>${{ row.total }}</div>\n        <div><b>剩餘：{{ row.times - row.used }} / {{ row.times }}</b></div>\n      </el-table-column>\n      <!-- <el-table-column v-slot=\"{ row }\" min-width=\"140\" label=\"次數與期限\">\n        <div>\n          <b>剩餘：{{ row.times - row.used }} / {{ row.times }}</b>\n        </div>\n        <div v-if=\"row.status === 1\">到期：{{row.expiredDate ? row.expiredDate : '' | formatDate}}{{row.expiredDate ? '' : '無使用期限' }}</div>\n      </el-table-column> -->\n\n    </el-table>\n    </div>\n    <BasePagination ref=\"pagination\" :current-page.sync=\"currentPage\" />\n    <el-drawer :visible.sync=\"drawerVisible\" append-to-body :size=\"$root.isSmallDevice ? '100%' : '50%'\">\n      <!-- header -->\n      <PortalTarget slot=\"title\" name=\"drawer-prepaid-header\"></PortalTarget>\n      <OrderDetail\n        ref=\"orderDetail\"\n        :default-value.sync=\"drawerOrderData\"\n        @update=\"tryToSearchOrder\"\n      />\n    </el-drawer>\n  </div>\n</template>\n","import mod from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MemberOrdersPrepaid.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../../node_modules/thread-loader/dist/cjs.js!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./MemberOrdersPrepaid.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./MemberOrdersPrepaid.vue?vue&type=template&id=380bd516&\"\nimport script from \"./MemberOrdersPrepaid.vue?vue&type=script&lang=js&\"\nexport * from \"./MemberOrdersPrepaid.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}