(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b4550cd6"],{"3c0c":function(e,t,i){"use strict";var s=i("d10e"),n=i.n(s);t["default"]=n.a},b127:function(e,t,i){"use strict";function s(e){if(Array.isArray(e))return e}function n(e,t){var i=[],s=!0,n=!1,a=void 0;try{for(var r,c=e[Symbol.iterator]();!(s=(r=c.next()).done);s=!0)if(i.push(r.value),t&&i.length===t)break}catch(d){n=!0,a=d}finally{try{s||null==c["return"]||c["return"]()}finally{if(n)throw a}}return i}function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function r(e,t){return s(e)||n(e,t)||a()}i.d(t,"a",function(){return r})},c612:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-popover",{attrs:{placement:"bottom",title:"貼標籤：",width:"200",trigger:"click"}},[i("div",{class:e.$style.popover},[i("el-input",{attrs:{clearable:""},on:{input:e.onSearch,clear:e.tryToFetchList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),i("div",{class:e.$style.list},[i("el-checkbox-group",{on:{change:e.onChanged},model:{value:e.selectedTag,callback:function(t){e.selectedTag=t},expression:"selectedTag"}},e._l(e.tagList,function(t,s){return i("el-checkbox",{key:"box-"+s,class:e.$style.checkbox,attrs:{label:t.id,disabled:0===e.selectedMember.length,indeterminate:e.showIndeterminate(t.id)}},[e._v(e._s(t.title))])}),1)],1),i("el-divider"),e.selectedMember.length&&!e.showManageBtn?i("div",{staticStyle:{"margin-bottom":"5px"}},[i("div",[i("el-button",{staticClass:"is-round",staticStyle:{width:"100%"},attrs:{loading:e.tryingApply,type:"primary",plain:""},on:{click:e.tryToApply}},[e._v("套 用")])],1)]):e._e(),e.showManageBtn?i("el-link",{staticStyle:{padding:"10px 0",width:"100%","justify-content":"left"},attrs:{underline:!1},on:{click:function(t){e.dialogVisible=!0}}},[e._v("新增 / 管理標籤")]):e._e(),i("TagManagment",{attrs:{"dialog-visible":e.dialogVisible},on:{"update:dialogVisible":function(t){e.dialogVisible=t},"update:dialog-visible":function(t){e.dialogVisible=t}}})],1),i("el-button",{staticClass:"is-round",attrs:{slot:"reference",plain:""},slot:"reference"},[i("BaseIcon",{attrs:{name:"user-tag"}}),i("span",[e._v("標籤管理 ")]),i("BaseIcon",{attrs:{name:"caret-down"}})],1)],1)},n=[],a=i("b127"),r=i("f210"),c=i("4795"),d=i.n(c),l=i("cb0c"),o=i("a315"),h=i("2ef0"),u={components:{TagManagment:function(){return Object(o["a"])(i.e("chunk-2d73098a").then(i.bind(null,"7945")))}},props:{selectedMember:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,keyword:"",tagList:[],selectedTag:[],selectedTagClone:[],selectedTagPrevious:[],tryingApply:!1,tryingFetch:!1,addList:new Set,addListTracker:1,deleteList:new Set,deleteListTracker:1}},computed:{tagRecord:function(){var e={};return this.tagList.forEach(function(t){e["id_".concat(t.id)]=0}),this.selectedMember.forEach(function(t){t.tags.forEach(function(t){void 0!==e["id_".concat(t.id)]&&e["id_".concat(t.id)]++})}),e},showManageBtn:function(){return!this.isAddedOrDeleted&&this.isEqualArray(this.selectedTag,this.selectedTagClone)},isAddedOrDeleted:function(){return this.addListTracker&&this.addList.size>0||this.deleteListTracker&&this.deleteList.size>0}},watch:{selectedMember:function(e,t){this.checkSelectedTag()},dialogVisible:function(e){!1===e&&(this.tryToFetchList(),this.$emit("update"))}},created:function(){var e=this;this.tryToFetchList(),this.onSearch=Object(h["debounce"])(function(){var t=Object(l["a"])(d.a.mark(function t(i){return d.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.tryToFetchList(i);case 1:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),500)},methods:{tryToFetchList:function(){var e=Object(l["a"])(d.a.mark(function e(t){return d.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingFetch=!0,e.next=3,this.$store.dispatch("member/fetchTags",{search:t||this.keyword});case 3:this.tagList=e.sent,this.tryingFetch=!1,this.checkSelectedTag();case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tryToApply:function(){var e=Object(l["a"])(d.a.mark(function e(){var t,i;return d.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.isAddedOrDeleted){e.next=3;break}return this.$message({message:"請先選擇標籤",type:"warning"}),e.abrupt("return");case 3:if(!this.tryingApply){e.next=5;break}return e.abrupt("return");case 5:return this.tryingApply=!0,t=this.selectedMember.map(function(e){return e.id}),i={addIds:Object(r["a"])(this.addList),deleteIds:Object(r["a"])(this.deleteList),memberIds:t},e.next=10,this.$store.dispatch("member/applyTags",i);case 10:this.tryingApply=!1,this.$emit("update");case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),showIndeterminate:function(e){return!this.addList.has(e)&&!this.deleteList.has(e)&&(this.tagRecord["id_".concat(e)]>0&&this.tagRecord["id_".concat(e)]<this.selectedMember.length)},isIndeterminate:function(e){return this.tagRecord["id_".concat(e)]>0&&this.tagRecord["id_".concat(e)]<this.selectedMember.length},checkSelectedTag:function(){var e=this;this.selectedTag=[],this.tagList.forEach(function(t){e.selectedMember.length>0&&e.tagRecord["id_".concat(t.id)]===e.selectedMember.length&&e.selectedTag.push(t.id)}),this.selectedTagClone=Object(r["a"])(this.selectedTag),this.selectedTagPrevious=Object(r["a"])(this.selectedTag),this.addList.clear(),this.deleteList.clear(),this.$nextTick(function(){e.$forceUpdate()})},onChanged:function(){var e=this;this.isAdd(),this.isDelete(),this.selectedTagPrevious=Object(r["a"])(this.selectedTag),this.$nextTick(function(){e.$forceUpdate()})},isEqualArray:function(e,t){return e.length===t.length&&e.every(function(e,i){return e===t[i]})},isAdd:function(){var e=this,t=this.selectedTag.filter(function(t){return!e.selectedTagPrevious.includes(t)}),i=Object(a["a"])(t,1),s=i[0];s&&(this.selectedTagClone.includes(s)?this.deleteList.delete(s):this.deleteList.has(s)?(this.selectedTag=Object(r["a"])(this.selectedTag.filter(function(e){return e!==s})),this.selectedTagPrevious=Object(r["a"])(this.selectedTag),this.deleteList.delete(s)):this.addList.add(s)),this.addListTracker+=1},isDelete:function(){var e=this,t=this.selectedTagPrevious.filter(function(t){return!e.selectedTag.includes(t)}),i=Object(a["a"])(t,1),s=i[0];s&&((this.isIndeterminate(s)||this.selectedTagClone.includes(s))&&this.deleteList.add(s),this.addList.delete(s)),this.deleteListTracker+=1}}},g=u,p=i("3c0c"),f=i("2877");function b(e){this["$style"]=p["default"].locals||p["default"]}var y=Object(f["a"])(g,s,n,!1,b,null,null);t["default"]=y.exports},d10e:function(e,t,i){e.exports={slide:"TagPopover_slide_1yB1V","slide-reverse":"TagPopover_slide-reverse_1Z_6-",popover:"TagPopover_popover_EcEBv",list:"TagPopover_list_2Qu-t",checkbox:"TagPopover_checkbox_S3iVt"}}}]);
//# sourceMappingURL=chunk-b4550cd6.e187b81b.js.map