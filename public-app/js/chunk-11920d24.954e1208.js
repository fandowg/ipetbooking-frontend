(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-11920d24"],{"3a19":function(t,e,a){"use strict";var s=a("9b1d"),i=a.n(s);e["default"]=i.a},"9b1d":function(t,e,a){t.exports={slide:"Orders_slide_3Rydv","slide-reverse":"Orders_slide-reverse_3aZ69",title:"Orders_title_1jn3r",info:"Orders_info_2YzdI",question:"Orders_question_3aMFR",params:"Orders_params_2Ohmz",params__item:"Orders_params__item_25n90",total:"Orders_total_2iJFb",total__item:"Orders_total__item_3uvk7","total__item--discount":"Orders_total__item--discount_1_3Vx",payment:"Orders_payment_2_rf3",invoice:"Orders_invoice_35V43"}},bd32:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.$style.service},[a("BaseCollapse",{attrs:{title:"預約訂單","order-theme":!0,expanded:!0}},[a("div",{class:t.$style.params},[a("div",{class:t.$style["params__item"]},[a("div",[t._v("訂購項目")]),a("div",[t._v("售價")]),a("div",[t._v("數量")]),t.isPaidByPrepaid?t._e():a("div",[t._v("小計")])]),t._l(t.defaultValue.params,function(e){return a("div",{key:e.id,class:t.$style["params__item"]},[a("div",[t._v(t._s(e.title))]),a("div",{staticClass:"Jost"},[t._v(t._s(e.price))]),a("div",{staticClass:"Jost"},[t._v(t._s("x"+e.qty))]),t.isPaidByPrepaid?t._e():a("div",{staticClass:"Jost"},[t._v(t._s(e.price*e.qty))])])}),t.isPaidByPrepaid?[a("div",{class:t.$style.total},[a("div",{class:t.$style["total__item"]},[a("div",[t._v("使用方案")]),a("div",[t._v(t._s(t.defaultValue.prepaid.title))])]),a("div",{class:t.$style["total__item"]},[a("div",[t._v("使用次數")]),a("div",{staticClass:"Jost"},[t._v(t._s(t.defaultValue.groupSize))])])])]:[a("div",{class:t.$style.total},[a("div",{class:t.$style["total__item"]},[a("div",[t._v("小計")]),a("div",{staticClass:"Jost"},[t._v(t._s(t.defaultValue.priceBase))])]),t.defaultValue.hasOwnProperty("coupon")?a("div",{class:[t.$style["total__item"],t.$style["total__item--discount"]]},[a("div",[t._v(t._s(t.defaultValue.coupon.title+"（"+t.defaultValue.coupon.code+"）"))]),a("div",{staticClass:"Jost"},[t._v(t._s("-"+t.defaultValue.coupon.discountValue))])]):t._e(),t.defaultValue.refundHistories.length>0?t._l(t.defaultValue.refundHistories,function(e,s){return a("div",{key:s,class:t.$style["total__item"]},[a("div",{staticClass:"alert-word"},[t._v(t._s(e.refundDate)+"退款")]),a("div",{staticClass:"Jost alert-word"},[t._v("-"+t._s(e.Amt))])])}):t._e()],2),a("div",{class:t.$style.total},[a("div",{class:t.$style["total__item"]},[a("div",[t._v("付款金額")]),t.defaultValue.paidAt?a("div",{staticClass:"Jost"},[t._v(t._s(t.defaultValue.backBalance))]):t._e(),t.defaultValue.paidAt||0===t.defaultValue.status?t._e():a("div",{staticClass:"Jost"},[t._v(t._s(t.defaultValue.priceTotal))]),t.defaultValue.paidAt||0!==t.defaultValue.status?t._e():a("div",{staticClass:"Jost"},[t._v("0")])])])]],2),a("BaseCollapse",{class:t.$style.payment,attrs:{title:"付款資訊"}},[a("ul",{staticStyle:{padding:"0 25px","padding-bottom":"10px"}},[a("li",[a("span",{staticClass:"title"},[t._v("付款方式")]),a("span",{staticClass:"content"},[t._v(t._s(t.orderPaymentMethodMap[t.defaultValue.paymentMethod]||"不指定"))]),t.defaultValue.prepaid?a("span",["Prepaid"===t.defaultValue.paymentMethod?a("span",{staticStyle:{color:"lightgray"}},[t._v("（"+t._s(t.defaultValue.prepaid.title)+"）")]):t._e()]):t._e()]),"Prepaid"===t.defaultValue.paymentMethod&&t.defaultValue.prepaid?a("li",[a("span",{staticClass:"title"},[t._v("抵扣次數")]),a("span",{staticClass:"content"},[t._v(t._s(t.defaultValue.prepaid.deductTimes)+" 次 ")])]):t._e(),a("li",[a("span",{staticClass:"title"},[t._v("付款時間")]),a("span",{staticClass:"content"},[t._v(t._s(t.paidAt))])]),"Vacc"!==t.defaultValue.paymentMethod&&"Prepaid"!==t.defaultValue.paymentMethod?a("li",[a("span",{staticClass:"title"},[t._v("付款期限")]),a("span",{staticClass:"content"},[t._v(t._s(t.paymentExpiredDate))])]):t._e(),t.defaultValue.Vacc?[a("li",{staticStyle:{"border-top":"1px solid #dcdfe6"}},[a("span",{staticClass:"title"},[t._v("轉帳銀行")]),a("span",{staticClass:"content"},[t._v(t._s(t.defaultValue.Vacc.Bank+" "+t.defaultValue.Vacc.BankCode))])]),a("li",[a("span",{staticClass:"title"},[t._v("轉帳帳號")]),a("span",{staticClass:"content"},[t._v(t._s(t.defaultValue.Vacc.VACCNo))])]),a("li",[a("span",{staticClass:"title"},[t._v("轉帳期限")]),a("span",{staticClass:"content"},[t._v(t._s(t._f("formatDate")(t.defaultValue.paymentExpiredDate,"dateTime")))])])]:t._e()],2)]),a("div",{staticClass:"btn-group-inline"},[0!==t.defaultValue.status?a("el-button",{staticClass:"is-round is-fullwidth",staticStyle:{"margin-top":"24px"},attrs:{type:"primary",plain:""},on:{click:t.handlerDrawerOpen}},[t._v("編輯訂單")]):t._e(),t.defaultValue.paidAt&&"Prepaid"!==t.defaultValue.paymentMethod&&0!==t.defaultValue.backBalance?a("el-button",{staticClass:"is-round",staticStyle:{"margin-top":"24px"},on:{click:t.openRefundDialog}},[t._v("退款記錄")]):t._e()],1)],1),a("BaseCollapse",{attrs:{title:"訂單變更紀錄","order-theme":!0}},[a("el-timeline",t._l(t.defaultValue.history,function(e){return a("el-timeline-item",{key:e.id,attrs:{timestamp:t._f("formatDate")(e.created,"dateTime"),type:"primary",placement:"top"}},[t._v("\n        "+t._s(e.description)+"\n        "),a("span",{staticStyle:{"font-size":"13px"}},[e.creator?a("span",[t._v("- "+t._s(e.creator))]):t._e()]),e.note?a("div",[t._v(t._s(e.note))]):t._e()])}),1)],1),a("el-drawer",{ref:"drawer",staticClass:"no-header",attrs:{visible:t.drawerVisible,"append-to-body":"",size:t.$root.isSmallDevice?"100%":"50%","destroy-on-close":""},on:{"update:visible":function(e){t.drawerVisible=e}}},[a("el-page-header",{attrs:{content:"編輯訂單"},on:{back:t.handleDrawerClosed}}),a("el-divider"),a("Info",{attrs:{"default-value":t.defaultValue}}),a("OrderForm",{attrs:{"default-value":t.drawerOrderData},on:{store:t.handleStore,cancel:t.handleDrawerClosed}})],1),a("el-dialog",{attrs:{title:"退款",visible:t.refundDialogVisible,top:"0","append-to-body":""},on:{"update:visible":function(e){t.refundDialogVisible=e}}},[a("el-form",{ref:"refundForm",staticClass:"el-form--floating",attrs:{rules:t.refundRules,model:t.refundSubmitData,"label-position":"top"}},[a("el-form-item",{staticStyle:{"margin-top":"20px"},attrs:{label:"退款金額",prop:"amount"}},[a("el-input",{attrs:{disabled:!t.canPartialRefund,placeholder:""},model:{value:t.refundSubmitData.amount,callback:function(e){t.$set(t.refundSubmitData,"amount",e)},expression:"refundSubmitData.amount"}},[a("span",{staticStyle:{"padding-right":"10px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("元")])]),a("span",{staticClass:"alert-word"},[t._v("上限為"+t._s(t.defaultValue.backBalance)+"元")])],1),a("el-form-item",{attrs:{label:"退款日期",prop:"refundDate"}},[a("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"選擇日期"},model:{value:t.refundSubmitData.refundDate,callback:function(e){t.$set(t.refundSubmitData,"refundDate",e)},expression:"refundSubmitData.refundDate"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"退款原因"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:""},model:{value:t.refundSubmitData.note,callback:function(e){t.$set(t.refundSubmitData,"note",e)},expression:"refundSubmitData.note"}}),a("p",[t._v("除「信用卡」付款之外，其他所有支付方式若需退款服務，皆須透過店家進行線下退款。")])],1)],1),a("div",{staticClass:"bottom-btn-center"},[a("el-button",{staticClass:"is-round",on:{click:function(e){t.refundDialogVisible=!1}}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:function(e){return t.tryToRefund(t.defaultValue.id)}}},[t._v("確認退款記錄")])],1)],1)],1)},i=[],l=a("4795"),n=a.n(l),r=a("cb0c"),d=a("a315"),u=a("7e02"),o=a("6bea"),c=a("0644"),f=a.n(c),p={components:{BaseCollapse:function(){return Object(d["a"])(a.e("chunk-f797d1f4").then(a.bind(null,"da06")))},Addition:function(){return Object(d["a"])(a.e("chunk-ceab2aee").then(a.bind(null,"6f10")))},OrderForm:function(){return Object(d["a"])(Promise.all([a.e("chunk-3f4a3bbc"),a.e("chunk-6bf782f0")]).then(a.bind(null,"075c")))},Info:function(){return Object(d["a"])(a.e("chunk-af7ea718").then(a.bind(null,"cb6f")))}},filters:{formatDate:o["a"],genderFilter:u["h"]},props:{defaultValue:{type:Object,default:function(){}}},data:function(){return{orderPaymentMethodMap:u["l"],drawerVisible:!1,drawerOrderData:{},taxTypeMap:u["B"],carrierTypeMap:u["c"],refund:{total:3999},refundSubmitData:{refundDate:"",amount:"",note:""},refundDialogVisible:!1,isRefund:!1,tryingRefund:!1}},computed:{isEmptyByOrderExtrafields:function(){return this.defaultValue.byOrderExtrafields instanceof Array},isPaidByPrepaid:function(){return"prepaid"===this.defaultValue.paymentMethod&&this.defaultValue.prepaid},paidAt:function(){return!1===!!this.defaultValue.paidAt?"無":Object(o["a"])(this.defaultValue.paidAt,"dateTime")},paymentExpiredDate:function(){return 1===this.defaultValue.allowExpired?"無（可逾期付款）":Object(o["a"])(this.defaultValue.paymentExpiredDate,"dateTime")},canPartialRefund:function(){return this.defaultValue.canPartialRefund},refundRules:function(){return{refundDate:[{required:!0,message:"請選擇日期"}],amount:[{required:!0,message:"請輸入退款金額"}]}}},created:function(){},methods:{handleDrawerClosed:function(){this.$refs.drawer.handleClose()},handleStore:function(){this.$emit("update"),this.handleDrawerClosed()},handlerDrawerOpen:function(){this.drawerOrderData=f()(this.defaultValue),this.drawerVisible=!0},openRefundDialog:function(){this.refundDialogVisible=!0,this.canPartialRefund||(this.refundSubmitData.amount=this.defaultValue.backBalance)},tryToRefund:function(){var t=Object(r["a"])(n.a.mark(function t(e){return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.refundForm.validate();case 2:if(!(this.refundSubmitData.amount>this.defaultValue.backBalance)){t.next=5;break}return this.$confirm("退款金額不能超過可退款金額","提示",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0}),t.abrupt("return");case 5:return t.prev=5,this.tryingRefund=!0,t.next=9,this.$store.dispatch("order/refundOrder",{id:e,refundData:this.refundSubmitData});case 9:this.$confirm("退款已完成","提示",{confirmButtonText:"關閉",showCancelButton:!1,type:"warning",center:!0}),this.$emit("update"),t.next=16;break;case 13:t.prev=13,t.t0=t["catch"](5),console.log("TCL: tryToCreateOrder -> error",t.t0);case 16:return t.prev=16,this.tryingRefund=!1,this.isRefund=!0,this.refundDialogVisible=!1,t.finish(16);case 21:case"end":return t.stop()}},t,this,[[5,13,16,21]])}));return function(e){return t.apply(this,arguments)}}()}},_=p,m=a("3a19"),v=a("2877");function y(t){this["$style"]=m["default"].locals||m["default"]}var h=Object(v["a"])(_,s,i,!1,y,null,null);e["default"]=h.exports}}]);
//# sourceMappingURL=chunk-11920d24.954e1208.js.map