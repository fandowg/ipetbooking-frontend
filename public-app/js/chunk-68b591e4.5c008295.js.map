{"version":3,"sources":["webpack:///./src/components/Order/AdditionEditForm.vue?6997","webpack:///./src/components/Order/AdditionEditForm.vue?9264","webpack:///src/components/Order/AdditionEditForm.vue","webpack:///./src/components/Order/AdditionEditForm.vue?35cf","webpack:///./src/components/Order/AdditionEditForm.vue?1658","webpack:///./src/components/Order/AdditionEditForm.vue?2e91","webpack:///./src/utils/scroll-to-element.js"],"names":["_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_0_0_node_modules_css_loader_index_js_ref_8_oneOf_0_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_0_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_0_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_AdditionEditForm_vue_vue_type_style_index_0_lang_scss_module_true___WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_0_0_node_modules_css_loader_index_js_ref_8_oneOf_0_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_0_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_0_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_AdditionEditForm_vue_vue_type_style_index_0_lang_scss_module_true___WEBPACK_IMPORTED_MODULE_0___default","n","__webpack_exports__","render","_vm","this","_h","$createElement","_c","_self","class","$style","staticClass","attrs","default-value","bookingOrder","ref","model","submitData","rules","submitRules","label-position","_v","_s","defaultValue","id","title","type","show-icon","closable","_e","label","disabled","disabledPayment","on","change","onChangePayment","value","callback","$$v","$set","expression","isEmployee","isHomeService","storeCashflowSetting","border","paymentMethod","prop","_l","bank","index","key","gutter","hasUnpaidItem","includes","span","click","$event","updateOrderStatus","item","placeholder","status","fullRefundOnly","addItems","price","staticStyle","margin-top","xs","$emit","loading","tryingToStoreOrder","handleStoreOrder","staticRenderFns","AdditionEditFormvue_type_script_lang_js_initData","_cloneDeep","cloneDeep_default","orderId","map","Object","objectSpread","defaultStatus","AdditionEditFormvue_type_script_lang_js_","components","Info","lazyload_component","e","then","bind","props","default","Number","data","bankTypeList","computed","helpers","bankType","required","isRequiredBankType","message","some","filterSubmitData","isPaid","isPaidByCredit","canRefund","canPartialRefund","storeType","currentUser","scheduleItemId","showVacc","bookingDate","Date","format_date","date","today","date_fns","methods","_this","$refs","form","validate","valid","tryToStoreOrder","$nextTick","scroll_to_element","$el","querySelector","_tryToStoreOrder","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","next","$store","dispatch","finish","stop","apply","arguments","forEach","payment","resetItemsStatus","_cloneDeep2","Order_AdditionEditFormvue_type_script_lang_js_","injectStyles","context","AdditionEditFormvue_type_style_index_0_lang_scss_module_true_","locals","component","componentNormalizer","module","exports","slide","slide-reverse","edit-addition","payment-methods","scrollToElement","offset","length","undefined","container","findScrollableContainer","scrollTo","top","findPos","behavior","isScrollable","hasScrollableContent","scrollHeight","clientHeight","overflowYStyle","window","getComputedStyle","overflowY","isOverflowYScroll","parentElement","el","curtop","offsetParent","offsetTop","d"],"mappings":"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","file":"js/chunk-68b591e4.5c008295.js","sourcesContent":["import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-0-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-0-2!../../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-0-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdditionEditForm.vue?vue&type=style&index=0&lang=scss&module=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-0-0!../../../node_modules/css-loader/index.js??ref--8-oneOf-0-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-0-2!../../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-0-3!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdditionEditForm.vue?vue&type=style&index=0&lang=scss&module=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{class:_vm.$style['edit-addition']},[_c('Info',{staticClass:\"order-info\",attrs:{\"default-value\":_vm.bookingOrder}}),_c('el-form',{ref:\"form\",staticClass:\"el-form-item--normal-margin el-form-item--white-bg\",attrs:{\"model\":_vm.submitData,\"rules\":_vm.submitRules,\"label-position\":\"top\"}},[_c('div',{staticClass:\"order-id Jost\"},[_vm._v(\"加購訂單 #\"+_vm._s(_vm.defaultValue.id))]),(_vm.fullRefundOnly)?_c('el-alert',{attrs:{\"title\":\"信用卡公司尚未請款完成，目前只允許整筆退款！\",\"type\":\"warning\",\"show-icon\":\"\",\"closable\":false}}):_vm._e(),_c('el-form-item',{attrs:{\"label\":\"付款方式\"}},[_c('el-select',{staticClass:\"is-round is-border\",attrs:{\"disabled\":_vm.disabledPayment},on:{\"change\":_vm.onChangePayment},model:{value:(_vm.submitData.paymentMethod),callback:function ($$v) {_vm.$set(_vm.submitData, \"paymentMethod\", $$v)},expression:\"submitData.paymentMethod\"}},[_c('el-option',{attrs:{\"value\":null,\"label\":\"不指定\",\"disabled\":_vm.isEmployee && _vm.isHomeService}}),_c('el-option',{attrs:{\"value\":\"Cash\",\"label\":\"到店付款(現金)\",\"disabled\":_vm.isEmployee || _vm.isHomeService}}),_c('el-option',{attrs:{\"value\":\"Atm\",\"label\":\"線下匯款\"}}),_c('el-option',{attrs:{\"value\":\"StoreCredit\",\"label\":\"現場刷卡\",\"disabled\":_vm.isEmployee || _vm.isHomeService}}),( _vm.storeCashflowSetting === 1)?_c('el-option',{attrs:{\"value\":\"Credit\",\"label\":\"信用卡付款\"}}):_vm._e(),( _vm.storeCashflowSetting !== 0)?_c('el-option',{attrs:{\"value\":\"Vacc\",\"label\":\"ATM虛擬帳戶\",\"border\":\"\"}}):_vm._e()],1)],1),(_vm.defaultValue.paymentMethod !== 'Vacc' && _vm.submitData.paymentMethod === 'Vacc')?_c('el-form-item',{attrs:{\"prop\":\"bankType\",\"label\":\"轉帳銀行\"}},[_c('el-select',{staticClass:\"is-round is-border\",model:{value:(_vm.submitData.bankType),callback:function ($$v) {_vm.$set(_vm.submitData, \"bankType\", $$v)},expression:\"submitData.bankType\"}},_vm._l((_vm.bankTypeList),function(bank,index){return _c('el-option',{key:(\"bank-\" + index),attrs:{\"value\":bank.id,\"label\":bank.title}})}),1)],1):_vm._e(),_c('el-row',{attrs:{\"gutter\":20}},[(_vm.hasUnpaidItem && !['Credit', 'Vacc'].includes(_vm.submitData.paymentMethod) && !(_vm.isHomeService && _vm.isEmployee))?_c('el-col',{attrs:{\"span\":12}},[_c('el-button',{staticClass:\"is-round is-fullwidth paid\",attrs:{\"type\":\"primary\"},on:{\"click\":function($event){return _vm.updateOrderStatus(1)}}},[_vm._v(\"整筆訂單已付款\")])],1):_vm._e(),_c('el-col',{attrs:{\"span\":_vm.hasUnpaidItem && !['Credit', 'Vacc'].includes(_vm.submitData.paymentMethod) && !(_vm.isHomeService && _vm.isEmployee) ? 12 : 24}},[_c('el-button',{staticClass:\"is-round is-fullwidth\",attrs:{\"type\":\"danger\"},on:{\"click\":function($event){return _vm.updateOrderStatus(0)}}},[_vm._v(\"取消此筆訂單\")])],1)],1),_c('el-divider'),_c('div',{staticClass:\"item-wrapper\"},[_c('div',{staticClass:\"item header\"},[_c('div',[_vm._v(\"加購項目\")]),_c('div',[_vm._v(\"訂單狀態\")]),_c('div',[_vm._v(\"金額\")])]),_vm._l((_vm.defaultValue.addItems),function(item,index){return _c('div',{key:(\"item-\" + index),staticClass:\"item\"},[_c('div',[_vm._v(_vm._s(item.title))]),_c('div',{staticClass:\"status\"},[_c('el-select',{staticClass:\"is-round is-border\",attrs:{\"placeholder\":\"訂單狀態\",\"disabled\":item.status === 0 || _vm.fullRefundOnly},model:{value:(_vm.submitData.addItems[index].status),callback:function ($$v) {_vm.$set(_vm.submitData.addItems[index], \"status\", $$v)},expression:\"submitData.addItems[index].status\"}},[_c('el-option',{attrs:{\"value\":0,\"label\":\"已取消\"}}),(item.status !== 1)?_c('el-option',{attrs:{\"value\":2,\"label\":\"未付款\"}}):_vm._e(),(item.status !== 0)?_c('el-option',{attrs:{\"value\":1,\"label\":\"已付款\",\"disabled\":\"\"}}):_vm._e()],1)],1),_c('div',{staticClass:\"Jost\"},[_vm._v(\"$\"+_vm._s(item.price))])])})],2)],1),_c('el-row',{staticClass:\"footer\",staticStyle:{\"margin-top\":\"32px\"},attrs:{\"gutter\":20}},[_c('el-col',{attrs:{\"span\":12,\"xs\":24}},[_c('el-button',{staticClass:\"is-round is-fullwidth\",on:{\"click\":function($event){return _vm.$emit('close')}}},[_vm._v(\"取消編輯\")])],1),_c('el-col',{attrs:{\"span\":12,\"xs\":24}},[_c('el-button',{staticClass:\"is-round is-fullwidth\",attrs:{\"loading\":_vm.tryingToStoreOrder,\"type\":\"primary\"},on:{\"click\":_vm.handleStoreOrder}},[_vm._v(\"儲存變更\")])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport lazyLoadComponent from '@router/lazyload-component'\nimport cloneDeep from 'lodash/cloneDeep'\nimport formatDate from '@utils/format-date'\nimport { differenceInDays } from 'date-fns'\nimport { authComputed } from '@state/helpers'\nimport scrollToElement from '@utils/scroll-to-element'\n\nconst initData = (defaultValue) => {\n  const { id, orderId, paymentMethod, addItems } = cloneDeep(defaultValue)\n  return {\n    id,\n    orderId,\n    paymentMethod,\n    addItems: addItems.map((item) => ({\n      ...item,\n      defaultStatus: item.status,\n    })),\n  }\n}\n\nexport default {\n  components: {\n    Info: () => lazyLoadComponent(import('@components/Order/Info')),\n  },\n  props: {\n    defaultValue: {\n      type: Object,\n      default: () => {},\n    },\n    bookingOrder: {\n      type: Object,\n      default: () => {},\n    },\n    storeCashflowSetting: {\n      type: Number,\n      default: 1,\n    },\n  },\n  data() {\n    return {\n      submitData: initData(this.defaultValue),\n      tryingToStoreOrder: false,\n      bankTypeList: [{ id: 'BOT', title: '台灣銀行' }, { id: 'Taishin', title: '台新' }, { id: 'HNCB', title: '華南' }],\n    }\n  },\n  computed: {\n    ...authComputed,\n    submitRules() {\n      return {\n        bankType: [{ required: this.isRequiredBankType, message: '請選擇轉帳銀行' }],\n      }\n    },\n    hasUnpaidItem() {\n      return this.defaultValue.addItems.some((item) => item.status === 2)\n    },\n    filterSubmitData() {\n      const addItems = this.submitData.addItems.map((item) => ({\n        id: item.id,\n        status: item.status,\n      }))\n      return {\n        ...this.submitData,\n        addItems,\n      }\n    },\n    isPaid() {\n      return this.defaultValue.status === 1\n    },\n    isPaidByCredit() {\n      return this.defaultValue.paymentMethod === 'Credit'\n    },\n    fullRefundOnly() {\n      return this.isPaid && this.isPaidByCredit && this.defaultValue.canRefund === 1 && this.defaultValue.canPartialRefund === 0\n    },\n    isHomeService() {\n      return this.bookingOrder.storeType === 'home'\n    },\n    isEmployee() {\n      // console.log(this.currentUser)\n      return !!this.currentUser.scheduleItemId\n      // return this.currentUserRoutes.includes('employee-calendar')\n    },\n    showVacc() {\n      const bookingDate = new Date(formatDate(new Date(this.bookingOrder.date)))\n      const today = new Date(formatDate(new Date()))\n      // 虛擬帳戶付款距離預約日要大於1天\n      return differenceInDays(bookingDate, today) > 1\n    },\n    isRequiredBankType() {\n      return this.submitData.paymentMethod === 'Vacc'\n    },\n    disabledPayment() {\n      return this.defaultValue.status === 1 || (this.isEmployee && this.isHomeService && !this.showVacc)\n    },\n  },\n  methods: {\n    handleStoreOrder() {\n      this.$refs.form.validate((valid) => {\n        if (valid) this.tryToStoreOrder()\n        else\n          this.$nextTick(() => {\n            scrollToElement(this.$refs.form.$el.querySelector('.el-form-item__error'), 182)\n          })\n      })\n    },\n    async tryToStoreOrder() {\n      this.tryingToStoreOrder = true\n      try {\n        await this.$store.dispatch('order/storeAdditionalOrder', this.filterSubmitData)\n      } finally {\n        this.tryingToStoreOrder = false\n      }\n\n      this.$emit('update')\n    },\n    updateOrderStatus(status) {\n      this.submitData.addItems.forEach((item) => {\n        if (item.defaultStatus !== 0) item.status = status\n      })\n    },\n    onChangePayment(payment) {\n      if (['Credit', 'Vacc'].includes(payment)) this.resetItemsStatus()\n    },\n    resetItemsStatus() {\n      const { addItems } = cloneDeep(this.defaultValue)\n      this.submitData = {\n        ...this.submitData,\n        addItems: addItems.map((item) => ({\n          ...item,\n          defaultStatus: item.status,\n        })),\n      }\n    },\n  },\n}\n</script>\n\n<template>\n  <div :class=\"$style['edit-addition']\">\n    <Info class=\"order-info\" :default-value=\"bookingOrder\"></Info>\n    <el-form ref=\"form\" :model=\"submitData\" :rules=\"submitRules\" label-position=\"top\" class=\"el-form-item--normal-margin el-form-item--white-bg\">\n      <div class=\"order-id Jost\">加購訂單 #{{ defaultValue.id }}</div>\n      <el-alert v-if=\"fullRefundOnly\" title=\"信用卡公司尚未請款完成，目前只允許整筆退款！\" type=\"warning\" show-icon :closable=\"false\"></el-alert>\n      <el-form-item label=\"付款方式\">\n        <el-select v-model=\"submitData.paymentMethod\" class=\"is-round is-border\" :disabled=\"disabledPayment\" @change=\"onChangePayment\">\n          <el-option :value=\"null\" label=\"不指定\" :disabled=\"isEmployee && isHomeService\"></el-option>\n          <el-option value=\"Cash\" label=\"到店付款(現金)\" :disabled=\"isEmployee || isHomeService\"></el-option>\n          <el-option value=\"Atm\" label=\"線下匯款\" ></el-option>\n          <el-option value=\"StoreCredit\" label=\"現場刷卡\" :disabled=\"isEmployee || isHomeService\"></el-option>\n          <el-option v-if=\" storeCashflowSetting === 1\" value=\"Credit\" label=\"信用卡付款\"></el-option>\n          <el-option v-if=\" storeCashflowSetting !== 0\" value=\"Vacc\" label=\"ATM虛擬帳戶\"  border></el-option>\n        </el-select>\n      </el-form-item>\n      <el-form-item v-if=\"defaultValue.paymentMethod !== 'Vacc' && submitData.paymentMethod === 'Vacc'\" prop=\"bankType\" label=\"轉帳銀行\">\n        <el-select v-model=\"submitData.bankType\" class=\"is-round is-border\">\n          <el-option v-for=\"(bank, index) in bankTypeList\" :key=\"`bank-${index}`\" :value=\"bank.id\" :label=\"bank.title\"></el-option>\n        </el-select>\n      </el-form-item>\n      <el-row :gutter=\"20\">\n        <el-col v-if=\"hasUnpaidItem && !['Credit', 'Vacc'].includes(submitData.paymentMethod) && !(isHomeService && isEmployee)\" :span=\"12\">\n          <el-button class=\"is-round is-fullwidth paid\" type=\"primary\" @click=\"updateOrderStatus(1)\">整筆訂單已付款</el-button>\n        </el-col>\n        <el-col :span=\"hasUnpaidItem && !['Credit', 'Vacc'].includes(submitData.paymentMethod) && !(isHomeService && isEmployee) ? 12 : 24\">\n          <el-button class=\"is-round is-fullwidth\" type=\"danger\" @click=\"updateOrderStatus(0)\">取消此筆訂單</el-button>\n        </el-col>\n      </el-row>\n      <el-divider></el-divider>\n      <div class=\"item-wrapper\">\n        <div class=\"item header\">\n          <div>加購項目</div>\n          <div>訂單狀態</div>\n          <div>金額</div>\n        </div>\n        <div v-for=\"(item, index) in defaultValue.addItems\" :key=\"`item-${index}`\" class=\"item\">\n          <div>{{ item.title }}</div>\n          <div class=\"status\">\n            <el-select v-model=\"submitData.addItems[index].status\" class=\"is-round is-border\" placeholder=\"訂單狀態\" :disabled=\"item.status === 0 || fullRefundOnly\">\n              <el-option :value=\"0\" label=\"已取消\"></el-option>\n              <el-option v-if=\"item.status !== 1\" :value=\"2\" label=\"未付款\"></el-option>\n              <el-option v-if=\"item.status !== 0\" :value=\"1\" label=\"已付款\" disabled></el-option>\n            </el-select>\n          </div>\n          <div class=\"Jost\">${{ item.price }}</div>\n        </div>\n      </div>\n    </el-form>\n    <el-row :gutter=\"20\" class=\"footer\" style=\"margin-top: 32px;\">\n      <el-col :span=\"12\" :xs=\"24\">\n        <el-button class=\"is-round is-fullwidth\" @click=\"$emit('close')\">取消編輯</el-button>\n      </el-col>\n      <el-col :span=\"12\" :xs=\"24\">\n        <el-button :loading=\"tryingToStoreOrder\" class=\"is-round is-fullwidth\" type=\"primary\" @click=\"handleStoreOrder\">儲存變更</el-button>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n\n<style lang=\"scss\" module>\n@import '@design';\n.edit-addition {\n  :global {\n    .order-info {\n      @include touch {\n        display: none;\n      }\n    }\n    .el-form {\n      margin-top: 30px;\n      padding: 30px 25px;\n      background-color: white;\n      @include touch {\n        padding-left: 0;\n        padding-right: 0;\n        margin-top: 0;\n      }\n      .order-id {\n        font-size: 16px;\n        line-height: 18px;\n        letter-spacing: 1.6px;\n        font-weight: 500;\n        margin-bottom: 30px;\n      }\n      .el-button.paid {\n        background-color: $color-state-success;\n      }\n      .item-wrapper {\n        @include touch {\n          border: 1px solid #c6c6ba;\n        }\n        .item {\n          display: flex;\n          padding: 12px 0;\n          @include touch {\n            flex-wrap: wrap;\n            padding: 30px 20px;\n            &:not(.header) + .item {\n              padding-top: 0;\n              &::before {\n                content: '';\n                border-top: 1px dashed #c6c6ba;\n                height: 1px;\n                width: 100%;\n                padding: 0 20px;\n                margin-bottom: 30px;\n              }\n            }\n          }\n          > div {\n            flex: 1;\n            display: flex;\n            align-items: center;\n            &:first-child {\n              flex: 2;\n            }\n            &:last-child {\n              justify-content: flex-end;\n            }\n            @include touch {\n              color: $color-dark-primary;\n            }\n          }\n          @include touch {\n            .status {\n              order: 3;\n              flex-basis: 100%;\n              margin-top: 25px;\n              flex-wrap: wrap;\n              &:before {\n                content: '訂單狀態';\n                display: block;\n                color: #3f3a2e;\n                margin-bottom: 10px;\n              }\n            }\n          }\n\n          &.header {\n            padding: 0;\n            height: 44px;\n            line-height: 44px;\n            color: #919191;\n            @include touch {\n              display: none;\n            }\n          }\n        }\n      }\n    }\n    @include touch {\n      .footer {\n        display: flex;\n        flex-direction: column-reverse;\n        .el-col + .el-col {\n          margin-bottom: 10px;\n        }\n      }\n    }\n  }\n}\n.payment-methods {\n  :global {\n    .el-radio {\n      margin: 5px !important;\n    }\n  }\n}\n</style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdditionEditForm.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./AdditionEditForm.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./AdditionEditForm.vue?vue&type=template&id=7d907570&\"\nimport script from \"./AdditionEditForm.vue?vue&type=script&lang=js&\"\nexport * from \"./AdditionEditForm.vue?vue&type=script&lang=js&\"\nimport style0 from \"./AdditionEditForm.vue?vue&type=style&index=0&lang=scss&module=true&\"\n\n\n\n\nfunction injectStyles (context) {\n  \n  this[\"$style\"] = (style0.locals || style0)\n\n}\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  null,\n  null\n  \n)\n\nexport default component.exports","// extracted by mini-css-extract-plugin\nmodule.exports = {\"slide\":\"AdditionEditForm_slide_2OHsn\",\"slide-reverse\":\"AdditionEditForm_slide-reverse_1iIiH\",\"edit-addition\":\"AdditionEditForm_edit-addition_3i8Do\",\"payment-methods\":\"AdditionEditForm_payment-methods_35rf3\"};","export default function scrollToElement($el, offset = 0) {\n  const container = findScrollableContainer($el)\n  container.scrollTo({\n    top: findPos($el) - offset,\n    behavior: \"smooth\"\n  })\n}\n\nfunction isScrollable($el) {\n  // Compare the height to see if the element has scrollable content\n  const hasScrollableContent = $el.scrollHeight > $el.clientHeight;\n\n  // It's not enough because the element's `overflow-y` style can be set as\n  // * `hidden`\n  // * `hidden !important`\n  // In those cases, the scrollbar isn't shown\n  const overflowYStyle = window.getComputedStyle($el).overflowY;\n  const isOverflowYScroll = ['scroll', 'auto'].includes(overflowYStyle)\n\n  return hasScrollableContent && isOverflowYScroll;\n}\n\nfunction findScrollableContainer($el) {\n  if(!isScrollable($el))\n    return findScrollableContainer($el.parentElement)\n  else\n    return $el\n}\n\nfunction findPos(el) {\n  var curtop = 0\n  if (el.offsetParent) {\n    do {\n      curtop += el.offsetTop\n    } while ((el = el.offsetParent))\n    return curtop\n  }\n}"],"sourceRoot":""}