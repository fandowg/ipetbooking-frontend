(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22c004d0"],{1500:function(e,t,r){e.exports={slide:"ScheduleStaffServiceForm_slide_3eMma","slide-reverse":"ScheduleStaffServiceForm_slide-reverse_1o1yh",repeat:"ScheduleStaffServiceForm_repeat_Lhi2v","services-wrap":"ScheduleStaffServiceForm_services-wrap_Dapr6",services:"ScheduleStaffServiceForm_services_2T7YT",footer:"ScheduleStaffServiceForm_footer_3euLW"}},5358:function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"form",staticStyle:{"margin-top":"30px"},attrs:{model:e.submitData,rules:e.submitRules,"label-position":"top"}},[r("el-form-item",{attrs:{label:"設定此時段可服務的地點",prop:"storeIds"}},[r("el-select",{attrs:{"value-key":"id",multiple:"",placeholder:"請選擇","popper-append-to-body":!0},on:{change:e.onLocationChange},model:{value:e.submitData.storeIds,callback:function(t){e.$set(e.submitData,"storeIds",t)},expression:"submitData.storeIds"}},e._l(e.locations,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e}})}),1)],1),e.categoryList.length>0?r("el-form-item",{attrs:{prop:"serviceCategoryIds"}},[r("span",{staticClass:"clickOk",attrs:{slot:"label"},slot:"label"},[e._v("此時段可服務的寵物類別與體型 "),r("el-checkbox",{staticClass:"check-by-head",attrs:{indeterminate:e.isIndeterminateCategory},on:{change:e.handleCheckAllCategory},model:{value:e.checkAllCategory,callback:function(t){e.checkAllCategory=t},expression:"checkAllCategory"}},[e._v("全選")])],1),r("el-select",{attrs:{"value-key":"id",multiple:"",placeholder:"請選擇","popper-append-to-body":!0},model:{value:e.submitData.serviceCategoryIds,callback:function(t){e.$set(e.submitData,"serviceCategoryIds",t)},expression:"submitData.serviceCategoryIds"}},e._l(e.categoryList,function(e){return r("el-option",{key:e.id,attrs:{label:e.categoryTitle,value:e.id}})}),1)],1):e._e(),r("el-form-item",{class:e.$style["services-wrap"],staticStyle:{"min-height":"250px"},attrs:{label:"可受理的服務項目",prop:"productPriceIds"}},[e.availableService.length?r("el-checkbox",{staticStyle:{"margin-left":"5px","margin-top":"10px","margin-bottom":"5px"},attrs:{indeterminate:e.isIndeterminate,border:""},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全 選")]):r("el-alert",{attrs:{title:"請選擇分店與寵物體型",type:"warning",closable:!1}}),r("el-checkbox-group",{class:e.$style.services,model:{value:e.submitData.productPriceIds,callback:function(t){e.$set(e.submitData,"productPriceIds",t)},expression:"submitData.productPriceIds"}},e._l(e.availableService,function(t){return r("el-checkbox",{key:"free-"+t.id,attrs:{label:t.id,border:""}},[r("div",{staticClass:"content"},[0===t.state?r("span",{staticClass:"side-icon"},[e._v("已下架")]):e._e(),r("span",{staticClass:"title",staticStyle:{"font-size":"15px"}},[e._v(e._s(t.title))]),r("span",{staticClass:"meta"},[r("span",{staticStyle:{"font-size":"14px","margin-right":"10px"}},[e._v(e._s(t.location))]),r("span",[e._v(e._s(t.categoryTitle))])])])])}),1)],1)],1)],1)},a=[],s=r("f210"),c=r("4795"),n=r.n(c),o=r("cb0c"),l=r("9395");function u(){return{storeIds:[],serviceCategoryIds:[],productPriceIds:[]}}var d={components:{},props:{defaultValue:{type:Object,default:function(){return u()}}},data:function(){return{submitData:{storeIds:[],serviceCategoryIds:[],productPriceIds:[]},categoryList:[],priceList:[],locations:[],checkAll:!1,checkAllCategory:!1}},computed:{isEditMode:function(){return void 0!==this.defaultValue.id},availableService:function(){var e=this,t=[];return this.priceList.forEach(function(r){e.submitData.storeIds.forEach(function(i){r.productId===i.id&&e.submitData.serviceCategoryIds.forEach(function(e){r.petSizeId===e&&t.push(Object(l["a"])({},r,{location:i.name}))})})}),t},isIndeterminate:function(){return this.checkAll=this.submitData.productPriceIds.length===this.availableService.length,0!==this.submitData.productPriceIds.length&&(this.submitData.productPriceIds.length>0&&this.submitData.productPriceIds.length<this.availableService.length)},isIndeterminateCategory:function(){return this.checkAllCategory=this.submitData.serviceCategoryIds.length===this.categoryList.length,0!==this.submitData.serviceCategoryIds.length&&(this.submitData.serviceCategoryIds.length>0&&this.submitData.serviceCategoryIds.length<this.categoryList.length)},filterSubmitData:function(){var e=this.submitData.storeIds.map(function(e){return e.id});return Object(l["a"])({},this.submitData,{storeIds:e})},submitRules:function(){var e=this,t=""===this.submitData.repeat,r="week"===this.submitData.repeat;return{title:[{required:!0,message:"請填寫方案名稱",trigger:"blur"}],description:[{required:!0,message:"請填寫方案內容",trigger:"blur"}],startTime:[{required:!0,validator:function(t,r,i){if(!r)return i(new Error("請選擇時段開始時間"));e.submitData.endTime&&e.$refs.form.validateField("endTime"),i()},trigger:"change"}],endTime:[{required:!0,validator:function(t,r,i){return r?minutesOfTime(e.submitData.startTime)>=minutesOfTime(r)?i(new Error("結束時間不可早於開始時間")):void i():i(new Error("請選擇時段結束時間"))},trigger:"change"}],repeatWith:[{type:"array",required:r,message:"請選擇重複的星期",trigger:"change"}],repeatEndDate:[{required:!t,message:"請選擇重複結束日期",trigger:"change"}],maxCollision:[{required:!0,message:"請輸入人數"},{type:"number",message:"人數必須為數字"}],storeIds:[{required:!0,validator:function(t,r,i){if(!r.length)return e.$nextTick(function(){e.$refs.form.clearValidate("productPriceIds")}),i(new Error("請選擇服務地點"));i()},trigger:"change"}],productPriceIds:[{required:!0,message:"請選擇服務項目",trigger:"change"}],serviceCategoryIds:[{required:!0,message:"請選擇寵物類別與體型",trigger:"change"}]}}},watch:{},created:function(){this.tryToFetchPrices(),this.getDefaultSubmitData()},methods:{getDefaultSubmitData:function(){var e=Object(o["a"])(n.a.mark(function e(){var t,r,i,a,s,c;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.tryToSearchProduct();case 2:return e.next=4,this.$store.dispatch("product/fetchServiceCategory");case 4:t=e.sent,r=[],t.forEach(function(e){e.children.forEach(function(e){r.push(e)})}),this.categoryList=r,this.isEditMode?(i=this.defaultValue,a=i.storeIds,s=i.serviceCategoryIds,c=i.productPriceIds,this.submitData={storeIds:this.locations.filter(function(e){return a.includes(e.id)}),serviceCategoryIds:s,productPriceIds:c}):this.submitData={storeIds:[],serviceCategoryIds:[],productPriceIds:[]};case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),tryToFetchPrices:function(){var e=Object(o["a"])(n.a.mark(function e(){var t,r;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("product/fetchServicePrices",{limit:1e4,page:1});case 2:t=e.sent,r=t.items,this.priceList=r;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),tryToSearchProduct:function(){var e=Object(o["a"])(n.a.mark(function e(){var t,r;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("product/fetchList",{limit:1e4,page:1});case 2:t=e.sent,r=t.items,this.locations=r;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),onLocationChange:function(e){this.checkValidServices()},checkValidServices:function(){var e=this.submitData.storeIds.map(function(e){return e.id}),t=this.priceList.filter(function(t){return e.includes(t.productId)}).map(function(e){return e.id});this.submitData.productPriceIds=Object(s["a"])(this.submitData.productPriceIds.filter(function(e){return t.includes(e)}))},handleCheckAllChange:function(e){this.submitData.productPriceIds=e?this.availableService.map(function(e){return e.id}):[]},handleCheckAllCategory:function(e){this.submitData.serviceCategoryIds=e?this.categoryList.map(function(e){return e.id}):[]},validate:function(){return this.$refs.form.validate()}}},h=d,p=r("9dc4"),m=r("2877");function f(e){this["$style"]=p["default"].locals||p["default"]}var g=Object(m["a"])(h,i,a,!1,f,null,null);t["default"]=g.exports},"9dc4":function(e,t,r){"use strict";var i=r("1500"),a=r.n(i);t["default"]=a.a}}]);
//# sourceMappingURL=chunk-22c004d0.f33cf680.js.map