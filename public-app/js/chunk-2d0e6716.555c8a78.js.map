{"version":3,"sources":["webpack:///./src/components/OrderChangeStatusDialog.vue?bfa4","webpack:///src/components/OrderChangeStatusDialog.vue","webpack:///./src/components/OrderChangeStatusDialog.vue?d3bb","webpack:///./src/components/OrderChangeStatusDialog.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","visible","show-close","top","append-to-body","staticStyle","margin-bottom","slot","staticClass","font-size","color","_v","_s","dialogTitle","ref","model","submitData","rules","submitRules","margin-top","text-align","prop","label","type","rows","placeholder","value","callback","$$v","$set","expression","_e","isNotPayPrepaid","isPaidStatus","canOnlineRefund","newebpayStatus","title","closable","isRefundPercentage","order","priceTotal","min","scopedSlots","_u","key","fn","_f","refundUnit","proxy","_n","refundNumber","refundValue","on","click","handleClose","$event","goToPrepaidOrder","prepaidOrderUuid","_g","loading","tryingCancel","emitPaid","handleCancel","staticRenderFns","formatUnitText","unit","calculateValue","number","total","concat","convertPercentToValue","percentage","Math","round","OrderChangeStatusDialogvue_type_script_lang_js_","filters","props","Boolean","default","Object","required","prepaidOrder","paidMode","String","data","note","computed","newebpayStatusMap","0","1","2","3","orderNo","id","refundNumberMax","status","paymentStatus","isPaidByCreditCard","paymentMethod","refund","isPrepaidOrder","hasOwnProperty","message","trigger","max","watch","handler","immediate","created","methods","$refs","form","resetFields","$emit","emitCancelled","tryToCancel","_tryToCancel","asyncToGenerator","regenerator_default","a","mark","_callee","CANCEL_API_URL","wrap","_context","prev","next","$store","dispatch","orderId","cancelData","objectSpread","$message","t0","console","log","finish","stop","apply","arguments","_this","validate","valid","$router","push","name","query","components_OrderChangeStatusDialogvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__"],"mappings":"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","file":"js/chunk-2d0e6716.555c8a78.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('el-dialog',{attrs:{\"visible\":_vm.visible,\"show-close\":false,\"top\":\"0\",\"append-to-body\":\"\"}},[_c('h5',{staticStyle:{\"margin-bottom\":\"0\"},attrs:{\"slot\":\"title\"},slot:\"title\"},[_c('i',{staticClass:\"el-icon-warning\",staticStyle:{\"font-size\":\"24px\",\"margin-bottom\":\"15px\",\"color\":\"#E2B550\"}}),_c('br'),_vm._v(\"\\n  \"+_vm._s(_vm.dialogTitle))]),_c('el-form',{ref:\"form\",staticClass:\"el-form-item--normal-margin\",attrs:{\"model\":_vm.submitData,\"rules\":_vm.submitRules}},[(_vm.isPaidStatus)?[(_vm.isNotPayPrepaid )?[_c('p',{staticStyle:{\"margin-top\":\"0\",\"text-align\":\"center\"}},[_vm._v(\"抵用的包月方案 \"),_c('span',{staticClass:\"alert-text\"},[_vm._v(\"尚未付款\")]),_vm._v(\"。\"),_c('br'),_vm._v(\"請問是否要將此筆訂單的狀態修改為【已付款】？\")]),_c('el-form-item',{attrs:{\"prop\":\"note\",\"label\":\"\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":2,\"placeholder\":\"請輸入付款備註\"},model:{value:(_vm.submitData.note),callback:function ($$v) {_vm.$set(_vm.submitData, \"note\", $$v)},expression:\"submitData.note\"}})],1)]:_vm._e(),(!_vm.isNotPayPrepaid )?[_c('el-form-item',{attrs:{\"prop\":\"note\",\"label\":\"付款備註\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":2,\"placeholder\":\"請輸入付款備註\"},model:{value:(_vm.submitData.note),callback:function ($$v) {_vm.$set(_vm.submitData, \"note\", $$v)},expression:\"submitData.note\"}})],1)]:_vm._e()]:_vm._e(),(!_vm.isPaidStatus)?[(_vm.isPaidByCreditCard)?[(!_vm.canOnlineRefund)?_c('el-alert',{attrs:{\"title\":\"此訂單非線上付款，請自行處理退款事宜。\",\"type\":\"warning\",\"closable\":false}}):[(_vm.newebpayStatus === 0)?_c('el-alert',{attrs:{\"title\":\"此訂單目前授權成功但尚未正式扣款，僅能整筆退款，無法部分退款。\",\"type\":\"error\",\"closable\":false}}):_vm._e(),(_vm.newebpayStatus === 1)?_c('el-alert',{attrs:{\"title\":\"此訂單目前金流尚在請款流程中，暫無法取消訂單，請稍後再試。\",\"type\":\"error\",\"closable\":false}}):_vm._e(),(_vm.newebpayStatus === 3)?_c('el-alert',{attrs:{\"title\":\"產生非預期之錯誤，請通知我們。\",\"type\":\"error\",\"closable\":false}}):_vm._e(),(_vm.newebpayStatus === 2)?[_c('small',[_vm._v(\"退訂單的\\n              20％，退款種類請選「訂單總金額的百分比（％）」，退款百分比請輸入「20」。\")]),_c('br'),_c('small',[_vm._v(\"退 150\\n              元，退款種類請選「指定金額」，退款金額請輸入「150」。\")]),_c('el-form-item',{attrs:{\"prop\":\"refundUnit\",\"label\":\"退款種類\"}},[_c('el-select',{model:{value:(_vm.submitData.refundUnit),callback:function ($$v) {_vm.$set(_vm.submitData, \"refundUnit\", $$v)},expression:\"submitData.refundUnit\"}},[_c('el-option',{attrs:{\"label\":\"訂單總金額的百分比（％）\",\"value\":\"%\"}}),_c('el-option',{attrs:{\"label\":\"指定金額\",\"value\":\"fixed\"}})],1)],1),_c('el-form-item',{attrs:{\"prop\":\"refundNumber\",\"label\":(\"退款\" + (_vm.isRefundPercentage ? '百分比' : '金額'))}},[_c('small',[_vm._v(\"訂單金額 \"+_vm._s(_vm.order.priceTotal)+\" 元\")]),_c('el-input',{attrs:{\"min\":\"0\",\"placeholder\":\"請輸入退款金額\"},scopedSlots:_vm._u([{key:\"append\",fn:function(){return [_vm._v(_vm._s(_vm._f(\"formatUnitText\")(_vm.submitData.refundUnit)))]},proxy:true}],null,false,2908787069),model:{value:(_vm.submitData.refundNumber),callback:function ($$v) {_vm.$set(_vm.submitData, \"refundNumber\", _vm._n($$v))},expression:\"submitData.refundNumber\"}}),(_vm.isRefundPercentage && _vm.submitData.refundNumber >= 0)?_c('small',[_vm._v(\"經四捨五入計算，將會退 \"+_vm._s(_vm.refundValue)+\" 元給客戶\")]):_vm._e()],1)]:_vm._e()]]:_vm._e(),(_vm.newebpayStatus !== 1 || _vm.newebpayStatus !== 3)?_c('el-form-item',{attrs:{\"prop\":\"note\",\"label\":\"僅作取消訂單說明使用；若有退款請另行操作[退款紀錄]\"}},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":2,\"placeholder\":\"請輸入取消原因\"},model:{value:(_vm.submitData.note),callback:function ($$v) {_vm.$set(_vm.submitData, \"note\", $$v)},expression:\"submitData.note\"}})],1):_vm._e()]:_vm._e()],2),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":_vm.handleClose}},[_vm._v(\"放棄\")]),(_vm.isNotPayPrepaid && _vm.isPaidStatus)?_c('el-button',{on:{\"click\":function($event){return _vm.goToPrepaidOrder(_vm.prepaidOrderUuid)}}},[_vm._v(\"查看包月方案\")]):_vm._e(),(_vm.newebpayStatus === 1 || _vm.newebpayStatus === 3)?_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.handleClose}},[_vm._v(\"關閉\")]):_c('el-button',_vm._g({attrs:{\"type\":\"primary\",\"loading\":_vm.tryingCancel}},{ click: _vm.isPaidStatus ? _vm.emitPaid : _vm.handleCancel }),[_vm._v(\"確定\")])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nconst formatUnitText = function(unit) {\n  return unit === '%' ? '%' : '元'\n}\nconst calculateValue = function(number, unit, total) {\n  return `${unit === '%' ? convertPercentToValue(number, total) : number}`\n}\nconst convertPercentToValue = function(percentage, total) {\n  return Math.round((total * percentage) / 100) || 0\n}\n\nexport default {\n  filters: {\n    formatUnitText,\n  },\n  props: {\n    visible: {\n      type: Boolean,\n      default: false,\n    },\n    order: {\n      type: Object,\n      required: true,\n    },\n    prepaidOrder:{\n      type: Object,\n      default:()=>{}\n    },\n    paidMode: {\n      type: Boolean,\n      default: false,\n    },\n    isNotPayPrepaid:{\n      type: Boolean,\n      default: false,\n    },\n    prepaidOrderUuid:{\n      type:String,\n      default:''\n    }\n  },\n\n  data() {\n    return {\n      tryingCancel: false,\n      submitData: {\n        note: '',\n        refundUnit: '%', // 不會送給後端\n        refundNumber: '', // 不會送給後端\n      },\n    }\n  },\n  computed: {\n    dialogTitle() {\n      // 0: 授權成功，剛刷完卡，只可以整筆退款\n      // 1: 請款提送中、請款中，都不可以退款\n      // 2: 請款完成＋未退款，可以選擇退款比例\n      // 3: 拿不到單筆交易紀錄、交易紀錄取得失敗、付款未成功、請款完成＋退款提送中or退款中or退款完成\n      const newebpayStatusMap = {\n        0: '確定取消此訂單及授權？',\n        1: '此筆訂單尚在金流請款中',\n        2: '確定取消此筆訂單？',\n        3: '取消訂單時產生非預期之錯誤',\n      }\n      return this.isPaidStatus\n        ? '將訂單狀態改為已付款'\n        : newebpayStatusMap[this.newebpayStatus] || `確定取消此筆 ${this.order.orderNo ? this.order.orderNo : this.order.id} 訂單？`\n    },\n    refundNumberMax() {\n      return this.isRefundPercentage ? 100 : this.order.priceTotal\n    },\n    refundValue() {\n      return calculateValue(\n        this.submitData.refundNumber,\n        this.submitData.refundUnit,\n        this.order.priceTotal\n      )\n    },\n    newebpayStatus() {\n      return this.order.newebpayStatus\n    },\n    isPaidStatus() {\n      let status = false\n      if(this.prepaidOrder){\n        status =this.order.status !==0 && this.prepaidOrder.status === 1 || this.order.paymentStatus === 'PAID' || this.order.status === 1 \n      }else{\n        status =this.order.status !==0 && this.order.paymentStatus === 'PAID' || this.order.status === 1\n      }\n      return status\n    },\n    isPaidByCreditCard() {\n      return this.order.paymentMethod === 'Credit'\n    },\n    canOnlineRefund() {\n      return this.order.refund === 1\n    },\n    isRefundPercentage() {\n      return this.submitData.refundUnit === '%'\n    },\n    isPrepaidOrder() {\n      return this.order.hasOwnProperty('prepaidTitle')\n    },\n    submitRules() {\n      return {\n        refundUnit: [\n          {\n            required: this.canOnlineRefund,\n            message: '請選擇退款種類',\n            trigger: 'change',\n          },\n        ],\n        refundNumber: [\n          {\n            required: this.canOnlineRefund,\n            message: '請輸入退款金額',\n            trigger: 'change',\n          },\n          {\n            type: 'number',\n            min: 0,\n            max: this.refundNumberMax,\n            message: `請輸入小於 ${this.refundNumberMax} 之數字`,\n          },\n        ],\n      }\n    },\n  },\n  watch: {\n    newebpayStatus: {\n      handler(value) {\n        if (value === 0) this.submitData.refundNumber = 100\n      },\n      immediate: true,\n    },\n  },\n  created() {\n    // console.log(this.order.id)\n  },\n  methods: {\n    handleClose() {\n      this.$refs.form.resetFields()\n      this.$emit('update:visible', false)\n    },\n    emitPaid() {\n      this.$emit('paid', this.submitData.note)\n      this.handleClose()\n    },\n    emitCancelled() {\n      this.$emit('cancelled')\n      this.handleClose()\n    },\n\n    async tryToCancel() {\n      const CANCEL_API_URL = this.isPrepaidOrder\n        ? 'prepaid/cancelOrder'\n        : 'order/cancel'\n\n      this.tryingCancel = true\n      try {\n        await this.$store.dispatch(CANCEL_API_URL, {\n          orderId: this.order.id,\n          cancelData: {\n            ...this.submitData,\n            refundValue: this.refundValue,\n          },\n        })\n\n        this.$message({\n          message: '取消成功！',\n          type: 'success',\n        })\n\n        this.emitCancelled()\n      } catch (error) {\n        console.log('TCL: tryToCancel -> error', error)\n      } finally {\n        this.tryingCancel = false\n      }\n    },\n\n    handleCancel() {\n      // const ORDER_NUMBER = this.isPrepaidOrder\n      //   ? this.order.orderNo\n      //   : this.order.id\n      // const confirmMassage = {\n      //   title: `您將取消訂單 ${ORDER_NUMBER}`,\n      //   content: this.canOnlineRefund\n      //     ? `確認取消此筆訂單？`\n      //     : '確認取消此筆訂單？',\n      // }\n      this.$refs.form.validate((valid) => {\n        if (valid) {\n          this.tryToCancel()\n          // this.$confirm(confirmMassage.content, confirmMassage.title, {\n          //   confirmButtonText: '確定',\n          //   cancelButtonText: '取消',\n          //   type: 'warning',\n          //   closeOnClickModal: false,\n          //   center: true,\n          // }).then(() => {\n          //   this.tryToCancel()\n          // })\n        }\n      })\n    },\n    goToPrepaidOrder(id) {\n        this.$router.push({\n          name: 'orders',\n          query: {\n            type: 'prepaidOrder',\n            id,\n          },\n        })\n    },\n  },\n}\n</script>\n<template>\n  <el-dialog\n  \n    :visible=\"visible\"\n    :show-close=\"false\"\n    top=\"0\"\n    append-to-body\n  >\n  \n  <h5 slot=\"title\" style=\"margin-bottom:0\">\n    <i class=\"el-icon-warning\" style=\"font-size:24px;margin-bottom:15px;color:#E2B550\"></i><br>\n    {{dialogTitle}}</h5>\n    <el-form\n      ref=\"form\"\n      :model=\"submitData\"\n      :rules=\"submitRules\"\n      class=\"el-form-item--normal-margin\"\n    >\n    <template  v-if=\"isPaidStatus\">\n      <template v-if=\"isNotPayPrepaid \">\n      \n      <p style=\"margin-top:0;text-align: center;\">抵用的包月方案 <span class=\"alert-text\">尚未付款</span>。<br>請問是否要將此筆訂單的狀態修改為【已付款】？</p>\n      <el-form-item prop=\"note\" label=\"\">\n        <el-input\n          v-model=\"submitData.note\"\n          type=\"textarea\"\n          :rows=\"2\"\n          placeholder=\"請輸入付款備註\"\n        ></el-input>\n      </el-form-item>\n      </template>\n    \n    <template v-if=\"!isNotPayPrepaid \">\n      <el-form-item  prop=\"note\" label=\"付款備註\">\n        <el-input\n          v-model=\"submitData.note\"\n          type=\"textarea\"\n          :rows=\"2\"\n          placeholder=\"請輸入付款備註\"\n        ></el-input>\n      </el-form-item>\n    </template>\n\n      </template>\n\n      <template v-if=\"!isPaidStatus\">\n        <template v-if=\"isPaidByCreditCard\">\n          <el-alert\n            v-if=\"!canOnlineRefund\"\n            title=\"此訂單非線上付款，請自行處理退款事宜。\"\n            type=\"warning\"\n            :closable=\"false\"\n          ></el-alert>\n          <template v-else>\n            <el-alert\n              v-if=\"newebpayStatus === 0\"\n              title=\"此訂單目前授權成功但尚未正式扣款，僅能整筆退款，無法部分退款。\"\n              type=\"error\"\n              :closable=\"false\"\n            ></el-alert>\n            <el-alert\n              v-if=\"newebpayStatus === 1\"\n              title=\"此訂單目前金流尚在請款流程中，暫無法取消訂單，請稍後再試。\"\n              type=\"error\"\n              :closable=\"false\"\n            ></el-alert>\n            <el-alert\n              v-if=\"newebpayStatus === 3\"\n              title=\"產生非預期之錯誤，請通知我們。\"\n              type=\"error\"\n              :closable=\"false\"\n            ></el-alert>\n            <template v-if=\"newebpayStatus === 2\">\n              <small\n                >退訂單的\n                20％，退款種類請選「訂單總金額的百分比（％）」，退款百分比請輸入「20」。</small\n              >\n              <br />\n              <small\n                >退 150\n                元，退款種類請選「指定金額」，退款金額請輸入「150」。</small\n              >\n              <el-form-item prop=\"refundUnit\" label=\"退款種類\">\n                <el-select v-model=\"submitData.refundUnit\">\n                  <el-option\n                    label=\"訂單總金額的百分比（％）\"\n                    value=\"%\"\n                  ></el-option>\n                  <el-option label=\"指定金額\" value=\"fixed\"></el-option>\n                </el-select>\n              </el-form-item>\n              <el-form-item\n                prop=\"refundNumber\"\n                :label=\"`退款${isRefundPercentage ? '百分比' : '金額'}`\"\n              >\n                <small>訂單金額 {{ order.priceTotal }} 元</small>\n                <el-input\n                  v-model.number=\"submitData.refundNumber\"\n                  min=\"0\"\n                  placeholder=\"請輸入退款金額\"\n                >\n                  <template v-slot:append>{{\n                    submitData.refundUnit | formatUnitText\n                  }}</template>\n                </el-input>\n                <small v-if=\"isRefundPercentage && submitData.refundNumber >= 0\"\n                  >經四捨五入計算，將會退 {{ refundValue }} 元給客戶</small\n                >\n              </el-form-item>\n            </template>\n          </template>\n        </template>\n        <el-form-item\n          v-if=\"newebpayStatus !== 1 || newebpayStatus !== 3\"\n          prop=\"note\"\n          label=\"僅作取消訂單說明使用；若有退款請另行操作[退款紀錄]\"\n        >\n          <el-input\n            v-model=\"submitData.note\"\n            type=\"textarea\"\n            :rows=\"2\"\n            placeholder=\"請輸入取消原因\"\n          ></el-input>\n        </el-form-item>\n      </template>\n    </el-form>\n    <span slot=\"footer\" class=\"dialog-footer\">\n      <el-button @click=\"handleClose\">放棄</el-button>\n       <el-button\n        v-if=\"isNotPayPrepaid && isPaidStatus\"\n        @click=\"goToPrepaidOrder(prepaidOrderUuid)\"\n        >查看包月方案</el-button\n      >\n      <el-button\n        v-if=\"newebpayStatus === 1 || newebpayStatus === 3\"\n        type=\"primary\"\n        @click=\"handleClose\"\n        >關閉</el-button\n      >\n     \n      <el-button\n        v-else\n        type=\"primary\"\n        :loading=\"tryingCancel\"\n        v-on=\"{ click: isPaidStatus ? emitPaid : handleCancel }\"\n        >確定</el-button\n      >\n    </span>\n  </el-dialog>\n</template>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OrderChangeStatusDialog.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./OrderChangeStatusDialog.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./OrderChangeStatusDialog.vue?vue&type=template&id=d1bfe548&\"\nimport script from \"./OrderChangeStatusDialog.vue?vue&type=script&lang=js&\"\nexport * from \"./OrderChangeStatusDialog.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}