(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d1e08ad6","chunk-177d8412","chunk-177d8412","chunk-177d8412"],{"18ee":function(e,t,l){},"19d5":function(e,t,l){"use strict";var s=l("db0a"),a=l.n(s);t["default"]=a.a},5602:function(e,t,l){e.exports={slide:"BaseButtonDialog_slide_1oaPh","slide-reverse":"BaseButtonDialog_slide-reverse_2oPsW",floating:"BaseButtonDialog_floating_1ftAD","floating--active":"BaseButtonDialog_floating--active_3j2JZ",floating__order2:"BaseButtonDialog_floating__order2_1fFr3",floating__wrapper:"BaseButtonDialog_floating__wrapper_2aAl-"}},"62d4":function(e,t,l){"use strict";l.r(t);var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return e.floating?l("div",{class:e.$style["floating__wrapper"]},[e.onlyDialog?e._e():[l("el-tooltip",{attrs:{effect:"dark",content:e.tooltipText,placement:"left"}},[l("el-button",e._b({class:e.floatingClass,attrs:{type:e.buttonType,circle:e.floating},on:{click:e.manualOpen}},"el-button",e.$attrs,!1),[l("BaseIcon",{attrs:{name:e.buttonIconName}}),e._t("trigger")],2)],1)],e.onlyButton?e._e():l("el-dialog",e._b({attrs:{visible:e.dialogVisible,title:e.title,top:"0",width:e.width,"append-to-body":"","destroy-on-close":e.destroy},on:{close:e.handleClose,opened:e.dialogOpened}},"el-dialog",e.dialogProps,!1),[e._t("default")],2)],2):l("span",[e.onlyDialog?e._e():[l("el-button",e._b({attrs:{type:e.buttonType},on:{click:e.manualOpen}},"el-button",e.$attrs,!1),[l("BaseIcon",{attrs:{name:e.buttonIconName}}),e._t("trigger")],2)],e.onlyButton?e._e():l("el-dialog",e._b({attrs:{visible:e.dialogVisible,title:e.title,top:"0",width:e.width,"append-to-body":"","destroy-on-close":e.destroy},on:{close:e.handleClose,opened:e.dialogOpened}},"el-dialog",e.dialogProps,!1),[e._t("default")],2)],2)},a=[],i=l("88d8"),n={inheritAttrs:!1,props:{floating:{type:Boolean,default:!1},title:{type:String,default:""},dialogVisible:{type:Boolean,default:!1},dialogProps:{type:Object,default:function(){}},buttonTooltip:{type:String,default:""},buttonType:{type:String,default:"primary"},buttonIconName:{type:String,default:"plus"},order:{type:String,default:"1"},onlyDialog:{type:Boolean,default:!1},onlyButton:{type:Boolean,default:!1},destroy:{type:Boolean,default:!1},width:{type:String,default:"830px"}},computed:{floatingClass:function(){return[this.$style.floating,Object(i["a"])({},this.$style["floating--active"],"plus"===this.buttonIconName&&this.dialogVisible),this.$style["floating__order".concat(this.order)]]},tooltipText:function(){return this.buttonTooltip?this.buttonTooltip:this.title}},methods:{manualOpen:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("opened")},dialogOpened:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("dialog-opened")},handleClose:function(){this.onlyButton||this.$emit("update:dialogVisible",!1),this.$emit("closed")}}},o=n,r=l("be7b"),c=l("2877");function d(e){this["$style"]=r["default"].locals||r["default"]}var u=Object(c["a"])(o,s,a,!1,d,null,null);t["default"]=u.exports},a0cd:function(e,t,l){"use strict";var s=l("18ee"),a=l.n(s);a.a},be7b:function(e,t,l){"use strict";var s=l("5602"),a=l.n(s);t["default"]=a.a},db0a:function(e,t,l){e.exports={slide:"index_slide_3ZbUd","slide-reverse":"index_slide-reverse_2JKzU",page:"index_page_1TRDP","card-wrapper":"index_card-wrapper_X063L",footer:"index_footer_3X6Oz","split-labels-1":"index_split-labels-1_1_HE7","split-labels-2":"index_split-labels-2_16v9j","split-labels-3":"index_split-labels-3_3c2gV","split-labels-4":"index_split-labels-4_2ynFG","split-labels-5":"index_split-labels-5_3QAoQ","split-labels-6":"index_split-labels-6_3B3Ky","split-labels-7":"index_split-labels-7_2qnw2","split-labels-8":"index_split-labels-8_35mR3","split-labels-9":"index_split-labels-9_1wQNZ","split-labels-10":"index_split-labels-10_2fBBB","schedule-dropdown":"index_schedule-dropdown_17R_N",schedule:"index_schedule_MRK9z",filter:"index_filter_vSazs","custom-scrollbar":"index_custom-scrollbar_cxii6","zoom-reverse":"index_zoom-reverse_1CSdy",zoom:"index_zoom_32sRa"}},e014:function(e,t,l){"use strict";l.r(t);var s=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("Layout",[l("div",{class:e.$style.page,staticStyle:{"margin-bottom":"0"}},[e.visibleScheduleItem?e._e():l("BaseTableSearch",{attrs:{"hide-action":"","default-value":e.filterData,border:!0},on:{"update:defaultValue":function(t){e.filterData=t},"update:default-value":function(t){e.filterData=t},reset:function(t){return e.tryToFetchSchedule("filter")},tryToFetchList:e.tryToFetchSchedule},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.fields;return[l("el-form-item",{attrs:{prop:"productId"}},[l("el-select",{on:{change:function(t){return e.tryToFetchSchedule("filter")}},model:{value:s.productId,callback:function(t){e.$set(s,"productId",t)},expression:"fields.productId"}},[l("el-option",{attrs:{label:"所有地點",value:""}}),e._l(e.merchantProducts,function(e,t){return l("el-option",{key:"list-tag-"+t,attrs:{label:e.name,value:e.id}})})],2)],1),l("el-form-item",{attrs:{prop:"productId"}},[l("el-select",{on:{change:function(t){return e.tryToFetchSchedule("filter")}},model:{value:s.scheduleItemId,callback:function(t){e.$set(s,"scheduleItemId",t)},expression:"fields.scheduleItemId"}},[l("el-option",{attrs:{label:"所有排班人員",value:""}}),e._l(e.staffsInSchedule,function(e,t){return l("el-option",{key:t,attrs:{label:e.name,value:e.id}})})],2)],1)]}}],null,!1,2191131170)}),l("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.tryingFetchItemDetail,expression:"tryingFetchItemDetail"}],class:e.$style["card-wrapper"],staticStyle:{"margin-bottom":"0"},attrs:{"element-loading-text":"取得排班資訊中",shadow:"never"}},[l("transition-group",{attrs:{name:e.visibleScheduleItem?e.$style.zoom:e.$style["zoom-reverse"]}},[l("div",{directives:[{name:"show",rawName:"v-show",value:!e.visibleScheduleItem,expression:"!visibleScheduleItem"}],key:"vue-cal",staticClass:"vue-cal-layout"},[l("div",[l("CalendarItem",{ref:"sm-cal",attrs:{"selected-date":e.selectedDate,"calendar-events":e.calendarEvents},on:{"update:selectedDate":function(t){e.selectedDate=t},"update:selected-date":function(t){e.selectedDate=t},"view-change":e.onViewChange,rendered:e.onRenderedCalendarItem},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data,a=s.cell,i=s.events;return[l("span",{staticClass:"vuecal__cell-date",class:i[0]&&i[0].customInfo.isOpen?"is-available":""},[e._v(e._s(a.content))])]}}])}),l("el-divider")],1),l("div",{staticClass:"schedule-wrap"},[l("VueCal",{ref:"cal",staticClass:"full-cal vuecal--full-height-delete",class:[e.$style.schedule,e.$style["split-labels-"+e.staffs]],attrs:{"hide-weekends":"hide-weekends","active-view":"day",locale:"zh-hk","selected-date":e.selectedDate,"time-from":360,"time-to":1440,"split-days":e.splitLabels,"sticky-split-labels":!0,"editable-events":e.editable,events:e.events,"on-event-click":e.onEventClick,"time-step":15,"disable-views":["years","year","week","day","month"],"hide-title-bar":!0,"time-cell-height":50,"snap-to-time":1},on:{"cell-click":e.onCellClick,"view-change":e.fetchEvents},scopedSlots:e._u([{key:"split-label",fn:function(t){var s=t.split;return["create"===s.type?l("el-dropdown",{attrs:{trigger:"click"}},[l("el-button",{staticStyle:{"background-color":"#98b8ad33",height:"44px"}},[e._v("選擇人員 "),l("BaseIcon",{attrs:{"icon-style":"fal",name:"chevron-down"}})],1),l("el-dropdown-menu",{class:e.$style["schedule-dropdown"],attrs:{slot:"dropdown"},slot:"dropdown"},[l("el-dropdown-item",{nativeOn:{click:function(t){return e.createStaff(t)}}},[l("BaseIcon",{attrs:{name:"plus"}}),e._v(" 新增人員")],1),e._l(e.scheduleStaffs,function(t,s){return l("el-dropdown-item",{key:"staff-"+s,nativeOn:{click:function(l){return e.tryToStoreItem(t)}}},[e._v(e._s(t.name)+" ")])})],2)],1):e._e(),"create"===s.type||s.canDelete?e._e():l("el-button",{staticStyle:{background:"#c6c6ba66",height:"44px",width:"100%","text-align":"left","pointer-events":"none"}},[e._v("\n                  "+e._s(s.name)+"\n                ")]),"create"!==s.type&&s.canDelete?l("div",{staticStyle:{padding:"14px 20px",background:"#c6c6ba66",height:"44px",position:"relative",width:"100%","text-align":"left"}},[e._v("\n                  "+e._s(s.name)+"\n                  "),l("div",{staticClass:"cancelBtn",on:{click:function(t){return e.tryToRemoveItem(s.id)}}},[l("BaseIcon",{attrs:{"icon-style":"fal",name:"times"}})],1)]):e._e()]}},{key:"event",fn:function(t){var s=t.event;return[l("div",{staticClass:"title"},[l("div",{staticClass:"time Jost"},[e._v(e._s(s.start.format("HH:mm")+" ~ "+s.end.format("HH:mm"))+"\n                    "),l("span",{staticClass:"state",class:{"is-close":0===s.customInfo.state}},[e._v(e._s(s.customInfo.state?"開放中":"未開放"))]),l("br"),l("span",{staticClass:"cycle"},[e._v(e._s(s.customInfo.repeat))])])]),l("div",[e._v(e._s("本時段可服務 "+s.customInfo.servicesCount+" 種項目"))]),l("div",[e._v(e._s("可於 "+s.customInfo.productsCount+" 個地點服務"))]),l("el-button",{staticClass:"is-fullwidth is-round",staticStyle:{"margin-top":"10px",padding:"8px"},attrs:{type:"primary"}},[l("BaseIcon",{staticStyle:{"font-size":"20px"},attrs:{name:"edit"}})],1)]}}])}),l("div",{class:e.$style["custom-scrollbar"],attrs:{id:"custom-scrollbar"}},[l("div",{style:"height:inherit;width: "+e.mirrorWidth+"px;"})])],1)]),l("ScheduleItem",{directives:[{name:"show",rawName:"v-show",value:e.visibleScheduleItem,expression:"visibleScheduleItem"}],key:"ScheduleItem",attrs:{"default-value":e.selectedItem,"staff-name":e.selectedStaffName,day:e.selectedDateString,locations:e.merchantProducts},on:{cancel:function(t){e.visibleScheduleItem=!1},store:e.onItemStored}})],1)],1),e.visibleScheduleItem?l("div",{staticStyle:{"margin-top":"60px"}}):e._e()],1),l("BaseButtonDialog",{attrs:{width:"70%","only-dialog":"",title:"新增人員","dialog-visible":e.dialogVisible,floating:""},on:{"update:dialogVisible":function(t){e.dialogVisible=t},"update:dialog-visible":function(t){e.dialogVisible=t}}},[l("ScheduleStaffForm",{attrs:{"default-value":e.dialogItem,"access-type":"schedule"},on:{store:e.tryToStoreItem,close:e.closeDialog}})],1)],1)},a=[],i=l("9395"),n=l("f210"),o=l("4795"),r=l.n(o),c=l("cb0c"),d=l("340b"),u=l("6bea"),f=l("a315"),h=l("444f"),p=l("62d4"),m=l("7fa7"),v=l.n(m),b=(l("592c"),{page:{title:"排班",meta:[{name:"description",container:"schedule"}]},components:{Layout:h["a"],VueCal:v.a,BaseButtonDialog:p["default"],ScheduleItem:function(){return Object(f["a"])(l.e("chunk-3840a78d").then(l.bind(null,"10cc")))},CalendarItem:function(){return Object(f["a"])(l.e("chunk-1811ed17").then(l.bind(null,"05a4")))},ScheduleStaffForm:function(){return Object(f["a"])(l.e("chunk-a0f32da0").then(l.bind(null,"b062")))}},props:{staffItems:{type:Array,required:!0},merchantProducts:{type:Array,required:!0}},data:function(){return{selectedDate:new Date,selectedItem:{},filterData:{productId:"",scheduleItemId:""},visibleScheduleItem:!1,splitLabels:[],staffsInSchedule:[],events:[],calendarEvents:[],scheduleStaffs:this.staffItems,dialogVisible:!1,dialogItem:{},dialogMode:"edit",editable:{title:!1,drag:!1,resize:!1,create:!1,delete:!1},tryingFetchItemDetail:!1,selectedStaffName:"",isFirst:!0}},computed:{staffs:function(){return this.splitLabels.length},selectedDateString:function(){return this.selectedDate.format()},mirrorWidth:function(){return 200*this.splitLabels.length}},created:function(){var e=this;void 0!==this.$route.params.selectedDate&&(this.selectedDate=this.$route.params.selectedDate),this.tryToFetchSchedule();var t=setInterval(function(){void 0!==e.$refs["cal"]&&(clearInterval(t),e.handleSynchronizeScroll())},300)},beforeDestroy:function(){this.handleSynchronizeScroll(!1)},methods:{tryToFetchSchedule:function(){var e=Object(c["a"])(r.a.mark(function e(t){var l,s;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("schedule/fetchList",{date:this.selectedDateString,productId:this.filterData.productId,scheduleItemId:this.filterData.scheduleItemId});case 2:l=e.sent,s=l.scheduleItems,this.filterSplitLabels(s),this.filterEvents(s),this.filterScheduleStaffs(s),"filter"===t&&this.tryToFetchCurrentMonthly();case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tryToStoreItem:function(){var e=Object(c["a"])(r.a.mark(function e(t){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("schedule/storeItem",{date:this.selectedDateString,itemId:t.id});case 2:this.filterData.scheduleItemId="",this.filterData.productId="",this.tryToFetchSchedule();case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tryToFetchCurrentMonthly:function(){var e=this.$refs["sm-cal"].getViewInfo(),t=e.firstCellDate,l=e.lastCellDate,s=Object(u["e"])(t),a=Object(u["e"])(l);this.tryToFetchMonthly({startDate:s,endDate:a,scheduleItemId:this.filterData.scheduleItemId})},filterScheduleStaffs:function(e){this.scheduleStaffs=Object(n["a"])(this.staffItems);var t=e.map(function(e){return e.id});this.scheduleStaffs=Object(n["a"])(this.scheduleStaffs.filter(function(e){return!t.includes(e.id)}))},filterSplitLabels:function(e){var t=e.map(function(e){return{id:e.id,name:"".concat(e.name).concat(e.scheduleDetails.length?"":"（無排班）"),canDelete:0===e.scheduleDetails.length}});this.staffsInSchedule=Object(n["a"])(t),this.splitLabels=Object(n["a"])(t).concat([{type:"create"}])},filterEvents:function(e){var t=[];e.forEach(function(e){e.scheduleDetails.forEach(function(l){0===l.isFiltered&&t.push({start:l.startDate,end:l.endDate,split:e.id,customInfo:Object(i["a"])({},l)})})}),this.events=t},onCellClick:function(e){var t=e.date,l=e.split;"number"!==typeof l&&(this.tryToFetchStaffDetail(l,t),this.getSelectedStaffName(l),this.visibleScheduleItem=!0)},onEventClick:function(){var e=Object(c["a"])(r.a.mark(function e(t,l){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingFetchItemDetail=!0,e.next=3,this.$store.dispatch("schedule/fetchItemDetail",t.customInfo.id);case 3:this.selectedItem=e.sent,this.getSelectedStaffName(t.split),this.visibleScheduleItem=!0,this.tryingFetchItemDetail=!1,l.stopPropagation();case 8:case"end":return e.stop()}},e,this)}));return function(t,l){return e.apply(this,arguments)}}(),fetchEvents:function(){this.tryToFetchSchedule()},getStartEndTime:function(e){var t=Object(d["getMinutes"])(e),l="";switch(!0){case t<15:l=Object(d["setMinutes"])(e,0);break;case t<30&&t>=15:l=Object(d["setMinutes"])(e,15);break;case t<45&&t>=30:l=Object(d["setMinutes"])(e,30);break;case t<60&&t>=45:l=Object(d["setMinutes"])(e,45);break}var s=Object(d["addMinutes"])(l,15);return{startTime:Object(u["a"])(l,"time"),endTime:Object(u["a"])(s,"time")}},createStaff:function(){this.openDialog("add")},openDialog:function(e,t){this.dialogVisible=!0,this.dialogMode=e,this.$set(this.$data,"dialogItem",t)},closeDialog:function(){this.dialogVisible=!1},onItemStored:function(){this.tryToFetchSchedule(),this.tryToFetchCurrentMonthly(),this.visibleScheduleItem=!1},getSelectedStaffName:function(e){var t=this;this.splitLabels.some(function(l){return l.id===e&&(t.selectedStaffName=l.name)})},onViewChange:function(e){"month"===e.view&&this.tryToFetchMonthly({startDate:Object(u["e"])(e.firstCellDate),endDate:Object(u["e"])(e.lastCellDate),scheduleItemId:this.filterData.scheduleItemId})},tryToFetchMonthly:function(){var e=Object(c["a"])(r.a.mark(function e(t){var l;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("schedule/fetchMonthly",Object(i["a"])({},t));case 2:l=e.sent,this.calendarEvents=l.map(function(e){return{start:e.date,end:e.date,customInfo:Object(i["a"])({},e)}});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),onRenderedCalendarItem:function(){this.tryToFetchCurrentMonthly()},handleSynchronizeScroll:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.$refs.cal.$el.getElementsByClassName("vuecal__header")[0],l=this.$refs.cal.$el.querySelector("[row]"),s=this.$el.querySelector("#custom-scrollbar");e?(t.addEventListener("scroll",function(){l.scrollLeft=t.scrollLeft,s.scrollLeft=t.scrollLeft}),l.addEventListener("scroll",function(){t.scrollLeft=l.scrollLeft,s.scrollLeft=l.scrollLeft}),s.addEventListener("scroll",function(){t.scrollLeft=s.scrollLeft,l.scrollLeft=s.scrollLeft})):(t.removeEventListener("scroll",function(){l.scrollLeft=t.scrollLeft,s.scrollLeft=t.scrollLeft}),l.removeEventListener("scroll",function(){t.scrollLeft=l.scrollLeft,s.scrollLeft=l.scrollLeft}),s.removeEventListener("scroll",function(){t.scrollLeft=s.scrollLeft,l.scrollLeft=s.scrollLeft}))},tryToFetchStaffDetail:function(){var e=Object(c["a"])(r.a.mark(function e(t,l){var s,a,n,o,c;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("schedule/fetchStaffDetail",{id:t});case 2:s=e.sent,a=s.storeIds,n=s.serviceCategoryIds,o=s.productPriceIds,c=s.maxCollision,this.selectedItem=Object(i["a"])({itemId:t},this.getStartEndTime(l),{productIds:a,serviceCategoryIds:n,serviceIds:o,maxCollision:c});case 8:case"end":return e.stop()}},e,this)}));return function(t,l){return e.apply(this,arguments)}}(),tryToRemoveItem:function(){var e=Object(c["a"])(r.a.mark(function e(t){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$store.dispatch("schedule/deleteScheduleItem",{date:this.selectedDateString,itemId:t});case 3:this.tryToFetchSchedule();case 4:return e.prev=4,e.finish(4);case 6:case"end":return e.stop()}},e,this,[[0,,4,6]])}));return function(t){return e.apply(this,arguments)}}()}}),y=b,g=(l("a0cd"),l("19d5")),_=l("2877");function I(e){this["$style"]=g["default"].locals||g["default"]}var S=Object(_["a"])(y,s,a,!1,I,null,null);t["default"]=S.exports}}]);
//# sourceMappingURL=chunk-d1e08ad6.5bf67a05.js.map