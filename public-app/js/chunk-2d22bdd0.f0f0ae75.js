(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22bdd0"],{f17f:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("BasePageHeader",{scopedSlots:e._u([{key:"title",fn:function(){return[e._v("優惠券之適用對象")]},proxy:!0},{key:"right",fn:function(){return[n("el-button",{attrs:{type:"text"},on:{click:function(t){return e.changePage(0)}}},[n("span",[e._v("編輯適用對象")])]),n("el-button",{staticClass:"is-round",on:{click:function(t){return e.tryToSend("all")}}},[n("span",[e._v("全部發送")])]),n("el-button",{staticClass:"is-round",attrs:{disabled:e.enabledBulkButton},on:{click:function(t){return e.tryToSend("selected")}}},[n("span",[e._v("選取發送")])])]},proxy:!0}])}),n("div",{staticClass:"el-table-wrapper"},[n("el-table",{attrs:{"element-loading-text":"取得適用對象資訊中",data:e.availableMembers},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),n("el-table-column",{attrs:{label:"姓名電話","min-width":11},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("b",[e._v(e._s(r.fullName)+" "+e._s(e._f("genderFilter")(r.gender)))]),n("div",[e._v(e._s(r.phoneCode+" "+r.phoneNumber))])]}}])}),n("el-table-column",{attrs:{label:"標籤","min-width":11},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[n("div",e._l(r.tags,function(t){return n("el-tag",{key:"tag-"+t.id,attrs:{type:"info",effect:"plain","disable-transitions":""}},[e._v("\n            "+e._s(t.title)+"\n          ")])}),1)]}}])}),n("el-table-column",{attrs:{label:"有效訂單","min-width":11,prop:"ordersCounts"}}),n("el-table-column",{attrs:{label:"累積消費金額","min-width":11,prop:"ordersTotal"}}),n("el-table-column",{attrs:{"min-width":11,label:"最後訂單日期"},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[e._v(e._s(e._f("formatDate")(n.lastOrderDate,"dateTime")))]}}])})],1)],1)],1)},a=[],i=n("4795"),s=n.n(i),l=n("cb0c"),c=n("9395"),u=n("1b80"),o=n("7e02"),d=n("6bea"),h=n("4d77"),f=(n("2ef0"),{components:{},filters:{genderFilter:o["h"],formatDate:d["a"]},mixins:[u["c"]],props:{defaultValue:{type:Object,default:function(){}}},data:function(){return{tableData:[{id:1223}],allMembers:[],dialogVisible:!1,selectAllDialogVisible:!1,selectedMember:[],tagList:[],tryingToSend:!1,tryingFetchTag:!1,membersLimit:0,membersUsed:0}},computed:Object(c["a"])({},h["f"],{enabledBulkButton:function(){return 0===this.selectedMember.length},enabledCopyButton:function(){return 1===this.selectedMember.length},memberIds:function(){return this.selectedMember.map(function(e){return e.id})},availableMembers:function(){var e=[];if(0===this.defaultValue.availableTags.length&&0===this.defaultValue.availableMembers.length)e=this.allMembers;else{var t=this.defaultValue.availableTags.map(function(e){return e.id}),n=this.defaultValue.availableMembers.map(function(e){return e.id}),r=this.defaultValue.blockMembers.map(function(e){return e.id});e=this.allMembers.filter(function(e){var a=e.tags.map(function(e){return e.id}),i=a.some(function(e){return t.includes(e)});return!(!i||r.includes(e.id))||(!!n.includes(e.id)||void 0)})}return e}}),created:function(){this.tryToSearch()},methods:{tryToSearch:function(){var e=Object(l["a"])(s.a.mark(function e(){var t,n,r,a;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return Object.assign({},this.$route.query,this.pageQuery),e.next=3,this.$store.dispatch("member/fetchList");case 3:t=e.sent,n=t.items,r=t.membersLimit,a=t.membersUsed,t.total,this.allMembers=n,this.membersUsed=a,this.membersLimit=r;case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleSelectionChange:function(e){this.selectedMember=e},tryToFetchTag:function(){var e=Object(l["a"])(s.a.mark(function e(){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingFetchTag=!0,e.next=3,this.$store.dispatch("member/fetchTags",{search:""});case 3:this.tagList=e.sent,this.tryingFetchTag=!1;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),tryToRemove:function(){var e=Object(l["a"])(s.a.mark(function e(){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$confirm("確定刪除該適用對象？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning",center:!0});case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),tryToSend:function(){var e=Object(l["a"])(s.a.mark(function e(t){var n;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,"selected"!==t){e.next=4;break}return e.next=4,this.$confirm("確定發送".concat(this.selectedMember.length,"張優惠券"),{confirmButtonText:"確定",cancelButtonText:"取消",center:!0});case 4:if("all"!==t){e.next=7;break}return e.next=7,this.$confirm("確定發送".concat(this.availableMembers.length,"張優惠券"),{confirmButtonText:"確定",cancelButtonText:"取消",center:!0});case 7:return this.tryingToSend=!0,n={memberIds:"selected"===t?this.memberIds:this.availableMembers.map(function(e){return e.id}),couponCode:this.defaultValue.code},e.next=11,this.$store.dispatch("coupon/sendCoupon",n);case 11:this.$message({message:"發送成功！",type:"success"});case 12:return e.prev=12,this.tryingToSend=!1,e.finish(12);case 15:case"end":return e.stop()}},e,this,[[0,,12,15]])}));return function(t){return e.apply(this,arguments)}}(),changePage:function(e){this.$emit("changePage",e)}}}),m=f,b=n("2877"),p=Object(b["a"])(m,r,a,!1,null,null,null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d22bdd0.f0f0ae75.js.map