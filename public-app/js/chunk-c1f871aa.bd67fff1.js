(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c1f871aa"],{4516:function(e,t,a){e.exports={slide:"SearchMember_slide_nsDmg","slide-reverse":"SearchMember_slide-reverse_q4ptX",infoList:"SearchMember_infoList_zKtWE"}},"7ded":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.$style.customer},[a("el-form",{ref:"searchForm",staticClass:"el-form-item--normal-margin el-form-item--white-bg",class:e.$style["search-form"],attrs:{model:e.searchData,rules:e.searchRules,"label-position":"top"}},[e.isEditMode?e._e():a("el-form-item",{attrs:{prop:"phoneNumber",label:"快速查詢客戶資料"}},[a("div",{staticClass:"lineFormItem"},[a("el-input",{staticClass:"lineFormItem__input",attrs:{placeholder:"請輸入手機號碼"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.validPhoneNumber(t)}},model:{value:e.searchData.phoneNumber,callback:function(t){e.$set(e.searchData,"phoneNumber","string"===typeof t?t.trim():t)},expression:"searchData.phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:e.searchData.phoneCode,callback:function(t){e.$set(e.searchData,"phoneCode",t)},expression:"searchData.phoneCode"}})],1),a("div",{staticClass:"lineFormItem__btn"},[!e.syncEditCustomerEnabled||e.isNewMember?a("el-button",{staticClass:"is-round isInputGroup",on:{click:e.validPhoneNumber}},[e._v("查詢")]):e._e(),e.isNewMember?[e.memberInfoShow?e._e():a("el-button",{staticClass:"is-round isInputGroup",on:{click:function(t){return e.tryToStoreMember(!0)}}},[e._v("新增此客戶")])]:[!e.syncEditCustomerEnabled&&e.memberInfoShow?a("el-button",{staticClass:"is-round isInputGroup",on:{click:e.openEditMember}},[e._v("修改資料")]):e._e(),e.syncEditCustomerEnabled?a("el-button",{staticClass:"is-round isInputGroup",on:{click:function(t){e.syncEditCustomerEnabled=!1}}},[e._v(" 取消")]):e._e(),e.syncEditCustomerEnabled?a("el-button",{staticClass:"is-round isInputGroup",attrs:{type:"primary",loading:e.tryingStoreMember},on:{click:function(t){return e.tryToStoreMember(!1)}}},[e._v(" 儲存")]):e._e()]],2)],1)]),e.isNewMember?a("span",{staticClass:"alert-word"},[e._v("查無客戶資訊，快速建立客戶")]):e._e()],1),e.syncEditCustomerEnabled?[e.syncMemberDataNotYet&&e.memberInfoShow?a("span",{staticClass:"alert-word"},[e._v("請輸入完整客戶資料")]):e._e(),a("el-form",{ref:"memberForm",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:e.memberSubmitData,rules:e.memberRules,"label-position":"top"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"fullName",label:"姓名"}},[a("el-input",{attrs:{placeholder:"請輸入姓名"},model:{value:e.memberSubmitData.fullName,callback:function(t){e.$set(e.memberSubmitData,"fullName",t)},expression:"memberSubmitData.fullName"}})],1)],1),a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin gender-box",attrs:{prop:"gender"}},[a("el-radio-group",{staticClass:"no-bg-radio-group",model:{value:e.memberSubmitData.gender,callback:function(t){e.$set(e.memberSubmitData,"gender",t)},expression:"memberSubmitData.gender"}},[a("el-radio",{attrs:{label:"male"}},[e._v("先生")]),a("el-radio",{attrs:{label:"female"}},[e._v("小姐")])],1)],1)],1),a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"phone",label:"電話"}},[a("el-input",{attrs:{placeholder:"請輸入手機號碼",disabled:e.isEditMember},model:{value:e.memberSubmitData.phone,callback:function(t){e.$set(e.memberSubmitData,"phone","string"===typeof t?t.trim():t)},expression:"memberSubmitData.phone"}},[a("CountryCodePicker",{attrs:{slot:"prepend",disabled:e.isEditMember},slot:"prepend",model:{value:e.searchData.phoneCode,callback:function(t){e.$set(e.searchData,"phoneCode",t)},expression:"searchData.phoneCode"}})],1)],1)],1),a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"標籤"}},[a("el-select",{attrs:{"value-key":"id",multiple:"",placeholder:"請選擇"},model:{value:e.memberSubmitData.tagIds,callback:function(t){e.$set(e.memberSubmitData,"tagIds",t)},expression:"memberSubmitData.tagIds"}},e._l(e.tagList,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1)],1),a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{attrs:{label:"Email"}},[a("el-input",{attrs:{placeholder:"Email"},model:{value:e.memberSubmitData.email,callback:function(t){e.$set(e.memberSubmitData,"email",t)},expression:"memberSubmitData.email"}})],1)],1),a("el-col",{attrs:{span:24,md:12}},[a("el-form-item",{attrs:{label:"LINE ID"}},[a("el-input",{attrs:{placeholder:"LINE ID"},model:{value:e.memberSubmitData.lineId,callback:function(t){e.$set(e.memberSubmitData,"lineId",t)},expression:"memberSubmitData.lineId"}})],1)],1)],1)],1)]:e._e(),e.memberInfoShow&&!e.syncEditCustomerEnabled?[a("div",{class:e.$style.infoList},[a("div",{staticClass:"infoList__row"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"infoList__title",attrs:{span:24}},[e._v(" 客戶資訊")]),a("el-col",{attrs:{span:24}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[e._v(" "+e._s(e.memberInfo.fullName)+" "+e._s(e._f("genderFilter")(e.memberInfo.gender))+" ")]),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[e._v(" "+e._s(e.memberInfo.phoneCode+" "+e.memberInfo.phoneNumber))]),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[e.memberInfo.tags.length>0?e._l(e.memberInfo.tags,function(t){return a("el-tag",{key:"tag-"+t.id,attrs:{type:"info",effect:"plain","disable-transitions":""}},[e._v("\n                    "+e._s(t.title)+"\n                  ")])}):[a("span",{staticClass:"muted"},[e._v(" 目前尚無標籤")])]],2),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[e._v("LINE ID: "+e._s(e.memberInfo.lineId)+" ")])],1)],1)],1)],1),a("div",{staticClass:"infoList__row"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"infoList__title",attrs:{span:24}},[e._v(" 內部備註")]),a("el-col",{staticClass:"infoList__item",attrs:{span:24}},[e.memberInfo.merchantNote?a("span",{staticClass:"muted",domProps:{innerHTML:e._s(e.memberInfo.merchantNote)}}):a("span",{staticClass:"muted"},[e._v("目前尚無備註")])])],1)],1)])]:e._e()],2)},s=[],i=a("9395"),n=a("4795"),m=a.n(n),o=a("cb0c"),l=a("a315"),c=a("7e02"),u=a("6bea"),b={components:{CountryCodePicker:function(){return Object(l["a"])(a.e("chunk-66428ff2").then(a.bind(null,"e05d")))}},filters:{genderFilter:c["h"]},props:{scheduleDetail:{type:Object,default:function(){}},syncMemberInfo:{type:Object,default:function(){}},isEditMode:{type:String,default:""},memberInfoShow:{type:Boolean,defalut:!1},editCustomerEnabled:{type:Boolean,defalut:!1},memberDataNotYet:{type:Boolean,defalut:!1}},data:function(){return{searchData:{phoneCode:"+886",phoneNumber:""},memberInfo:{},memberSubmitData:{fullName:"",phone:"",email:"",tagIds:[],gender:"male",lineId:""},tagList:[],tryingStoreMember:!1,isEditMember:!1,isNewMember:!1}},computed:{syncEditCustomerEnabled:{get:function(){return this.editCustomerEnabled},set:function(e){this.$emit("update:editCustomerEnabled",e)}},searchRules:function(){var e=this,t="+886"===this.searchData.phoneCode;return{phoneNumber:[{pattern:t?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"},{validator:function(t,a,r){if(!a)return r();e.tryToSearchMember()},trigger:"custom"}]}},memberRules:function(){var e="+886"===this.searchData.phoneCode;return{fullName:[{required:!0,message:"請輸入姓名"}],phone:[{required:!0,message:"請填寫手機號碼",trigger:"blur"},{pattern:e?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別"}],email:[{required:!0,message:"請輸入 Email"},{type:"email",message:"請輸入正確的 Email 格式"}]}},syncMemberDataNotYet:function(){return!this.memberInfo.fullName||!this.memberInfo.gender}},watch:{syncMemberDataNotYet:{handler:function(e){this.$emit("update:memberDataNotYet",e)},immediate:!0}},created:function(){this.tryToFetchTagList()},methods:{tryToFetchTagList:function(){var e=Object(o["a"])(m.a.mark(function e(t){return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("member/fetchTags",{search:t});case 2:this.tagList=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),validPhoneNumber:function(e){this.$refs.searchForm.validateField("phoneNumber")},tryToSearchMember:function(){var e=Object(o["a"])(m.a.mark(function e(){var t=this;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.scheduleDetail&&(this.searchData.bookingDateTime="".concat(Object(u["a"])(this.scheduleDetail.date,"date-dash")," ").concat(Object(u["a"])(this.scheduleDetail.date,"time"))),this.$store.dispatch("member/findByPhone",this.searchData).then(function(e){t.memberInfo=e,t.$emit("update:syncMemberInfo",e),t.$emit("updateMemberInfo",e),t.isNewMember=!1,t.syncEditCustomerEnabled=!1,t.memberSubmitData={fullName:"",phone:"",email:"",tagIds:[],gender:"",lineId:""},t.syncMemberDataNotYet&&t.openEditMember()}).catch(function(){t.memberInfo={},t.$emit("update:syncMemberInfo",{}),t.$emit("updateMemberInfo"),t.isNewMember=!0,t.syncEditCustomerEnabled=!0,t.memberSubmitData={fullName:"",phone:t.searchData.phoneNumber,email:"",tagIds:[],gender:"male",lineId:""}});case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),openEditMember:function(){this.syncEditCustomerEnabled=!0,this.$nextTick(function(){}),this.memberSubmitData.phone=this.memberInfo.phoneNumber,this.memberSubmitData.email=this.memberInfo.email||"",this.memberSubmitData.fullName=this.memberInfo.fullName||"",this.memberSubmitData.lineId=this.memberInfo.lineId||"",this.memberSubmitData.tagIds=this.memberInfo.tags.map(function(e){return e.id}),this.memberSubmitData.gender=this.memberInfo.gender||"",this.isEditMember=!0},tryToStoreMember:function(){var e=Object(o["a"])(m.a.mark(function e(t){var a=this;return m.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.memberForm.validate();case 2:if(this.tryingStoreMember=!0,t){e.next=8;break}return e.next=6,this.$store.dispatch("member/store",Object(i["a"])({},this.memberSubmitData,{id:this.memberInfo.id}));case 6:e.next=10;break;case 8:return e.next=10,this.$store.dispatch("member/store",Object(i["a"])({},this.memberSubmitData));case 10:this.searchData.phoneNumber=this.memberSubmitData.phone,this.$store.dispatch("member/findByPhone",this.searchData).then(function(e){a.memberInfo=e,a.$emit("update:syncMemberInfo",e),a.$emit("updateMemberInfo",e),a.syncEditCustomerEnabled=!1,a.tryingStoreMember=!1,a.isNewMember=!1});case 12:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()}},d=b,p=a("8770"),h=a("2877");function f(e){this["$style"]=p["default"].locals||p["default"]}var g=Object(h["a"])(d,r,s,!1,f,null,null);t["default"]=g.exports},8770:function(e,t,a){"use strict";var r=a("4516"),s=a.n(r);t["default"]=s.a}}]);
//# sourceMappingURL=chunk-c1f871aa.bd67fff1.js.map