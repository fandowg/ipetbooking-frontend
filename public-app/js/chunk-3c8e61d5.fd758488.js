(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c8e61d5","chunk-177d8412","chunk-177d8412","chunk-177d8412"],{"3c98":function(t,e,a){"use strict";var i=a("1547");class n extends i["a"]{async write(t){if("undefined"===typeof navigator||!navigator.clipboard)throw this.unavailable("Clipboard API not available in this browser");if(void 0!==t.string)await this.writeText(t.string);else if(t.url)await this.writeText(t.url);else{if(!t.image)throw new Error("Nothing to write");if("undefined"===typeof ClipboardItem)throw this.unavailable("Writing images to the clipboard is not supported in this browser");try{const a=await(await fetch(t.image)).blob(),i=new ClipboardItem({[a.type]:a});await navigator.clipboard.write([i])}catch(e){throw new Error("Failed to write image")}}}async read(){if("undefined"===typeof navigator||!navigator.clipboard)throw this.unavailable("Clipboard API not available in this browser");if("undefined"===typeof ClipboardItem)return this.readText();try{const e=await navigator.clipboard.read(),a=e[0].types[0],i=await e[0].getType(a),n=await this._getBlobData(i,a);return{value:n,type:a}}catch(t){return this.readText()}}async readText(){if("undefined"===typeof navigator||!navigator.clipboard||!navigator.clipboard.readText)throw this.unavailable("Reading from clipboard not supported in this browser");const t=await navigator.clipboard.readText();return{value:t,type:"text/plain"}}async writeText(t){if("undefined"===typeof navigator||!navigator.clipboard||!navigator.clipboard.writeText)throw this.unavailable("Writting to clipboard not supported in this browser");await navigator.clipboard.writeText(t)}_getBlobData(t,e){return new Promise((a,i)=>{const n=new FileReader;e.includes("image")?n.readAsDataURL(t):n.readAsText(t),n.onloadend=(()=>{const t=n.result;a(t)}),n.onerror=(t=>{i(t)})})}}a.d(e,"a",function(){return o});const o=Object(i["b"])("Clipboard",{web:()=>new n})},"3cd9":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[0!==t.defaultValue.status?[a("el-button",{staticClass:"icon-text",on:{click:function(e){t.writeDialogVisible=!0}}},[a("BaseIcon",{attrs:{name:"envelope","icon-style":"fal"}}),t._v("撰寫通知")],1),t.currentUserRoutes.includes("view-member")?a("el-button",{staticClass:"icon-text",on:{click:t.showMemberDialog}},[a("BaseIcon",{attrs:{name:"address-card","icon-style":"fal"}}),t._v("查看客戶資訊")],1):t._e(),t.currentUserRoutes.includes("chat")&&t.relatedChat.length>0?a("el-button",{staticClass:"icon-text",on:{click:t.showChatHistory}},[t._v("\n      查看問答紀錄\n      "),a("el-dialog",{attrs:{title:"請選擇欲查看的紀錄",visible:t.chatHistoryDialogVisible,top:"0",width:"680px","append-to-body":""},on:{"update:visible":function(e){t.chatHistoryDialogVisible=e}}},[a("div",{class:t.$style.chat},t._l(t.relatedChat,function(e,i){return a("div",{key:i,staticClass:"message",on:{click:function(a){return a.stopPropagation(),t.onHistoryClick(e)}}},[a("div",{staticClass:"text"},[t._v(t._s(e.data.message||"客戶傳送了圖片。"))]),a("div",{staticClass:"name-date"},[a("div",{staticClass:"date"},[t._v(t._s(t._f("formatDate")(e.data.created_at,"dateTime")))])])])}),0)])],1):t._e(),5!==t.defaultValue.status?a("el-button",{staticClass:"icon-text",on:{click:t.showShareDialog}},[a("BaseIcon",{attrs:{name:"paper-plane","icon-style":"fal"}}),t._v("分享"+t._s(t.linkTitle)+"頁面連結")],1):t._e(),1===t.defaultValue.status||2===t.defaultValue.status?a("el-button",{staticClass:"icon-text",attrs:{loading:t.tryingSendEmail},on:{click:t.tryToSendEmail}},[a("BaseIcon",{attrs:{name:"paper-plane","icon-style":"fal"}}),t._v("發送"+t._s(t.linkTitle)+"連結至使用人Email")],1):t._e(),a("el-dialog",{attrs:{title:"分享連結",visible:t.shareDialogVisible,top:"0",width:"680px","append-to-body":"","lock-scroll":""},on:{"update:visible":function(e){t.shareDialogVisible=e},open:t.tryToGetShareLink}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("h5",[t._v(t._s("#"+t.defaultValue.id))]),a("ul",[a("li",[t._v("使用人："+t._s(t.defaultValue.fullName)+" "+t._s(t._f("genderFilter")(t.defaultValue.gender)))]),a("li",[t._v("訂購內容："+t._s(t.defaultValue.productName)+" "+t._s(t._f("formatDate")(t.defaultValue.date))+" "+t._s(t.defaultValue.time))])])]),a("div",{class:t.$style["share__buttons"]},[a("el-button",{class:t.$style["share__button"],attrs:{type:"text"},on:{click:function(e){return t.handleShareLink("facebook")}}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"facebook-f","icon-style":"fab"}})],1),a("el-button",{class:t.$style["share__button"],attrs:{type:"text"},on:{click:function(e){return t.handleShareLink("line")}}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"line","icon-style":"fab"}})],1),a("el-button",{class:t.$style["share__button"],attrs:{type:"text",loading:t.tryingSendSMS},on:{click:t.tryToSendSMS}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"sms"}})],1),a("div",{class:t.$style["share__button"]},[a("el-button",{attrs:{circle:""},on:{click:t.copyShareLink}},[a("BaseIcon",{attrs:{name:"copy"}})],1),a("div",{class:t.$style["share__label"]},[t._v("複製連結")])],1)],1)]),a("BaseButtonDialog",{attrs:{"only-dialog":!0,title:"撰寫通知","dialog-visible":t.writeDialogVisible,destroy:!0,floating:""},on:{"update:dialogVisible":function(e){t.writeDialogVisible=e},"update:dialog-visible":function(e){t.writeDialogVisible=e}}},[a("NotificationWrite",{attrs:{"selected-order-ids":[t.defaultValue.id],"source-name":"order","source-order":t.defaultValue},on:{close:t.closeDialog}})],1)]:[t.currentUserRoutes.includes("view-member")?a("el-button",{staticClass:"icon-text",on:{click:t.showMemberDialog}},[a("BaseIcon",{attrs:{name:"address-card","icon-style":"fal"}}),t._v("查看客戶資訊")],1):t._e()],a("OrderMemberDialog",{attrs:{visible:t.memberDialogVisible,"member-id":t.defaultValue.memberId},on:{"update:visible":function(e){t.memberDialogVisible=e}}})],2)},n=[],o=a("4795"),s=a.n(o),r=a("cb0c"),l=a("9395"),c=a("a315"),d=a("62d4"),u=a("7e02"),h=a("6bea"),p=a("3c98"),f=a("4d77"),b={components:{BaseButtonDialog:d["default"],NotificationWrite:function(){return Object(c["a"])(a.e("chunk-6e54ddcf").then(a.bind(null,"0ca1")))},OrderMemberDialog:function(){return Object(c["a"])(a.e("chunk-2e165cfa").then(a.bind(null,"795e")))}},filters:{formatDate:h["a"],genderFilter:u["h"]},props:{defaultValue:{type:Object,default:function(){}}},data:function(){return{writeDialogVisible:!1,memberDialogVisible:!1,relatedChat:[],chatHistoryDialogVisible:!1,shareLink:"",shareDialogVisible:!1,mapStatusName:{PAID:"訂單資訊",UNPAID:"付款"},tryingSendSMS:!1,tryingSendEmail:!1}},created:function(){this.currentUserRoutes.includes("chat")&&this.tryToFetchChat()},computed:Object(l["a"])({},f["b"],{isOnChatView:function(){return"view-chat"===this.$route.name},linkTitle:function(){var t=this.defaultValue.addOrders;if(t.length){var e=!1;return e=t.some(function(t){return 2===t.status}),this.mapStatusName[e?"UNPAID":"PAID"]}return this.mapStatusName[this.defaultValue.paymentStatus]}}),methods:{showMemberDialog:function(){this.memberDialogVisible=!0},tryToGetShareLink:function(){var t=Object(r["a"])(s.a.mark(function t(){return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("order/getLink",this.defaultValue.id);case 2:this.shareLink=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToFetchChat:function(){var t=Object(r["a"])(s.a.mark(function t(){var e;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.defaultValue,t.next=3,this.$store.dispatch("member/fetchOrderRelatedChat",{phone:"".concat(e.phoneCode,"-").concat(e.phoneNumber),page:1,limit:100,order_id:e.id});case 3:this.relatedChat=t.sent;case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),showChatHistory:function(){this.relatedChat.length>1?this.chatHistoryDialogVisible=!0:(this.$store.dispatch("member/updateMessageId",this.relatedChat[0]),this.redirectToChatView(this.relatedChat[0].data.id))},onHistoryClick:function(t){this.$store.dispatch("member/updateMessageId",t),this.redirectToChatView(t.data.id)},redirectToChatView:function(t){if(this.isOnChatView)return this.chatHistoryDialogVisible=!1,void this.$emit("close");this.$router.push({name:"view-chat",params:{memberId:this.defaultValue.memberId,messageId:t}})},showShareDialog:function(){this.shareDialogVisible=!0},copyShareLink:function(){var t=Object(r["a"])(s.a.mark(function t(){var e;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=document.createElement("INPUT"),document.body.appendChild(e),e.setAttribute("value",this.shareLink),e.select(),document.execCommand("copy"),document.body.removeChild(e),t.next=9,p["a"].write({string:this.shareLink});case 9:this.$message("連結複製成功");case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleShareLink:function(t){var e={facebook:"https://www.facebook.com/sharer/sharer.php?u=".concat(this.shareLink),line:"https://social-plugins.line.me/lineit/share?url=".concat(this.shareLink)};window.open(e[t],"_blank")},tryToSendEmail:function(){var t=Object(r["a"])(s.a.mark(function t(){var e=this;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingSendEmail=!0,t.prev=1,t.next=4,this.$store.dispatch("order/sendLink",{orderId:this.defaultValue.id,router:"email"});case 4:this.$alert("已發送".concat(this.linkTitle,"連結至使用人 Email"),"Email 發送成功！",{confirmButtonText:"確認",center:!0,callback:function(){e.tryingSendEmail=!1}}),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),this.tryingSendEmail=!1;case 10:case"end":return t.stop()}},t,this,[[1,7]])}));return function(){return t.apply(this,arguments)}}(),tryToSendSMS:function(){var t=Object(r["a"])(s.a.mark(function t(){var e=this;return s.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingSendSMS=!0,t.prev=1,t.next=4,this.$store.dispatch("order/sendLink",{orderId:this.defaultValue.id,router:"sms"});case 4:this.$alert("已發送".concat(this.linkTitle,"連結簡訊至使用人電話"),"簡訊發送成功！",{confirmButtonText:"確認",center:!0,callback:function(){e.tryingSendSMS=!1}}),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),this.tryingSendSMS=!1;case 10:case"end":return t.stop()}},t,this,[[1,7]])}));return function(){return t.apply(this,arguments)}}(),closeDialog:function(){this.writeDialogVisible=!1}}},g=b,m=a("7905"),_=a("2877");function y(t){this["$style"]=m["default"].locals||m["default"]}var v=Object(_["a"])(g,i,n,!1,y,null,null);e["default"]=v.exports},5602:function(t,e,a){t.exports={slide:"BaseButtonDialog_slide_1oaPh","slide-reverse":"BaseButtonDialog_slide-reverse_2oPsW",floating:"BaseButtonDialog_floating_1ftAD","floating--active":"BaseButtonDialog_floating--active_3j2JZ",floating__order2:"BaseButtonDialog_floating__order2_1fFr3",floating__wrapper:"BaseButtonDialog_floating__wrapper_2aAl-"}},"62d4":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.floating?a("div",{class:t.$style["floating__wrapper"]},[t.onlyDialog?t._e():[a("el-tooltip",{attrs:{effect:"dark",content:t.tooltipText,placement:"left"}},[a("el-button",t._b({class:t.floatingClass,attrs:{type:t.buttonType,circle:t.floating},on:{click:t.manualOpen}},"el-button",t.$attrs,!1),[a("BaseIcon",{attrs:{name:t.buttonIconName}}),t._t("trigger")],2)],1)],t.onlyButton?t._e():a("el-dialog",t._b({attrs:{visible:t.dialogVisible,title:t.title,top:"0",width:t.width,"append-to-body":"","destroy-on-close":t.destroy},on:{close:t.handleClose,opened:t.dialogOpened}},"el-dialog",t.dialogProps,!1),[t._t("default")],2)],2):a("span",[t.onlyDialog?t._e():[a("el-button",t._b({attrs:{type:t.buttonType},on:{click:t.manualOpen}},"el-button",t.$attrs,!1),[a("BaseIcon",{attrs:{name:t.buttonIconName}}),t._t("trigger")],2)],t.onlyButton?t._e():a("el-dialog",t._b({attrs:{visible:t.dialogVisible,title:t.title,top:"0",width:t.width,"append-to-body":"","destroy-on-close":t.destroy},on:{close:t.handleClose,opened:t.dialogOpened}},"el-dialog",t.dialogProps,!1),[t._t("default")],2)],2)},n=[],o=a("88d8"),s={inheritAttrs:!1,props:{floating:{type:Boolean,default:!1},title:{type:String,default:""},dialogVisible:{type:Boolean,default:!1},dialogProps:{type:Object,default:function(){}},buttonTooltip:{type:String,default:""},buttonType:{type:String,default:"primary"},buttonIconName:{type:String,default:"plus"},order:{type:String,default:"1"},onlyDialog:{type:Boolean,default:!1},onlyButton:{type:Boolean,default:!1},destroy:{type:Boolean,default:!1},width:{type:String,default:"830px"}},computed:{floatingClass:function(){return[this.$style.floating,Object(o["a"])({},this.$style["floating--active"],"plus"===this.buttonIconName&&this.dialogVisible),this.$style["floating__order".concat(this.order)]]},tooltipText:function(){return this.buttonTooltip?this.buttonTooltip:this.title}},methods:{manualOpen:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("opened")},dialogOpened:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("dialog-opened")},handleClose:function(){this.onlyButton||this.$emit("update:dialogVisible",!1),this.$emit("closed")}}},r=s,l=a("be7b"),c=a("2877");function d(t){this["$style"]=l["default"].locals||l["default"]}var u=Object(c["a"])(r,i,n,!1,d,null,null);e["default"]=u.exports},7905:function(t,e,a){"use strict";var i=a("b00c"),n=a.n(i);e["default"]=n.a},b00c:function(t,e,a){t.exports={slide:"More_slide_2OQGp","slide-reverse":"More_slide-reverse_5M-Ka",share__buttons:"More_share__buttons_34s26",share__button:"More_share__button_1HMQT",share__icon:"More_share__icon_1Zg7t",share__label:"More_share__label_VOJ9V",chat:"More_chat_BXKj8"}},be7b:function(t,e,a){"use strict";var i=a("5602"),n=a.n(i);e["default"]=n.a}}]);
//# sourceMappingURL=chunk-3c8e61d5.fd758488.js.map