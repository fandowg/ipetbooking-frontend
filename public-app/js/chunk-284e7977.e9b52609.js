(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-284e7977"],{"33cd":function(e,t,a){e.exports={wrapper:"PrepaidOrderForm_wrapper_1wFT_",slide:"PrepaidOrderForm_slide_1vrtW","slide-reverse":"PrepaidOrderForm_slide-reverse_IkEaE",infoList:"PrepaidOrderForm_infoList_2Bz-g","search-form":"PrepaidOrderForm_search-form_1wHRx",title:"PrepaidOrderForm_title_OML5S",info:"PrepaidOrderForm_info_3a6t1","params-options":"PrepaidOrderForm_params-options_1ZMFX","params-list":"PrepaidOrderForm_params-list_1wHw3","params-list__item":"PrepaidOrderForm_params-list__item_2cBSx","payment-methods":"PrepaidOrderForm_payment-methods_2QtTP"}},"8b4c":function(e,t,a){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=s(e);a.scrollTo({top:n(e)-t,behavior:"smooth"})}function i(e){var t=e.scrollHeight>e.clientHeight,a=window.getComputedStyle(e).overflowY,r=["scroll","auto"].includes(a);return t&&r}function s(e){return i(e)?e:s(e.parentElement)}function n(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return t}}a.d(t,"a",function(){return r})},cf57:function(e,t,a){"use strict";var r=a("33cd"),i=a.n(r);t["default"]=i.a},facf:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.$style.wrapper},[a("SearchMember",{ref:"SearchMember",attrs:{"sync-member-info":e.memberInfo,"is-edit-mode":e.isEditMode,"member-info-show":e.memberInfoShow,"edit-customer-enabled":e.editCustomerEnabled},on:{"update:syncMemberInfo":function(t){e.memberInfo=t},"update:sync-member-info":function(t){e.memberInfo=t},"update:editCustomerEnabled":function(t){e.editCustomerEnabled=t},"update:edit-customer-enabled":function(t){e.editCustomerEnabled=t},updateMemberInfo:e.updateMemberInfo}}),a("el-form",{ref:"form",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:e.submitData,rules:e.submitRules,"label-position":"top"}},[e.prepaid?[0!==e.prepaid.price?a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[e.isEditMode?e._e():a("el-form-item",{attrs:{prop:"status",label:"選擇體型"}},[a("el-select",{attrs:{placeholder:"選擇體型"},on:{change:e.changeSize},model:{value:e.prepaidId,callback:function(t){e.prepaidId=t},expression:"prepaidId"}},e._l(e.prepaid.prepaids,function(e,t){return a("el-option",{key:e.id,attrs:{value:e.id,label:e.sizeTitle+" / "+e.price+"元"}})}),1)],1),a("el-form-item",{attrs:{prop:"status",label:"訂單狀態"}},[a("el-select",{attrs:{placeholder:"訂單狀態"},model:{value:e.submitData.status,callback:function(t){e.$set(e.submitData,"status",t)},expression:"submitData.status"}},e._l(e.filteredStatusMap,function(e,t){return a("el-option",{key:t,attrs:{value:+t,label:e.text}})}),1)],1)],1),a("el-col",{attrs:{span:24}},[[a("el-form-item",{class:e.$style["payment-methods"],attrs:{label:"付款方式",prop:"paymentMethod"}},[a("el-radio-group",{model:{value:e.submitData.paymentMethod,callback:function(t){e.$set(e.submitData,"paymentMethod",t)},expression:"submitData.paymentMethod"}},[2===e.submitData.status?a("el-radio",{attrs:{label:"",border:""}},[e._v("不指定")]):e._e(),a("el-radio",{attrs:{label:"Cash",border:""}},[e._v("到店付款(現金)")]),a("el-radio",{attrs:{label:"StoreCredit",border:""}},[e._v("現場刷卡")]),a("el-radio",{attrs:{label:"Atm",border:""}},[e._v("線下匯款")]),2===e.submitData.status&&1===e.storeCashflowSetting?a("el-radio",{attrs:{label:"Credit",border:""}},[e._v("信用卡付款")]):e._e(),2===e.submitData.status&&0!==e.storeCashflowSetting?a("el-radio",{attrs:{label:"Vacc",border:""}},[e._v("ATM虛擬帳戶")]):e._e()],1)],1),"Vacc"===e.submitData.paymentMethod?a("el-form-item",{attrs:{prop:"bankType",label:"轉帳銀行"}},[a("el-select",{model:{value:e.submitData.bankType,callback:function(t){e.$set(e.submitData,"bankType",t)},expression:"submitData.bankType"}},e._l(e.bankTypeList,function(e,t){return a("el-option",{key:"bank-"+t,attrs:{value:e.id,label:e.title}})}),1)],1):e._e()]],2)],1):e._e(),0===e.prepaid.price?a("el-alert",{staticStyle:{"margin-bottom":"20px"},attrs:{title:"本包月方案免費",type:"warning",closable:!1}}):e._e()]:e._e(),e.prepaid?e._e():[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{prop:"status",label:"訂單狀態"}},[a("el-select",{attrs:{placeholder:"訂單狀態"},model:{value:e.submitData.status,callback:function(t){e.$set(e.submitData,"status",t)},expression:"submitData.status"}},e._l(e.filteredStatusMap,function(e,t){return a("el-option",{key:t,attrs:{value:+t,label:e.text}})}),1)],1)],1),a("el-col",{attrs:{span:14}},[2===e.defaultValue.status&&0!==e.submitData.status?[a("el-form-item",{class:e.$style["payment-methods"],attrs:{label:"付款方式",prop:"paymentMethod"}},[a("el-radio-group",{model:{value:e.submitData.paymentMethod,callback:function(t){e.$set(e.submitData,"paymentMethod",t)},expression:"submitData.paymentMethod"}},[2===e.submitData.status?a("el-radio",{attrs:{label:"",border:""}},[e._v("不指定")]):e._e(),a("el-radio",{attrs:{label:"Cash",border:""}},[e._v("到店付款(現金)")]),a("el-radio",{attrs:{label:"StoreCredit",border:""}},[e._v("現場刷卡")]),a("el-radio",{attrs:{label:"Atm",border:""}},[e._v("線下匯款")]),2===e.submitData.status&&1===e.storeCashflowSetting?a("el-radio",{attrs:{label:"Credit",border:""}},[e._v("信用卡付款")]):e._e(),2===e.submitData.status&&0!==e.storeCashflowSetting?a("el-radio",{attrs:{label:"Vacc",border:""}},[e._v("ATM虛擬帳戶")]):e._e()],1)],1),"Vacc"===e.submitData.paymentMethod?a("el-form-item",{attrs:{prop:"bankType",label:"轉帳銀行"}},[a("el-select",{model:{value:e.submitData.bankType,callback:function(t){e.$set(e.submitData,"bankType",t)},expression:"submitData.bankType"}},e._l(e.bankTypeList,function(e,t){return a("el-option",{key:"bank-"+t,attrs:{value:e.id,label:e.title}})}),1)],1):e._e()]:e._e()],2)],1)],e.isEditMode?e._e():[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{sm:15,span:24}},[a("el-form-item",{attrs:{label:"折扣類型",prop:"type"}},[a("el-radio-group",{model:{value:e.submitData.type,callback:function(t){e.$set(e.submitData,"type",t)},expression:"submitData.type"}},[a("el-radio",{staticStyle:{background:"none"},attrs:{label:"fixed"}},[e._v("固定金額")]),a("el-radio",{staticStyle:{background:"none"},attrs:{label:"%"}},[e._v("按訂單總額比例")])],1)],1)],1),a("el-col",{attrs:{sm:9,span:24}},[a("el-form-item",{attrs:{label:"數值",prop:"discount"}},[a("el-input",{attrs:{min:"0"},scopedSlots:e._u([{key:"append",fn:function(){return[e._v(e._s(e._f("numberUnitFilter")(e.submitData.type)))]},proxy:!0}],null,!1,3217582896),model:{value:e.submitData.discount,callback:function(t){e.$set(e.submitData,"discount",e._n(t))},expression:"submitData.discount"}})],1)],1)],1)],e.isEditMode?[a("el-form-item",{attrs:{label:"客戶資訊"}},[a("ul",{class:e.$style.info},[a("li",[e._v(e._s(e.submitData.fullName)+" "+e._s(e._f("genderFilter")(e.submitData.gender)))]),a("li",[e._v(e._s(e.submitData.phoneCode+" "+e.submitData.phoneNumber))]),a("li",[e._v(e._s(e.submitData.email))])])])]:e._e()],2),a("Portal",{attrs:{to:"drawer-prepaid-header"}},[a("el-button",{staticClass:"is-round",attrs:{type:"primary",disabled:e.tryingStore||e.isNotReady,loading:e.tryingStore},on:{click:e.handleStoreOrder}},[e._v(e._s(e.isEditMode?"儲存變更":"新增訂單"))]),a("el-button",{staticClass:"is-round",on:{click:e.emitCancel}},[e._v(e._s("取消"+(e.isEditMode?"編輯":"新增")))])],1),a("OrderChangeStatusDialog",{attrs:{visible:e.statusDialogVisible,order:e.submitData},on:{"update:visible":function(t){e.statusDialogVisible=t},paid:e.handlePaidStatus,cancelled:e.emitStore}})],1)},i=[],s=a("4795"),n=a.n(s),o=a("cb0c"),l=a("9395"),u=a("a315"),d=a("7e02"),c=a("2b88"),m=a("4d77"),p=a("8b4c"),b=function(){return{prepaidId:"",fullName:"",gender:"female",phoneCode:"+886",phoneNumber:"",email:"",note:"",status:2,memberId:"",paymentMethod:"Cash",bankType:"",taxType:"B2C",CarrierType:"",CarrierNum:"",taxId:"",LoveCode:"",invoiceSync:!0,type:"fixed",discount:0}},f={components:{SearchMember:function(){return Object(u["a"])(a.e("chunk-c1f871aa").then(a.bind(null,"7ded")))},CountryCodePicker:function(){return Object(u["a"])(a.e("chunk-66428ff2").then(a.bind(null,"e05d")))},OrderChangeStatusDialog:function(){return Object(u["a"])(a.e("chunk-2d0e6716").then(a.bind(null,"9988")))},Portal:c["Portal"],InvoiceForm:function(){return Object(u["a"])(a.e("chunk-2d0ab0e8").then(a.bind(null,"143b")))}},filters:{genderFilter:d["h"],numberUnitFilter:d["j"]},props:{defaultValue:{type:Object,default:function(){return b()}},prepaid:{type:Object,default:function(){}},selectPrice:{type:Number,default:0}},data:function(){return{tryingStore:!1,submitData:Object.assign({},this.defaultValue),prepaidId:"",statusDialogVisible:!1,memberInfo:{},bankTypeList:[{id:"BOT",title:"台灣銀行"},{id:"Taishin",title:"台新"},{id:"HNCB",title:"華南"}],editCustomerEnabled:!1}},computed:Object(l["a"])({},m["b"],m["g"],{submitRules:function(){var e=this,t="+886"===this.submitData.phoneCode,a=function(t,a,r){e.$refs.form.validateField("discount"),r()};return{phoneNumber:[{required:!0,message:"請填寫手機號碼",trigger:"blur"},{pattern:t?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"}],email:[{required:!0,message:"請輸入 Email"},{type:"email",message:"請輸入正確的 Email 格式"}],fullName:[{required:!0,message:"請輸入客戶姓名"},{validator:function(t,a,r){e.submitData.gender?r():r(new Error("請選擇客戶性別！"))},trigger:"blur"}],bankType:[{required:!0,message:"請選擇轉帳銀行"}],paymentMethod:[{required:!0,validator:function(t,a,r){2!==e.submitData.status&&""===a&&r(new Error("請選擇付款方式")),r()},trigger:"change"}],type:[{validator:a,trigger:"change"}],discount:[{type:"number",min:0,max:"%"===this.submitData.type?100:null,message:"%"===this.submitData.type?"請輸入小於 100 之數字":"請輸入欲折扣之數值"}]}},isEditMode:function(){return this.defaultValue.id},isNotReady:function(){var e=!this.isEditMode&&!this.memberInfoShow,t=!this.isEditMode&&!this.prepaidId;return e||t},statusIsChanged:function(){return this.defaultValue.status!==this.submitData.status},filteredStatusMap:function(){var e=this,t=Object.keys(d["p"]).filter(function(t){switch(e.defaultValue.status){case 1:return+t<2;case 2:return+t<=2;default:return!1}}).reduce(function(e,t){return e[t]=d["p"][t],e},{}),a=Object.keys(d["p"]).filter(function(t){return t>0&&t<=e.defaultValue.status}).reduce(function(e,t){return e[t]=d["p"][t],e},{});return this.isEditMode?t:a},isMemberInfoIncomplete:function(){return this.memberInfo==={}||null===this.memberInfo.email},CarrierNumExample:function(){return 1===this.submitData.CarrierType?"例：AB01234567898765":"例：/ABC+123"},storeCashflowSetting:function(){return this.prepaid?this.prepaid.storeCashflowSetting:this.defaultValue.storeCashflowSetting},memberInfoShow:function(){return 0!==Object.keys(this.memberInfo).length},merchantCheck:function(){return"lionpet"===this.currentUser.merchantAlias}}),watch:{memberInfo:"updateUserByMember","submitData.paymentMethod":function(e){"Vacc"!==e&&(this.submitData.bankType="")},"submitData.status":function(e){this.submitData.paymentMethod=""}},created:function(){console.log(this.currentUser.merchantAlias)},methods:{emitCancel:function(){this.$emit("cancel")},emitStore:function(){this.$emit("store")},handlePaidStatus:function(){var e=Object(o["a"])(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isEditMode?this.tryToSaveOrder(t):this.tryToCreateOrder(t);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),handleStoreOrder:function(){var e=this;this.$refs.form.validate(function(t){if(t){if(e.statusIsChanged&&(1===e.submitData.status||e.isEditMode))return e.statusDialogVisible=!0;e.isEditMode?e.tryToSaveOrder():e.tryToCreateOrder()}else e.$nextTick(function(){Object(p["a"])(e.$refs.form.$el.querySelector(".el-form-item__error"),100)})})},handleCreateSuccess:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$alert("已發送".concat(t?"付款":"訂單","連結至客戶 Email"),"包月方案購買成功！",{confirmButtonText:"確認",center:!0,callback:function(){e.emitStore()}})},handleSaveSuccess:function(){this.$message({message:"編輯成功！",type:"success"}),this.emitStore()},tryToSaveOrder:function(){var e=Object(o["a"])(n.a.mark(function e(){var t,a,r=arguments;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",a=Object(l["a"])({},this.submitData,{merchantNote:t}),this.tryingStore=!0,e.prev=3,e.next=6,this.$store.dispatch("prepaid/storeOrder",a);case 6:this.handleSaveSuccess(),e.next=11;break;case 9:e.prev=9,e.t0=e["catch"](3);case 11:return e.prev=11,this.tryingStore=!1,e.finish(11);case 14:case"end":return e.stop()}},e,this,[[3,9,11,14]])}));return function(){return e.apply(this,arguments)}}(),tryToCreateOrder:function(){var e=Object(o["a"])(n.a.mark(function e(){var t,a,r,i=arguments;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]?i[0]:"",a=Object(l["a"])({},this.submitData,{prepaidId:this.prepaidId,merchantNote:t,CarrierNum:"2"===this.submitData.CarrierType?this.submitData.phoneNumber:this.submitData.CarrierNum}),this.tryingStore=!0,e.prev=3,e.next=6,this.$store.dispatch("prepaid/storeOrder",a);case 6:r=1!==a.status,0===this.prepaid.price&&(r=!1),this.handleCreateSuccess(r),e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](3);case 13:return e.prev=13,this.tryingStore=!1,e.finish(13);case 16:case"end":return e.stop()}},e,this,[[3,11,13,16]])}));return function(){return e.apply(this,arguments)}}(),updateMemberInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};0===Object.keys(e).length&&(this.submitData.phoneNumber=this.$refs.SearchMember.searchData.phoneNumber)},updateUserByMember:function(){var e=this,t=["memberId","fullName","gender","phoneCode","phoneNumber","email","taxType","taxId","CarrierType","CarrierNum","LoveCode"];t.forEach(function(t){e.submitData[t]="memberId"===t?e.memberInfo.id:e.memberInfo[t]})},onTaxTypeChange:function(){this.submitData.CarrierNum="",this.submitData.taxId="",this.submitData.LoveCode=""},changeSize:function(e){var t=this.prepaid.prepaids.find(function(t){return t.id===e});this.$emit("update:selectPrice",t.price)}}},h=f,y=a("cf57"),v=a("2877");function _(e){this["$style"]=y["default"].locals||y["default"]}var g=Object(v["a"])(h,r,i,!1,_,null,null);t["default"]=g.exports}}]);
//# sourceMappingURL=chunk-284e7977.e9b52609.js.map