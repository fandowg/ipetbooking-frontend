(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24ab9126"],{"3fa5":function(t,e,a){"use strict";a.d(e,"b",function(){return r}),a.d(e,"a",function(){return s});var n=a("5c96");function r(t){"add"===t&&Object(n["Message"])({message:"已新增",type:"success"}),"edit"===t&&Object(n["Message"])({message:"已儲存",type:"success"})}function s(){Object(n["Message"])({message:"已刪除",type:"success"})}},"4f1a":function(t,e,a){"use strict";var n=a("ef3f"),r=a.n(n);e["default"]=r.a},"7eec":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Layout",{class:t.$style.page},[a("el-tabs",{attrs:{type:"border-card","before-leave":t.beforeTabSwitch,stretch:""},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},t._l(t.tabList,function(e,n){return a("el-tab-pane",{key:n,attrs:{label:e.title,name:e.title}},[a("keep-alive",[a(e.component,{ref:"step"+(n+1),refInFor:!0,tag:"component",class:t.$style["card-wrapper"],attrs:{"item-type":t.productType,"default-value":t.componentData},on:{validate:t.handleFormValidate}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.showFooter,expression:"tab.showFooter"}],class:t.$style.footer},[a("el-button",{staticClass:"is-round",on:{click:t.onClickLeave}},[t._v("取消")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.saveButtonVisible,expression:"saveButtonVisible"}],staticClass:"is-round",attrs:{loading:t.tryingToSave},on:{click:function(e){return t.onClickSave("leave")}}},[t._v("儲存並返回列表")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.saveButtonVisible,expression:"saveButtonVisible"}],staticClass:"is-round",attrs:{type:"primary",loading:t.tryingToSave},on:{click:t.onClickSave}},[t._v("儲存變更")])],1)],1)}),1)],1)},r=[],s=a("9395"),i=a("f210"),c=a("4795"),o=a.n(c),u=a("cb0c"),d=a("0644"),l=a.n(d),p=a("a315"),h=a("444f"),f=a("3fa5"),b={page:{title:"編輯項目",meta:[{name:"description",content:"Edit Product"}]},components:{Layout:h["a"]},props:{defaultValue:{type:Object,required:!0},productType:{type:String,default:"activity"}},data:function(){return{tryingToSave:!1,saveButtonVisible:!0,activeTab:"基本資訊",tabList:[{title:"基本資訊",component:function(){return Object(p["a"])(Promise.all([a.e("chunk-42549d6e"),a.e("chunk-56236740")]).then(a.bind(null,"3733")))},showFooter:!0},{title:"營業時間",component:function(){return Object(p["a"])(a.e("chunk-4eba3e06").then(a.bind(null,"cff5")))},showFooter:!0},{title:"自訂題目",component:function(){return Object(p["a"])(Promise.all([a.e("chunk-42549d6e"),a.e("chunk-2d212b99"),a.e("chunk-fb6a22d2")]).then(a.bind(null,"0c0b")))},showFooter:!0}],componentData:this.defaultValue,geocoder:"",map:[],hasGeo:!1}},computed:{productId:function(){return this.$route.params.productId}},mounted:function(){this.initGeocoder()},methods:{handleFormValidate:function(t){this.saveButtonVisible=t},handleStorePrice:function(t){var e=function(t){return t.match(/(\d+):(\d+):(00)$/g)?t.replace(/:(00)$/g,""):t};return t.forEach(function(t){t.saleStartDate&&(t.saleStartDate=e(t.saleStartDate)),t.saleEndDate&&(t.saleEndDate=e(t.saleEndDate))}),this.$store.dispatch("product/storePrices",{productId:this.productId,storeData:t})},handleStoreProduct:function(){var t=Object(u["a"])(o.a.mark(function t(e){var a,n,r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(a=this.defaultValue.location,n=this.$refs.step1[0].submitData.location,r="".concat(a.city).concat(a.district).concat(a.address)==="".concat(n.city).concat(n.district).concat(n.address),r){t.next=8;break}return t.next=6,this.geocode(e);case 6:e.lat=this.map[0],e.lng=this.map[1];case 8:return e.type=this.productType,t.abrupt("return",this.$store.dispatch("product/store",e));case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),handleStoreExtraField:function(t){var e=Object(i["a"])(t.byOrder).concat(Object(i["a"])(t.bySize)),a={productId:this.productId};return e.length>0&&(a.extraFields=e),this.$store.dispatch("product/updateExtraField",a)},getProductInfo:function(){var t=this;this.$store.dispatch("product/fetchSingle",this.productId).then(function(e){t.componentData=l()(e)})},handleSaveSuccess:function(){var t=Object(u["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$alert("儲存成功","太棒了！",{confirmButtonText:"確認",type:"success",center:!0});case 2:this.tryingToSave=!1;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onClickSave:function(){var t=Object(u["a"])(o.a.mark(function t(e){var a,n,r,i,c;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:for(i in this.tryingToSave=!0,a=this.$refs.step1[0],n=this.$refs.step2[0],r=n.serviceTimeSetting,r)r[i].start=r[i].timeRange[0],r[i].end=r[i].timeRange[1];t.prev=5,t.t0=this.activeTab,t.next="基本資訊"===t.t0?9:"營業時間"===t.t0?16:"自訂題目"===t.t0?23:33;break;case 9:return t.next=11,a.validate();case 11:return t.next=13,this.handleStoreProduct(Object(s["a"])({},a.formatSubmitData,{serviceTimeSetting:r}));case 13:return Object(f["b"])("edit"),this.tryingToSave=!1,t.abrupt("break",33);case 16:return t.next=18,n.validate();case 18:return t.next=20,this.handleStoreProduct(Object(s["a"])({},a.formatSubmitData,{serviceTimeSetting:r}));case 20:return Object(f["b"])("edit"),this.tryingToSave=!1,t.abrupt("break",33);case 23:return c=this.$refs.step3[0].list,t.next=26,this.handleStoreExtraField(c);case 26:return t.next=28,this.handleStoreProduct(Object(s["a"])({},a.formatSubmitData,{serviceTimeSetting:r}));case 28:return t.next=30,this.getProductInfo();case 30:return Object(f["b"])("edit"),this.tryingToSave=!1,t.abrupt("break",33);case 33:"leave"===e&&this.$router.push({name:"products"}),t.next=39;break;case 36:t.prev=36,t.t1=t["catch"](5),this.tryingToSave=!1;case 39:case"end":return t.stop()}},t,this,[[5,36]])}));return function(e){return t.apply(this,arguments)}}(),onClickLeave:function(){this.$router.push({name:"products"})},beforeTabSwitch:function(){var t=Object(u["a"])(o.a.mark(function t(e,a){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("基本資訊"!==a){t.next=3;break}return t.next=3,this.$refs.step1[0].validate();case 3:if("營業時間"!==a){t.next=6;break}return t.next=6,this.$refs.step2[0].validate();case 6:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}(),initGeocoder:function(){this.geocoder=new google.maps.Geocoder},geocode:function(){var t=Object(u["a"])(o.a.mark(function t(e){var a,n,r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.geocoder.geocode({address:"".concat(e.location.city).concat(e.location.district).concat(e.location.address),componentRestrictions:{country:"TW"}});case 2:a=t.sent,n=a.results[0].geometry.location.lat(),r=a.results[0].geometry.location.lng(),this.map=[n,r];case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}},v=b,m=a("4f1a"),g=a("2877");function y(t){this["$style"]=m["default"].locals||m["default"]}var w=Object(g["a"])(v,n,r,!1,y,null,null);e["default"]=w.exports},ef3f:function(t,e,a){t.exports={slide:"edit_slide_1J5tL","slide-reverse":"edit_slide-reverse_1apWk",page:"edit_page_1CWXB","card-wrapper":"edit_card-wrapper_1d7JE",footer:"edit_footer_2CO7e"}}}]);
//# sourceMappingURL=chunk-24ab9126.96e54fa2.js.map