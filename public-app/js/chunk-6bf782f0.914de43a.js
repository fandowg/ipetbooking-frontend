(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6bf782f0"],{"075c":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.$style.wrapper},[a("el-form",{ref:"form",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:e.submitData,rules:e.submitRules,"label-position":"top"}},[e.isEditMode&&"UNPAID"===e.defaultValue.paymentStatus&&0!==e.submitData.status&&"Prepaid"!==e.defaultValue.paymentMethod?[a("el-form-item",{attrs:{label:"付款方式"}},[a("el-radio-group",{class:e.$style["payment-methods"],model:{value:e.submitData.paymentMethod,callback:function(t){e.$set(e.submitData,"paymentMethod",t)},expression:"submitData.paymentMethod"}},["UNPAID"===e.submitData.paymentStatus?a("el-radio",{attrs:{label:null,border:""}},[e._v("不指定")]):e._e(),a("el-radio",{attrs:{label:"Cash",border:""}},[e._v("到店付款(現金)")]),a("el-radio",{attrs:{label:"StoreCredit",border:""}},[e._v("現場刷卡")]),a("el-radio",{attrs:{label:"Atm",border:""}},[e._v("線下匯款")]),"UNPAID"===e.submitData.paymentStatus&&1===e.storeCashflowSetting?a("el-radio",{attrs:{label:"Credit",border:""}},[e._v("信用卡付款")]):e._e(),"UNPAID"===e.submitData.paymentStatus&&0!==e.storeCashflowSetting?a("el-radio",{attrs:{label:"Vacc",border:""}},[e._v("ATM虛擬帳戶")]):e._e(),e.memberInfo?a("el-radio",{attrs:{label:"Prepaid",border:""}},[e._v("抵扣包月方案")]):e._e()],1)],1),"Vacc"===e.submitData.paymentMethod?a("el-form-item",{attrs:{prop:"bankType",label:"轉帳銀行"}},[a("el-select",{attrs:{disabled:!1},model:{value:e.submitData.bankType,callback:function(t){e.$set(e.submitData,"bankType",t)},expression:"submitData.bankType"}},e._l(e.bankTypeList,function(e,t){return a("el-option",{key:"bank-"+t,attrs:{value:e.id,label:e.title}})}),1)],1):e._e(),e.memberInfo&&e.submitPriceTotal>0&&"Prepaid"===e.submitData.paymentMethod?[Object.keys(e.availablePrepaidList).length>0?a("el-form-item",{attrs:{prop:"prepaidOrderUuid",label:"請選擇包月方案"}},[a("el-select",{on:{change:e.updateSelectedPrepaid},model:{value:e.submitData.prepaidOrderUuid,callback:function(t){e.$set(e.submitData,"prepaidOrderUuid",t)},expression:"submitData.prepaidOrderUuid"}},e._l(e.availablePrepaidList,function(t,r){return a("el-option",{key:r,attrs:{value:r,label:t.prepaidTitle}},[e._v("\n              "+e._s(t.prepaidTitle)+"\n              "),a("span",{staticClass:"select__option--meta"},[e._v(e._s("(尚餘"+(t.times-t.used)+"次)"))])])}),1)],1):a("el-form-item",{attrs:{label:"請選擇包月方案"}},[a("el-alert",{attrs:{title:"目前選擇的服務項目無適用之包月方案（或包月方案剩餘次數不足），請調整購買數量、建議顧客購買新的包月方案、或請顧客改以其它方式付款",type:"warning",closable:!1}})],1)]:e._e()]:e._e(),e.paramsWithNoQty.length>0?a("el-form-item",{class:e.$style["params-list"]},["Prepaid"===e.submitData.paymentMethod&&Object.keys(e.availablePrepaidList).length>0?[a("div",{class:e.$style["params-list__item"]},[a("div",[e._v("訂購項目")]),a("div",[e._v("數量")])]),e._l(e.paramsWithNoQty,function(t){return a("div",{key:t.id,class:e.$style["params-list__item"]},[a("div",[e._v(e._s(t.title))]),a("div",[e._v(e._s("x"+t.qty))])])}),a("div",{class:e.$style.total},[e.selectedPrepaid?a("div",{class:e.$style["total__item"]},[a("div",[e._v("使用方案")]),a("div",[e._v(e._s(e.selectedPrepaid.prepaidTitle))])]):e._e(),a("div",{class:e.$style["total__item"]},[a("div",[e._v("使用次數")]),a("div",[e._v(e._s(e.paramSizeTotal))])])])]:[a("div",{class:e.$style["params-list__item"]},[a("div",[e._v("訂購項目")]),a("div",[e._v("售價")]),a("div",[e._v("數量")]),a("div",[e._v("小計")])]),e._l(e.paramsWithNoQty,function(t){return a("div",{key:t.id,class:e.$style["params-list__item"]},[a("div",[e._v(e._s(t.title))]),a("div",[e._v(e._s(t.price))]),a("div",[e._v(e._s("x"+t.qty))]),a("div",[e._v(e._s(t.price*t.qty))])])}),a("div",{class:e.$style.total},[a("div",{class:e.$style["total__item"]},[a("div",[e._v("小計")]),a("div",[e._v(e._s(e.paramPriceTotal))])]),e.couponInfo?a("div",{class:[e.$style["total__item"],e.$style["total__item--discount"]]},[a("div",[e._v(e._s("優惠券（"+e.couponInfo.code+"）"))]),a("div",[e._v(e._s(e.submitPriceTotal-e.paramPriceTotal))])]):e._e()]),a("div",{class:e.$style.total},[a("div",{class:e.$style["total__item"]},[a("div",[e._v("付款金額")]),a("div",[e._v(e._s(e.submitPriceTotal))])])])]],2):e._e(),!e.isEditMode&&e.submitPriceTotal>0&&("Cash"===e.submitData.paymentMethod||""===e.submitData.paymentMethod)?a("el-form-item",{ref:"couponCode",attrs:{prop:"couponCode",label:"優惠券"}},[a("el-input",{attrs:{disabled:!!e.couponInfo,placeholder:"請輸入優惠券代碼"},model:{value:e.submitData.couponCode,callback:function(t){e.$set(e.submitData,"couponCode",t)},expression:"submitData.couponCode"}},[e.couponInfo?a("el-button",{attrs:{slot:"append"},on:{click:e.resetCoupon},slot:"append"},[e._v("清除優惠券")]):a("el-button",{attrs:{slot:"append"},on:{click:e.validCoupon},slot:"append"},[e._v("使用優惠券")])],1)],1):e._e(),a("el-form-item",{attrs:{prop:"fullName",label:"使用人資訊"}},[e.memberInfo?a("el-checkbox",{model:{value:e.userSameAsMember,callback:function(t){e.userSameAsMember=t},expression:"userSameAsMember"}},[e._v("使用人同客戶")]):e._e(),a("el-input",{attrs:{disabled:e.userSameAsMember,placeholder:"姓名"},model:{value:e.submitData.fullName,callback:function(t){e.$set(e.submitData,"fullName",t)},expression:"submitData.fullName"}},[a("el-select",{attrs:{slot:"append",disabled:e.userSameAsMember,placeholder:"性別"},slot:"append",model:{value:e.submitData.gender,callback:function(t){e.$set(e.submitData,"gender",t)},expression:"submitData.gender"}},[a("el-option",{attrs:{value:"female",label:"小姐"}}),a("el-option",{attrs:{value:"male",label:"先生"}})],1)],1)],1),a("el-form-item",{attrs:{prop:"phoneNumber"}},[a("el-input",{attrs:{disabled:e.userSameAsMember,placeholder:"手機號碼",autocomplete:"tel"},model:{value:e.submitData.phoneNumber,callback:function(t){e.$set(e.submitData,"phoneNumber",t)},expression:"submitData.phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend",disabled:e.userSameAsMember},slot:"prepend",model:{value:e.submitData.phoneCode,callback:function(t){e.$set(e.submitData,"phoneCode",t)},expression:"submitData.phoneCode"}})],1)],1),e.isHomeService&&e.filterCities.length>0?[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{md:6}},[a("el-form-item",{attrs:{prop:"city",label:"縣市"}},[a("el-select",{attrs:{filterable:"",placeholder:"請選擇"},on:{change:e.onSelectCity},model:{value:e.submitData.city,callback:function(t){e.$set(e.submitData,"city",t)},expression:"submitData.city"}},e._l(e.filterCities,function(e,t){return a("el-option",{key:t,attrs:{label:e.city,value:e.city}})}),1)],1)],1),a("el-col",{attrs:{md:6}},[a("el-form-item",{attrs:{prop:"district",label:"區域"}},[a("el-select",{attrs:{placeholder:"請選擇",filterable:""},model:{value:e.submitData.district,callback:function(t){e.$set(e.submitData,"district",t)},expression:"submitData.district"}},e._l(e.districts,function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})}),1)],1)],1),a("el-col",{attrs:{md:12}},[a("el-form-item",{attrs:{prop:"address",label:"地址"}},[a("el-input",{attrs:{placeholder:"地址"},model:{value:e.submitData.address,callback:function(t){e.$set(e.submitData,"address",t)},expression:"submitData.address"}})],1)],1)],1)]:e._e(),a("el-form-item",{attrs:{prop:"note",label:"使用人備註"}},[a("small",{staticStyle:{"margin-top":"-20px",display:"block",opacity:"0.5"}},[e._v("客戶可瀏覽此備註。若是不需要提供客戶瀏覽的資訊，請使用「內部備註」功能")]),a("el-input",{attrs:{type:"textarea",rows:2,placeholder:"其他備註"},model:{value:e.submitData.note,callback:function(t){e.$set(e.submitData,"note",t)},expression:"submitData.note"}})],1),a("OrderExtraField",{ref:"extrafield",attrs:{"default-value":e.defaultValue}}),a("el-form-item",{attrs:{prop:"allowExpired"}},[a("el-checkbox",{attrs:{"false-label":0,"true-label":1},model:{value:e.submitData.allowExpired,callback:function(t){e.$set(e.submitData,"allowExpired",t)},expression:"submitData.allowExpired"}},[e._v("可逾期付款")])],1)],2),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-button",{staticClass:"is-round is-fullwidth",on:{click:e.emitCancel}},[e._v(e._s("取消"+(e.isEditMode?"編輯":"新增")))])],1),a("el-col",{attrs:{span:12}},[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",loading:e.tryingStore,disabled:e.isEditMode?!e.submitData.groupSize:!e.paramSizeTotal},on:{click:e.handleStoreOrder}},[e._v(e._s(e.isEditMode?"儲存變更":"新增訂單"))])],1)],1),a("OrderChangeStatusDialog",{attrs:{visible:e.statusDialogVisible,"is-not-pay-prepaid":2===e.defaultValue.prepaidOrderStatus,"prepaid-order-uuid":e.defaultValue.prepaidOrderUuid,order:e.submitData},on:{"update:visible":function(t){e.statusDialogVisible=t},paid:e.handlePaidStatus,cancelled:e.emitStore}})],1)},i=[],s=a("f210"),n=a("4795"),o=a.n(n),l=a("9395"),u=a("cb0c"),d=a("0644"),c=a.n(d),m=a("a315"),p=a("5117"),f=a("7e02"),h=a("b775"),b=a("2b88"),v=a("6bea"),y=a("340b"),_=a("8b4c"),g=function(){return{params:[],fullName:"",gender:"female",phoneCode:"+886",phoneNumber:"",email:"",note:"",status:2,basePrice:"",total:"",allowExpired:0,couponCode:"",memberId:"",prepaidOrderUuid:"",byOrderExtrafields:{},customerInfos:[],paymentMethod:"Cash",bankType:"BOT"}},D={components:{CountryCodePicker:function(){return Object(m["a"])(a.e("chunk-66428ff2").then(a.bind(null,"e05d")))},OrderChangeStatusDialog:function(){return Object(m["a"])(a.e("chunk-2d0e6716").then(a.bind(null,"9988")))},OrderExtraField:function(){return Object(m["a"])(a.e("chunk-76d781a7").then(a.bind(null,"dc89")))},Portal:b["Portal"]},filters:{genderFilter:f["h"]},props:{defaultValue:{type:Object,default:function(){return g()}},inventory:{type:Object,default:function(){}}},data:function(){var e=this;return{tryingStore:!1,submitData:Object.assign({},g(),this.defaultValue),searchData:{phoneCode:"+886",phoneNumber:""},searchRules:{phoneNumber:[{validator:function(t,a,r){if(!a)return r();e.$store.dispatch("member/findByPhone",e.searchData).then(function(t){e.updateMemberInfo(t)}).catch(function(){return e.updateMemberInfo(),r(new Error("此手機號碼尚未註冊"))})},trigger:"custom"}]},statusDialogVisible:!1,productParams:[],couponInfo:"",memberInfo:"",userSameAsMember:!1,selectedPrepaid:"",productHasExtraField:!1,bankTypeList:[{id:"BOT",title:"台灣銀行"},{id:"Taishin",title:"台新"},{id:"HNCB",title:"華南"}],filterCities:[]}},computed:{submitRules:function(){var e=this,t="+886"===this.submitData.phoneCode,a="";return{phoneNumber:[{required:!0,message:"請填寫手機號碼",trigger:"blur"},{pattern:t?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"}],email:[{required:!0,message:"請輸入 Email"},{type:"email",message:"請輸入正確的 Email 格式"}],fullName:[{required:!0,message:"請輸入使用人姓名"}],bankType:[{required:this.isRequiredBankType,message:"請選擇轉帳銀行"}],city:[{required:this.isHomeService,message:"請選擇縣市"}],district:[{required:this.isHomeService,message:"請選擇區域"}],address:[{required:!0,message:"請輸入服務地址"}],prepaidOrderUuid:[{required:this.isRequiredPrePaid,message:"請選擇包月方案",trigger:"change"}],couponCode:[{validator:function(t,r,i){if(clearTimeout(a),""===r)return e.$refs.form.clearValidate("couponCode"),i();a=setTimeout(function(){e.$store.dispatch("coupon/validCode",{code:r,basePrice:e.paramPriceTotal,productId:e.inventory.productId}).then(function(t){i(),e.applyCoupon(t.items)}).catch(function(e){return i(new Error(Object(h["b"])(e.status)))})},500)},trigger:"custom"}]}},submitPriceTotal:function(){var e=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t-e},t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.round(t*(e/100))},a=this.paramPriceTotal,r=this.couponInfo,i=r.discount,s=r.type;return this.couponInfo?"fixed"===s?e(i,a):t(i,a):a},isEditMode:function(){return this.defaultValue.id},statusIsChanged:function(){return this.defaultValue.status!==this.submitData.status},filteredStatusMap:function(){var e=this,t=Object.keys(f["b"]).filter(function(t){switch(e.defaultValue.status){case 1:return+t<2;case 2:return+t<=2;case 3:return 0===+t||3===+t;case 4:return 4===+t||0===+t;case 5:return 0===+t||5===+t;case 6:return 6===+t;default:return!1}}).reduce(function(e,t){return e[t]=f["b"][t],e},{});return this.isEditMode?t:f["b"]},availableSizeTotal:function(){return this.inventory.infinity?9999-this.inventory.qty:this.inventory.inventory-this.inventory.qty||0},paramSizeTotal:function(){var e=this.submitData.params.map(function(e){return+e.qty*+e.size});return e.length>0?e.reduce(function(e,t){return+e+ +t},0):""},paramPriceTotal:function(){var e=this.submitData.params.map(function(e){return+e.qty*+e.price});return e.length>0?e.reduce(function(e,t){return+e+ +t},0):""},paramsWithNoQty:function(){return this.submitData.params.filter(function(e){return 0!==e.qty})},availablePrepaidList:function(){var e=this.memberInfo&&this.memberInfo.availablePrepaidOrders||[],t=this.paramsWithNoQty.map(function(e){return e.id}),a=this.paramSizeTotal,r=function(e,t){var a=t.filter(function(t){return!e.has(t)});return 0===a.length},i=function(e,t){return t<=e},s=e.filter(function(e){var s=e.times,n=e.used,o=e.productPriceIds;return r(new Set(o),t)&&i(s-n,a)});return Object(p["a"])(s,"prepaid")||{}},productType:function(){return this.inventory?this.inventory.productType:this.defaultValue.productType||this.$route.params.product.type},isAddOrdersCanceled:function(){return this.defaultValue.addOrders.every(function(e){return 0===e.status})},showVacc:function(){var e=new Date(Object(v["a"])(new Date(this.defaultValue.date))),t=new Date(Object(v["a"])(new Date));return Object(y["differenceInDays"])(e,t)>1},isRequiredPrePaid:function(){return this.memberInfo&&this.submitPriceTotal>0&&"Prepaid"===this.submitData.paymentMethod&&Object.keys(this.availablePrepaidList).length>0},isRequiredBankType:function(){return"Vacc"===this.submitData.paymentMethod},storeCashflowSetting:function(){return this.defaultValue.storeCashflowSetting},isHomeService:function(){return"home"===this.defaultValue.storeType},districts:function(){var e=this;if(!this.submitData.city)return[];var t=this.filterCities.find(function(t){return e.submitData.city===t.city});return t.district}},watch:{"submitData.paymentMethod":function(e){"Prepaid"!==e&&(this.submitData.prepaidOrderUuid=""),"Vacc"!==e&&(this.submitData.bankType="")},availablePrepaidList:function(e){},"submitData.prepaidOrderUuid":function(e){this.updateSelectedPrepaid(e)},"submitData.params":{handler:"updateEachExtraField",deep:!0},memberInfo:"updateUserByMember",userSameAsMember:"updateUserByMember"},created:function(){this.isEditMode||this.tryToGetParams(),this.isEditMode||this.fetchExtraField(),this.isEditMode&&this.tryToFetchMember(),this.isEditMode&&this.tryToGetFilterCities()},methods:{isEmptyExtrafields:function(e){return e instanceof Array},emitCancel:function(){this.$emit("cancel")},emitStore:function(){this.$emit("store")},applyCoupon:function(e){this.couponInfo=e},validCoupon:function(){this.$refs.form.validateField("couponCode")},resetCoupon:function(){this.couponInfo="",this.$refs.couponCode.resetField("couponCode")},tryToGetParams:function(){var e=Object(u["a"])(o.a.mark(function e(){var t;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("product/fetchPrices",{productId:this.inventory.productId});case 2:this.productParams=e.sent,t=this.productParams.map(function(e){return Object(l["a"])({},e,{qty:0})}),this.$set(this.submitData,"params",t);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handlePaidStatus:function(){var e=Object(u["a"])(o.a.mark(function e(t){return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.isEditMode?this.tryToSaveOrder(t):this.tryToCreateOrder(t);case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),handleStoreOrder:function(){var e=this;this.$refs.form.validate(function(t){if(t){if(e.statusIsChanged&&e.isEditMode)return e.statusDialogVisible=!0;if("Prepaid"===e.submitData.paymentMethod&&"Prepaid"!==e.defaultValue.paymentMethod){if(Object.keys(e.availablePrepaidList).length>0&&""===e.submitData.prepaidOrderUuid)return void e.$confirm("請選擇包月方案","提示",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0});if(0===Object.keys(e.availablePrepaidList).length)return void e.$confirm("目前選擇的服務項目無適用之包月方案，<br>請選擇其他付款方式","提示",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0,dangerouslyUseHTMLString:!0})}e.isEditMode?e.tryToSaveOrder():e.tryToCreateOrder()}else e.$nextTick(function(){Object(_["a"])(e.$refs.form.$el.querySelector(".el-form-item__error"),100)})})},handleCreateSuccess:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$alert("已發送".concat(t?"付款":" QR Code ","連結至使用人 Email"),"訂單新增成功！",{confirmButtonText:"確認",center:!0,callback:function(){e.emitStore()}})},handleSaveSuccess:function(){this.$message({message:"編輯成功！",type:"success"}),this.emitStore()},tryToSaveOrder:function(){var e=Object(u["a"])(o.a.mark(function e(){var t,a,r=arguments;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:"",a=Object(l["a"])({},this.convertExtraFieldToStoreDataFromEditMode(this.submitData),{basePrice:this.paramPriceTotal,total:this.submitPriceTotal,merchantNote:t}),this.tryingStore=!0,e.prev=3,e.next=6,this.$store.dispatch("order/store",a);case 6:this.handleSaveSuccess(),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](3),this.$message({type:"error",message:"Server Error"});case 12:return e.prev=12,this.tryingStore=!1,e.finish(12);case 15:case"end":return e.stop()}},e,this,[[3,9,12,15]])}));return function(){return e.apply(this,arguments)}}(),tryToCreateOrder:function(){var e=Object(u["a"])(o.a.mark(function e(){var t,a,r,i,s=arguments;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"",a=this.productHasExtraField?this.convertExtraFieldToStoreDataFromCreateMode():void 0,r=Object(l["a"])({},this.submitData,{basePrice:this.paramPriceTotal,total:this.submitPriceTotal,groupSize:this.paramSizeTotal,productId:this.inventory.productId,inventoryId:this.inventory.id,merchantNote:t,orderExtrafields:a}),this.tryingStore=!0,e.prev=4,e.next=7,this.$store.dispatch("order/store",r);case 7:i=1!==r.status&&(2===r.status&&r.total>0),this.handleCreateSuccess(i),e.next=13;break;case 11:e.prev=11,e.t0=e["catch"](4);case 13:return e.prev=13,this.tryingStore=!1,e.finish(13);case 16:case"end":return e.stop()}},e,this,[[4,11,13,16]])}));return function(){return e.apply(this,arguments)}}(),calculateParamMaxQty:function(e){var t=this.availableSizeTotal-this.paramSizeTotal,a=t>=e?Math.floor(this.paramSizeTotal/e):0;return Math.floor(t/e)+a},updateSelectedPrepaid:function(e){this.selectedPrepaid=this.availablePrepaidList[e]},validPhoneNumber:function(e){this.$refs.searchForm.validateField("phoneNumber")},updateMemberInfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e||(this.submitData.phoneNumber=this.searchData.phoneNumber),this.memberInfo=e,this.userSameAsMember=!!e},updateUserByMember:function(){var e=this,t=["memberId","fullName","gender","phoneCode","phoneNumber","email"];t.forEach(function(t){e.submitData[t]="memberId"===t?e.memberInfo.id:e.memberInfo[t]})},convertExtraFieldToStoreDataFromEditMode:function(e){var t=c()(e),a=c()(this.$refs.extrafield.defaultValue);return t.byOrderExtrafields=this.getExtraFieldsArray(a.byOrderExtrafields),t.bySizeExtrafields=this.getBySizeExtraFieldsArray(a.customerInfos),delete t.customerInfos,t},getBySizeExtraFieldsArray:function(e){var t=this;return e.map(function(e){return{customerInfoId:e.customerInfoId,orderExtrafields:t.getExtraFieldsArray(e.bySizeExtrafields)}})},getExtraFieldsArray:function(e){var t=this,a=[];return Object.keys(e).forEach(function(r){if(t.isEdited(e[r])){var i=e[r],s=i.id,n=i.value;a.push({id:s,value:n})}}),a},isEdited:function(e){return!0===e.edited},fetchExtraField:function(){var e=Object(u["a"])(o.a.mark(function e(){var t;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("product/fetchSingle",this.inventory.productId);case 2:t=e.sent,this.defaultValue.byOrderExtrafields=this.convertToObject(t.orderExtrafields.byOrder),this.bySizeExtraFieldsQuestion=t.orderExtrafields.bySize,this.productHasExtraField=null!==t.orderExtrafields.bySize||null!==t.orderExtrafields.byOrder;case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),convertToObject:function(e){if(null!==e){var t={};return e.forEach(function(e){t[e.id]={group:1,id:e.id,Alias:"",value:"",title:e.title}}),t}},updateEachExtraField:function(){var e=this.getSelectedPrices();this.updateEachCustomerExtraFields(e)},getSelectedPrices:function(){return this.submitData.params.filter(function(e){return e.qty>0})},updateEachCustomerExtraFields:function(e){var t=this;if(null!==this.bySizeExtraFieldsQuestion){var a=[],r=1;e.forEach(function(e){for(var i=0;i<e.qty;i++)for(var s=function(i){var s={};r++,t.bySizeExtraFieldsQuestion.forEach(function(t){s[t.id]={group:r,id:t.id,Alias:e.alias,value:"",title:t.title}}),a.push({bySizeExtrafields:s})},n=0;n<e.size;n++)s(n)}),this.defaultValue.customerInfos=a}},convertExtraFieldToStoreDataFromCreateMode:function(){var e=[],t=[],a=this.$refs.extrafield.defaultValue.byOrderExtrafields||{},r=this.$refs.extrafield.defaultValue.customerInfos;return e=Object.keys(a).map(function(e){return a[e]}),r.map(function(e){Object.keys(e.bySizeExtrafields).forEach(function(a){t.push(e.bySizeExtrafields[a])})}),Object(s["a"])(e).concat(t)},onStatusChange:function(e){this.isEditMode&&1===e&&"Prepaid"!==this.defaultValue.paymentMethod&&(this.submitData.paymentMethod="Cash")},tryToFetchMember:function(){var e=Object(u["a"])(o.a.mark(function e(){var t,a,r,i;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.defaultValue.member,a=t.phoneCode,r=t.phoneNumber,e.next=3,this.$store.dispatch("member/findByPhone",{phoneCode:a,phoneNumber:r});case 3:i=e.sent,this.updateMemberInfo(i);case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),onSelectCity:function(){this.submitData.district=""},tryToGetFilterCities:function(){var e=Object(u["a"])(o.a.mark(function e(){var t,a;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("product/fetchSingle",this.submitData.productId);case 2:t=e.sent,a=t.addressRestrictions,this.filterCities=a;case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},S=D,x=a("48c9"),O=a("2877");function E(e){this["$style"]=x["default"].locals||x["default"]}var C=Object(O["a"])(S,r,i,!1,E,null,null);t["default"]=C.exports},"0c16":function(e,t,a){e.exports={wrapper:"OrderForm_wrapper_3KEOm",slide:"OrderForm_slide_1iMp2","slide-reverse":"OrderForm_slide-reverse_y0w9c","search-form":"OrderForm_search-form_9PCDn",title:"OrderForm_title_CUk1j",info:"OrderForm_info_29e-Z","params-options":"OrderForm_params-options_SZ7Sr","params-list":"OrderForm_params-list_1wM7T","params-list__item":"OrderForm_params-list__item_3BVAi",total:"OrderForm_total_3j8K2",total__item:"OrderForm_total__item_3GLK_","total__item--discount":"OrderForm_total__item--discount_2WvH2","payment-methods":"OrderForm_payment-methods_32O3b"}},"48c9":function(e,t,a){"use strict";var r=a("0c16"),i=a.n(r);t["default"]=i.a},"8b4c":function(e,t,a){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=s(e);a.scrollTo({top:n(e)-t,behavior:"smooth"})}function i(e){var t=e.scrollHeight>e.clientHeight,a=window.getComputedStyle(e).overflowY,r=["scroll","auto"].includes(a);return t&&r}function s(e){return i(e)?e:s(e.parentElement)}function n(e){var t=0;if(e.offsetParent){do{t+=e.offsetTop}while(e=e.offsetParent);return t}}a.d(t,"a",function(){return r})}}]);
//# sourceMappingURL=chunk-6bf782f0.914de43a.js.map