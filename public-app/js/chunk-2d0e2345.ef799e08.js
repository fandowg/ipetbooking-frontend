(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e2345"],{"7e67":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("BasePageHeader",{attrs:{title:"此包月方案客戶購買紀錄"},scopedSlots:e._u([{key:"right",fn:function(){return[r("el-button",{staticClass:"is-round",attrs:{disabled:!e.enabledCreateOrder,type:"primary"},on:{click:e.handleCreateOrder}},[e._v("代客購買此包月方案")])]},proxy:!0}])}),r("el-table",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.tryingToGetOrder,expression:"tryingToGetOrder",modifiers:{fullscreen:!0,lock:!0}}],attrs:{"element-loading-text":"取得訂單資訊中",data:e.loadedOrders,"default-sort":{prop:"created",order:"descending"},"row-class-name":e.calcRowClassName},on:{"row-click":e.tryToGetOrder,"sort-change":e.sortChange}},[r("el-table-column",{attrs:{label:"#訂單編號",prop:"created_at","min-width":"170",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("span",[e._v(e._s("#"+a.orderNo))]),r("div",[e._v(e._s(e._f("formatDate")(a.created,"dateTime")))])]}}])}),r("el-table-column",{attrs:{label:"狀態與來源",prop:"status","min-width":"120",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("BaseStateLabel",{attrs:{state:e._f("orderStatusFilter")(a.status,"color"),text:""}},[e._v(e._s(e._f("orderStatusFilter")(a.status,"text")))]),r("br"),r("BaseStateLabel",{attrs:{state:"info",text:""}},[e._v(e._s(e._f("orderSourceFilter")(a.source)))])]}}])}),r("el-table-column",{attrs:{label:"體型","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(e._s(r.sizeTitle))]}}])}),r("el-table-column",{attrs:{label:"付款方式","min-width":"100",prop:"paymentMethod",sortable:"custom"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[e._v(e._s(e._f("orderPaymentMethodFilter")(r.paymentMethod)))]}}])}),r("el-table-column",{attrs:{label:"客戶資訊","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.row;return[r("div",[e._v(e._s(a.fullName)+" "+e._s(e._f("genderFilter")(a.gender)))]),r("div",[e._v(e._s(a.phoneCode+" "+a.phoneNumber))])]}}])}),r("el-table-column",{attrs:{"min-width":"40"}},[r("el-tooltip",{attrs:{content:"查看訂單詳情",placement:"top"}},[r("el-button",{attrs:{type:"text"}},[r("BaseIcon",{attrs:{name:"ellipsis-v"}})],1)],1)],1)],1),r("BasePagination",{ref:"pagination",attrs:{"current-page":e.currentPage},on:{"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}}),r("el-drawer",{ref:"drawer",attrs:{visible:e.drawerVisible,"append-to-body":"",size:e.$root.isSmallDevice?"100%":"50%","destroy-on-close":!0},on:{"update:visible":function(t){e.drawerVisible=t}}},["detail"===e.drawerMode?[r("PortalTarget",{attrs:{slot:"title",name:"drawer-prepaid-header"},slot:"title"}),r("OrderDetail",{ref:"orderDetail",attrs:{"default-value":e.drawerOrderData},on:{"update:defaultValue":function(t){e.drawerOrderData=t},"update:default-value":function(t){e.drawerOrderData=t},update:e.tryToFetchOrder}})]:[r("PortalTarget",{attrs:{slot:"title",name:"drawer-prepaid-header"},slot:"title"}),r("h4",[e._v(e._s(e.defaultValue.title))]),r("h5",[e._v(e._s(e.defaultValue.times+"次")),e.selectPrice?r("span",[e._v(e._s(" / $"+e.selectPrice))]):e._e()]),r("OrderForm",{attrs:{prepaid:e.defaultValue,"select-price":e.selectPrice},on:{"update:selectPrice":function(t){e.selectPrice=t},"update:select-price":function(t){e.selectPrice=t},store:e.handleUpdateOrders,cancel:e.handleCloseDrawer}})]],2)],1)},n=[],i=r("9395"),d=r("4795"),s=r.n(d),l=r("cb0c"),o=r("a315"),u=r("7e02"),c=r("6bea"),f=r("1b80"),p=r("2b88"),h={components:{PortalTarget:p["PortalTarget"],BaseStateLabel:function(){return Object(o["a"])(r.e("chunk-12bed50d").then(r.bind(null,"38d1")))},OrderDetail:function(){return Object(o["a"])(r.e("chunk-825dd5fc").then(r.bind(null,"6dc4")))},OrderForm:function(){return r.e("chunk-284e7977").then(r.bind(null,"facf"))}},filters:{genderFilter:u["h"],orderStatusFilter:u["o"],orderSourceFilter:u["m"],orderPaymentMethodFilter:u["k"],formatDate:c["a"]},mixins:[f["c"]],props:{defaultValue:{type:Object,default:function(){}}},data:function(){return{loadedOrders:[],tryingToGetOrder:!1,drawerVisible:!1,drawerOrderData:"",drawerMode:"detail",filterData:{order_by:"created_at",order:"desc"},selectPrice:0}},computed:{enabledCreateOrder:function(){return 1===this.defaultValue.infinity||0===this.defaultValue.infinity&&this.defaultValue.inventory>this.defaultValue.qty}},watch:{currentPage:{handler:"tryToFetchOrder",immediate:!0},drawerVisible:function(e){e||(this.selectPrice=0)}},methods:{updateDrawerMode:function(e){this.drawerMode!==e&&(this.drawerMode=e)},calcRowClassName:function(e){var t=e.row,r=t.status,a=t.groupSize/t.usedSize;return 0===r?"order--canceled":1===a?"order--used":void 0},tryToGetOrder:function(){var e=Object(l["a"])(s.a.mark(function e(t){return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingToGetOrder=!0,e.next=3,this.$store.dispatch("prepaid/fetchOrderSingle",t.id);case 3:this.drawerOrderData=e.sent,this.tryingToGetOrder=!1,this.updateDrawerMode("detail"),this.drawerVisible=!0;case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),tryToFetchOrder:function(){var e=Object(l["a"])(s.a.mark(function e(){var t,r,a,n=this;return s.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("prepaid/fetchOrders",Object.assign({groupOrdering:this.defaultValue.groupOrdering,paymentMethod:"All",order_by:this.filterData.order_by,order:this.filterData.order},this.pageQuery));case 2:t=e.sent,r=t.items,a=t.total,this.loadedOrders=r,this.$nextTick(function(){n.$refs.pagination.updateTotal(a)});case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),handleCreateOrder:function(){this.updateDrawerMode("add"),this.drawerVisible=!0},handleCloseDrawer:function(){this.$refs.drawer.closeDrawer()},handleUpdateOrders:function(){this.$emit("update:defaultValue",Object(i["a"])({},this.defaultValue,{qty:this.defaultValue.qty+1})),this.tryToFetchOrder(),this.handleCloseDrawer()},sortChange:function(e){e.column;var t=e.prop,r=e.order;r&&(this.filterData.order_by=t,this.filterData.order="ascending"===r?"asc":"desc",this.currentPage=1,this.tryToFetchOrder())}}},w=h,b=r("2877"),m=Object(b["a"])(w,a,n,!1,null,null,null);t["default"]=m.exports}}]);
//# sourceMappingURL=chunk-2d0e2345.ef799e08.js.map