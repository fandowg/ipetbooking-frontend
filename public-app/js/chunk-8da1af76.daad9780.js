(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8da1af76"],{"380b":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:e.$style.wrapper},[r("div",{class:e.$style.scanner},[e.cameraVisible?r("QrcodeStream",{directives:[{name:"loading",rawName:"v-loading",value:e.cameraLoading,expression:"cameraLoading"}],attrs:{camera:e.cameraStatus},on:{init:e.onInit,decode:e.onDecode}}):e._e(),e.cameraErrorMessage?r("el-alert",{class:e.$style.result,attrs:{title:e.cameraErrorMessage,type:"error",effect:"dark","show-icon":"",closable:!1}}):e._e(),e.isAutoMode&&!e.cameraVisible?r("el-card",{class:e.$style.result,attrs:{header:"請先設定自動核銷範圍"}},[r("el-form",{ref:"verify-form",staticClass:"el-form-item--normal-margin",attrs:{model:e.verifyForm,"label-position":"left","label-width":"80px"}},[r("el-form-item",{attrs:{label:"項目",required:"",prop:"productId"}},[r("el-select",{attrs:{placeholder:"請選擇項目"},model:{value:e.verifyForm.productId,callback:function(t){e.$set(e.verifyForm,"productId",t)},expression:"verifyForm.productId"}},e._l(e.cachedProducts,function(e){return r("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),r("el-form-item",{attrs:{label:"日期",required:"",prop:"date"}},[r("el-date-picker",{attrs:{align:"right",type:"date",placeholder:"請選擇日期",format:"yyyy/MM/dd",editable:!1},on:{change:e.tryToFetchInventory},model:{value:e.verifyForm.date,callback:function(t){e.$set(e.verifyForm,"date",t)},expression:"verifyForm.date"}})],1),r("el-form-item",{attrs:{label:"時段",required:"",prop:"inventoryId"}},[r("el-select",{attrs:{placeholder:"請選擇時段",loading:e.tryingToFetchInventory},model:{value:e.verifyForm.inventoryId,callback:function(t){e.$set(e.verifyForm,"inventoryId",t)},expression:"verifyForm.inventoryId"}},e._l(e.inventoryList,function(t){return r("el-option",{key:t.id,attrs:{label:e.formatDate(t.start,"dateTime"),value:t.id}},[r("span",[e._v(e._s(e.formatDate(t.start,"dateTime")))])])}),1)],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:e.handleAutoScan}},[e._v("完成設定並開始掃描憑證")])],1)],1)],1):!e.isAutoMode&&e.decodeResult?r("el-card",{class:e.$style.result,attrs:{header:"憑證編號："+e.decodeResult}},[e.codeInfo?r("div",[r("h4",[e._v("訂單編號："+e._s(e.codeInfo.orderId))]),r("ul",{class:e.$style.result__detail},[r("li",[e._v("活動名稱："+e._s(e.codeInfo.productTitle))]),r("li",[e._v("活動開始時間："+e._s(e._f("formatDate")(e.codeInfo.startDate,"dateTime")))]),r("li",[e._v("活動結束時間："+e._s(e._f("formatDate")(e.codeInfo.endDate,"dateTime")))]),r("li",[e._v("方案名稱："+e._s(e.codeInfo.priceTitle))]),r("li",[e._v("使用人姓名："+e._s(e.codeInfo.fullName))])]),e.codeCanCheckIn?r("div",[r("el-button",{on:{click:e.handleContinue}},[e._v("不使用，繼續掃描憑證")]),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleCodeVerify(e.codeInfo.id)}}},[e._v("立即使用")])],1):e._e()]):e._e(),e.codeInvalidMessage?r("div",[r("el-alert",{class:e.$style.result__detail,attrs:{title:e.codeInvalidMessage,type:"error",effect:"dark","show-icon":"",closable:!1}}),r("el-button",{class:e.$style.action,attrs:{type:"primary"},on:{click:e.handleContinue}},[e._v("繼續掃描憑證")])],1):e._e()]):e._e()],1),r("div",{class:e.$style.setting},[r("div",{class:e.$style["setting-mode"]},[r("el-radio-group",{model:{value:e.mode,callback:function(t){e.mode=t},expression:"mode"}},[r("el-radio-button",{attrs:{label:"manual"}},[e._v("手動")]),r("el-radio-button",{attrs:{label:"auto"}},[e._v("自動")])],1),"manual"===e.mode?r("p",[e._v("若購買方案有不同的內容需入場時逐一核對，請選手動模式；掃描 QR Code 後會將客戶購買的方案及時段列出供您核對。")]):r("p",[e._v("若您單一場次入場人數較多，且購買方案單純，可以選擇自動模式，設定好預約之時間場次後可以快速驗證 QR Code 是否有效並符合時段，但無法列出購買細項。")]),e.isAutoMode&&e.cameraVisible?r("div",{class:e.$style.params},[r("el-button",{attrs:{size:"small"},on:{click:e.handleResetVerifyForm}},[e._v("重新設定核銷範圍")])],1):e._e()],1)])])},a=[],o=r("4795"),i=r.n(o),s=r("cb0c"),c=r("9395");function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function d(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");u(e.prototype,t&&t.prototype),t&&u(e,t)}var f=r("f9fa");function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return!t||"object"!==Object(f["a"])(t)&&"function"!==typeof t?p(e):t}function m(e){return m=Object.getPrototypeOf||function(e){return e.__proto__},m(e)}function v(e,t,r){return v="undefined"!==typeof Reflect&&Reflect.construct?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var a=e.bind.apply(e,n),o=new a;return r&&u(o,r.prototype),o},v.apply(null,arguments)}function y(e){var t="function"===typeof Map?new Map:void 0;return y=function(e){if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),u(r,u(function(){return v(e,arguments,m(this).constructor)},e))},y(e)}var _=r("6d12"),b=r("4d77"),I=r("b775"),w=r("6bea"),g={NotAllowedError:"請允許 iPetBooking 存取您的相機",NotFoundError:"此裝置無相機",NotSupportedError:"此頁面非安全瀏覽（如：HTTPS、localhost 或 file://）",NotReadableError:"無法存取您的相機。相機是否正在使用中？",OverconstrainedError:"您裝置的相機無法使用",StreamApiNotSupportedError:"掃描憑證不支援此瀏覽器"},C=function(e){function t(e){var r;return l(this,t),r=h(this,m(t).call(this,e)),r.status=e,r}return d(t,e),t}(y(Error)),k=function(){return{decodeResult:"",codeInfo:"",codeCanCheckIn:!1,codeInvalidMessage:""}},S={components:{QrcodeStream:_["QrcodeStream"]},filters:{formatDate:w["a"]},data:function(){return Object(c["a"])({mode:"manual",cameraStatus:"auto",cameraErrorMessage:"",cameraVisible:!0,cameraLoading:!1},k(),{verifyForm:{productId:"",date:"",inventoryId:""},tryingToFetchInventory:!1,inventoryList:[]})},computed:Object(c["a"])({},b["c"],{isAutoMode:function(){return"auto"===this.mode},autoVerifyValues:function(){return Object.values(this.verifyForm).join(", ")}}),watch:{mode:"onChangeMode"},methods:{formatDate:w["a"],changeCameraStatus:function(e){this.cameraStatus=e},handleContinue:function(){this.resetDecodeData(),this.cameraVisible=!0},resetDecodeData:function(){Object.assign(this.$data,k())},switchCamera:function(){},handleVerifySuccess:function(e){this.$notify({title:"成功",message:Object(I["b"])(e,!1),type:"success"})},handleGetCodeInfo:function(){var e=Object(s["a"])(i.a.mark(function e(t){var r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.cameraVisible=!1,e.prev=1,e.next=4,this.$store.dispatch("order/fetchSingleCode",t);case 4:return r=e.sent,this.codeInfo=r,e.next=8,this.checkValidation(r);case 8:this.codeCanCheckIn=e.sent,e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),this.codeInvalidMessage=Object(I["b"])(e.t0.status);case 14:case"end":return e.stop()}},e,this,[[1,11]])}));return function(t){return e.apply(this,arguments)}}(),handleCodeVerify:function(){var e=Object(s["a"])(i.a.mark(function e(t){var r,n;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return r=this.isAutoMode?{codeId:t,verifyRule:this.verifyForm}:{codeId:t},e.prev=1,e.next=4,this.$store.dispatch("order/verifyCode",r).then(function(e){return e.status});case 4:n=e.sent,this.handleVerifySuccess(n),this.handleContinue(),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](1),this.$notify.error({title:"錯誤",message:Object(I["b"])(e.t0.status)||e.t0,duration:0});case 12:case"end":return e.stop()}},e,this,[[1,9]])}));return function(t){return e.apply(this,arguments)}}(),onDecode:function(){var e=Object(s["a"])(i.a.mark(function e(t){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:this.decodeResult=t,this.isAutoMode?this.handleCodeVerify(t):this.handleGetCodeInfo(t);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),checkValidation:function(e){var t=e.orderStatus,r=e.used;return 1===t&&0===r?Promise.resolve(!0):1===r?Promise.reject(new C("ORDER_QRCODE_ADMIN_QRCODE_HAS_BEEN_VERIFIED")):Promise.reject(new C(0===t?"ORDER_QRCODE_ADMIN_PLEASE_CHECKOUT_FIRST":"ORDER_QRCODE_ADMIN_INVALID_QRCODE"))},onInit:function(){var e=Object(s["a"])(i.a.mark(function e(t){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.cameraLoading=!0,e.prev=1,e.next=4,t;case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),this.cameraErrorMessage=g[e.t0.name]||"未預期的錯誤：".concat(e.t0);case 9:return e.prev=9,this.cameraLoading=!1,e.finish(9);case 12:case"end":return e.stop()}},e,this,[[1,6,9,12]])}));return function(t){return e.apply(this,arguments)}}(),handleResetVerifyForm:function(){this.cameraVisible=!1},handleAutoScan:function(){var e=Object(s["a"])(i.a.mark(function e(){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$refs["verify-form"].validate();case 3:this.cameraVisible=!0,e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),this.cameraVisible=!1;case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),onChangeMode:function(){this.isAutoMode?this.handleAutoScan():this.cameraVisible=!0},tryToFetchInventory:function(){var e=Object(s["a"])(i.a.mark(function e(){var t=this;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingToFetchInventory=!0,e.next=3,this.$store.dispatch("product/inventoryCalendar",{productId:this.verifyForm.productId,submitData:{startDate:Object(w["e"])(this.verifyForm.date),endDate:Object(w["e"])(this.verifyForm.date),withGroup:0}}).then(function(e){return e.items}).finally(function(){return t.tryingToFetchInventory=!1});case 3:this.inventoryList=e.sent;case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}},O=S,D=r("5c8b"),E=r("2877");function R(e){this["$style"]=D["default"].locals||D["default"]}var x=Object(E["a"])(O,n,a,!1,R,null,null);t["default"]=x.exports},"5c8b":function(e,t,r){"use strict";var n=r("ae29"),a=r.n(n);t["default"]=a.a},ae29:function(e,t,r){e.exports={slide:"QrcodeScanner_slide_mh28d","slide-reverse":"QrcodeScanner_slide-reverse_6aJOM",wrapper:"QrcodeScanner_wrapper_3bzdM",scanner:"QrcodeScanner_scanner_-p0_p",result:"QrcodeScanner_result_23uMn",result__detail:"QrcodeScanner_result__detail_2P86x",result__action:"QrcodeScanner_result__action_1t6fL",setting:"QrcodeScanner_setting_1-CCR","setting-mode":"QrcodeScanner_setting-mode_3ZggR",params:"QrcodeScanner_params_DLSbo"}}}]);
//# sourceMappingURL=chunk-8da1af76.daad9780.js.map