(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6251a3f3"],{"263a":function(t,e,i){"use strict";var s=i("d47e"),a=i.n(s);e["default"]=a.a},a1e7:function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{class:t.$style["create-addition"]},[i("el-form",{ref:"form",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:t.submitData,rules:t.submitRules,"label-position":"top"}},[[i("div",{staticClass:"header"},[i("div",[t._v("目前排程")]),i("div",[t._v("美容師："+t._s(t.isEditMode?t.defaultValue.scheduleItem.name:t.scheduleDetail.name))])]),i("div",{staticClass:"schedule-group-wrap"},[i("div",{staticClass:"schedule"},[i("div",[t._v("本服務(含緩衝)時間")]),i("div",{staticClass:"date"},[i("span",{staticClass:"today"},[t._v("今天")]),i("br"),i("span",{staticClass:"time Jost"},[t.isEditMode?i("span",[t._v(t._s(t.defaultValue.time))]):i("span",[t._v(t._s(t._f("formatDate")(t.scheduleDetail.date,"time")))]),t._v("－\n\n              \n              "),i("span",{style:"color:"+(0===t.totalMinute?"":t.differMinute>0?"#C79484":"#E35D5D")+";"},[i("span",{staticClass:"text-primary"},[t.isEditMode?i("span",[t._v(t._s(t._f("formatDate")(t.defaultValue.endDate,"time"))+" ")]):i("span",[t._v(t._s(t.serviceEndTime))])])])])]),i("div",{staticClass:"service"},[t.isEditMode?i("span",{staticClass:"title"},[t._v(t._s(t.defaultValue.productName)+" "+t._s(t.defaultValue.params[0].title))]):i("span",{staticClass:"title"},[t._v(t._s(t.currentService.storeTitle)+" "+t._s(t.currentService.title))])])]),i("div",{staticClass:"schedule"},[i("BaseIcon",{attrs:{name:"angle-double-right","icon-style":"fal"}}),i("div",[t._v("下個服務開始時間")]),t.hasNextOrder?[i("div",{staticClass:"date"},[i("span",{staticClass:"today"},[t._v("今天")]),i("br"),i("span",{staticClass:"time Jost"},[t._v(t._s(t._f("formatDate")(t.nextOrder.startDate,"time")))])]),i("div",{staticClass:"service"},[i("span",{staticClass:"title"},[t._v(t._s(t.nextOrder.productTitle)+" "+t._s(t.nextOrder.priceTitle))])])]:i("div",{staticClass:"date"},[i("span",{staticClass:"today vs-hide"},[t._v("今天")]),i("br"),i("span",{staticClass:"no-booking"},[t._v("暫無預約")])])],2)]),i("div",{staticClass:"alert Jost",class:{danger:t.differMinute<=0}},[t._v("本次加購時間 "),i("span",{staticClass:"text-secondary"},[t._v(t._s(t.totalMinute))]),t._v(" 分\n        "),t.hasNextOrder?i("span",[t.differMinute>0?i("span",[t._v("\n            ，空檔時間剩餘 "),i("span",{staticClass:"text-secondary"},[t._v(t._s(t.differMinute))]),t._v(" 分\n          ")]):i("span",[t._v(" ，已與下個預約重疊 ")])]):t._e()])],i("el-form-item",{attrs:{label:"選擇加購項目"}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingGetAddlList,expression:"tryingGetAddlList"}],class:t.$style.addItems},[i("div",{staticClass:"wrap"},t._l(t.priceList,function(e,s){return i("div",{key:s,staticClass:"item"},[i("el-checkbox-group",{model:{value:t.submitData.addItems,callback:function(e){t.$set(t.submitData,"addItems",e)},expression:"submitData.addItems"}},[i("el-checkbox",{attrs:{label:e.id,border:""}},[i("div",[i("span",{staticClass:"name"},[t._v(t._s(e.title))]),i("br"),i("span",{staticClass:"size"},[t._v(t._s(e.introtext))])]),i("div",{staticClass:"price"},[t._v("$"+t._s(e.price)+"/"+t._s(e.serviceTime)+"分")])])],1)],1)}),0),i("div",{staticClass:"total"},[i("div",[t._v("加購總計")]),i("div",[t._v("$"+t._s(t.total)+"，共 "+t._s(t.totalMinute)+" 分")])])])])],2),i("el-row",{staticClass:"footer",attrs:{gutter:20}},[i("el-col",{attrs:{span:24,xs:24}},[t.isChildren?[t.isEditMode?i("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary"},on:{click:t.editAddList}},[t._v("確定加購")]):t._e()]:[t.isEditMode?i("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary"},on:{click:t.reEditAddList}},[t._v("新增加購")]):i("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary"},on:{click:t.editAddList}},[t._v("確定加購")])]],2)],1)],1)},a=[],r=i("f210"),d=i("4795"),n=i.n(d),c=i("cb0c"),l=i("9395"),u=i("7e02"),o=i("6bea"),f=i("340b"),m=(i("8b4c"),i("4d77")),p={components:{},filters:{orderStatusMap:u["p"],formatDate:o["a"]},props:{isChildren:{type:Boolean,default:!1},defaultValue:{type:Object,default:function(){}},addList:{type:Array,default:function(){return[]}},petSizeId:{type:Number,default:0},scheduleDetail:{type:Object,default:function(){}},schedules:{type:Array,default:function(){return[]}},currentService:{type:Object,default:function(){}},isEditMode:{type:Boolean,default:!1}},data:function(){return{isMainOrder:!0,submitData:{addItems:[]},priceList:[],nextOrder:null,endDate:"",tryingToCreteOrder:!1,bankTypeList:[{id:"BOT",title:"台灣銀行"},{id:"Taishin",title:"台新"},{id:"HNCB",title:"華南"}],tryingGetAddlList:!1}},watch:{currentService:{handler:function(){this.findNextOrder()},deep:!0,immediate:!0},addList:{handler:function(t){this.isChildren?this.submitData.addItems=t.map(function(t){return t.priceId}):this.isEditMode||(this.submitData.addItems=t.map(function(t){return t.priceId}))},immediate:!0}},created:function(){this.tryToFetchPrice(),this.isEditMode},mounted:function(){},computed:Object(l["a"])({},m["b"],{submitRules:function(){return{addItems:[{required:!0,message:"請選擇服務項目",trigger:"blur"}]}},hasNextOrder:function(){return this.nextOrder},filteredStatusMap:function(){var t=this,e=Object.keys(u["p"]).filter(function(e){switch(t.defaultValue.status){case 1:return+e<2;case 2:return(1!==+e||"Vacc"!==t.defaultValue.paymentMethod)&&+e<=2;case 3:return 0===+e||3===+e;case 4:return 4===+e;case 5:return 0===+e||5===+e;case 6:return 6===+e;default:return!1}}).reduce(function(t,e){return t[e]=u["p"][e],t},{});return this.isEditMode?e:u["p"]},serviceEndTime:function(){return Object(o["a"])(Object(f["addMinutes"])(this.endDate,this.totalMinute),"time")},differMinute:function(){if(!this.hasNextOrder)return 1e4;var t=this.isEditMode?this.defaultValue.endDate:this.endDate,e=this.isEditMode?this.defaultValue.scheduleItem.nextOrder.startDate:this.nextOrder.startDate,i=Object(f["differenceInMinutes"])(e,t);return i-this.totalMinute},selectedItem:function(){var t=this;return this.priceList.filter(function(e){return t.submitData.addItems.includes(e.id)})},selectParams:function(){return this.selectedItem.map(function(t){return{type:"cosmetic-add",title:t.title,priceId:t.id,price:t.price,qty:1}})},selectAddList:{get:function(){return this.addList},set:function(t){this.$emit("update:addList",t)}},total:function(){return this.selectedItem.reduce(function(t,e){return t+e.price},0)},totalMinute:function(){return this.selectedItem.reduce(function(t,e){return t+e.serviceTime},0)},isHomeService:function(){return"home"===this.defaultValue.storeType},isEmployee:function(){return!!this.currentUser.scheduleItemId},showVacc:function(){var t=new Date(Object(o["a"])(new Date(this.defaultValue.date))),e=new Date(Object(o["a"])(new Date));return Object(f["differenceInDays"])(t,e)>1},storeCashflowSetting:function(){return this.defaultValue.storeCashflowSetting}}),methods:{findNextOrder:function(){if(this.isEditMode)this.nextOrder=this.defaultValue.scheduleItem.nextOrder;else{var t=60*this.currentService.serviceTime*1e3,e=new Date(this.scheduleDetail.date).getTime();this.endDate=Object(o["a"])(new Date(t+e),"dateTime");var i=this.schedules.filter(function(t){return new Date(t.startDate).getTime()>e});i.length>0&&(this.nextOrder=i[0])}},tryToFetchPrice:function(){var t=Object(c["a"])(n.a.mark(function t(){var e,i;return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingGetAddlList=!0,t.next=3,this.$store.dispatch("product/fetchAdditionalPrices",{state:1,order_by:"groupOrdering",productId:this.defaultValue.productId,petSizeId:this.isEditMode?this.defaultValue.pet.sizeId:this.petSizeId,limit:1e4});case 3:e=t.sent,i=e.items,this.priceList=i,this.tryingGetAddlList=!1;case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),editAddList:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.$emit("prepaidAndEdit"),t.selectAddList=Object(r["a"])(t.selectParams),t.$emit("close"))})},reEditAddList:function(){var t=this;this.$refs.form.validate(function(e){e&&(t.$emit("addMore",Object(r["a"])(t.selectParams)),t.$emit("close"))})}}},h=p,v=i("263a"),_=i("2877");function b(t){this["$style"]=v["default"].locals||v["default"]}var y=Object(_["a"])(h,s,a,!1,b,null,null);e["default"]=y.exports},d47e:function(t,e,i){t.exports={slide:"AdditionFormOrder_slide_1yU01","slide-reverse":"AdditionFormOrder_slide-reverse_1Znsq","create-addition":"AdditionFormOrder_create-addition_3VpSp",addItems:"AdditionFormOrder_addItems_3qUNp","payment-methods":"AdditionFormOrder_payment-methods_1fLNg"}}}]);
//# sourceMappingURL=chunk-6251a3f3.d123a8f9.js.map