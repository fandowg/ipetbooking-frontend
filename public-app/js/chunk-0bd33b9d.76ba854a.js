(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0bd33b9d"],{"0cf1":function(t,e,i){"use strict";var a=i("ecd8"),r=i.n(a);e["default"]=r.a},"3c98":function(t,e,i){"use strict";var a=i("1547");class r extends a["a"]{async write(t){if("undefined"===typeof navigator||!navigator.clipboard)throw this.unavailable("Clipboard API not available in this browser");if(void 0!==t.string)await this.writeText(t.string);else if(t.url)await this.writeText(t.url);else{if(!t.image)throw new Error("Nothing to write");if("undefined"===typeof ClipboardItem)throw this.unavailable("Writing images to the clipboard is not supported in this browser");try{const i=await(await fetch(t.image)).blob(),a=new ClipboardItem({[i.type]:i});await navigator.clipboard.write([a])}catch(e){throw new Error("Failed to write image")}}}async read(){if("undefined"===typeof navigator||!navigator.clipboard)throw this.unavailable("Clipboard API not available in this browser");if("undefined"===typeof ClipboardItem)return this.readText();try{const e=await navigator.clipboard.read(),i=e[0].types[0],a=await e[0].getType(i),r=await this._getBlobData(a,i);return{value:r,type:i}}catch(t){return this.readText()}}async readText(){if("undefined"===typeof navigator||!navigator.clipboard||!navigator.clipboard.readText)throw this.unavailable("Reading from clipboard not supported in this browser");const t=await navigator.clipboard.readText();return{value:t,type:"text/plain"}}async writeText(t){if("undefined"===typeof navigator||!navigator.clipboard||!navigator.clipboard.writeText)throw this.unavailable("Writting to clipboard not supported in this browser");await navigator.clipboard.writeText(t)}_getBlobData(t,e){return new Promise((i,a)=>{const r=new FileReader;e.includes("image")?r.readAsDataURL(t):r.readAsText(t),r.onloadend=(()=>{const t=r.result;i(t)}),r.onerror=(t=>{a(t)})})}}i.d(e,"a",function(){return s});const s=Object(a["b"])("Clipboard",{web:()=>new r})},"40c0":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.$style.orderformSection},[t.totalAllShow?a("div",{staticClass:"orderformSection__all"},[a("div",{staticClass:"orderformSection__right",staticStyle:{"border-right":"#dcdfe6 1px solid"}},[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:function(e){e.stopPropagation(),t.isChildren?t.closeChildren():t.closeTotalAll()}}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[a("div",{staticClass:"inline-between",staticStyle:{"padding-right":"15px","align-items":"center"}},[t.isChildren?a("span",[t._v(" 新增子訂單 ")]):a("span",[t._v(" 價格編輯與折扣 ")])])])]),a("div",{staticClass:"orderformSection__right__content",staticStyle:{padding:"0 0 20px 0"}},[a("TotalTable",{staticStyle:{height:"calc(100% - 10px)"},attrs:{"is-main-order":t.isMainOrder,"is-children":t.isChildren,"delete-ids":t.deleteIds,adds:t.adds,"is-edit-mode":t.isEditMode,"is-paid":t.isPaid,"has-coupon-info":t.hasCouponInfo,"order-params":t.submitData.params,"order-total-edit-list":t.totalEditList,"order-add-list":t.addList,"service-total":t.serviceTotal,"coupon-price-total":t.couponPriceTotal,"submit-price-total":t.submitPriceTotal,"children-order-total":t.childrenOrderTotal,"coupon-info":t.couponInfo,"submit-data":t.submitData,"submit-data-prepaid":t.submitDataPrepaid,"current-buy-prepaid":t.currentBuyPrepaid,"more-items":t.moreItems,"have-items":t.haveItems},on:{"update:deleteIds":function(e){t.deleteIds=e},"update:delete-ids":function(e){t.deleteIds=e},"update:adds":function(e){t.adds=e},"update:orderParams":function(e){return t.$set(t.submitData,"params",e)},"update:order-params":function(e){return t.$set(t.submitData,"params",e)},"update:orderTotalEditList":function(e){t.totalEditList=e},"update:order-total-edit-list":function(e){t.totalEditList=e},"update:orderAddList":function(e){t.addList=e},"update:order-add-list":function(e){t.addList=e},"update:moreItems":function(e){t.moreItems=e},"update:more-items":function(e){t.moreItems=e},"update:haveItems":function(e){t.haveItems=e},"update:have-items":function(e){t.haveItems=e},openAdd:t.openAddEdit,openTotalEdit:t.openTotalEdit}},[a("div",{class:t.$style.bottom},[t.isChildren?[a("div",{staticClass:"children__bottom"},[a("div",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("h6",[t._v("付款方式")]),a("el-checkbox",{staticClass:"check-by-head text-muted-0",attrs:{"false-label":0,"true-label":1},model:{value:t.submitData.allowExpired,callback:function(e){t.$set(t.submitData,"allowExpired",e)},expression:"submitData.allowExpired"}},[t._v("可逾期付款")])],1),a("el-radio-group",{model:{value:t.paymentWay,callback:function(e){t.paymentWay=e},expression:"paymentWay"}},[a("el-radio",{attrs:{label:"offline",disabled:"prepaid-order"===t.ordertype&&!t.isBuyPrepaid&&!t.isPrepaidAndEdit,border:""}},[t._v("線下付款")]),a("el-radio",{attrs:{label:"online",disabled:"prepaid-order"===t.ordertype&&!t.isBuyPrepaid&&!t.isPrepaidAndEdit,border:""}},[t._v("線上付款")])],1),a("el-button",{staticClass:"is-round orderformSection__bottom__btn",staticStyle:{"margin-top":"20px",width:"100%"},attrs:{type:"primary",disabled:t.tryingStore||0===t.addList.length&&0===t.totalEditList.length,loading:t.tryingStore},on:{click:function(e){return t.handleStoreOrder("children")}}},[t._v("新增子訂單")])],1)]:[!t.isPaid&&t.serviceTotal>0&&!t.submitData.prepaidOrderUuid&&!t.submitDataPrepaid.prepaidId&&"main"===t.addOrderIndex?a("el-form",{ref:"couponForm",attrs:{model:t.submitData,rules:t.submitRules}},[a("el-form-item",{ref:"couponCode",staticClass:"el-form-item--white-bg",attrs:{prop:"couponCode"}},[a("el-input",{attrs:{clearable:"",disabled:!!t.hasCouponInfo,placeholder:"請輸入優惠券代碼"},model:{value:t.submitData.couponCode,callback:function(e){t.$set(t.submitData,"couponCode",e)},expression:"submitData.couponCode"}},[t.hasCouponInfo?a("el-button",{attrs:{slot:"append"},on:{click:t.resetCoupon},slot:"append"},[t._v("清除優惠券")]):a("el-button",{attrs:{slot:"append"},on:{click:t.validCoupon},slot:"append"},[t._v("使用優惠券")])],1)],1)],1):t._e(),a("div",{staticClass:"btn-group-inline"},[t.isEditMode?a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:t.editOrderItem}},[t._v("儲存")]):a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:t.saveTotalEdit}},[t._v("儲存")])],1)]],2)])],1)]),a("div",{staticClass:"orderformSection__left",staticStyle:{border:"0"}},[a("div",{staticClass:"orderformSection__left__content",staticStyle:{"padding-bottom":"0"}},[t.addShow?a("div",[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:function(e){return e.stopPropagation(),t.closeAdd(e)}}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[a("div",{staticClass:"inline-between",staticStyle:{"padding-right":"15px","align-items":"center"}},[t._v(" 加購 ")])])]),a("div",{staticClass:"info-section"},[a("AdditionForm",{ref:"addForm",attrs:{"is-edit-mode":t.isEditMode,"add-list":t.addList,"pet-size-id":t.petSizeId,"default-value":t.isEditMode?t.defaultValue:t.submitData,"schedule-detail":t.scheduleDetail,schedules:t.schedules,"current-service":t.currentService,"is-children":t.isChildren},on:{"update:addList":function(e){t.addList=e},"update:add-list":function(e){t.addList=e},"update:defaultValue":function(e){t.isEditMode?t.defaultValue:t.submitData=e},"update:default-value":function(e){t.isEditMode?t.defaultValue:t.submitData=e},prepaidAndEdit:t.prepaidAndEdit,addMore:t.addMore,close:t.closeAdd}})],1)]):a("TotalEdit",{on:{"update:totalEditList":t.addTotalEdit}})],1)])]):t._e(),t.prepaidAllShow?a("div",{staticClass:"orderformSection__all"},[a("div",{staticClass:"orderformSection__right",staticStyle:{"border-right":"#dcdfe6 1px solid"}},[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:function(e){return e.stopPropagation(),t.closePrepaidAll(e)}}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[a("div",{staticClass:"inline-between",staticStyle:{"padding-right":"15px","align-items":"center"}},[t.isBuyPrepaid?a("span",[t._v("購買包月方案")]):a("span",[t._v("可使用包月方案")]),t.isBuyPrepaid?t._e():a("el-button",{staticStyle:{"padding-top":"0","padding-bottom":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.goToBuyPrepaid}},[t._v(" 購買包月方案 ")])],1)])]),a("div",{staticClass:"orderformSection__right__content"},[t.filteredAvailablePrepaidList.length>0&&!t.isBuyPrepaid?t._l(t.filteredAvailablePrepaidList,function(e){return a("div",{key:e.id,class:[t.$style.price,{isActive:t.currentPrepaid.id===e.id},{isDisabled:1!==e.status}],staticStyle:{cursor:"pointer"},on:{click:function(i){return t.goToPrepaid(e)}}},[a("el-image",{staticClass:"image price__image",attrs:{src:e.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"price__cont"},[a("div",[a("div",{staticClass:"price__title"},[t.multipleStore?a("div",{staticStyle:{"padding-bottom":"5px"}},[t._v(t._s(e.storeTitles.join("，"))+" ")]):t._e(),t._v(" "+t._s(e.prepaidTitle)+"\n                ")]),a("div",{staticClass:"text-muted-0",staticStyle:{"line-height":"1.6"}},[t._v("\n                  可抵用次數："+t._s(e.times-e.used)+"/"+t._s(e.times)),a("br"),t._v("\n                  到期日："+t._s(t._f("formatDate")(e.expiredDate?e.expiredDate:""))+t._s(e.expiredDate?"":"無使用期限")+"\n                  "),2===e.status?a("div",{staticClass:"alert-text"},[t._v(" 未付款")]):t._e()])])])],1)}):t._e(),0!==t.filteredAvailablePrepaidList.length||t.isBuyPrepaid?t._e():a("el-alert",{attrs:{title:"目前選擇的寵物與服務人員無適用之包月方案，請調整購買數量、建議顧客購買新的包月方案",type:"warning",closable:!1}}),t.filterPrepaidList.length>0&&t.isBuyPrepaid?t._l(t.filterPrepaidList,function(e){return a("div",{key:e.id,class:[t.$style.price,{isActive:t.currentBuyPrepaid.id===e.id}],staticStyle:{cursor:"pointer"},on:{click:function(i){return t.selectBuyingPrepaid(e)}}},[a("el-image",{staticClass:"image price__image",attrs:{src:e.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"price__cont"},[a("div",[a("div",{staticClass:"price__title"},[t.multipleStore?a("div",{staticStyle:{"padding-bottom":"5px"}},[t._v(t._s(e.stores.join("，"))+" ")]):t._e(),t._v(" "+t._s(e.title)+"\n                ")]),a("div",{staticClass:"text-muted-0",staticStyle:{"line-height":"1.6"}},[t._v("\n                  可抵用次數："+t._s(e.times)),a("br"),t._v("\n                  價格："+t._s(e.price)+"\n                ")])])])],1)}):t._e()],2)]),a("div",{staticClass:"orderformSection__left",staticStyle:{border:"0"}},[a("div",{staticClass:"orderformSection__left__content info-section"},[t.currentPrepaid.id&&!t.isBuyPrepaid?a("div",{class:t.$style.prepaid},[a("el-image",{staticClass:"image prepaid__image",attrs:{src:t.currentPrepaid.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"inline-between",staticStyle:{"margin-bottom":"40px"}},[a("span",{staticClass:"prepaid__title"},[t.multipleStore?a("span",[t._v("\n                "+t._s(t.currentPrepaid.storeTitles.join("，"))+"\n              ")]):t._e(),t._v("\n              "+t._s(t.currentPrepaid.prepaidTitle)+"\n            ")]),a("span",{staticClass:"text-muted-0"},[t._v("可抵用次數："+t._s(t.currentPrepaid.times-t.currentPrepaid.used)+"/"+t._s(t.currentPrepaid.times))])]),a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("可使用服務項目")]),a("div",{staticClass:"el-form-item--white-bg"},[a("div",{staticStyle:{display:"flex"}},[a("el-select",{attrs:{"value-key":"id"},model:{value:t.currentService,callback:function(e){t.currentService=e},expression:"currentService"}},t._l(t.filteredServicesByPrepaid,function(e,i){return a("el-option",{key:e.id,attrs:{value:e,label:e.storeTitle+" "+e.name+" "}},[a("span",[t._v(t._s(e.storeTitle+" "+e.name))]),a("span",{staticClass:"select__option--meta"},[t._v(t._s("(尚餘"+(e.maxTimes-e.used)+"次)"))])])}),1),a("el-button",{staticClass:"is-round",staticStyle:{"margin-left":"20px"},attrs:{disabled:!t.currentService},on:{click:t.selectPrepaidService}},[t._v("使用方案")])],1)])]),t.currentPrepaid.slogan?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("優惠內容")]),a("p",[t._v(t._s(t.currentPrepaid.slogan))])]):t._e(),t.currentPrepaid.description?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("方案內容說明")]),a("p",[t._v(t._s(t.currentPrepaid.description))])]):t._e(),t.currentPrepaid.notice?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("注意事項")]),a("p",[t._v(t._s(t.currentPrepaid.notice))])]):t._e()],1):t._e(),t.isBuyPrepaid&&t.currentBuyPrepaid.id?a("div",{class:t.$style.prepaid},[a("el-image",{staticClass:"image prepaid__image",attrs:{src:t.currentBuyPrepaid.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"inline-between",staticStyle:{"margin-bottom":"40px"}},[a("span",{staticClass:"prepaid__title"},[t.multipleStore?a("span",[t._v("\n                "+t._s(t.currentBuyPrepaid.stores.join("，"))+"\n              ")]):t._e(),t._v("\n              "+t._s(t.currentBuyPrepaid.title)+"\n            ")]),a("span",{staticClass:"text-muted-0"},[t._v("可抵用次數："+t._s(t.currentBuyPrepaid.times))])]),a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("可使用服務項目")]),a("div",{staticClass:"el-form-item--white-bg"},[a("div",{staticStyle:{display:"flex"}},[a("el-select",{attrs:{"value-key":"id"},model:{value:t.currentService,callback:function(e){t.currentService=e},expression:"currentService"}},t._l(t.filteredServicesByBuyingPrepaid,function(e,i){return a("el-option",{key:e.id,attrs:{value:e,label:e.storeTitle+" "+e.title+" "}},[a("span",[t._v(t._s(e.storeTitle+" "+e.title))]),a("span",{staticClass:"select__option--meta"},[t._v(t._s("(可抵用次數"+e.maxTimes+"次)"))])])}),1),a("el-button",{staticClass:"is-round",staticStyle:{"margin-left":"20px"},attrs:{disabled:!t.currentService},on:{click:t.selectBuyingPrepaidService}},[t._v("使用方案")])],1)])]),t.currentBuyPrepaid.slogan?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("優惠內容")]),a("p",[t._v(t._s(t.currentBuyPrepaid.slogan))])]):t._e(),t.currentBuyPrepaid.description?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("方案內容說明")]),a("p",[t._v(t._s(t.currentBuyPrepaid.description))])]):t._e(),t.currentBuyPrepaid.notice?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("h6",[t._v("注意事項")]),a("p",[t._v(t._s(t.currentBuyPrepaid.notice))])]):t._e()],1):t._e()])])]):t._e(),t.prepaidAllShow||t.totalAllShow?t._e():a("div",{staticClass:"orderformSection__all"},[a("div",{staticClass:"orderformSection__left"},[a("div",{class:t.$style.header,attrs:{id:"orderHeader"}},[!t.isEditMode&&t.scheduleDetail.showExpiredAlert?a("el-alert",{attrs:{type:"warning",title:"請注意，您選擇的時段已經過期！",closable:!1}}):t._e(),a("h5",{staticClass:"Jost",class:t.$style.title},[t._v("此時段服務地點："+t._s(t.isEditMode?t.defaultValue.productName:t.scheduleDetail.storesTitle))]),(t.isEditMode?t.defaultValue.scheduleItem:t.scheduleDetail.name)?[a("h5",{staticClass:"Jost"},[t._v("美容師："+t._s(t.isEditMode?t.defaultValue.scheduleItem.name:t.scheduleDetail.name)+"\n            "),t.isEditMode?t._e():[t._v("\n              "+t._s(0===t.scheduleDetail.state?"(停權中)":"")+"\n            ")]],2),t.isEditMode?[6===t.defaultValue.status?a("div",{class:t.$style.editOneLine,staticStyle:{"margin-top":"15px padding:0  20px"}},[a("h5",{staticClass:"editOneLine__title"},[t._v("助理：")]),a("span",{staticClass:"editOneLine__text"},[t._v(t._s(t.defaultValue.helper?t.defaultValue.helper.name:"不指派")+" ")])]):a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingAssign,expression:"tryingAssign"}],class:t.$style.editOneLine,staticStyle:{"margin-top":"15px padding:0  20px"},attrs:{"element-loading-background":"rgba(0, 0, 0,0)"}},[a("h5",{staticClass:"editOneLine__title"},[t._v("助理：")]),t.editAssistantEnabled?[a("el-form",{ref:"assistantForm",staticClass:"el-form--floating",staticStyle:{width:"200px"}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:""}},[a("el-select",{model:{value:t.submitData.helper.id,callback:function(e){t.$set(t.submitData.helper,"id",e)},expression:"submitData.helper.id"}},[a("el-option",{attrs:{label:"不指派",value:""}}),t._l(t.assignList,function(e,i){return a("el-option",{key:i,attrs:{value:e.id,label:e.name+" "+(e.sameStore?"(同分店)":"(不同分店)")}},[t._v("\n                        "+t._s(e.name)+" ("+t._s(e.sameStore?"同分店":"不同分店")+")\n                      ")])})],2)],1)],1)]:t._e(),t.editAssistantEnabled?t._e():[t.assignList.length>0&&!t.defaultValue.helper?a("span",{staticClass:"editOneLine__text"},[t._v("請選擇")]):t._e(),t.tryingAssign||0!==t.assignList.length||t.defaultValue.helper?t._e():a("span",{staticClass:"editOneLine__text"},[t._v("目前無人員可指派 ")]),t.defaultValue.helper?a("span",{staticClass:"editOneLine__text"},[t._v(t._s(t.defaultValue.helper.name)+" ")]):t._e()],t.assignList.length>0?[t.editAssistantEnabled?[a("el-button",{staticClass:"is-round",on:{click:t.cancelAssignEdit}},[t._v("\n                    取消\n                  ")]),a("el-button",{staticClass:"is-round",attrs:{type:"primary",loading:t.tryingAssign},on:{click:t.tryToStoreAssignHelper}},[t._v("\n                    儲存\n                  ")])]:[a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:t.openAssignEdit}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)]]:t._e()],2)]:t._e()]:t._e(),a("h5",{staticClass:"Jost"},[t._v("預約時間："+t._s(t._f("formatDate")(t.isEditMode?t.editOrderDate:t.scheduleDetail.date,"dateTime")))])],2),a("div",{ref:"leftCont",staticClass:"orderformSection__left__content",style:"height:calc(100vh - "+t.headerHeight+"px)"},[t.mamberSearchShow&&!t.isEditMode?a("div",{staticClass:"search-section"},[a("el-tabs",{attrs:{stretch:""},model:{value:t.activeSearchType,callback:function(e){t.activeSearchType=e},expression:"activeSearchType"}},[a("el-tab-pane",{attrs:{label:"快速搜尋",name:"short"}},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingGetMember,expression:"tryingGetMember"}],staticClass:"search-box__wrapper",attrs:{"element-loading-background":"rgba(0, 0, 0, 0)"}},[a("el-form",{ref:"searchFormByShort",staticClass:"el-form-item--normal-margin el-form-item--white-bg search-box",attrs:{model:t.filterData},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("快速查詢客戶 "),a("span",{staticClass:"text-muted-0"},[t._v("(請輸入末三碼)")])]),a("el-autocomplete",{ref:"autocomplete",staticStyle:{width:"100%"},attrs:{"fetch-suggestions":t.searchQuery},on:{select:t.selectMember},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.item;return[a("span",{staticClass:"info-line-box"},[t.searchNone?a("span",{staticClass:"add-box"},[t._v(" 查無會員，立刻新增會員 "),a("BaseIcon",{attrs:{name:"plus"}})],1):[a("span",{staticClass:"info-line title"},[t._v(t._s(i.fullName))]),a("span",{staticClass:"info-line content"},[t._v(t._s(i.phoneNumber))]),a("span",{staticClass:"info-line more-content"},[t._v(t._s(t.memberPets(i)))])]],2)]}}],null,!1,3841936760),model:{value:t.filterData.search,callback:function(e){t.$set(t.filterData,"search",e)},expression:"filterData.search"}})],1),a("el-button",{staticClass:"is-round is-fullwidth isPrimaryOutLine",on:{click:t.searchQueryByBtn}},[t._v("查詢")]),a("el-button",{staticStyle:{"margin-left":"0"},attrs:{type:"text"},on:{click:t.creatMember}},[t._v("新增客戶")])],1)],1)]),a("el-tab-pane",{attrs:{label:"電話搜尋",name:"phone"}},[a("div",{staticClass:"search-box__wrapper"},[a("el-form",{ref:"searchFormByPhone",staticClass:"el-form-item--normal-margin el-form-item--white-bg search-box",attrs:{model:t.searchData,rules:t.searchRules}},[a("el-form-item",{attrs:{prop:"phoneNumber"}},[a("span",{attrs:{slot:"label"},slot:"label"},[t._v("查詢客戶 ")]),a("el-input",{attrs:{placeholder:"請輸入手機號碼"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.validPhoneNumber(e)}},model:{value:t.searchData.phoneNumber,callback:function(e){t.$set(t.searchData,"phoneNumber","string"===typeof e?e.trim():e)},expression:"searchData.phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:t.searchData.phoneCode,callback:function(e){t.$set(t.searchData,"phoneCode",e)},expression:"searchData.phoneCode"}})],1)],1),a("el-button",{staticClass:"is-round is-fullwidth isPrimaryOutLine",on:{click:t.validPhoneNumber}},[t._v("查詢")]),t.isNewMember?a("span",{staticClass:"alert-word",staticStyle:{"margin-top":"20px",display:"block"}},[t._v("查無客戶資訊，快速建立客戶")]):t._e()],1)],1)])],1)],1):t._e(),t.mamberSearchShow?t._e():a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingGetMember,expression:"tryingGetMember"}],staticClass:"info-section",staticStyle:{"min-height":"300px","padding-top":"20px"},attrs:{"element-loading-background":"rgba(0, 0, 0,0)"}},[t.memberInfo.id?[[a("BaseCollapse",{attrs:{expanded:"","is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[a("BaseIcon",{attrs:{"icon-style":"fal",name:"address-card"}}),t._v(" 客戶資訊")],1)]},proxy:!0}],null,!1,3600017957)},[a("div",[t.isEditMode?t._e():a("el-button",{staticClass:"is-round isPrimaryOutLine",staticStyle:{"margin-bottom":"20px"},on:{click:t.clearMemberInfo}},[t._v("重新搜尋")]),a("div",{class:t.$style.infoList},[a("div",{staticClass:"infoList__row"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("el-row",{attrs:{gutter:20,type:"flex"}},[a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.goToDetail}},[t._v("\n                                "+t._s(t.memberInfo.fullName)+" "+t._s(t._f("genderFilter")(t.memberInfo.gender))+"\n                              ")])],1),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[t._v(" "+t._s(t.memberInfo.phoneCode+" "+t.memberInfo.phoneNumber))]),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[t.memberInfo.tags.length>0?t._l(t.memberInfo.tags,function(e){return a("el-tag",{key:"tag-"+e.id,attrs:{type:"info",effect:"plain","disable-transitions":""}},[t._v("\n                                  "+t._s(e.title)+"\n                                ")])}):[a("span",{staticClass:"muted"},[t._v(" 目前尚無標籤")])]],2),a("el-col",{staticClass:"infoList__item",attrs:{span:24,md:12}},[t._v("LINE ID: "+t._s(t.memberInfo.lineId)+" ")])],1)],1)],1)],1),a("div",{staticClass:"infoList__row"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{staticClass:"infoList__title",attrs:{span:24}},[t._v(" 內部備註")]),a("el-col",{staticClass:"infoList__item",attrs:{span:24}},[t.memberInfo.merchantNote?a("span",{staticClass:"muted",domProps:{innerHTML:t._s(t.memberInfo.merchantNote)}}):a("span",[t._v("目前尚無備註")])])],1)],1)])],1)])],[a("BaseCollapse",{attrs:{expanded:"","is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[a("BaseIcon",{attrs:{name:"dog"}}),t._v(" 寵物資訊 ")],1)]},proxy:!0}],null,!1,1005478690)},[t.isEditMode?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("ul",{class:t.$style.box},[a("li",[t._v(t._s(t.defaultValue.pet.name))]),t.defaultValue.pet.birthday?a("li",[t._v(t._s(t.defaultValue.pet.birthday))]):t._e(),t.defaultValue.pet.breed?a("li",[t._v(t._s(t.defaultValue.pet.breed))]):t._e(),t.defaultValue.pet.gender?a("li",[t._v(t._s("male"===t.defaultValue.pet.gender?"公":"母"))]):t._e(),a("li",[t._v(t._s(t.defaultValue.pet.categoryTitle)+"/"+t._s(t.defaultValue.pet.sizeTitle))]),t.defaultValue.pet.note?a("li",{staticClass:"row-line"},[t._v(t._s(t.defaultValue.pet.note))]):t._e(),t.defaultValue.pet.questions?[t.defaultValue.pet.questions?a("li",{staticClass:"row-line"}):t._e(),t.defaultValue.pet.questions.personality.length>0?a("li",{staticClass:"row-line"},[t._v("個性："+t._s(t.personalityContentOrder))]):t._e(),t.defaultValue.pet.questions.healthy.length>0?a("li",{staticClass:"row-line"},[t._v("健康狀況："+t._s(t.healthyContentOrder))]):t._e(),t.defaultValue.pet.questions.behavior.length>0?a("li",{staticClass:"row-line indentList"},[a("span",{staticClass:"title"},[t._v("行為：")]),t.behaviorContentOrder.length>0?[a("span",{staticClass:"content"},t._l(t.behaviorContentOrder,function(e){return a("span",{key:e,staticClass:"content__item"},[t._v(t._s(e))])}),0)]:t._e()],2):t._e(),t.defaultValue.pet.questions.vaccine?a("li",{staticClass:"row-line"},[t._v("疫苗："+t._s(t.vaccineContentOrder))]):t._e()]:t._e()],2),a("div",{staticClass:"btn-group-inline",staticStyle:{"margin-bottom":"20px"}},[0!==t.commentList.length?a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.openCommentList}},[t._v("查看歷史備註")]):t._e(),a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:t.openCommentEdit}},[a("BaseIcon",{attrs:{name:"plus"}}),t._v(" 新增寵物備註")],1)],1),a("PetCommentList",{ref:"comment",attrs:{type:"order",order:t.defaultValue},on:{emitFetch:t.emitCommentFetch}}),a("el-dialog",{attrs:{visible:t.petCommentDialogVisible,pet:t.defaultValue.pet.id,title:"寵物備註",width:"800px",top:"0","append-to-body":""},on:{"update:visible":function(e){t.petCommentDialogVisible=e}}},[a("PetCommentList",{ref:"commentAll",attrs:{pet:t.defaultValue.pet.id,type:"pet",order:t.defaultValue}})],1)],1):a("div",{staticStyle:{"padding-bottom":"30px"}},[t.submitData.petId?[a("div",{staticClass:"inline-between",staticStyle:{"margin-top":"0"}},[t._v("\n                      寵物資訊\n                      "),a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.openSelectPet}},[t._v(" 重選寵物 ")])],1),a("div",{staticClass:"el-form-item--white-bg"},[a("el-input",{attrs:{readonly:!0},model:{value:t.selectPetCont,callback:function(e){t.selectPetCont=e},expression:"selectPetCont"}})],1)]:a("el-button",{staticClass:"is-round is-fullwidth",staticStyle:{"margin-top":"0"},on:{click:t.openSelectPet}},[t._v("選擇寵物")])],2)])],t.petSizeId||t.isEditMode?[a("BaseCollapse",{attrs:{expanded:"","is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[a("BaseIcon",{attrs:{name:"cut"}}),t._v(" 服務項目")],1)]},proxy:!0}],null,!1,313195490)},[t.isEditMode?a("div",{staticStyle:{"margin-bottom":"30px"}},[a("div",{class:t.$style.titleBox,staticStyle:{"margin-bottom":"30px"}},[t._v(t._s(t.mainService.title))]),a("div",{staticClass:"inline-between",staticStyle:{"margin-bottom":"10px"}},[a("span",{staticStyle:{"font-weight":"500"}},[t._v("服務備註")]),a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.openNoteEdit}},[t._v(" 編輯備註 ")])],1),a("div",{staticStyle:{"font-weight":"500","margin-bottom":"10px"}},[t._v("使用人資訊")]),a("ul",{class:t.$style.info,staticStyle:{"margin-bottom":"20px"}},[a("li",[t._v(t._s(t.defaultValue.fullName)+" "+t._s(t._f("genderFilter")(t.defaultValue.gender)))]),a("li",[t._v(t._s(t.defaultValue.phoneCode+" "+t.defaultValue.phoneNumber))]),a("li",[t._v(t._s(t.defaultValue.member.email))]),t.defaultValue.member.lineId?a("li",[t._v("LINE ID: "+t._s(t.defaultValue.member.lineId))]):t._e(),t.defaultValue.note?a("li",{staticStyle:{display:"block"}},[t._v("使用人備註："+t._s(t.defaultValue.note||"目前尚無備註"))]):t._e()]),t.isEmptyByOrderExtrafields?t._e():a("div",t._l(t.defaultValue.byOrderExtrafields,function(e,i){return a("ul",{key:"byOrderExtrafieldIndex-"+i,class:t.$style.question},[a("li",{staticStyle:{"margin-bottom":"10px"}},[t._v(t._s(e.title))]),a("li",{staticStyle:{"margin-bottom":"10px",color:"#909399"}},[t._v(t._s(e.value))])])}),0)]):a("div",[a("div",{staticClass:"btn-group-inline",staticStyle:{"margin-bottom":"30px","padding-top":"0"}},[a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"order"===t.ordertype},on:{click:function(e){return t.onSelectOrderType("order")}}},[t._v("單次預約")]),a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"prepaid-order"===t.ordertype},on:{click:function(e){return t.onSelectOrderType("prepaid-order")}}},[t._v("包月方案預約")])],1),t.submitData.params[0].priceId?[a("div",{staticClass:"inline-between",staticStyle:{"margin-top":"30px"}},[t._v("\n                      服務項目\n                      "),a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.reSelectOrder}},[t._v(" 重新選擇 ")])],1),a("div",{staticClass:"el-form-item--white-bg"},[a("el-input",{attrs:{readonly:!0},model:{value:t.currentServiceCont,callback:function(e){t.currentServiceCont=e},expression:"currentServiceCont"}})],1)]:t._e()],2)])]:t._e(),t.isHomeService?[a("BaseCollapse",{attrs:{expanded:"","is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[a("BaseIcon",{attrs:{name:"map-marker-alt"}}),t._v(" 服務地址")],1)]},proxy:!0}],null,!1,2770013692)},[a("div",{staticStyle:{"margin-bottom":"30px"}},[t.submitData.city?a("div",{staticStyle:{"margin-bottom":"20px"}},[t._v("服務地址："+t._s(t.submitData.city)+t._s(t.submitData.district)+t._s(t.submitData.address))]):t._e(),t.defaultValue.city?a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.openAddressEdit}},[t._v(" 編輯服務地址 ")]):a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.openAddressEdit}},[t._v(" 新增服務地址 ")])],1)])]:t._e(),t.isEditMode&&6===t.defaultValue.status&&t.defaultValue.invoice.InvoiceNumber?[a("BaseCollapse",{attrs:{"is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[t._v(" 發票資訊")])]},proxy:!0}],null,!1,2891043871)},[a("div",{staticStyle:{"margin-bottom":"30px"}},[a("div",{class:t.$style.invoice},[a("div",{staticStyle:{"margin-bottom":"10px"}},[t._v(" 預約訂單#"+t._s(t.defaultValue.id))]),a("div",{staticClass:"info"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,xs:24}},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票日期")]),a("span",[t._v(t._s(t._f("formatDate")(t.defaultValue.invoice.CreateTime)))])]),a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票號碼")]),a("span",[t._v(t._s(t.defaultValue.invoice.InvoiceNumber))])]),a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("隨機碼")]),a("span",[t._v(t._s(t.defaultValue.invoice.RandomNum))])])]),a("el-col",{attrs:{span:12,xs:24}},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票形式")]),a("span",[t._v(t._s(t.taxTypeMap[t.defaultValue.invoice.taxType]))])]),"B2C"===t.defaultValue.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("載具類別")]),a("span",[t._v(t._s(t.carrierTypeMap[t.defaultValue.invoice.CarrierType]))])]):t._e(),"B2C"===t.defaultValue.invoice.taxType&&["0","1"].includes(t.defaultValue.invoice.CarrierType)?a("div",{staticClass:"info-item",attrs:{span:12,xs:24}},[a("span",{staticClass:"title"},[t._v("載具編號")]),a("span",[t._v(t._s(t.defaultValue.invoice.CarrierNum))])]):t._e(),"B2B"===t.defaultValue.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("統一編號")]),a("span",[t._v(t._s(t.defaultValue.invoice.taxId))])]):t._e(),"DONATE"===t.defaultValue.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("捐贈碼")]),a("span",[t._v(t._s(t.defaultValue.invoice.LoveCode))])]):t._e()])],1)],1)]),t.childrenOrdersHaveInvoice.length>0?t._l(t.childrenOrdersHaveInvoice,function(e){return a("div",{key:e.invoice.InvoiceNumber,class:t.$style.invoice},[a("div",{staticStyle:{"margin-bottom":"10px"}},[t._v(" 子訂單#"+t._s(e.id))]),a("div",{staticClass:"info"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12,xs:24}},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票日期")]),a("span",[t._v(t._s(t._f("formatDate")(e.invoice.CreateTime)))])]),a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票號碼")]),a("span",[t._v(t._s(e.invoice.InvoiceNumber))])]),a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("隨機碼")]),a("span",[t._v(t._s(e.invoice.RandomNum))])])]),a("el-col",{attrs:{span:12,xs:24}},[a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("發票形式")]),a("span",[t._v(t._s(t.taxTypeMap[e.invoice.taxType]))])]),"B2C"===e.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("載具類別")]),a("span",[t._v(t._s(t.carrierTypeMap[e.invoice.CarrierType]))])]):t._e(),"B2C"===e.invoice.taxType&&["0","1"].includes(e.invoice.CarrierType)?a("div",{staticClass:"info-item",attrs:{span:12,xs:24}},[a("span",{staticClass:"title"},[t._v("載具編號")]),a("span",[t._v(t._s(e.invoice.CarrierNum))])]):t._e(),"B2B"===e.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("統一編號")]),a("span",[t._v(t._s(e.invoice.taxId))])]):t._e(),"DONATE"===e.invoice.taxType?a("div",{staticClass:"info-item"},[a("span",{staticClass:"title"},[t._v("捐贈碼")]),a("span",[t._v(t._s(e.invoice.LoveCode))])]):t._e()])],1)],1)])}):t._e()],2)])]:t._e(),t.isEditMode&&6===t.defaultValue.status?a("BaseCollapse",{attrs:{"is-order":"","order-theme":!0},scopedSlots:t._u([{key:"title",fn:function(){return[a("span",[t._v(" 簽名")])]},proxy:!0}],null,!1,4125503094)},[a("div",{staticStyle:{"margin-bottom":"20px"}},[a("el-image",{class:t.$style.image,attrs:{src:t.defaultValue.signature}},[a("div",{attrs:{slot:"error"},slot:"error"},[t._v(" 圖片載入失敗 ")])])],1)]):t._e()]:t._e()],2)])]),a("div",{staticClass:"orderformSection__right"},[[t.editDetailEnabled?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeEditDetail}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v(t._s("new"===t.memberEditMode?"新增客戶":"編輯客戶資訊"))])]),a("div",{staticClass:"orderformSection__right__content"},[a("el-form",{ref:"memberForm",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:t.submitDataMember,rules:t.memberRules,"label-position":"top"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"fullName",label:"姓名"}},[a("el-input",{attrs:{placeholder:"請輸入姓名"},model:{value:t.submitDataMember.fullName,callback:function(e){t.$set(t.submitDataMember,"fullName",e)},expression:"submitDataMember.fullName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin gender-box",attrs:{prop:"gender"}},[a("el-radio-group",{staticClass:"no-bg-radio-group",model:{value:t.submitDataMember.gender,callback:function(e){t.$set(t.submitDataMember,"gender",e)},expression:"submitDataMember.gender"}},[a("el-radio",{attrs:{label:"male"}},[t._v("先生")]),a("el-radio",{attrs:{label:"female"}},[t._v("小姐")])],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"phone",label:"電話"}},[a("el-input",{attrs:{placeholder:"請輸入手機號碼",disabled:"edit"===t.memberEditMode},model:{value:t.submitDataMember.phone,callback:function(e){t.$set(t.submitDataMember,"phone","string"===typeof e?e.trim():e)},expression:"submitDataMember.phone"}},[a("CountryCodePicker",{attrs:{slot:"prepend",disabled:"edit"===t.memberEditMode},slot:"prepend",model:{value:t.submitDataMember.phoneCode,callback:function(e){t.$set(t.submitDataMember,"phoneCode",e)},expression:"submitDataMember.phoneCode"}})],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"備用電話"}},[a("el-input",{attrs:{placeholder:"請輸入備用電話"},model:{value:t.submitDataMember.extraInfos.extraInfoPhone[0].phoneNumber,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoPhone[0],"phoneNumber","string"===typeof e?e.trim():e)},expression:"submitDataMember.extraInfos.extraInfoPhone[0].phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:t.submitDataMember.extraInfos.extraInfoPhone[0].phoneCode,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoPhone[0],"phoneCode",e)},expression:"submitDataMember.extraInfos.extraInfoPhone[0].phoneCode"}})],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"標籤"}},[a("el-select",{attrs:{"value-key":"id",multiple:"",placeholder:"請選擇"},model:{value:t.submitDataMember.tags,callback:function(e){t.$set(t.submitDataMember,"tags",e)},expression:"submitDataMember.tags"}},t._l(t.tagList,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t}})}),1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"Email",prop:"email"}},[a("el-input",{attrs:{placeholder:"Email"},model:{value:t.submitDataMember.email,callback:function(e){t.$set(t.submitDataMember,"email",e)},expression:"submitDataMember.email"}})],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"LINE ID"}},[a("el-input",{attrs:{placeholder:"LINE ID"},model:{value:t.submitDataMember.lineId,callback:function(e){t.$set(t.submitDataMember,"lineId",e)},expression:"submitDataMember.lineId"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"緊急聯絡人姓名"}},[a("el-input",{attrs:{placeholder:"請輸入姓名"},model:{value:t.submitDataMember.extraInfos.extraInfoEmergency[0].fullName,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoEmergency[0],"fullName",e)},expression:"submitDataMember.extraInfos.extraInfoEmergency[0].fullName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"el-form-item--normal-margin gender-box"},[a("el-radio-group",{staticClass:"no-bg-radio-group",model:{value:t.submitDataMember.extraInfos.extraInfoEmergency[0].gender,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoEmergency[0],"gender",e)},expression:"submitDataMember.extraInfos.extraInfoEmergency[0].gender"}},[a("el-radio",{attrs:{label:"male"}},[t._v("先生")]),a("el-radio",{attrs:{label:"female"}},[t._v("小姐")])],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"緊急聯絡人電話"}},[a("el-input",{attrs:{placeholder:"請輸入緊急聯絡人電話"},model:{value:t.submitDataMember.extraInfos.extraInfoEmergency[0].phoneNumber,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoEmergency[0],"phoneNumber","string"===typeof e?e.trim():e)},expression:"submitDataMember.extraInfos.extraInfoEmergency[0].phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:t.submitDataMember.extraInfos.extraInfoEmergency[0].phoneCode,callback:function(e){t.$set(t.submitDataMember.extraInfos.extraInfoEmergency[0],"phoneCode",e)},expression:"submitDataMember.extraInfos.extraInfoEmergency[0].phoneCode"}})],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"內部備註"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:10},placeholder:"請輸入你的備註文字"},model:{value:t.submitDataMember.merchantNote,callback:function(e){t.$set(t.submitDataMember,"merchantNote",e)},expression:"submitDataMember.merchantNote"}})],1)],1)],1),a("div",{staticClass:"btn-group-inline",staticStyle:{padding:"30px 0 50px"}},[a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.closeEditDetail}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{loading:t.tryingSaveMember,disabled:t.tryingSaveMember,type:"primary"},on:{click:t.tryToSaveDetail}},[t._v("儲存")])],1)],1)],1)]:t._e(),t.memberInfoShow&&!t.editDetailEnabled?[[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeMemberInfo}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("el-tabs",{attrs:{stretch:""},model:{value:t.activeMemberData,callback:function(e){t.activeMemberData=e},expression:"activeMemberData"}},[a("el-tab-pane",{attrs:{label:"客戶資訊",name:"information"}}),a("el-tab-pane",{attrs:{label:"所有預約",name:"orders"}})],1)],1),a("div",{staticClass:"orderformSection__right__content"},["information"===t.activeMemberData?a("div",[a("h4",{staticClass:"form-block-title"},[t._v("基本資料\n\n                  "),a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:t.enableEditDetail}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)],1),a("ul",{class:t.$style.detail},[a("li",[t._v("姓名："+t._s(t.memberInfo.fullName)+" "+t._s(t._f("genderFilter")(t.memberInfo.gender)))]),a("li",[t._v("聯絡電話："+t._s(t.memberInfo.phoneCode+" "+t.memberInfo.phoneNumber))]),t.memberInfo.extraInfos&&t.memberInfo.extraInfos.extraInfoPhone[0].phoneNumber?a("li",[t._v("\n                    備用電話：\n                    "+t._s(t.memberInfo.extraInfos.extraInfoPhone[0].phoneCode+" "+t.memberInfo.extraInfos.extraInfoPhone[0].phoneNumber)+"\n                  ")]):t._e(),t.memberInfo.extraInfos&&t.memberInfo.extraInfos.extraInfoEmergency[0].fullName?a("li",[t._v("\n                    緊急聯絡人姓名：\n                    "+t._s(t.memberInfo.extraInfos.extraInfoEmergency[0].fullName)+" "+t._s(t._f("genderFilter")(t.memberInfo.extraInfos.extraInfoEmergency[0].gender))+"\n                  ")]):t._e(),t.memberInfo.extraInfos&&t.memberInfo.extraInfos.extraInfoEmergency[0].phoneNumber?a("li",[t._v("\n                    緊急聯絡人電話：\n                    "+t._s(t.memberInfo.extraInfos.extraInfoEmergency[0].phoneCode+" "+t.memberInfo.extraInfos.extraInfoEmergency[0].phoneNumber)+"\n                  ")]):t._e(),a("li",[t._v("電子信箱："+t._s(t.memberInfo.email))]),a("li",[t._v("LINE ID："+t._s(t.memberInfo.lineId))]),a("li",[t._v("標籤：\n                    "),t._l(t.memberInfo.tags,function(e){return a("el-tag",{key:"tag-"+e.id,attrs:{type:"info",effect:"plain","disable-transitions":""}},[t._v("\n                      "+t._s(e.title)+"\n                    ")])})],2),a("li",{staticStyle:{display:"flex"}},[t._v("內部備註： "),a("span",{domProps:{innerHTML:t._s(t.memberInfo.merchantNote||"目前尚無備註")}})]),t.$hasHomeService()?[a("li",[t._v("\n                      帳單地址：\n                      "),t.memberInfo.billingInfo?[t._v(" "+t._s(t.memberInfo.billingInfo.city)+" "+t._s(t.memberInfo.billingInfo.district)+" "+t._s(t.memberInfo.billingInfo.address)+" ")]:t._e(),a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:function(e){return t.enableEditAddress("billing")}}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)],2),a("li",[t._v("\n                      地址：\n                      "),t.memberInfo.shippingInfo?[t._v(" "+t._s(t.memberInfo.shippingInfo[0].city)+" "+t._s(t.memberInfo.shippingInfo[0].district)+" "+t._s(t.memberInfo.shippingInfo[0].address)+" ")]:t._e(),a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:function(e){return t.enableEditAddress("shipping")}}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)],2)]:t._e()],2),a("el-dialog",{attrs:{title:"編輯"+("billing"===t.addressMode?"帳單":"")+"地址",visible:t.visibleDialogAddress,top:"0",width:"680px","append-to-body":""},on:{"update:visible":function(e){t.visibleDialogAddress=e},close:t.handleCloseAddress}},[t.$hasHomeService()&&t.submitDataMember[t.addressMode+"Info"]?[a("el-form",{ref:"addressForm",staticClass:"el-form--floating",staticStyle:{"margin-top":"30px"},attrs:{model:t.submitDataMember,rules:t.addressRules,"label-position":"top"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"姓名"}},["shipping"===t.addressMode?a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"][0].name,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"name",e)},expression:"submitDataMember[`${addressMode}Info`][0].name"}}):a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"].name,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"name",e)},expression:"submitDataMember[`${addressMode}Info`].name"}})],1)],1),a("el-col",{attrs:{span:12}},["shipping"===t.addressMode?a("el-form-item",{attrs:{label:"電話",prop:"shippingInfo.0.phone"}},[a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"][0].phone,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"phone",e)},expression:"submitDataMember[`${addressMode}Info`][0].phone"}})],1):a("el-form-item",{attrs:{label:"電話",prop:"billingInfo.phone"}},[a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"].phone,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"phone",e)},expression:"submitDataMember[`${addressMode}Info`].phone"}})],1)],1)],1),"billing"===t.addressMode?a("el-form-item",{attrs:{label:"電子郵件"}},[a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"].email,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"email",e)},expression:"submitDataMember[`${addressMode}Info`].email"}})],1):t._e(),a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"縣市"}},["shipping"===t.addressMode?a("el-select",{attrs:{placeholder:"請選擇縣市",filterable:""},on:{change:t.onSelectCity},model:{value:t.submitDataMember[t.addressMode+"Info"][0].city,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"city",e)},expression:"submitDataMember[`${addressMode}Info`][0].city"}},t._l(t.taiwanCitys,function(t,e){return a("el-option",{key:"billing-city-"+e,attrs:{label:t.name,value:t.name}})}),1):a("el-select",{attrs:{placeholder:"請選擇縣市",filterable:""},on:{change:t.onSelectCity},model:{value:t.submitDataMember[t.addressMode+"Info"].city,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"city",e)},expression:"submitDataMember[`${addressMode}Info`].city"}},t._l(t.taiwanCitys,function(t,e){return a("el-option",{key:"billing-city-"+e,attrs:{label:t.name,value:t.name}})}),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"鄉鎮市區"}},["shipping"===t.addressMode?a("el-select",{attrs:{placeholder:"請選擇鄉鎮市區",filterable:""},on:{change:t.onSelectDistrict},model:{value:t.submitDataMember[t.addressMode+"Info"][0].district,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"district",e)},expression:"submitDataMember[`${addressMode}Info`][0].district"}},t._l(t.districts,function(t,e){return a("el-option",{key:"billing-district-"+e,attrs:{label:t.name,value:t.name}})}),1):a("el-select",{attrs:{placeholder:"請選擇鄉鎮市區",filterable:""},on:{change:t.onSelectDistrict},model:{value:t.submitDataMember[t.addressMode+"Info"].district,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"district",e)},expression:"submitDataMember[`${addressMode}Info`].district"}},t._l(t.districts,function(t,e){return a("el-option",{key:"billing-district-"+e,attrs:{label:t.name,value:t.name}})}),1)],1)],1)],1),a("el-form-item",{attrs:{label:"郵政編號"}},["shipping"===t.addressMode?a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"][0].postcode,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"postcode",e)},expression:"submitDataMember[`${addressMode}Info`][0].postcode"}}):a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"].postcode,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"postcode",e)},expression:"submitDataMember[`${addressMode}Info`].postcode"}})],1),a("el-form-item",{attrs:{label:"詳細地址"}},["shipping"===t.addressMode?a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"][0].address,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"][0],"address",e)},expression:"submitDataMember[`${addressMode}Info`][0].address"}}):a("el-input",{model:{value:t.submitDataMember[t.addressMode+"Info"].address,callback:function(e){t.$set(t.submitDataMember[t.addressMode+"Info"],"address",e)},expression:"submitDataMember[`${addressMode}Info`].address"}})],1)],1),a("div",{class:t.$style.footer},[a("el-button",{staticClass:"is-round",on:{click:function(e){t.visibleDialogAddress=!1}}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{loading:t.tryingSaveAddress,disabled:t.tryingSaveAddress,type:"primary"},on:{click:t.onSaveAddress}},[t._v("儲存")])],1)]:t._e()],2),t.storeInvoiceSetting?[a("div",{staticClass:"bottom-line-box-normal"}),a("h4",{staticClass:"form-block-title"},[t._v("發票資訊\n                    "),t.editInvoiceEnabled?[a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:t.cancelEditInvoice}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{size:"mini",type:"primary"},on:{click:t.tryToSaveDetail}},[a("BaseIcon",{attrs:{name:"check"}}),a("span",[t._v("儲存")])],1)]:a("el-button",{staticClass:"is-round",attrs:{size:"mini"},on:{click:t.enableEditInvoice}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)],2),a("ul",{class:t.$style.detail},[t.editInvoiceEnabled?[a("el-form",{ref:"form-invoice",staticClass:"el-form-item--normal-margin el-form-item--white-bg",class:t.$style["detail-form"],attrs:{model:t.submitDataMember,"label-position":"left","label-width":"100px"}},[a("InvoiceForm",{attrs:{"default-value":t.submitDataMember,"show-sync":!1}})],1)]:[a("li",[t._v("開立類型："+t._s(t.taxTypeMap[t.submitDataMember.taxType]))]),"B2C"===t.submitDataMember.taxType?[a("li",[t._v("載具類別："+t._s(t.carrierTypeMap[t.submitDataMember.CarrierType]||"無（寄送電子發票至客戶 email）"))]),"0"===t.submitDataMember.CarrierType||"1"===t.submitDataMember.CarrierType?a("li",[t._v("載具編號："+t._s(t.submitDataMember.CarrierNum))]):t._e()]:"B2B"===t.submitDataMember.taxType?a("li",[t._v("統一編號："+t._s(t.submitDataMember.taxId))]):a("li",[t._v("捐贈碼："+t._s(t.submitDataMember.LoveCode))])]],2)]:t._e()],2):t._e(),"orders"===t.activeMemberData?a("div",[a("div",{staticClass:"btn-group-inline",staticStyle:{"margin-bottom":"20px"}},[a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"order"===t.memberOrderType},on:{click:function(e){return t.onSelectMemberOrderType("order")}}},[t._v("預約訂單")]),a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"prepaid-order"===t.memberOrderType},on:{click:function(e){return t.onSelectMemberOrderType("prepaid-order")}}},[t._v("包月方案")])],1),"order"===t.memberOrderType?a("MemberOrdersProduct",{attrs:{"member-info-id":t.memberInfo.id}}):t._e(),"prepaid-order"===t.memberOrderType?a("MemberOrdersPrepaid",{attrs:{"member-info-id":t.memberInfo.id}}):t._e()],1):t._e()])]]:t._e(),t.petShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closePet}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("選擇寵物")])]),a("div",{staticClass:"orderformSection__right__content"},[t.editPetEnabled?[a("el-button",{staticClass:"is-round is-fullwidth",staticStyle:{"margin-bottom":"20px"},on:{click:t.closeEditPet}},[t._v("取消編輯")]),a("el-form",{ref:"petForm",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:t.submitDataPet,rules:t.submitPetRules,"label-position":"left","validate-on-rule-change":!1,"label-width":"100px"}},[a("el-form-item",{staticClass:"isAvatar"},[a("h6",{staticClass:"text-cener"},[t._v(t._s("new"===t.petEditMode?"新增寵物資料":"編輯寵物資料"))]),a("BaseUpload",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingGetPet,expression:"tryingGetPet"}],attrs:{resource:"pet",circle:"",dir:"pet"},model:{value:t.submitDataPet.avatar,callback:function(e){t.$set(t.submitDataPet,"avatar",e)},expression:"submitDataPet.avatar"}})],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"name",label:"寵物名"}},[a("el-input",{attrs:{placeholder:"請輸入寵物名"},model:{value:t.submitDataPet.name,callback:function(e){t.$set(t.submitDataPet,"name",e)},expression:"submitDataPet.name"}})],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"類別",prop:"categoryId"}},[a("el-select",{on:{change:t.changeCategory},model:{value:t.submitDataPet.categoryId,callback:function(e){t.$set(t.submitDataPet,"categoryId",e)},expression:"submitDataPet.categoryId"}},t._l(t.category,function(t,e){return a("el-option",{key:e,attrs:{value:t.id,label:t.title}})}),1)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"體型",prop:"sizeId"}},[a("el-select",{model:{value:t.submitDataPet.sizeId,callback:function(e){t.$set(t.submitDataPet,"sizeId",e)},expression:"submitDataPet.sizeId"}},t._l(t.category[t.parentCategoryIndex].children,function(t,e){return a("el-option",{key:e,attrs:{label:t.title,value:t.id}})}),1)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{prop:"breed",label:"品種"}},[a("el-input",{attrs:{placeholder:"請輸入品種"},model:{value:t.submitDataPet.breed,callback:function(e){t.$set(t.submitDataPet,"breed",e)},expression:"submitDataPet.breed"}})],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"性別"}},[a("el-select",{model:{value:t.submitDataPet.gender,callback:function(e){t.$set(t.submitDataPet,"gender",e)},expression:"submitDataPet.gender"}},[a("el-option",{attrs:{label:"母",value:"female"}}),a("el-option",{attrs:{label:"公",value:"male"}})],1)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"生日"}},[a("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:t.submitDataPet.birthday,callback:function(e){t.$set(t.submitDataPet,"birthday",e)},expression:"submitDataPet.birthday"}})],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"個性"}},[a("el-checkbox-group",{model:{value:t.submitDataPet.questions.personality,callback:function(e){t.$set(t.submitDataPet.questions,"personality",e)},expression:"submitDataPet.questions.personality"}},t._l(t.questions.personality,function(e){return a("el-checkbox",{key:e.name,attrs:{label:e.title}},[t._v(t._s(e.title))])}),1)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"健康狀況"}},[a("el-checkbox-group",{model:{value:t.healthy,callback:function(e){t.healthy=e},expression:"healthy"}},[t._l(t.questions.healthy,function(e){return[a("el-checkbox",{key:e.name,attrs:{label:e.title}},[t._v(t._s(e.title))]),t.healthy.includes("其他疾病")&&"other"===e.name?a("el-input",{key:e.title,attrs:{placeholder:"請填寫其他疾病"},model:{value:e.text,callback:function(i){t.$set(e,"text",i)},expression:"item.text"}}):t._e()]})],2)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"行為"}},[a("el-checkbox-group",{model:{value:t.behavior,callback:function(e){t.behavior=e},expression:"behavior"}},[t._l(t.questions.behavior,function(e){return[a("div",{key:e.title,staticClass:"inline-checkbox-input"},[a("el-checkbox",{key:e.name,attrs:{label:e.title}},[t._v(t._s(e.title))]),a("el-input",{model:{value:e.text,callback:function(i){t.$set(e,"text",i)},expression:"item.text"}})],1)]})],2)],1),a("el-form-item",{staticClass:"el-form-item--normal-margin no-bg-radio-group",attrs:{label:"疫苗"}},[a("el-radio",{attrs:{label:1},model:{value:t.submitDataPet.questions.vaccine,callback:function(e){t.$set(t.submitDataPet.questions,"vaccine",e)},expression:"submitDataPet.questions.vaccine"}},[t._v("1 劑")]),a("el-radio",{attrs:{label:2},model:{value:t.submitDataPet.questions.vaccine,callback:function(e){t.$set(t.submitDataPet.questions,"vaccine",e)},expression:"submitDataPet.questions.vaccine"}},[t._v("2 劑")]),a("el-radio",{attrs:{label:3},model:{value:t.submitDataPet.questions.vaccine,callback:function(e){t.$set(t.submitDataPet.questions,"vaccine",e)},expression:"submitDataPet.questions.vaccine"}},[t._v("3 劑")])],1),a("p",[t._v("內部備註")]),a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.submitDataPet.note,callback:function(e){t.$set(t.submitDataPet,"note",e)},expression:"submitDataPet.note"}})],1),a("div",{staticClass:"btn-group-inline",staticStyle:{padding:"30px 0 50px"}},[a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.closeEditPet}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{loading:t.tryingSaveMember,type:"primary"},on:{click:t.tryToSavePet}},[t._v("儲存")])],1)],1)]:[t.showDetailPet?[[a("el-button",{staticClass:"is-round is-fullwidth",staticStyle:{"margin-bottom":"20px"},on:{click:t.backToPetList}},[t._v("返回寵物列表")]),a("div",{staticClass:"btn-group-inline",staticStyle:{"margin-bottom":"20px"}},[a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"info"===t.petTabType},on:{click:function(e){return t.onSelectPetTabType("info")}}},[t._v("寵物資訊")]),a("el-button",{staticClass:"is-round isInputGroup",class:{isActive:"comment"===t.petTabType},on:{click:function(e){return t.onSelectPetTabType("comment")}}},[t._v("寵物備註")])],1),"info"===t.petTabType?a("div",{class:t.$style.pet},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingGetPet,expression:"tryingGetPet"}],staticClass:"pet__box",attrs:{"element-loading-background":"rgba(0, 0, 0, 0)"}},[a("el-row",{staticStyle:{"margin-bottom":"30px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"pet__avatar",staticStyle:{"margin-bottom":"20px"}},[a("BaseUpload",{attrs:{resource:"pet",circle:"",dir:"pet"},on:{sendSuccess:t.petUploadToStore},model:{value:t.singlePetData.avatar,callback:function(e){t.$set(t.singlePetData,"avatar",e)},expression:"singlePetData.avatar"}})],1)]),a("el-col",{attrs:{span:24}},[a("div",{staticClass:"top"},[a("el-button",{staticClass:"is-round",attrs:{size:"mini",disabled:t.tryingGetPet},on:{click:t.openEditPet}},[a("BaseIcon",{attrs:{name:"edit"}}),a("span",[t._v("編輯")])],1)],1)]),a("el-col",{attrs:{span:24}},[a("div",{staticClass:"pet__info"},[a("ul",{staticClass:"pet__info__list"},[a("li",{staticClass:"pet__info__item"},[t._v("寵物名"),a("span",{staticClass:"danger"},[t._v("*")]),t._v("："+t._s(t.singlePetData.name))]),a("li",{staticClass:"pet__info__item"},[t._v("類別"),a("span",{staticClass:"danger"},[t._v("*")]),t._v("："+t._s(t.singlePetData.categoryTitle))]),a("li",{staticClass:"pet__info__item"},[t._v("體型"),a("span",{staticClass:"danger"},[t._v("*")]),t._v("："+t._s(t.singlePetData.sizeTitle))]),a("li",{staticClass:"pet__info__item"},[t._v("品種："+t._s(t.singlePetData.breed))]),a("li",{staticClass:"pet__info__item"},[t._v("\n                                性別：\n                                "),t.singlePetData.gender?a("span",[t._v("\n                                  "+t._s("male"===t.singlePetData.gender?"公":"母")+"\n                                ")]):t._e()]),a("li",{staticClass:"pet__info__item"},[t._v("生日："+t._s(t.singlePetData.birthday))])])])])],1),a("div",{staticClass:"notice"},[a("h4",{staticClass:"form-block-title"},[t._v("寵物問題：")]),t.singlePetData.questions?a("ul",{staticClass:"pet__info__list"},[a("li",{staticClass:"pet__info__item"},[t._v("個性："+t._s(t.personalityContent?t.personalityContent:"未填寫"))]),a("li",{staticClass:"pet__info__item"},[t._v("健康狀況："+t._s(t.healthyContent?t.healthyContent:"未填寫"))]),a("li",{staticClass:"pet__info__item indentList"},[a("span",{staticClass:"title"},[t._v("行為：")]),t.behaviorContent.length>0?[a("span",{staticClass:"content"},t._l(t.behaviorContent,function(e){return a("span",{key:e,staticClass:"content__item"},[t._v(t._s(e))])}),0)]:a("span",[t._v("未填寫")])],2),a("li",{staticClass:"pet__info__item"},[t._v("疫苗："+t._s(t.singlePetData.questions.vaccine?t.vaccineContent:"未填寫"))])]):t._e()]),a("div",{staticClass:"notice"},[a("h4",{staticClass:"form-block-title"},[t._v("內部備註：")]),a("div",[t._v(" "+t._s(t.singlePetData.note))])])],1)]):t._e(),t.singlePetData.id&&"comment"===t.petTabType?a("PetCommentList",{ref:"commentAll",attrs:{order:void 0,pet:t.singlePetData.id,type:"pet"}}):t._e()]]:[a("el-button",{staticClass:"is-round is-fullwidth",staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary"},on:{click:t.creatPet}},[t._v("新增")]),t._l(t.petList,function(e){return a("div",{key:e.id,class:[t.$style.petList,{isActive:t.submitData.petId===e.id}],on:{click:function(i){return t.selectPet(e)}}},[e.avatar?a("img",{staticClass:"petList__img",attrs:{src:e.avatar,alt:""}}):a("img",{staticClass:"petList__img",attrs:{src:i("99bb"),alt:""}}),a("div",{staticClass:"petList__cont"},[a("div",{staticStyle:{"padding-bottom":"10px"}},[t._v(t._s(e.name))]),t._v("\n                    "+t._s(e.breed)+"\n                    "+t._s(e.categoryTitle)+"\n                    "+t._s(e.sizeTitle)+"\n                  ")]),a("el-button",{staticClass:"petList__btn",attrs:{type:"text"},on:{click:function(i){return i.stopPropagation(),t.gotoSinglePet(e)}}},[a("BaseIcon",{attrs:{name:"eye"}})],1)],1)})]]],2)]:t._e(),t.serviceShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeService}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("選擇服務")])]),a("div",{staticClass:"orderformSection__right__content"},[t.submitData.petId?[t.filteredServices.length>0?t._l(t.filteredServices,function(e){return a("div",{key:e.id,class:t.$style.price},[a("el-image",{staticClass:"image price__image",attrs:{src:e.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"price__cont"},[a("div",[a("div",{staticClass:"price__title"},[t.multipleStore?a("span",[t._v(t._s(e.storeTitle))]):t._e(),t._v(" "+t._s(e.title)+"\n                      ")]),a("div",{staticClass:"text-muted-0"},[t._v(" $"+t._s(e.price)+" ")])]),a("el-button",{staticClass:"is-round is-fullwidth",class:{isActive:e.id===t.submitData.params[0].priceId},on:{click:function(i){return t.selectService(e)}}},[t._v("選擇服務")])],1)],1)}):[a("el-alert",{attrs:{title:"目前選擇的寵物與不在服務人員的排班範圍之內",type:"warning",closable:!1}})]]:a("span",[t._v("\n              請先選擇寵物\n            ")])],2)]:t._e(),t.prepaidShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closePrepaid}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[a("div",{staticClass:"inline-between",staticStyle:{"padding-right":"15px","align-items":"center"}},[t._v("\n                可使用包月方案\n                "),a("el-button",{staticStyle:{"padding-top":"0","padding-bottom":"0","text-decoration":"underline"},attrs:{type:"text"},on:{click:t.goToBuyPrepaid}},[t._v(" 購買包月方案 ")])],1)])]),a("div",{staticClass:"orderformSection__right__content"},[t.filteredAvailablePrepaidList.length>0?t._l(t.filteredAvailablePrepaidList,function(e){return a("div",{key:e.id,class:[t.$style.price,{isDisabled:1!==e.status}],staticStyle:{cursor:"pointer"},on:{click:function(i){return t.goToPrepaid(e)}}},[a("el-image",{staticClass:"image price__image",attrs:{src:e.image,fit:"cover"}},[a("div",{attrs:{slot:"error"},slot:"error"},[a("BaseIcon",{staticClass:"image--error",attrs:{name:"image"}})],1)]),a("div",{staticClass:"price__cont"},[a("div",[a("div",{staticClass:"price__title"},[t.multipleStore?a("div",{staticStyle:{"padding-bottom":"5px"}},[t._v(t._s(e.storeTitles.join("，"))+" ")]):t._e(),t._v(" "+t._s(e.prepaidTitle)+"\n                    ")]),a("div",{staticClass:"text-muted-0",staticStyle:{"line-height":"1.6"}},[t._v("\n                      可抵用次數："+t._s(e.times-e.used)+"/"+t._s(e.times)),a("br"),t._v("\n                      到期日："+t._s(t._f("formatDate")(e.expiredDate?e.expiredDate:""))+t._s(e.expiredDate?"":"無使用期限")+"\n                      "),2===e.status?a("div",{staticClass:"alert-text"},[t._v(" 未付款")]):t._e()])])])],1)}):a("el-alert",{attrs:{title:"目前選擇的寵物與服務人員無適用之包月方案，請調整購買數量、建議顧客購買新的包月方案",type:"warning",closable:!1}})],2)]:t._e(),t.addressShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeAddress}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("編輯到府地址")])]),a("div",{staticClass:"orderformSection__right__content"},[a("div",[a("el-form",{ref:"addressForm",staticClass:"el-form-item--white-bg",attrs:{rules:t.submitRules,model:t.submitData}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{md:12}},[a("el-form-item",{attrs:{prop:"city",label:"縣市"}},[a("el-select",{attrs:{filterable:"",placeholder:"請選擇"},on:{change:t.onSelectCity},model:{value:t.submitData.city,callback:function(e){t.$set(t.submitData,"city",e)},expression:"submitData.city"}},t._l(t.isEditMode?t.editFilterCities:t.filterCities,function(t,e){return a("el-option",{key:e,attrs:{label:t.city,value:t.city}})}),1)],1)],1),a("el-col",{attrs:{md:12}},[a("el-form-item",{attrs:{prop:"district",label:"區域"}},[a("el-select",{attrs:{placeholder:"請選擇",filterable:""},model:{value:t.submitData.district,callback:function(e){t.$set(t.submitData,"district",e)},expression:"submitData.district"}},t._l(t.districts,function(t,e){return a("el-option",{key:e,attrs:{label:t,value:t}})}),1)],1)],1),a("el-col",{attrs:{md:24}},[a("el-form-item",{attrs:{prop:"address",label:"地址"}},[a("el-input",{attrs:{placeholder:"地址"},model:{value:t.submitData.address,callback:function(e){t.$set(t.submitData,"address",e)},expression:"submitData.address"}})],1)],1)],1),t.isEditMode?t._e():a("el-checkbox",{staticStyle:{"margin-bottom":"20px"},model:{value:t.enableSaveAddress,callback:function(e){t.enableSaveAddress=e},expression:"enableSaveAddress"}},[t._v("儲存到客戶地址")])],1),a("div",{staticClass:"btn-group-inline",staticStyle:{padding:"30px 0 50px"}},[a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.closeAddress}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{loading:t.tryingStore,disabled:t.tryingStore,type:"primary"},on:{click:t.saveHomeAddress}},[t._v("儲存")])],1)],1)])]:t._e(),t.orderRefundShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeOpenRefund}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("訂單退款")])]),a("div",{staticClass:"orderformSection__right__content"},[a("div",[a("el-form",{ref:"refundForm",staticClass:"el-form--floating el-form-item--white-bg",attrs:{rules:t.refundRules,model:t.refundSubmitData,"label-position":"top"}},[a("el-form-item",{attrs:{label:"退款金額",prop:"amount"}},[a("el-input",{attrs:{disabled:!t.canPartialRefund,placeholder:""},model:{value:t.refundSubmitData.amount,callback:function(e){t.$set(t.refundSubmitData,"amount",e)},expression:"refundSubmitData.amount"}},[a("span",{staticStyle:{"padding-right":"10px"},attrs:{slot:"suffix"},slot:"suffix"},[t._v("元")])]),a("span",{staticClass:"alert-word"},[t._v("上限為"+t._s(t.currentOrder.backBalance)+"元")])],1),a("el-form-item",{attrs:{label:"退款日期",prop:"refundDate"}},[a("el-date-picker",{attrs:{type:"date",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd",placeholder:"選擇日期"},model:{value:t.refundSubmitData.refundDate,callback:function(e){t.$set(t.refundSubmitData,"refundDate",e)},expression:"refundSubmitData.refundDate"}})],1),a("el-form-item",{staticStyle:{"margin-bottom":"20px"},attrs:{label:"退款原因"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2},placeholder:""},model:{value:t.refundSubmitData.note,callback:function(e){t.$set(t.refundSubmitData,"note",e)},expression:"refundSubmitData.note"}}),a("p",[t._v("除「信用卡」付款之外，其他所有支付方式若需退款服務，皆須透過店家進行線下退款。")])],1)],1),a("div",{staticClass:"bottom-btn-center"},[a("el-button",{staticClass:"is-round",on:{click:t.closeOpenRefund}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:function(e){return t.tryToRefund(t.currentOrder.id)}}},[t._v("確認退款記錄")])],1)],1)])]:t._e(),t.noteEditShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeNoteEdit}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("編輯備註")])]),a("div",{staticClass:"orderformSection__right__content"},[a("el-form",{ref:"form",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:t.currentOrder,rules:t.submitRules,"label-position":"top"}},[a("div",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("h6",{staticStyle:{"margin-top":"0"}},[t._v("使用人")]),a("el-checkbox",{staticClass:"check-by-head",model:{value:t.userSameAsMember,callback:function(e){t.userSameAsMember=e},expression:"userSameAsMember"}},[t._v("使用人同客戶")])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"fullName",label:"姓名"}},[a("el-input",{attrs:{disabled:t.userSameAsMember,placeholder:"姓名"},model:{value:t.currentOrder.fullName,callback:function(e){t.$set(t.currentOrder,"fullName",e)},expression:"currentOrder.fullName"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{staticClass:"gender-box",attrs:{prop:"gender"}},[a("el-radio-group",{staticClass:"no-bg-radio-group",model:{value:t.currentOrder.gender,callback:function(e){t.$set(t.currentOrder,"gender",e)},expression:"currentOrder.gender"}},[a("el-radio",{attrs:{label:"male"}},[t._v("先生")]),a("el-radio",{attrs:{label:"female"}},[t._v("小姐")])],1)],1)],1),a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"phoneNumber",label:"電話"}},[a("el-input",{attrs:{disabled:t.userSameAsMember,placeholder:"手機號碼",autocomplete:"tel"},model:{value:t.currentOrder.phoneNumber,callback:function(e){t.$set(t.currentOrder,"phoneNumber",e)},expression:"currentOrder.phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend",disabled:t.userSameAsMember},slot:"prepend",model:{value:t.currentOrder.phoneCode,callback:function(e){t.$set(t.currentOrder,"phoneCode",e)},expression:"currentOrder.phoneCode"}})],1)],1)],1)],1)],1),a("el-form",{staticClass:"el-form-item--normal-margin el-form-item--white-bg el-form--label-top"},[a("OrderExtraField",{ref:"extrafieldEdit",attrs:{"default-value":t.defaultValue}}),a("el-form-item",{attrs:{label:"使用人備註"}},[a("small",{staticStyle:{display:"block",opacity:"0.5","line-height":"1.3","margin-bottom":"10px"}},[t._v("客戶可瀏覽此備註。若是不需要提供客戶瀏覽的資訊，請使用「內部備註」功能")]),a("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.currentOrder.note,callback:function(e){t.$set(t.currentOrder,"note",e)},expression:"currentOrder.note"}})],1)],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",loading:t.tryingStore},on:{click:function(e){return t.tryToSaveOrder("extraField")}}},[t._v(" 儲存 ")])],1)]:t._e(),t.orderHistoryShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeHistory}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("訂單變更記錄")])]),a("div",{staticClass:"orderformSection__right__content"},[a("el-timeline",t._l(t.currentHistory,function(e){return a("el-timeline-item",{key:e.id,attrs:{timestamp:t._f("formatDate")(e.created,"dateTime"),type:"primary",placement:"top"}},[t._v("\n                "+t._s(e.description)+"\n                "),a("span",{staticStyle:{"font-size":"13px"}},[e.creator?a("span",[t._v("- "+t._s(e.creator))]):t._e()]),e.note?a("div",[t._v(t._s(e.note))]):t._e()])}),1)],1)]:t._e(),t.editPaymentMethodShow?[a("div",{staticClass:"orderformSection__right__header"},[a("button",{staticClass:"el-drawer__close-btn",attrs:{"aria-label":"close drawer",type:"button"},on:{click:t.closeEditPaymentMethod}},[a("i",{staticClass:"el-dialog__close el-icon el-icon-close"})]),a("h4",{staticClass:"orderformSection__right__title"},[t._v("編輯付款方式")])]),a("div",{staticClass:"orderformSection__right__content"},[a("div",{staticClass:"payment-radio"},[a("div",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("h6",[t._v("付款方式")]),a("el-checkbox",{staticClass:"check-by-head text-muted-0",attrs:{"false-label":0,"true-label":1},model:{value:t.currentOrder.allowExpired,callback:function(e){t.$set(t.currentOrder,"allowExpired",e)},expression:"currentOrder.allowExpired"}},[t._v("可逾期付款")])],1),a("el-radio-group",{model:{value:t.currentOrder.paymentMethod,callback:function(e){t.$set(t.currentOrder,"paymentMethod",e)},expression:"currentOrder.paymentMethod"}},[a("el-radio",{attrs:{label:"Cash",border:""}},[t._v("到店付款(現金)")]),a("el-radio",{attrs:{label:"StoreCredit",border:""}},[t._v("現場刷卡")]),a("el-radio",{attrs:{label:"Atm",border:""}},[t._v("線下匯款")]),"UNPAID"===t.currentOrder.paymentStatus&&1===t.storeCashflowSetting?a("el-radio",{attrs:{label:"Credit",border:""}},[t._v("信用卡付款")]):t._e(),"UNPAID"===t.currentOrder.paymentStatus&&0!==t.storeCashflowSetting?a("el-radio",{attrs:{label:"Vacc",border:""}},[t._v("ATM虛擬帳戶")]):t._e()],1),"StoreCredit"===t.currentOrder.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px","padding-top":"10px"}},[t._v("信用卡末四碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.currentOrder.Card4No,callback:function(e){t.$set(t.currentOrder,"Card4No",e)},expression:"currentOrder.Card4No"}})]],2)]:t._e(),"Atm"===t.currentOrder.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px","padding-top":"10px"}},[t._v("匯款帳號末五碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.currentOrder.PayerAccount5Code,callback:function(e){t.$set(t.currentOrder,"PayerAccount5Code",e)},expression:"currentOrder.PayerAccount5Code"}})]],2)]:t._e(),"Vacc"===t.currentOrder.paymentMethod?[a("el-form",{ref:"bankType",attrs:{model:t.currentOrder,rules:t.submitRules}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"bankType",label:"轉帳銀行"}},[[a("el-select",{model:{value:t.currentOrder.bankType,callback:function(e){t.$set(t.currentOrder,"bankType",e)},expression:"currentOrder.bankType"}},t._l(t.bankTypeList,function(t,e){return a("el-option",{key:"bank-"+e,attrs:{value:t.id,label:t.title}})}),1)]],2)],1)]:t._e(),a("div",{staticClass:"btn-group-inline",staticStyle:{padding:"30px 0 50px"}},[a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.closeEditPaymentMethod}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{loading:t.tryingStore,disabled:t.tryingStore,type:"primary"},on:{click:t.tryToStorePayment}},[t._v("確認變更")])],1)],2)])]:t._e()],[t.isEditMode?a("div",{class:t.$style.total},[a("div",{staticClass:"total__cont"},[a("TotalTable",{attrs:{"is-out-side":"","is-edit-mode":t.isEditMode,"is-paid":t.isPaid,"has-coupon-info":t.hasCouponInfo,"order-params":t.submitData.params,"order-total-edit-list":t.totalEditList,"order-add-list":t.addList,"service-total":t.serviceTotal,"coupon-price-total":t.couponPriceTotal,"submit-price-total":t.submitPriceTotal,"coupon-info":t.couponInfo,"submit-data":t.submitData,"submit-data-prepaid":t.submitDataPrepaid,"current-buy-prepaid":t.currentBuyPrepaid},on:{"update:orderParams":function(e){return t.$set(t.submitData,"params",e)},"update:order-params":function(e){return t.$set(t.submitData,"params",e)},"update:orderTotalEditList":function(e){t.totalEditList=e},"update:order-total-edit-list":function(e){t.totalEditList=e},"update:orderAddList":function(e){t.addList=e},"update:order-add-list":function(e){t.addList=e},openAdd:t.openAddEdit,editOpenTotalEdit:t.editOpenTotalEdit,editOpenPaymentMethod:t.editOpenPaymentMethod,editOpenHistory:t.editOpenHistory,tryToCancelOrder:t.tryToCancelOrder,editOpenRefund:t.editOpenRefund}},[a("div",{staticStyle:{padding:"30px"}},[0!==t.defaultValue.status?a("el-button",{staticClass:"is-round is-fullwidth",on:{click:t.openAddOrder}},[t._v("新增子訂單")]):t._e()],1)])],1)]):a("div",{class:t.$style.total},[a("div",{staticClass:"total__cont"},[a("TotalTable",{attrs:{"is-out-side":"","is-edit-mode":t.isEditMode,"has-coupon-info":t.hasCouponInfo,"order-params":t.submitData.params,"order-total-edit-list":t.totalEditList,"order-add-list":t.addList,"service-total":t.serviceTotal,"coupon-price-total":t.couponPriceTotal,"submit-price-total":t.submitPriceTotal,"coupon-info":t.couponInfo,"submit-data":t.submitData,"submit-data-prepaid":t.submitDataPrepaid,"current-buy-prepaid":t.currentBuyPrepaid},on:{"update:orderParams":function(e){return t.$set(t.submitData,"params",e)},"update:order-params":function(e){return t.$set(t.submitData,"params",e)},"update:orderTotalEditList":function(e){t.totalEditList=e},"update:order-total-edit-list":function(e){t.totalEditList=e},"update:orderAddList":function(e){t.addList=e},"update:order-add-list":function(e){t.addList=e},openAdd:t.openAddEdit}},[t.submitData.params[0].priceId?a("div",{staticClass:"btn-group-inline",class:t.$style.bottom,staticStyle:{padding:"30px"}},[a("el-button",{staticClass:"is-round",attrs:{plain:""},on:{click:t.openTotalEdit}},[t._v("價格編輯與折扣")]),a("el-button",{staticClass:"is-round",on:{click:t.openAddEdit}},[t._v("加購")])],1):t._e()])],1),a("div",{staticClass:"total__bottom"},[a("div",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("h6",[t._v("付款方式")]),a("el-checkbox",{staticClass:"check-by-head text-muted-0",attrs:{"false-label":0,"true-label":1},model:{value:t.submitData.allowExpired,callback:function(e){t.$set(t.submitData,"allowExpired",e)},expression:"submitData.allowExpired"}},[t._v("可逾期付款")])],1),a("el-radio-group",{model:{value:t.paymentWay,callback:function(e){t.paymentWay=e},expression:"paymentWay"}},[t.prepaidListAfterService.length>0&&!t.isBuyPrepaid&&!t.isPrepaidAndEdit&&"prepaid-order"===t.ordertype?a("el-radio",{attrs:{label:"Prepaid",border:""}},[t._v("包月抵扣")]):t._e(),a("el-radio",{attrs:{label:"offline",disabled:"prepaid-order"===t.ordertype&&!t.isBuyPrepaid&&!t.isPrepaidAndEdit,border:""}},[t._v("線下付款")]),a("el-radio",{attrs:{label:"online",disabled:"prepaid-order"===t.ordertype&&!t.isBuyPrepaid&&!t.isPrepaidAndEdit,border:""}},[t._v("線上付款")])],1)],1)])]],2),a("div",{staticClass:"orderformSection__bottom"},[t.isEditMode?a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("BaseStateLabel",{attrs:{state:t._f("paymentStatusMapFilter")(t.defaultValue.paymentStatus,"color")}},[t._v(t._s(t._f("paymentStatusMapFilter")(t.defaultValue.paymentStatus,"text")))]),a("BaseStateLabel",{staticStyle:{padding:"0 18px",height:"25px"},attrs:{round:!0,state:t._f("bookingStatusFilter")(t.defaultValue.status,"color"),text:""}},[t._v(t._s(t._f("bookingStatusFilter")(t.defaultValue.status,"text")))]),a("div",{staticStyle:{"padding-left":"20px"}},[t._v("\n          NT$ "+t._s(t.defaultValue.allActualPayTotal)+" \n          "),t.defaultValue.allUnpaidTotal?a("span",{staticStyle:{color:"#e35d5d","margin-left":"5px","font-size":"12px",display:"inline-block"}},[t._v(" ( 未付款金額 NT$"+t._s(t.defaultValue.allUnpaidTotal)+" )")]):t._e(),a("br"),a("BaseStateLabel",{staticClass:"text-muted-0",staticStyle:{"padding-top":"5px"},attrs:{state:"info",text:""}},[t._v(t._s(t._f("orderPaymentMethodFilter")(t.defaultValue.paymentMethod)))])],1)],1):a("div",{staticStyle:{display:"flex","align-items":"center"}},[a("BaseStateLabel",{attrs:{state:t._f("paymentStatusMapFilter")(t.defaultValue.paymentStatus,"color")}},[t._v(t._s(t._f("paymentStatusMapFilter")(t.defaultValue.paymentStatus,"text")))]),a("div",{staticStyle:{"padding-left":"20px"}},[t._v("\n          應付 NT$ "),t.submitDataPrepaid.prepaidId?a("span",[t._v(" "+t._s(t.currentBuyPrepaid.price)+" + ")]):t._e(),t._v(" "+t._s(t.submitPriceTotal)+"\n          "),t.submitData.params[0].priceId?t._e():a("div",{staticClass:"text-muted-0",staticStyle:{"padding-top":"5px"}},[t._v("未選擇付款方式")])])],1),t.isEditMode?a("div",{staticStyle:{"flex-shrink":"0",padding:"0 10px"}},[a("el-button",{staticClass:"no-color-text-btn",staticStyle:{"font-size":"20px","margin-right":"5px"},attrs:{type:"text"},on:{click:function(e){t.writeDialogVisible=!0}}},[a("BaseIcon",{attrs:{name:"envelope","icon-style":"fal"}})],1),5!==t.defaultValue.status&&0!==t.defaultValue.status?a("el-button",{staticClass:"icon-text no-color-text-btn",staticStyle:{"font-size":"20px"},attrs:{type:"text"},on:{click:t.showShareDialog}},[a("BaseIcon",{attrs:{name:"paper-plane","icon-style":"fal"}})],1):t._e()],1):t._e(),a("BaseButtonDialog",{attrs:{"only-dialog":!0,title:"撰寫通知","dialog-visible":t.writeDialogVisible,destroy:!0,floating:""},on:{"update:dialogVisible":function(e){t.writeDialogVisible=e},"update:dialog-visible":function(e){t.writeDialogVisible=e}}},[a("NotificationWrite",{attrs:{"selected-order-ids":[t.defaultValue.id],"source-name":"order","source-order":t.defaultValue},on:{close:t.closeNotificationDialog}})],1),a("el-dialog",{attrs:{title:"分享連結",visible:t.shareDialogVisible,top:"0",width:"680px","append-to-body":"","lock-scroll":""},on:{"update:visible":function(e){t.shareDialogVisible=e},open:t.tryToGetShareLink}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("h5",[t._v(t._s("#"+t.defaultValue.id))]),a("ul",[a("li",[t._v("使用人："+t._s(t.defaultValue.fullName)+" "+t._s(t._f("genderFilter")(t.defaultValue.gender)))]),a("li",[t._v("訂購內容："+t._s(t.defaultValue.productName)+" "+t._s(t._f("formatDate")(t.defaultValue.date))+" "+t._s(t.defaultValue.time))])])]),a("div",{class:t.$style["share__buttons"]},[a("el-button",{class:t.$style["share__button"],attrs:{type:"text"},on:{click:function(e){return t.handleShareLink("facebook")}}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"facebook-f","icon-style":"fab"}})],1),a("el-button",{class:t.$style["share__button"],attrs:{type:"text"},on:{click:function(e){return t.handleShareLink("line")}}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"line","icon-style":"fab"}})],1),a("el-button",{class:t.$style["share__button"],attrs:{type:"text",loading:t.tryingSendSMS},on:{click:t.tryToSendSMS}},[a("BaseIcon",{class:t.$style["share__icon"],attrs:{name:"sms"}})],1),a("div",{class:t.$style["share__button"]},[a("el-button",{attrs:{circle:""},on:{click:t.copyShareLink}},[a("BaseIcon",{attrs:{name:"copy"}})],1),a("div",{class:t.$style["share__label"]},[t._v("複製連結")])],1)],1)]),t.isEditMode?[a("div",{staticStyle:{"flex-shrink":"0"}},[3===t.defaultValue.status?a("el-button",{staticClass:"is-round orderformSection__bottom__btn-item",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:t.changeCheckDialog}},[t._v("變更報到狀態")]):t._e(),0!==t.defaultValue.status&&"UNPAID"===t.defaultValue.paymentStatus&&"Credit"!==t.defaultValue.paymentMethod&&"Vacc"!==t.defaultValue.paymentMethod&&"Prepaid"!==t.defaultValue.paymentMethod?a("el-button",{staticClass:"is-round orderformSection__bottom__btn-item",attrs:{type:"success",disabled:t.tryingStore,loading:t.tryingStore},on:{click:t.openPaidDialog}},[t._v("付款")]):t._e(),t.unPaidAddOrder&&t.unPaidAddOrder.id&&"UNPAID"===t.unPaidAddOrder.paymentStatus&&"Credit"!==t.unPaidAddOrder.paymentMethod&&"Vacc"!==t.unPaidAddOrder.paymentMethod?a("el-button",{staticClass:"is-round orderformSection__bottom__btn-item",attrs:{type:"success",disabled:t.tryingStore,loading:t.tryingStore},on:{click:t.openAddPaidDialog}},[t._v("付款子訂單")]):t._e(),2===t.defaultValue.prepaidOrderStatus?[a("div",{staticStyle:{display:"inline-block"}},[a("el-alert",{staticStyle:{display:"inline-block",width:"auto",top:"14px",left:"0","margin-left":"10px"},attrs:{type:"error",closable:!1}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v("包月訂單未付款")])]),a("el-button",{staticStyle:{"padding-top":"0","text-decoration":"underline","margin-left":"10px"},attrs:{type:"text"},on:{click:function(e){return t.goToPrepaidOrder(t.defaultValue.prepaidOrderUuid)}}},[t._v(" 前往 ")])],1)]:t._e(),4===t.defaultValue.status&&t.isPaid&&!t.unPaidAddOrder&&2!==t.defaultValue.prepaidOrderStatus?a("el-button",{staticClass:"is-round orderformSection__bottom__btn-item",attrs:{type:"primary"},on:{click:t.showSignDialog}},[t._v("簽名請款")]):t._e(),4===t.defaultValue.status?[[!t.isPaid||t.unPaidAddOrder?a("el-alert",{staticStyle:{display:"inline-block",width:"auto",top:"14px",left:"0","margin-left":"20px"},attrs:{type:"error",closable:!1}},[a("span",{attrs:{slot:"title"},slot:"title"},[t._v("請將訂單及子訂單款項結清，"),a("br"),t._v("始可完成簽名請款")])]):t._e()]]:t._e()],2)]:[t.isBuyPrepaid?a("el-button",{staticClass:"is-round orderformSection__bottom__btn",attrs:{type:"primary",disabled:t.tryingStore||!t.submitData.params[0].priceId,loading:t.tryingStore},on:{click:t.handleStorePrepaidOrder}},[t._v("購買包月方案 + 新增預約")]):a("el-button",{staticClass:"is-round orderformSection__bottom__btn",attrs:{type:"primary",disabled:t.tryingStore||!t.submitData.params[0].priceId,loading:t.tryingStore},on:{click:t.handleStoreOrder}},[t._v("新增預約")])]],2),a("el-dialog",{attrs:{visible:t.changeDialogVisible,width:"40%",top:"0","custom-class":"small-dialog","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(e){t.changeDialogVisible=e}}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"circle-icon bg-success"},[a("BaseIcon",{attrs:{name:"check"}})],1),a("h4",{staticStyle:{"margin-bottom":"10px"}},[t._v("報到狀態")])]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary"},on:{click:t.openCheckDialog}},[t._v(" 已報到 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary"},on:{click:function(e){t.noShowDialogVisible=!0}}},[t._v(" 未報到 ")])],1),t.defaultValue.scheduleItem?a("el-dialog",{attrs:{title:"確認將此訂單改為「已報到」",visible:t.checkDialogVisible,top:"0","append-to-body":""},on:{"update:visible":function(e){t.checkDialogVisible=e}}},[a("el-form",{ref:"beauticianForm",staticClass:"el-form-item--normal-margin",attrs:{model:t.check,rules:t.helpSubmitRules,"label-width":"100px","label-position":"left"}},[a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"美容師"}},[t._v("\n          "+t._s(t.defaultValue.scheduleItem?t.defaultValue.scheduleItem.name:"")+"\n          ")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.tryingAssign,expression:"tryingAssign"}],attrs:{"element-loading-background":"rgba(0, 0, 0,0)"}},[t.assignList.length>0?a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"助理",prop:"assistant"}},[a("el-select",{model:{value:t.check.helperId,callback:function(e){t.$set(t.check,"helperId",e)},expression:"check.helperId"}},[a("el-option",{attrs:{label:"不指派",value:""}}),t._l(t.assignList,function(t,e){return a("el-option",{key:e,attrs:{value:t.id,label:t.name+" "+(t.sameStore?"(同分店)":"(不同分店)")}})})],2)],1):t._e(),0!==t.assignList.length||t.tryingAssign?t._e():a("el-form-item",{staticClass:"el-form-item--normal-margin",attrs:{label:"助理",prop:"assistant"}},[a("el-alert",{attrs:{title:"目前無人員可指派",type:"warning",closable:!1}})],1)],1)],1),a("div",{staticClass:"bottom-btn-center"},[a("el-button",{staticClass:"is-round",on:{click:function(e){t.checkDialogVisible=!1}}},[t._v("取消")]),a("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:t.tryToStoreAssignAndCheckIn}},[t._v("確認")])],1)],1):t._e(),a("el-dialog",{attrs:{title:"請說明未報到情況",visible:t.noShowDialogVisible,top:"0","append-to-body":""},on:{"update:visible":function(e){t.noShowDialogVisible=e}}},[a("el-form",{ref:"form",attrs:{model:t.submitData,rules:{note:[{required:!0,message:"請輸入情況！",trigger:"blur"}]}}},[a("el-form-item",{attrs:{prop:"note"}},[a("el-input",{staticClass:"is-round is-light is-border",attrs:{type:"textarea",rows:4,placeholder:"請輸入備註"},model:{value:t.submitData.note,callback:function(e){t.$set(t.submitData,"note",e)},expression:"submitData.note"}})],1)],1),a("el-row",{staticStyle:{"margin-top":"20px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-button",{staticClass:"is-round is-fullwidth",on:{click:function(e){t.noShowDialogVisible=!1}}},[t._v("返回")])],1),a("el-col",{attrs:{span:12}},[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{loading:t.tryingNoShow,disabled:t.tryingNoShow,type:"danger"},on:{click:t.onClickNoShow}},[t._v("未報到")])],1)],1)],1)],1),a("SignatureDialog",{key:t.signDialogKey,attrs:{visible:t.signDialogVisible,order:Object.assign({},t.defaultValue)},on:{"update:visible":function(e){t.signDialogVisible=e},update:t.updateOrder}}),a("el-dialog",{attrs:{visible:t.paymentDialogVisible,width:"40%",top:"0","custom-class":"small-dialog","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(e){t.paymentDialogVisible=e}}},[1===t.paymentStep?[a("div",{attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"circle-icon bg-success"},[a("BaseIcon",{attrs:{name:"check"}})],1),a("h4",{staticStyle:{"margin-bottom":"10px"}},[t._v("付款方式")])]),t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid?[a("el-form",{attrs:{model:t.submitData,rules:t.submitRules}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border text-center",attrs:{label:"請選擇包月方案"}},[a("el-select",{model:{value:t.catchPrepaidOrderUuid,callback:function(e){t.catchPrepaidOrderUuid=e},expression:"catchPrepaidOrderUuid"}},t._l(t.prepaidListAfterService,function(e,i){return a("el-option",{key:i,attrs:{disabled:1!==e.status,value:e.id,label:e.prepaidTitle}},[t._v("\n                  "+t._s(e.prepaidTitle)+"\n                  "),1===e.status?a("span",{staticClass:"select__option--meta"},[t._v(t._s("(尚餘"+(e.times-e.used)+"次)"))]):a("span",{staticClass:"select__option--meta"},[t._v(t._s("未付款"))])])}),1)],1)],1)]:t._e(),"offline"===t.paymentWay?a("div",[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid&&!t.catchPrepaidOrderUuid},on:{click:function(e){return t.selectPayment("Cash")}}},[t._v(" 到店付款(現金) ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid&&!t.catchPrepaidOrderUuid},on:{click:function(e){return t.selectPayment("StoreCredit")}}},[t._v(" 現場信用卡 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid&&!t.catchPrepaidOrderUuid},on:{click:function(e){return t.selectPayment("Atm")}}},[t._v(" 線下匯款 ")])],1):t._e(),"online"===t.paymentWay?a("div",[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid&&!t.catchPrepaidOrderUuid},on:{click:function(e){return t.selectPayment("Credit")}}},[t._v(" 線上信用卡 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.isPrepaidAndEdit&&!t.submitData.prepaidOrderUuid&&!t.catchPrepaidOrderUuid},on:{click:function(e){return t.selectPayment("Vacc")}}},[t._v(" 虛擬帳戶 ")])],1):t._e()]:t._e(),2===t.paymentStep?[a("div",{attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"el-message-box__status el-icon-warning",staticStyle:{position:"relative",transform:"none","margin-bottom":"0"}}),a("h4",{staticStyle:{"margin-bottom":"10px"}},[t._v("\n          "+t._s(t.paymentTitle)+"\n        ")])]),t.isChildren?["Cash"===t.childrenSubmitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("客人是否已付款")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 是 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 否 ")])]:t._e(),"StoreCredit"===t.childrenSubmitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("信用卡末四碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.childrenSubmitData.Card4No,callback:function(e){t.$set(t.childrenSubmitData,"Card4No",e)},expression:"childrenSubmitData.Card4No"}})],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 確認 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 稍後付款 ")])]:t._e(),"Atm"===t.childrenSubmitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("匯款帳號末五碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.childrenSubmitData.PayerAccount5Code,callback:function(e){t.$set(t.childrenSubmitData,"PayerAccount5Code",e)},expression:"childrenSubmitData.PayerAccount5Code"}})],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 確認 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 稍後付款 ")])]:t._e(),"Vacc"===t.childrenSubmitData.paymentMethod?[a("el-form",{attrs:{model:t.childrenSubmitData,rules:t.submitRules}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"bankType",label:"轉帳銀行"}},[a("el-select",{model:{value:t.childrenSubmitData.bankType,callback:function(e){t.$set(t.childrenSubmitData,"bankType",e)},expression:"childrenSubmitData.bankType"}},t._l(t.bankTypeList,function(t,e){return a("el-option",{key:"bank-"+e,attrs:{value:t.id,label:t.title}})}),1)],1)],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 確認 ")])]:t._e()]:["Cash"===t.submitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("客人是否已付款")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 是 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 否 ")])]:t._e(),"StoreCredit"===t.submitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("信用卡末四碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[t.submitDataPrepaid.prepaidId?[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.submitDataPrepaid.Card4No,callback:function(e){t.$set(t.submitDataPrepaid,"Card4No",e)},expression:"submitDataPrepaid.Card4No"}})]:[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.submitData.Card4No,callback:function(e){t.$set(t.submitData,"Card4No",e)},expression:"submitData.Card4No"}})]],2),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 確認 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 稍後付款 ")])]:t._e(),"Atm"===t.submitData.paymentMethod?[a("div",{staticStyle:{"margin-bottom":"15px"}},[t._v("匯款帳號末五碼")]),a("div",{staticClass:"el-form-item el-form-item--white-bg-border"},[t.submitDataPrepaid.prepaidId?[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.submitDataPrepaid.PayerAccount5Code,callback:function(e){t.$set(t.submitDataPrepaid,"PayerAccount5Code",e)},expression:"submitDataPrepaid.PayerAccount5Code"}})]:[a("el-input",{attrs:{placeholder:"請輸入"},model:{value:t.submitData.PayerAccount5Code,callback:function(e){t.$set(t.submitData,"PayerAccount5Code",e)},expression:"submitData.PayerAccount5Code"}})]],2),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 確認 ")]),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 稍後付款 ")])]:t._e(),"Vacc"===t.submitData.paymentMethod?[a("el-form",{attrs:{model:t.submitData,rules:t.submitRules}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"bankType",label:"轉帳銀行"}},[t.submitDataPrepaid.prepaidId?[a("el-select",{model:{value:t.submitDataPrepaid.bankType,callback:function(e){t.$set(t.submitDataPrepaid,"bankType",e)},expression:"submitDataPrepaid.bankType"}},t._l(t.bankTypeList,function(t,e){return a("el-option",{key:"bank-"+e,attrs:{value:t.id,label:t.title}})}),1)]:[a("el-select",{model:{value:t.submitData.bankType,callback:function(e){t.$set(t.submitData,"bankType",e)},expression:"submitData.bankType"}},t._l(t.bankTypeList,function(t,e){return a("el-option",{key:"bank-"+e,attrs:{value:t.id,label:t.title}})}),1)]],2)],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!1)}}},[t._v(" 確認 ")])]:t._e(),"Prepaid"===t.submitData.paymentMethod?[a("el-form",{attrs:{model:t.submitData,rules:t.submitRules}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border text-center",attrs:{label:"請選擇包月方案"}},[a("el-select",{model:{value:t.submitData.prepaidOrderUuid,callback:function(e){t.$set(t.submitData,"prepaidOrderUuid",e)},expression:"submitData.prepaidOrderUuid"}},t._l(t.prepaidListAfterService,function(e,i){return a("el-option",{key:i,attrs:{disabled:1!==e.status,value:e.id,label:e.prepaidTitle}},[t._v("\n                  "+t._s(e.prepaidTitle)+"\n                  "),1===e.status?a("span",{staticClass:"select__option--meta"},[t._v(t._s("(尚餘"+(e.times-e.used)+"次)"))]):a("span",{staticClass:"select__option--meta"},[t._v(t._s("未付款"))])])}),1)],1)],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",disabled:t.tryingStore,loading:t.tryingStore},on:{click:function(e){return t.goToExtrafields(!0)}}},[t._v(" 確認 ")])]:t._e()]]:t._e()],2),a("el-dialog",{attrs:{visible:t.extraDialogVisible,width:"80%",top:"0",title:"備註","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(e){t.extraDialogVisible=e}}},[a("el-form",{ref:"extraForm",staticClass:"el-form-item--normal-margin",attrs:{model:t.submitData,rules:t.submitRules,"label-position":"top"}},[a("div",{staticStyle:{display:"flex","margin-bottom":"10px"}},[a("h6",{staticStyle:{"margin-top":"0"}},[t._v("使用人")]),a("el-checkbox",{staticClass:"check-by-head",model:{value:t.userSameAsMember,callback:function(e){t.userSameAsMember=e},expression:"userSameAsMember"}},[t._v("使用人同客戶")])],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"fullName",label:"姓名"}},[a("el-input",{attrs:{disabled:t.userSameAsMember,placeholder:"姓名"},model:{value:t.submitData.fullName,callback:function(e){t.$set(t.submitData,"fullName",e)},expression:"submitData.fullName"}})],1)],1),a("el-col",{attrs:{span:7}},[a("el-form-item",{staticClass:"gender-box",attrs:{prop:"gender"}},[a("el-radio-group",{staticClass:"no-bg-radio-group",model:{value:t.submitData.gender,callback:function(e){t.$set(t.submitData,"gender",e)},expression:"submitData.gender"}},[a("el-radio",{attrs:{label:"male"}},[t._v("先生")]),a("el-radio",{attrs:{label:"female"}},[t._v("小姐")])],1)],1)],1),a("el-col",{attrs:{span:10}},[a("el-form-item",{staticClass:"el-form-item--white-bg-border",attrs:{prop:"phoneNumber",label:"電話"}},[a("el-input",{attrs:{disabled:t.userSameAsMember,placeholder:"手機號碼",autocomplete:"tel"},model:{value:t.submitData.phoneNumber,callback:function(e){t.$set(t.submitData,"phoneNumber",e)},expression:"submitData.phoneNumber"}},[a("CountryCodePicker",{attrs:{slot:"prepend",disabled:t.userSameAsMember},slot:"prepend",model:{value:t.submitData.phoneCode,callback:function(e){t.$set(t.submitData,"phoneCode",e)},expression:"submitData.phoneCode"}})],1)],1)],1)],1)],1),a("el-form",{staticClass:"el-form-item--normal-margin el-form--label-top"},[a("OrderExtraField",{ref:"extrafield",attrs:{"default-value":{byOrderExtrafields:t.submitData.byOrderExtrafields,customerInfos:[]}}}),a("el-form-item",{attrs:{label:"使用人備註"}},[a("small",{staticStyle:{display:"block",opacity:"0.5","line-height":"1.3","margin-bottom":"10px"}},[t._v("客戶可瀏覽此備註。若是不需要提供客戶瀏覽的資訊，請使用「內部備註」功能")]),a("el-input",{attrs:{type:"textarea",rows:2},model:{value:t.submitData.note,callback:function(e){t.$set(t.submitData,"note",e)},expression:"submitData.note"}})],1)],1),a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"primary",loading:t.tryingStore,disabled:t.tryingStore},on:{click:t.handleCreateOrder}},[t._v(" 儲存並完成 ")])],1),a("OrderChangeStatusDialog",{attrs:{visible:t.statusDialogVisible,order:Object.assign({},t.currentOrder,{status:0})},on:{"update:visible":function(e){t.statusDialogVisible=e},cancelled:t.updateOrder}})],1)},r=[],s=i("9161"),n=i("4795"),o=i.n(n),l=i("cb0c"),d=i("9395"),c=i("f210"),u=i("a315"),m=(i("0644"),i("340b"),i("5117"),i("7e02")),p=i("6bea"),h=i("b775"),b=(i("2b88"),i("8b4c"),i("62d4")),f=i("2ef0"),v=i("b155"),y=function(){return{categoryId:"",sizeId:"",name:"",birthday:"",avatar:"",gender:"",breed:"",note:"",memberId:"",questions:{personality:[],healthy:[],behavior:[],vaccine:0}}},_={components:{BaseButtonDialog:b["default"],BaseUpload:function(){return Object(u["a"])(i.e("chunk-3559b494").then(i.bind(null,"0ac6")))},PetForm:function(){return Object(u["a"])(i.e("chunk-b0d2da58").then(i.bind(null,"eae8")))},PetCommentList:function(){return Object(u["a"])(i.e("chunk-838dbece").then(i.bind(null,"7d95")))}},filters:{},data:function(){return{questions:Object(f["cloneDeep"])(v["a"]),petList:[],submitDataPet:{categoryId:"",sizeId:"",name:"",birthday:"",avatar:"",gender:"",breed:"",note:"",memberId:"",questions:{personality:[],healthy:[],behavior:[],vaccine:0}},behavior:[],healthy:[],singlePetData:{},dialogVisiblePet:!1,showDetailPet:!1,editPetEnabled:!1,category:[],parentCategoryIndex:0,tryingGetPet:!1,activeTabPet:"1",petEditMode:"edit",petTabType:"info"}},computed:{submitPetRules:function(){return{avatar:[{required:!0,message:"請上傳頭像",trigger:"change"}],name:[{required:!0,message:"請填寫寵物名",trigger:"blur"}],categoryId:[{required:!0,message:"請選擇類別",trigger:"blur"}],sizeId:[{required:!0,message:"請選擇體型",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別",trigger:"change"}],birthday:[{required:!0,message:"請選擇生日",trigger:"blur"}]}},personalityContent:function(){return this.singlePetData.questions.personality.join("，")},healthyContent:function(){var t=this.singlePetData.questions.healthy.map(function(t){return"".concat(t.title).concat(t.text?" ( ":""," ").concat(t.text?t.text:"").concat(t.text?" )":"")});return t.join("，")},behaviorContent:function(){var t=this.singlePetData.questions.behavior.map(function(t){return"".concat(t.title).concat(t.text?" ( ":""," ").concat(t.text?t.text:"").concat(t.text?" )":"")});return t},vaccineContent:function(){var t="";switch(this.singlePetData.questions.vaccine){case 1:t="1 劑";break;case 2:t="2 劑";break;case 3:t="3 劑";break;default:break}return t},personalityContentOrder:function(){return this.defaultValue.pet.questions.personality.join("，")},healthyContentOrder:function(){var t=this.defaultValue.pet.questions.healthy.map(function(t){return"".concat(t.title).concat(t.text?" ( ":""," ").concat(t.text?t.text:"").concat(t.text?" )":"")});return t.join("，")},behaviorContentOrder:function(){var t=this.defaultValue.pet.questions.behavior.map(function(t){return"".concat(t.title).concat(t.text?" ( ":""," ").concat(t.text?t.text:"").concat(t.text?" )":"")});return t},vaccineContentOrder:function(){var t="";switch(this.defaultValue.pet.questions.vaccine){case 1:t="1 劑";break;case 2:t="2 劑";break;case 3:t="3 劑";break;default:break}return t},selectPetCont:function(){var t=this,e=this.petList.find(function(e){return e.id===t.submitData.petId}),i=e.gender?"male"===e.gender?" 公 ":" 母 ":"";return"".concat(e.name," ").concat(i," ").concat(e.categoryTitle,"/").concat(e.sizeTitle)}},watch:{"submitDataPet.categoryId":function(){this.getParentCategoryIndex()},behavior:function(t){var e=this;t.length>0&&this.submitDataPet.questions.behavior?this.submitDataPet.questions.behavior=t.map(function(t){var i=e.questions.behavior.find(function(e){return e.title===t});return i}):0===t.length&&this.submitDataPet.questions.behavior&&(this.submitDataPet.questions.behavior=[])},healthy:function(t){var e=this;t.length>0&&this.submitDataPet.questions.healthy?this.submitDataPet.questions.healthy=t.map(function(t){var i=e.questions.healthy.find(function(e){return e.title===t});return i}):0===t.length&&this.submitDataPet.questions.healthy&&(this.submitDataPet.questions.healthy=[])}},created:function(){this.tryToFetchCategory()},methods:{selectPet:function(t){this.submitData.petId=t.id,this.petShow=!1,this.tryToFetchPrepaid(),this.scrollToBottom()},closePet:function(){this.petShow=!1,this.ordertype=""},openSelectPet:function(){this.closeAllInfo(),this.ordertype="",this.petShow=!0},tryToFetchCategory:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("product/fetchServiceCategory");case 2:this.category=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToFetchPetList:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("member/fetchPetList",{memberId:this.memberInfo.id});case 2:this.petList=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),gotoSinglePet:function(){var t=Object(l["a"])(o.a.mark(function t(e){var i,a;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.petShow=!0,this.showDetailPet=!0,this.tryingGetPet=!0,t.next=5,this.$store.dispatch("member/fetchSinglePet",{memberId:this.memberInfo.id,petId:e.id});case 5:i=t.sent,a=i.items,this.singlePetData=a,this.getDefaultQuestion(),this.tryingGetPet=!1;case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),tryToFetchSinglePet:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingGetPet=!0,t.next=3,this.$store.dispatch("member/fetchSinglePet",{memberId:this.memberInfo.id,petId:this.singlePetData.id});case 3:e=t.sent,i=e.items,this.singlePetData=i,this.getDefaultQuestion(),this.tryingGetPet=!1;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),getDefaultQuestion:function(){this.questions.behavior.forEach(function(t){t.text=""}),this.questions.healthy.forEach(function(t){t.text=""}),this.singlePetData.questions?(this.behavior=this.singlePetData.questions.behavior.map(function(t){return t.title}),this.healthy=this.singlePetData.questions.healthy.map(function(t){return t.title})):(this.behavior=[],this.healthy=[])},openDialog:function(t,e){this.behavior=[],this.healthy=[],this.questions.behavior.forEach(function(t){t.text=""}),this.questions.healthy.forEach(function(t){t.text=""}),this.dialogVisiblePet=!0},closeDialog:function(){this.dialogVisiblePet=!1,this.tryToFetchPetList()},tryToRemovePet:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$confirm("確定刪除該寵物？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning",center:!0});case 2:return t.prev=2,t.next=5,this.$store.dispatch("member/removehPet",{memberId:this.memberInfo.id,ids:[e]});case 5:this.tryToFetchPetList();case 6:return t.prev=6,t.finish(6);case 8:case"end":return t.stop()}},t,this,[[2,,6,8]])}));return function(e){return t.apply(this,arguments)}}(),closeEditPet:function(){this.editPetEnabled=!1},openEditPet:function(){var t=this;this.editPetEnabled=!0,this.submitDataPet=Object(d["a"])({},this.singlePetData),this.submitDataPet.questions?(this.submitDataPet.questions.behavior.forEach(function(e){t.questions.behavior.forEach(function(t){e.title===t.title&&(t.text=e.text)})}),this.submitDataPet.questions.healthy.forEach(function(e){t.questions.healthy.forEach(function(t){e.title===t.title&&(t.text=e.text)})})):this.submitDataPet=Object(d["a"])({},this.submitDataPet,{questions:{personality:[],healthy:[],behavior:[],vaccine:""}}),this.getParentCategoryIndex()},creatPet:function(){this.editPetEnabled=!0,this.petEditMode="new",this.submitDataPet=y(),this.submitDataPet.memberId=this.memberInfo.id,this.behavior=[],this.healthy=[],this.questions.behavior.forEach(function(t){t.text=""}),this.questions.healthy.forEach(function(t){t.text=""})},tryToSavePet:function(){var t=Object(l["a"])(o.a.mark(function t(){var e=this;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.petForm.validate();case 2:if(this.submitDataPet.questions&&(this.submitDataPet.questions.behavior.forEach(function(t){e.questions.behavior.forEach(function(e){t.title===e.title&&(t.text=e.text)})}),this.submitDataPet.questions.healthy.forEach(function(t){e.questions.healthy.forEach(function(e){t.title===e.title&&(t.text=e.text)})})),"new"!==this.petEditMode){t.next=10;break}return t.next=6,this.$store.dispatch("member/storeSinglePet",this.submitDataPet);case 6:this.showDetailPet=!1,this.tryToFetchPetList(),t.next=13;break;case 10:return t.next=12,this.$store.dispatch("member/storeSinglePet",this.submitDataPet);case 12:this.tryToFetchSinglePet();case 13:this.editPetEnabled=!1;case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),backToPetList:function(){this.showDetailPet=!1,this.editPetEnabled=!1,this.submitDataPet={questions:{personality:[],healthy:[],behavior:[]}},this.singlePetData={},this.tryToFetchPetList()},getParentCategoryIndex:function(){var t=this;this.category.forEach(function(e,i){t.submitDataPet.categoryId===e.id&&(t.parentCategoryIndex=i)})},changeCategory:function(){this.submitDataPet.sizeId=""},petUploadToStore:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("member/storeSinglePet",{id:this.singlePetData.id,memberId:this.singlePetData.memberId,avatar:this.singlePetData.avatar,sizeId:this.singlePetData.sizeId,name:this.singlePetData.name});case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),onSelectPetTabType:function(t){this.petTabType=t}}},g={phoneCode:"+886",phoneNumber:""},S={phoneCode:"+886",phoneNumber:"",fullName:"",gender:"male"},C=function(){return{address:"",city:"",district:"",email:"",name:"",phone:"",postcode:""}},D=function(){return{fullName:"",gender:"male",phone:"",phoneCode:"+886",phoneNumber:"",tags:[],email:"",lineId:"",merchantNote:"",extraInfos:{extraInfoPhone:[g],extraInfoEmergency:[S]}}},x={components:{BaseButtonDialog:b["default"],CountryCodePicker:function(){return Object(u["a"])(i.e("chunk-66428ff2").then(i.bind(null,"e05d")))},InvoiceForm:function(){return Object(u["a"])(i.e("chunk-2d0ab0e8").then(i.bind(null,"143b")))}},filters:{orderStatusFilter:m["o"],orderSourceFilter:m["m"],formatDate:p["a"],bookingStatusFilter:m["a"],paymentStatusMapFilter:m["q"],genderFilter:m["h"]},data:function(){return{submitDataMember:D(),memberInfo:{},activeSearchType:"short",activeMemberData:"information",searchData:{phoneCode:"+886",phoneNumber:""},filterData:{search:""},searchNone:!1,isNewMember:!1,memberEditMode:"edit",memberOrderType:"order",addressMode:"billing",taiwanCitys:m["A"]}},computed:{searchRules:function(){var t=this,e="+886"===this.searchData.phoneCode;return{phoneNumber:[{pattern:e?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"},{validator:function(e,i,a){if(!i)return a();t.tryToSearchMember()},trigger:"custom"}]}},memberRules:function(){var t="+886"===this.submitDataMember.phoneCode;return{fullName:[{required:!0,message:"請輸入姓名"}],phone:[{required:!0,message:"請填寫手機號碼",trigger:"blur"},{pattern:t?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"}],gender:[{required:!0,message:"請選擇性別"}],email:[{type:"email",message:"請輸入正確的 Email 格式"}]}},addressRules:function(){return{"shippingInfo.0.phone":[{pattern:/[\s\#0-9_\-\+\/\(\)\.]/,message:"請輸入正確的 電話 格式",trigger:"blur"}],"billingInfo.phone":[{pattern:/[\s\#0-9_\-\+\/\(\)\.]/,message:"請輸入正確的 電話 格式",trigger:"blur"}]}},districts:function(){var t=[];return"shipping"===this.addressMode&&(t=this.submitDataMember["".concat(this.addressMode,"Info")][0].city),"billing"===this.addressMode&&(t=this.submitDataMember["".concat(this.addressMode,"Info")].city),Object(m["f"])(t)},storeInvoiceSetting:function(){return!!this.submitDataMember.storeInvoiceSetting&&this.submitDataMember.storeInvoiceSetting}},watch:{memberInfo:"updateUserByMember",userSameAsMember:"updateUserByMember"},created:function(){this.tryToFetchTagList()},methods:{memberPets:function(t){if("查無會員，立刻新增會員"!==t.value){var e=t.pets.map(function(t){return t.name});return e.join("，")}return""},updateUserByMember:function(){var t=this,e=["memberId","fullName","gender","phoneCode","phoneNumber","email"];e.forEach(function(e){t.submitData[e]="memberId"===e?t.memberInfo.id:t.memberInfo[e]})},tryToSearchMember:function(){var t=Object(l["a"])(o.a.mark(function t(){var e=this;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:this.tryingGetMember=!0,this.$store.dispatch("member/findByPhone",this.searchData).then(function(t){e.memberInfo=t,e.editDetailEnabled=!1,e.setSubmitDataMember(),e.tryToFetchPetList(),e.isNewMember=!1,e.tryingGetMember=!1,e.mamberSearchShow=!1}).catch(function(){e.creatMember(),e.submitDataMember.phone=e.searchData.phoneNumber,e.isNewMember=!0,e.tryingGetMember=!1});case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),searchQuery:function(){var t=Object(l["a"])(o.a.mark(function t(e,i){var a,r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!(e&&e.length>=2)){t.next=8;break}return t.next=3,this.$store.dispatch("member/fetchListShort",{search:e});case 3:a=t.sent,r=a.items,r.length>0?(r=r.map(function(t){return Object(d["a"])({},t,{value:t.phoneNumber})}),this.searchNone=!1,i(r)):(this.searchNone=!0,i([{value:"查無會員，立刻新增會員"}])),t.next=9;break;case 8:i([]);case 9:case"end":return t.stop()}},t,this)}));return function(e,i){return t.apply(this,arguments)}}(),tryToFetchDetail:function(){var t=Object(l["a"])(o.a.mark(function t(e){var i;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i={},this.tryingGetMember=!0,t.next=4,this.$store.dispatch("member/fetchSingle",e);case 4:i=t.sent,this.memberInfo=i,this.setSubmitDataMember(),this.mamberSearchShow=!1,this.tryingGetMember=!1,this.tryToFetchPetList(),this.isEditMode||this.scrollToBottom();case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),setSubmitDataMember:function(){this.submitDataMember=Object(f["cloneDeep"])(this.memberInfo),this.submitDataMember.extraInfos||(this.submitDataMember=Object(d["a"])({},this.submitDataMember,{extraInfos:{extraInfoPhone:[g],extraInfoEmergency:[S]}})),this.submitDataMember.merchantNote=this.submitDataMember.merchantNote?this.submitDataMember.merchantNote.replace(/<br\s\/>/g,""):"",this.submitDataMember.phone=this.submitDataMember.phoneNumber},searchQueryByBtn:function(){this.filterData.search&&"查無會員，立刻新增會員"!==this.filterData.search&&(this.$refs.autocomplete.$refs.suggestions.showPopper=!0)},selectMember:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.tryingGetMember=!0,t.prev=1,!e.value||"查無會員，立刻新增會員"===e.value){t.next=7;break}return t.next=5,this.tryToFetchDetail(e.id);case 5:this.mamberSearchShow=!1,this.editDetailEnabled=!1;case 7:"查無會員，立刻新增會員"===e.value&&(this.filterData.search="",this.creatMember()),t.next=12;break;case 10:t.prev=10,t.t0=t["catch"](1);case 12:return t.prev=12,this.tryingGetMember=!1,t.finish(12);case 15:case"end":return t.stop()}},t,this,[[1,10,12,15]])}));return function(e){return t.apply(this,arguments)}}(),creatMember:function(){this.editDetailEnabled=!0,this.memberEditMode="new",this.submitDataMember=D()},goToDetail:function(){this.closeAllInfo(),this.memberInfoShow=!0},clearMemberInfo:function(){this.mamberSearchShow=!0,this.memberInfo={},this.memberInfoShow=!1,this.editDetailEnabled=!1,this.filterData.search="",this.resetMember()},enableEditDetail:function(){this.editDetailEnabled=!0,this.memberEditMode="edit"},tryToSaveDetail:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a,r,n,l,c;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.$refs.memberForm){t.next=3;break}return t.next=3,this.$refs.memberForm.validate();case 3:if(this.tryingSaveMember=!0,e=this.submitDataMember,i=e.tags,a=Object(s["a"])(e,["tags"]),r=i.map(function(t){return t.id}),n=Object(d["a"])({},a,{tagIds:r}),"edit"!==this.memberEditMode){t.next=14;break}return n.id=this.submitDataMember.id,t.next=11,this.$store.dispatch("member/store",n);case 11:this.tryToFetchDetail(this.memberInfo.id),t.next=19;break;case 14:return t.next=16,this.$store.dispatch("member/store",n);case 16:l=t.sent,c=l.items,this.tryToFetchDetail(c.id);case 19:this.editDetailEnabled=!1,this.tryingSaveMember=!1,this.editInvoiceEnabled=!1;case 22:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),closeEditDetail:function(){this.editDetailEnabled=!1,this.setSubmitDataMember()},closeMemberInfo:function(){this.memberInfoShow=!1},onSelectMemberOrderType:function(t){this.memberOrderType=t},validPhoneNumber:function(t){this.$refs.searchFormByPhone.validateField("phoneNumber")},enableEditAddress:function(t){this.addressMode=t,this.visibleDialogAddress=!0},onSelectCity:function(){"billing"===this.addressMode&&(this.submitDataMember["".concat(this.addressMode,"Info")]=Object(d["a"])({},this.submitDataMember["".concat(this.addressMode,"Info")],{district:"",postcode:""})),"shipping"===this.addressMode&&(this.submitDataMember["".concat(this.addressMode,"Info")][0].district="",this.submitDataMember["".concat(this.addressMode,"Info")][0].postcode="")},onSelectDistrict:function(){if("shipping"===this.addressMode){var t=this.submitDataMember["".concat(this.addressMode,"Info")][0],e=t.city,i=t.district;this.submitDataMember["".concat(this.addressMode,"Info")][0].postcode=Object(m["g"])(e,i)}if("billing"===this.addressMode){var a=this.submitDataMember["".concat(this.addressMode,"Info")],r=a.city,s=a.district;this.submitDataMember["".concat(this.addressMode,"Info")].postcode=Object(m["g"])(r,s)}},onSaveAddress:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$refs.addressForm.validate();case 3:return this.tryingSaveAddress=!0,t.next=6,this.tryToSaveDetail();case 6:this.visibleDialogAddress=!1,t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](0),console.log(444);case 12:return t.prev=12,this.tryingSaveAddress=!1,t.finish(12);case 15:case"end":return t.stop()}},t,this,[[0,9,12,15]])}));return function(){return t.apply(this,arguments)}}(),handleCloseAddress:function(){this.submitDataMember=Object(f["cloneDeep"])(this.memberInfo),this.getDefaultAddress(),this.visibleDialogAddress=!1},getDefaultAddress:function(){this.$hasHomeService()&&(this.submitDataMember.billingInfo||(this.submitDataMember.billingInfo=C()),this.submitDataMember.shippingInfo||(this.submitDataMember.shippingInfo=[C()]))},enableEditInvoice:function(){this.editInvoiceEnabled=!0},cancelEditInvoice:function(){var t=this.memberInfo,e=t.taxType,i=t.taxId,a=t.CarrierType,r=t.CarrierNum,s=t.LoveCode;this.submitDataMember=Object(d["a"])({},this.submitDataMember,{taxType:e,taxId:i,CarrierType:a,CarrierNum:r,LoveCode:s}),this.editInvoiceEnabled=!1}}},I=function(){return{type:"cosmetic",title:"",priceId:"",price:0,qty:1}},P={components:{},filters:{},data:function(){return{currentServiceCont:"",currentPrepaid:{},currentBuyPrepaid:{},currentService:null,isBuyPrepaid:!1,prepaidList:[]}},computed:{filteredServices:function(){var t=this;if(this.petSizeId){var e=[];return this.products.forEach(function(t){var i=t.prices.map(function(e){return Object(d["a"])({},e,{storeTitle:t.title,productId:t.id})});e=Object(c["a"])(e).concat(Object(c["a"])(i))}),e=e.filter(function(e){return e.sizeId===t.petSizeId}),e}return[]},filteredAvailablePrepaidList:function(){var t=this,e=[];return this.memberInfo.availablePrepaidOrders&&(e=this.memberInfo.availablePrepaidOrders.filter(function(e){return t.products.some(function(i){return e.prices.some(function(a){var r=i.prices.map(function(t){return t.id}),s=i.prices.map(function(t){return t.sizeId}),n=e.sizeIds.includes(t.petSizeId),o=s.includes(t.petSizeId),l=n&&o;return r.includes(a.id)&&l})})})),e},prepaidListAfterService:function(){var t=this.submitData.params[0].priceId;return this.filteredAvailablePrepaidList.filter(function(e){return e.prices.some(function(e){return t===e.id})})},filteredServicesByPrepaid:function(){var t=this,e=[];return this.currentPrepaid.prices.forEach(function(i,a){return t.filteredServices.some(function(t){return t.id===i.id&&(i=Object(d["a"])({},i,{title:i.name,productId:t.productId,price:t.price,serviceTime:t.serviceTime}),e.push(i),!0)})}),e},filterPrepaidList:function(){var t=[],e=this.filteredServices.map(function(t){return t.id});return t=this.prepaidList.filter(function(t){return t.prices.some(function(t){return e.includes(t.id)})}),t},filteredServicesByBuyingPrepaid:function(){var t=this,e=[];return this.currentBuyPrepaid.prices.forEach(function(i,a){return t.filteredServices.some(function(t){return t.id===i.id&&(i=Object(d["a"])({},i,{productId:t.productId,price:t.price,serviceTime:t.serviceTime}),e.push(i),!0)})}),e}},watch:{},created:function(){},methods:{resetService:function(){this.submitData.prepaidOrderUuid="",this.submitDataPrepaid.prepaidId="",this.submitData.params=[I()],this.currentService=null,this.currentServiceCont=""},onSelectOrderType:function(t){this.ordertype=t,this.closeAllInfo(),"order"===t&&(this.serviceShow=!0,this.prepaidShow=!1,this.isBuyPrepaid=!1,this.resetService()),"prepaid-order"===t&&(this.serviceShow=!1,this.prepaidShow=!0,this.resetService())},reSelectOrder:function(){"order"===this.ordertype&&(this.serviceShow=!0,this.prepaidShow=!1),"prepaid-order"===this.ordertype&&(this.serviceShow=!1,this.prepaidShow=!0,this.isBuyPrepaid&&(this.prepaidAllShow=!0))},closeService:function(){this.serviceShow=!1,this.ordertype=""},setPrice:function(t){return{type:"cosmetic",title:t.title,priceId:t.id,price:t.price,qty:1}},selectService:function(t){this.submitData.params=[this.setPrice(t)],this.addList=[],this.totalEditList=[],this.currentService=t,this.currentServiceCont="服務項目：".concat(t.title," | ").concat(t.sizeTitle),this.submitData.prepaidOrderUuid="",this.submitDataPrepaid.prepaidId="",this.serviceShow=!1,this.isPrepaidAndEdit=!1,this.scrollToBottom()},selectPrepaidService:function(){this.submitData.params=[this.setPrice(this.currentService)],this.addList=[],this.totalEditList=[],this.currentServiceCont="包月方案：".concat(this.currentPrepaid.prepaidTitle,"  |  服務項目：").concat(this.currentService.title),this.prepaidAllShow=!1,this.prepaidShow=!1,this.paymentWay="Prepaid",this.submitData.paymentMethod="Prepaid",this.isPrepaidAndEdit=!1,this.scrollToBottom()},selectBuyingPrepaidService:function(){this.submitData.params=[this.setPrice(this.currentService)],this.addList=[],this.totalEditList=[],this.currentServiceCont="包月方案：".concat(this.currentBuyPrepaid.title,"  |  服務項目：").concat(this.currentService.title),this.prepaidAllShow=!1,this.prepaidShow=!1,this.isPrepaidAndEdit=!1,this.scrollToBottom()},goToPrepaid:function(t){this.isBuyPrepaid=!1,this.submitData.prepaidOrderUuid=t.id,this.currentPrepaid=Object(d["a"])({},t),this.prepaidAllShow=!0,this.currentBuyPrepaid={},this.submitData.params=[I()],this.submitDataPrepaid.prepaidId="",this.currentService=null,this.currentServiceCont=""},selectBuyingPrepaid:function(t){this.submitDataPrepaid.prepaidId=t.id,this.currentBuyPrepaid=t,this.currentService=null},closePrepaidAll:function(){this.prepaidAllShow=!1},closePrepaid:function(){this.prepaidShow=!1,this.ordertype=""},goToBuyPrepaid:function(){0!==this.filteredServices.length?(this.isBuyPrepaid=!0,this.submitData.prepaidOrderUuid="",this.prepaidAllShow=!0,this.currentPrepaid={},this.submitData.params=[I()],this.currentService=null,this.currentServiceCont="",this.filterPrepaidList.length>0&&this.selectBuyingPrepaid(this.filterPrepaidList[0]),this.clearPayment()):this.$confirm("目前選擇的寵物與不在服務人員的排班範圍之內","提醒",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0})},clearPayment:function(){this.paymentWay="offline",this.submitData.paymentMethod="Cash"},tryToFetchPrepaid:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("prepaid/fetchListAll",{bookingDateTime:"".concat(Object(p["a"])(this.scheduleDetail.date,"date-dash")," ").concat(Object(p["a"])(this.scheduleDetail.date,"time")),sizeId:this.petSizeId,paginate:0});case 2:e=t.sent,i=e.items,this.prepaidList=i;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},k=i("3c98"),w={components:{},filters:{},data:function(){return{assignList:[],signDialogKey:0,editAssistantEnabled:!1,tryingAssign:!1,commentList:[],petCommentDialogVisible:!1,checkDialogVisible:!1,changeDialogVisible:!1,noShowDialogVisible:!1,signDialogVisible:!1,noteEditShow:!1,editPaymentMethodShow:!1,orderHistoryShow:!1,orderRefundShow:!1,tryingNoShow:!1,tryingCheckIn:!1,isChildren:!1,payMethods:{Cash:"到店付款(現金)",StoreCredit:"現場刷卡",Atm:"線下匯款"},check:{helperId:""},addOrderIndex:"main",adds:[],deleteIds:[],deleteCoupon:{},mapStatusName:{PAID:"訂單資訊",UNPAID:"付款"},shareLink:"",shareDialogVisible:!1,tryingSendSMS:!1,writeDialogVisible:!1,tryingSendEmail:!1,refundSubmitData:{refundDate:"",amount:"",note:""},isRefund:!1,tryingRefund:!1}},computed:{canPartialRefund:function(){return this.currentOrder.canPartialRefund},storeCashflowSetting:function(){return this.defaultValue.storeCashflowSetting},editOrderDate:function(){return Object(p["a"])("".concat(this.defaultValue.date," ").concat(this.defaultValue.time),"dateTime")},isEmptyByOrderExtrafields:function(){return this.defaultValue.byOrderExtrafields instanceof Array},editParams:function(){return this.submitData.params.map(function(t){return Object(d["a"])({},t,{price:t.total})})},childrenOrders:function(){return this.defaultValue.childrenOrders.length>0?this.defaultValue.childrenOrders:[]},childrenOrdersHaveInvoice:function(){return this.childrenOrders.filter(function(t){return t.invoice.InvoiceNumber})},helpSubmitRules:function(){return{helperId:[{required:!0,message:"請選擇助理",trigger:"change"}]}},currentHistory:function(){return this.currentOrder.history},editTotalEditList:function(){var t=["+","-","%"];return this.defaultValue.params.filter(function(e){return t.includes(e.type)})},editAddList:function(){return this.defaultValue.params.filter(function(t){return"cosmetic-add"===t.type})},prepaidItem:function(){return this.defaultValue.params.find(function(t){return"prepaid"===t.type})},couponItem:function(){return this.defaultValue.params.find(function(t){return"coupon"===t.type})},editServiceTotal:function(){var t=0;return t=this.prepaidItem?0:this.couponItem?this.defaultValue.params[0].total+this.couponItem.total:this.defaultValue.params[0].total,t},childrenOrderTotal:function(){var t=this,e=0,i=0;return this.isChildren&&(this.addList.forEach(function(t,a){e+=parseInt(t.price),i+=parseInt(t.price)}),this.totalEditList.forEach(function(a,r){if("+"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"-"===a.type&&(e-=parseInt(a.price)),"%"===a.type){var s=Math.round(e*(a.price/100));t.totalEditList[r].discount=s,e-=s}}),this.moreItems.forEach(function(a,r){if("+"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"-"===a.type&&(e-=parseInt(a.price)),"%"===a.type){var s=Math.round(e*(a.price/100));t.moreItems[r].discount=s,e-=s}else e+=parseInt(a.price),i+=parseInt(a.price)}),this.basePrice=i),e},isMainOrder:function(){return"main"===this.addOrderIndex},linkTitle:function(){var t=this.defaultValue.childrenOrders;if(t.length){var e=!1;return e=t.some(function(t){return"UNPAID"===t.paymentStatus}),this.mapStatusName[e?"UNPAID":"PAID"]}return this.mapStatusName[this.defaultValue.paymentStatus]},refundRules:function(){return{refundDate:[{required:!0,message:"請選擇日期"}],amount:[{required:!0,message:"請輸入退款金額"}]}},unPaidAddOrder:function(){return this.childrenOrders.find(function(t){return"UNPAID"===t.paymentStatus&&0!==t.status})}},watch:{},created:function(){this.getEditOrderDefault(),this.getCoupon()},methods:{getCoupon:function(){this.isEditMode&&this.submitData.coupon&&(this.couponInfo=this.submitData.coupon,this.submitData=Object(d["a"])({},this.submitData,{couponCode:this.submitData.coupon.code}))},getEditOrderDefault:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.isEditMode){t.next=6;break}return this.mamberSearchShow=!1,this.tryToFetchHelperList(),t.next=5,this.tryToFetchDetail(this.defaultValue.memberId);case 5:this.tryToFetchCommentListAll();case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),openCommentEdit:function(){this.$refs.comment.openEdit()},tryToFetchCommentListAll:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.$store.dispatch("petComment/fetchList",{petId:this.defaultValue.pet.id,paginate:0});case 3:this.commentList=t.sent,t.next=8;break;case 6:t.prev=6,t.t0=t["catch"](0);case 8:case"end":return t.stop()}},t,this,[[0,6]])}));return function(){return t.apply(this,arguments)}}(),emitCommentFetch:function(){this.tryToFetchCommentListAll()},openCommentList:function(){var t=this;this.petCommentDialogVisible=!0,this.$nextTick(function(){t.$refs.commentAll.tryToFetchList()})},tryToFetchHelperList:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a=this;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingAssign=!0,t.next=3,this.$store.dispatch("order/fetchHelperList",this.defaultValue.id);case 3:e=t.sent,i=e.items,this.assignList=i,this.assignList.forEach(function(t,e){t.id===a.defaultValue.scheduleItem.id&&a.assignList.splice(e,1)}),this.tryingAssign=!1;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToStoreAssignHelper:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingAssign=!0,t.next=3,this.$store.dispatch("order/storeAssignHelper",{id:this.defaultValue.id,itemId:this.submitData.helper.id});case 3:this.updateOrder(),this.tryingAssign=!1,this.editAssistantEnabled=!1;case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),cancelAssignEdit:function(){this.editAssistantEnabled=!1},openAssignEdit:function(){this.editAssistantEnabled=!0,this.defaultValue.helper?this.submitData.helper=Object(d["a"])({},this.defaultValue.helper):this.submitData.helper={id:"",name:""}},openNoteEdit:function(){this.noteEditShow=!0,this.editPaymentMethodShow=!1,this.orderHistoryShow=!1,this.orderRefundShow=!1},closeNoteEdit:function(){this.noteEditShow=!1},convertExtraFieldToStoreDataFromEditMode:function(t){var e=Object(f["cloneDeep"])(t),i=Object(f["cloneDeep"])(this.$refs.extrafieldEdit.defaultValue);return e.byOrderExtrafields=this.getExtraFieldsArray(i.byOrderExtrafields),e.bySizeExtrafields=this.getBySizeExtraFieldsArray(i.customerInfos),delete e.customerInfos,e},getBySizeExtraFieldsArray:function(t){var e=this;return t.map(function(t){return{customerInfoId:t.customerInfoId,orderExtrafields:e.getExtraFieldsArray(t.bySizeExtrafields)}})},getExtraFieldsArray:function(t){var e=this,i=[];return Object.keys(t).forEach(function(a){if(e.isEdited(t[a])){var r=t[a],s=r.id,n=r.value;i.push({id:s,value:n})}}),i},isEdited:function(t){return!0===t.edited},tryToStorePayment:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.$refs.bankType){t.next=3;break}return t.next=3,this.$refs.bankType.validate();case 3:this.tryToSaveOrder();case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToSaveOrder:function(){var t=Object(l["a"])(o.a.mark(function t(e){var i,a,r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i=this.currentOrder,i.params,a=Object(s["a"])(i,["params"]),r={},r="extraField"===e?Object(d["a"])({},this.convertExtraFieldToStoreDataFromEditMode(Object(d["a"])({},a)),{merchantNote:""}):Object(d["a"])({},a,{merchantNote:""}),this.tryingStore=!0,t.prev=4,t.next=7,this.$store.dispatch("order/store",r);case 7:return this.handleSaveSuccess(),t.next=10,this.updateOrder();case 10:this.noteEditShow=!1,this.editPaymentMethodShow=!1,this.addressShow=!1,t.next=18;break;case 15:t.prev=15,t.t0=t["catch"](4),this.$message({type:"error",message:"Server Error"});case 18:return t.prev=18,this.tryingStore=!1,t.finish(18);case 21:case"end":return t.stop()}},t,this,[[4,15,18,21]])}));return function(e){return t.apply(this,arguments)}}(),handleSaveSuccess:function(){this.$message({message:"編輯成功！",type:"success"})},updateOrder:function(){var t=Object(l["a"])(o.a.mark(function t(){var e;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("order/fetchSingle",this.defaultValue.id);case 2:e=t.sent,this.$emit("update:defaultValue",e),this.submitData=Object.assign({},e),this.getCoupon(),this.$emit("update");case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),editOpenTotalEdit:function(t){this.totalAllShow=!0,"main"===t?(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.defaultValue)):(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.childrenOrders[t]));var e=Object(c["a"])(this.currentOrder.params);"main"===t&&(e.splice(0,1),e.forEach(function(t,i){"coupon"===t.type&&e.splice(i,1)}),e.forEach(function(t,i){"prepaid"===t.type&&e.splice(i,1)})),e=e.map(function(t){var e=t.total,i=Object(s["a"])(t,["total"]);return"-"===t.type&&(e=-e),"%"===t.type&&(e=parseInt(t.description)),Object(d["a"])({},i,{price:e})}),this.haveItems=e,this.moreItems=[],this.adds=[],this.deleteIds=[]},editOpenPaymentMethod:function(t){"main"===t?(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.defaultValue),delete this.currentOrder.bankType,this.currentOrder.Vacc&&(this.currentOrder=Object(d["a"])({},this.currentOrder,{bankType:this.currentOrder.Vacc.BankType}))):(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.childrenOrders[t]),delete this.currentOrder.bankType,this.currentOrder.Vacc&&(this.currentOrder=Object(d["a"])({},this.currentOrder,{bankType:this.currentOrder.Vacc.BankType}))),this.editPaymentMethodShow=!0},closeEditPaymentMethod:function(){this.editPaymentMethodShow=!1},editOpenHistory:function(t){"main"===t?(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.defaultValue)):(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.childrenOrders[t])),this.orderHistoryShow=!0},closeHistory:function(){this.orderHistoryShow=!1},tryToCancelOrder:function(t){this.statusDialogVisible=!0,"main"===t?(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.defaultValue)):(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.childrenOrders[t]))},editOpenRefund:function(t){"main"===t?(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.defaultValue)):(this.addOrderIndex=t,this.currentOrder=Object(f["cloneDeep"])(this.childrenOrders[t])),this.refundSubmitData={refundDate:"",amount:"",note:""},this.canPartialRefund||(this.refundSubmitData.amount=this.currentOrder.backBalance),this.orderRefundShow=!0},closeOpenRefund:function(){this.orderRefundShow=!1},openPaidDialog:function(){this.tryToPayOrder(this.submitData.paymentMethod,this.submitData,"main")},openAddPaidDialog:function(){this.tryToPayOrder(this.unPaidAddOrder.paymentMethod,this.unPaidAddOrder,"add")},tryToPayOrder:function(){var t=Object(l["a"])(o.a.mark(function t(e,i,a){var r;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(t.prev=0,"add"!==a){t.next=6;break}return t.next=4,this.$confirm("子訂單：".concat(i.id," 確認付款方式為「 ").concat(this.payMethods[e]," 」？"),"提示",{confirmButtonText:"確定",showCancelButton:!0,type:"warning",center:!0});case 4:t.next=8;break;case 6:return t.next=8,this.$confirm("確認付款方式為「 ".concat(this.payMethods[e]," 」？"),"提示",{confirmButtonText:"確定",showCancelButton:!0,type:"warning",center:!0});case 8:return i.params,r=Object(s["a"])(i,["params"]),t.next=11,this.$store.dispatch("order/store",Object(d["a"])({},r,{paymentMethod:e,paymentStatus:"PAID"}));case 11:this.$message({type:"success",message:"編輯成功！"}),this.updateOrder(),this.paidDialogVisible=!1,t.next=18;break;case 16:t.prev=16,t.t0=t["catch"](0);case 18:return t.prev=18,t.finish(18);case 20:case"end":return t.stop()}},t,this,[[0,16,18,20]])}));return function(e,i,a){return t.apply(this,arguments)}}(),changeCheckDialog:function(){this.changeDialogVisible=!0},openCheckDialog:function(){this.checkDialogVisible=!0,this.check.helperId=this.defaultValue.helper?this.defaultValue.helper.id:""},onClickNoShow:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.form.validate();case 2:return t.next=4,this.$confirm("確定將此訂單改為「未報到」？","警告",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning",center:!0});case 4:return this.tryingNoShow=!0,e=this.defaultValue,e.params,i=Object(s["a"])(e,["params"]),a=Object(d["a"])({},i,{status:5,merchantNote:this.submitData.note}),t.next=9,this.$store.dispatch("order/store",a);case 9:this.updateOrder(),this.submitData.note="",this.noShowDialogVisible=!1,this.changeDialogVisible=!1,this.tryingNoShow=!1;case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToStoreAssignAndCheckIn:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingCheckIn=!0,t.next=3,this.$store.dispatch("order/storeAssignHelper",{id:this.defaultValue.id,itemId:this.check.helperId});case 3:this.tryToCheckIn();case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToCheckIn:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.beauticianForm.validate();case 2:return this.checkDialogVisible=!1,t.prev=3,this.tryingCheckIn=!0,t.next=7,this.$store.dispatch("order/verifySingleCode",{codeId:this.defaultValue.params[0].codes[0].id,orderId:this.defaultValue.id});case 7:this.$message({type:"success",message:"報到成功！"}),this.changeDialogVisible=!1,this.updateOrder(),t.next=14;break;case 12:t.prev=12,t.t0=t["catch"](3);case 14:return t.prev=14,this.tryingCheckIn=!1,t.finish(14);case 17:case"end":return t.stop()}},t,this,[[3,12,14,17]])}));return function(){return t.apply(this,arguments)}}(),showSignDialog:function(){this.signDialogKey++,this.signDialogVisible=!0},editOrderItem:function(){var t=Object(l["a"])(o.a.mark(function t(){var e;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.adds=Object(c["a"])(this.moreItems),this.isMainOrder&&this.deleteCoupon.price&&(this.deleteIds=[this.deleteCoupon.id].concat(Object(c["a"])(this.deleteIds))),e={orderId:this.currentOrder.id,deleteIds:this.deleteIds,adds:this.adds,total:this.submitPriceTotal},this.isMainOrder&&this.deleteCoupon.price&&this.submitData.couponCode&&(e.couponCode=this.submitData.couponCode),t.next=6,this.$store.dispatch("order/storeOrderItem",e);case 6:this.$message({type:"success",message:"編輯成功！"}),this.adds=[],this.deleteIds=[],this.haveItems=[],this.moreItems=[],this.updateOrder(),this.totalAllShow=!1,this.addShow=!1;case 14:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),addMore:function(t){this.moreItems=Object(c["a"])(this.moreItems).concat(Object(c["a"])(t))},openAddOrder:function(){var t="UNPAID"===this.defaultValue.paymentStatus,e=this.childrenOrders.some(function(t){return"UNPAID"===t.paymentStatus&&0!==t.status});t||e?this.$confirm("未付款前，加購請於原來的訂單中選擇『編輯價格與折扣』","提醒",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0}):(this.totalAllShow=!0,this.addShow=!0,this.isChildren=!0,this.moreItems=[])},closeChildren:function(){this.totalAllShow=!1,this.addShow=!1,this.isChildren=!1},closeNotificationDialog:function(){this.writeDialogVisible=!1},tryToGetShareLink:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("order/getLink",this.defaultValue.id);case 2:this.shareLink=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),handleShareLink:function(t){var e={facebook:"https://www.facebook.com/sharer/sharer.php?u=".concat(this.shareLink),line:"https://social-plugins.line.me/lineit/share?url=".concat(this.shareLink)};window.open(e[t],"_blank")},tryToSendSMS:function(){var t=Object(l["a"])(o.a.mark(function t(){var e=this;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingSendSMS=!0,t.prev=1,t.next=4,this.$store.dispatch("order/sendLink",{orderId:this.defaultValue.id,router:"sms"});case 4:this.$alert("已發送".concat(this.linkTitle,"連結簡訊至使用人電話"),"簡訊發送成功！",{confirmButtonText:"確認",center:!0,callback:function(){e.tryingSendSMS=!1}}),t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](1),this.tryingSendSMS=!1;case 10:case"end":return t.stop()}},t,this,[[1,7]])}));return function(){return t.apply(this,arguments)}}(),copyShareLink:function(){var t=Object(l["a"])(o.a.mark(function t(){var e;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=document.createElement("INPUT"),document.body.appendChild(e),e.setAttribute("value",this.shareLink),e.select(),document.execCommand("copy"),document.body.removeChild(e),t.next=9,k["a"].write({string:this.shareLink});case 9:this.$message("連結複製成功");case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),showShareDialog:function(){this.shareDialogVisible=!0},tryToRefund:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.refundForm.validate();case 2:if(!(this.refundSubmitData.amount>this.currentOrder.backBalance)){t.next=5;break}return this.$confirm("退款金額不能超過可退款金額","提示",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0}),t.abrupt("return");case 5:return t.prev=5,this.tryingRefund=!0,t.next=9,this.$store.dispatch("order/refundOrder",{id:e,refundData:this.refundSubmitData});case 9:this.$confirm("退款已完成","提示",{confirmButtonText:"關閉",showCancelButton:!1,type:"warning",center:!0}),this.updateOrder(),this.orderRefundShow=!1,t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](5),console.log("TCL: tryToCreateOrder -> error",t.t0);case 17:return t.prev=17,this.tryingRefund=!1,this.isRefund=!0,t.finish(17);case 21:case"end":return t.stop()}},t,this,[[5,14,17,21]])}));return function(e){return t.apply(this,arguments)}}(),goToPrepaidOrder:function(t){this.$router.push({name:"orders",query:{type:"prepaidOrder",id:t}})}}},O=function(){return{type:"cosmetic",title:"",priceId:"",price:0,qty:1}},M=function(){return{params:[O()],fullName:"",gender:"male",phoneCode:"+886",phoneNumber:"",phone:"",email:"",note:"",status:2,paymentStatus:"UNPAID",basePrice:"",total:"",allowExpired:0,couponCode:"",memberId:"",prepaidOrderUuid:"",byOrderExtrafields:{},customerInfos:[],paymentMethod:"",productId:"",bankType:"",address:"",petId:"",city:"",district:"",errorHandle:!1,type:"cosmetic",storeCredit:"",credit:""}},T={components:{BaseButtonDialog:b["default"],BaseCollapse:function(){return Object(u["a"])(i.e("chunk-f797d1f4").then(i.bind(null,"da06")))},BaseStateLabel:function(){return Object(u["a"])(i.e("chunk-12bed50d").then(i.bind(null,"38d1")))},OrderExtraField:function(){return Object(u["a"])(i.e("chunk-76d781a7").then(i.bind(null,"dc89")))},OrderChangeStatusDialog:function(){return Object(u["a"])(i.e("chunk-2d0e6716").then(i.bind(null,"9988")))},SignatureDialog:function(){return Object(u["a"])(i.e("chunk-dc85eaa2").then(i.bind(null,"8d15")))},MemberOrdersProduct:function(){return Object(u["a"])(i.e("chunk-74a0d6eb").then(i.bind(null,"760c3")))},MemberOrdersPrepaid:function(){return Object(u["a"])(i.e("chunk-2d0bd806").then(i.bind(null,"2bee")))},TotalTable:function(){return Object(u["a"])(i.e("chunk-6acd3794").then(i.bind(null,"2deb")))},TotalEdit:function(){return Object(u["a"])(i.e("chunk-d930124e").then(i.bind(null,"dfcb")))},AdditionForm:function(){return Object(u["a"])(i.e("chunk-6251a3f3").then(i.bind(null,"a1e7")))},PetCommentList:function(){return Object(u["a"])(i.e("chunk-838dbece").then(i.bind(null,"7d95")))},NotificationWrite:function(){return Object(u["a"])(i.e("chunk-6e54ddcf").then(i.bind(null,"0ca1")))}},filters:{orderStatusFilter:m["o"],orderPaymentMethodFilter:m["k"],orderSourceFilter:m["m"],formatDate:p["a"],bookingStatusFilter:m["a"],paymentStatusMapFilter:m["q"],genderFilter:m["h"]},mixins:[_,x,P,w],props:{defaultValue:{type:Object,default:function(){return M()}},products:{type:Array,default:function(){return[]}},scheduleDetail:{type:Object,default:function(){}},schedules:{type:Array,default:function(){return[]}},memberItem:{type:Object,default:function(){}}},data:function(){return{type:"order",orderPaymentMethodMap:m["l"],taxTypeMap:m["B"],carrierTypeMap:m["c"],headerHeight:0,submitData:Object.assign({},this.defaultValue),childrenSubmitData:Object.assign({},this.defaultValue),currentOrder:Object.assign({},this.defaultValue),submitDataPrepaid:{prepaidId:"",status:2,paymentMethod:"Cash",bankType:"",taxType:"B2C",CarrierType:"",CarrierNum:"",taxId:"",LoveCode:"",invoiceSync:!0},couponInfo:{},previousCouponCode:"",prepaidAllShow:!1,priceAllShow:!1,totalAllShow:!1,mamberSearchShow:!0,memberInfoShow:!1,petShow:!1,editDetailEnabled:!1,visibleDialogAddress:!1,editInvoiceEnabled:!1,serviceShow:!1,prepaidShow:!1,addShow:!1,addressShow:!1,paymentDialogVisible:!1,extraDialogVisible:!1,tryingStore:!1,tryingUpdateTag:!1,tryingGetMember:!1,tryingSaveMember:!1,tryingSaveAddress:!1,isEditMember:!1,ordertype:"",paymentWay:"offline",paymentStep:1,bankTypeList:[{id:"BOT",title:"台灣銀行"},{id:"Taishin",title:"台新"},{id:"HNCB",title:"華南"}],productHasExtraField:!0,userSameAsMember:!0,statusDialogVisible:!1,MaxQty:1,isPrepaidAndEdit:!1,serviceParam:[{}],addList:[],totalEditList:[],totalPlusList:[],totalDicountList:[],haveItems:[],moreItems:[],basePrice:0,enableSaveAddress:!1,editFilterCities:[],catchPrepaidOrderUuid:""}},computed:{isHomeService:function(){var t=this;return this.isEditMode?"home"===this.defaultValue.storeType:this.products.some(function(e){return e.id===t.submitData.productId&&"home"===e.storeType})},filterCities:function(){var t=this;if(!this.isEditMode){if(!this.submitData.productId)return[];var e=this.products.find(function(e){return e.id===t.submitData.productId}).addressRestrictions;return e}},districts:function(){var t=this;if(!this.submitData.city)return[];var e=[];e=this.isEditMode?this.editFilterCities:this.filterCities;var i=e.find(function(e){return t.submitData.city===e.city});return i?i.district:[]},isPaid:function(){return"PAID"===this.defaultValue.paymentStatus},multipleStore:function(){return this.products.length>1},petSizeId:function(){var t=this;return this.submitData.petId?this.petList.find(function(e){return t.submitData.petId===e.id}).sizeId:0},submitRules:function(){var t=this,e="+886"===this.submitData.phoneCode,i="";return{phoneNumber:[{required:!0,message:"請填寫手機號碼",trigger:"blur"},{pattern:e?/^09\d{8}$/:"",message:"格式請符合 09XXXXXXXX",trigger:"blur"}],email:[{required:!0,message:"請輸入 Email"},{type:"email",message:"請輸入正確的 Email 格式"}],fullName:[{required:!0,message:"請輸入使用人姓名"}],gender:[{required:!0,message:"請選擇性別"}],productId:[{required:!0,message:"請選擇服務地點"}],productId2:[{required:!0,message:"請選擇服務地點"}],params:[{required:!0,message:"請選擇服務項目"}],bankType:[{required:!0,message:"請選擇轉帳銀行"}],petId:[{required:!0,message:"請選擇寵物"}],city:[{required:this.isHomeService,message:"請選擇縣市"}],district:[{required:this.isHomeService,message:"請選擇區域"}],address:[{required:this.isHomeService,message:"請輸入服務地址",trigger:"blur"}],prepaidOrderUuid:[{required:this.isRequiredPrePaid,message:"請選擇包月方案",trigger:"change"}],couponCode:[{validator:function(e,a,r){return clearTimeout(i),""===a?(t.$refs.couponForm.clearValidate("couponCode"),r()):t.previousCouponCode===t.submitData.couponCode?r():void(i=setTimeout(function(){t.previousCouponCode=t.submitData.couponCode,t.$store.dispatch("coupon/validCode",{code:a,basePrice:t.isEditMode?t.submitData.params[0].total:t.submitData.params[0].price,priceId:t.submitData.params[0].priceId,memberId:t.memberInfo.id}).then(function(e){r(),t.applyCoupon(e.items)}).catch(function(e){t.previousCouponCode="",r(new Error(Object(h["b"])(e.status)))})},500))},trigger:"custom"}]}},paymentTitle:function(){return this.isChildren?this.orderPaymentMethodMap[this.childrenSubmitData.paymentMethod]:this.orderPaymentMethodMap[this.submitData.paymentMethod]},statusIsChanged:function(){return this.defaultValue.paymentStatus!==this.submitData.paymentStatus},isEditMode:function(){return!!this.defaultValue.id},hasCouponInfo:function(){return 0!==Object.keys(this.couponInfo).length},paramPriceTotal:function(){var t=this.submitData.params.map?this.submitData.params.map(function(t){return 1*+t.price}):[];return t.length>0?t.reduce(function(t,e){return+t+ +e},0):0},mainService:function(){var t=this.submitData.params.find(function(t){return"cosmetic"===t.type});return t},serviceTotal:function(){return this.isEditMode?this.mainService.total:this.mainService.price},couponPriceTotal:function(){var t=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e-t<0?0:e-t},e=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e-Math.round(e*(t/100))},i=this.serviceTotal,a=this.couponInfo,r=a.discount,s=a.type;return this.couponInfo?"fixed"===s?t(r,i):e(r,i):i},submitPriceTotal:function(){var t=this,e=this.couponPriceTotal;(this.submitData.prepaidOrderUuid||this.submitDataPrepaid.prepaidId)&&(e=0),this.isEditMode&&(e=parseInt(this.editServiceTotal));var i=this.serviceTotal;return this.isChildren||(this.isEditMode?(this.isMainOrder||(i=0,e=0),this.haveItems.forEach(function(a,r){if("cosmetic-add"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"+"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"-"===a.type&&(e-=parseInt(a.price)),"%"===a.type){var s=Math.round(e*(a.price/100));t.haveItems[r].discount=s,e-=s}}),this.moreItems.forEach(function(a,r){if("cosmetic-add"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"+"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"-"===a.type&&(e-=parseInt(a.price)),"%"===a.type){var s=Math.round(e*(a.price/100));t.moreItems[r].discount=s,e-=s}})):(this.addList.forEach(function(t,a){e+=parseInt(t.price),i+=parseInt(t.price)}),this.totalEditList.forEach(function(a,r){if("+"===a.type&&(e+=parseInt(a.price),i+=parseInt(a.price)),"-"===a.type&&(e-=parseInt(a.price)),"%"===a.type){var s=Math.round(e*(a.price/100));t.totalEditList[r].discount=s,e-=s}}))),this.basePrice=i,e}},watch:{paymentDialogVisible:function(t){t||(this.paymentStep=1)},currentService:{handler:function(){var t=this;if(this.currentService&&this.currentService.productId){var e=[];this.products.some(function(i){return i.id===t.currentService.productId&&(e=i.extrafields.byOrder)}),this.submitData.productId=this.currentService.productId,this.submitData.byOrderExtrafields=this.convertToObject(e),this.getDefaultAddress()}},deep:!0},totalEditList:function(t){0===t.length&&0===this.addList.length&&(this.isPrepaidAndEdit=!1,this.submitData.prepaidOrderUuid&&(this.submitData.paymentMethod="Prepaid",this.paymentWay="Prepaid")),this.isChildren?this.childrenSubmitData.params=Object(c["a"])(this.addList).concat(Object(c["a"])(t)):this.isEditMode||(this.submitData.params=[Object(d["a"])({},this.mainService)].concat(Object(c["a"])(this.addList),Object(c["a"])(t)))},addList:function(t){0===t.length&&0===this.totalEditList.length&&(this.isPrepaidAndEdit=!1,this.submitData.prepaidOrderUuid&&(this.submitData.paymentMethod="Prepaid",this.paymentWay="Prepaid")),this.isChildren?this.childrenSubmitData.params=Object(c["a"])(t).concat(Object(c["a"])(this.totalEditList)):this.isEditMode||(this.submitData.params=[Object(d["a"])({},this.mainService)].concat(Object(c["a"])(t),Object(c["a"])(this.totalEditList)))},paymentWay:function(t){this.submitData.paymentMethod="Prepaid"===t?"Prepaid":""}},created:function(){this.isEditMode&&this.tryToGetFilterCities(),delete this.childrenSubmitData.prepaidOrderUuid},mounted:function(){var t=this;this.$nextTick(function(){t.headerHeight=document.querySelector("#orderHeader").offsetHeight+40})},methods:{tryToGetFilterCities:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("product/fetchSingle",this.submitData.productId);case 2:e=t.sent,i=e.addressRestrictions,this.editFilterCities=i;case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToFetchTagList:function(){var t=Object(l["a"])(o.a.mark(function t(e){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("member/fetchTags",{search:e});case 2:this.tagList=t.sent;case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),closeAllInfo:function(){this.memberInfoShow=!1,this.petShow=!1,this.serviceShow=!1,this.prepaidShow=!1},scrollToBottom:function(){var t=this;this.$nextTick(function(){t.$refs.leftCont.scrollTop=1e3})},resetMember:function(){this.submitData.petId="",this.resetService()},handleStoreOrder:function(t){var e=!1;e=this.isChildren?this.childrenOrderTotal<0:this.submitPriceTotal<0,e?this.$confirm("訂單金額不能小於0","提醒",{confirmButtonText:"確定",showCancelButton:!1,type:"warning",center:!0}):("offline"!==this.paymentWay&&"online"!==this.paymentWay||(this.paymentDialogVisible=!0),"Prepaid"===this.paymentWay&&"order"===this.ordertype&&(this.submitData.paymentMethod="Prepaid",this.paymentStep=2,this.paymentDialogVisible=!0),"Prepaid"===this.paymentWay&&"prepaid-order"===this.ordertype&&this.goToExtrafields(!0))},handleStorePrepaidOrder:function(){this.paymentDialogVisible=!0},handleCreateOrder:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.extraForm.validate();case 2:this.submitDataPrepaid.prepaidId?this.tryToCreatePrepaidOrder():this.tryToCreateOrder();case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToCreateOrder:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a,r,s=arguments;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=s.length>0&&void 0!==s[0]?s[0]:"",i=this.productHasExtraField?this.convertExtraFieldToStoreDataFromCreateMode():void 0,a=Object(d["a"])({},this.submitData,{basePrice:this.basePrice,total:this.submitPriceTotal,groupSize:1,merchantNote:e,orderExtrafields:i,startDate:"".concat(Object(p["a"])(this.scheduleDetail.date,"date-dash")," ").concat(Object(p["a"])(this.scheduleDetail.date,"time")),scheduleItemId:this.scheduleDetail.id}),this.tryingStore=!0,t.prev=4,t.next=7,this.tryToSaveAddress();case 7:return t.next=9,this.$store.dispatch("order/store",a);case 9:r="PAID"!==a.paymentStatus&&("UNPAID"===a.paymentStatus&&a.total>0),this.handleCreateSuccess(r),t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](4),"SCHEDULE_ITEM_CALENDAR_TIME_UNAVAILABLE"===t.t0.status&&this.$message({type:"warning",message:"與該訂單時段重疊： ".concat(Object(p["a"])(new Date(t.t0.data.date),"dateTime"))}),"SCHEDULE_ITEM_ADMIN_ITEM_NOT_EXIST"===t.t0.status?this.$message({type:"error",message:"此排班不存在或該排班人員不存在"}):this.$message({type:"error",message:"Server Error"});case 17:return t.prev=17,this.tryingStore=!1,t.finish(17);case 20:case"end":return t.stop()}},t,this,[[4,13,17,20]])}));return function(){return t.apply(this,arguments)}}(),tryToCreateChildrenOrder:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a,r,n,l;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.childrenSubmitData,e.byOrderExtrafields,e.customerInfos,i=e.id,a=e.pet,r=Object(s["a"])(e,["byOrderExtrafields","customerInfos","id","pet"]),n=Object(d["a"])({},r,{type:"cosmetic",parentId:i,basePrice:this.basePrice,total:this.childrenOrderTotal,groupSize:1,scheduleItemId:this.childrenSubmitData.scheduleItem.id,startDate:"".concat(this.childrenSubmitData.date," ").concat(this.childrenSubmitData.time),petId:a.id}),delete n.status,this.tryingStore=!0,t.prev=4,t.next=7,this.$store.dispatch("order/store",n);case 7:l="PAID"!==n.paymentStatus&&("UNPAID"===n.paymentStatus&&n.total>0),this.handleCreateSuccess(l),this.addList=[],this.totalEditList=[],this.paymentDialogVisible=!1,this.totalAllShow=!1,this.addShow=!1,this.updateOrder(),t.next=21;break;case 17:t.prev=17,t.t0=t["catch"](4),"SCHEDULE_ITEM_CALENDAR_TIME_UNAVAILABLE"===t.t0.status&&this.$message({type:"warning",message:"與該訂單時段重疊： ".concat(Object(p["a"])(new Date(t.t0.data.date),"dateTime"))}),"SCHEDULE_ITEM_ADMIN_ITEM_NOT_EXIST"===t.t0.status?this.$message({type:"error",message:"此排班不存在或該排班人員不存在"}):this.$message({type:"error",message:"Server Error"});case 21:return t.prev=21,this.tryingStore=!1,t.finish(21);case 24:case"end":return t.stop()}},t,this,[[4,17,21,24]])}));return function(){return t.apply(this,arguments)}}(),tryToCreatePrepaidOrder:function(){var t=Object(l["a"])(o.a.mark(function t(){var e,i,a,r,s,n=arguments;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:"",i=this.productHasExtraField?this.convertExtraFieldToStoreDataFromCreateMode():void 0,a=Object(d["a"])({},this.submitData,{basePrice:this.basePrice,total:this.submitPriceTotal,groupSize:1,merchantNote:e,orderExtrafields:i,startDate:"".concat(Object(p["a"])(this.scheduleDetail.date,"date-dash")," ").concat(Object(p["a"])(this.scheduleDetail.date,"time")),scheduleItemId:this.scheduleDetail.id}),r=Object(d["a"])({},this.submitDataPrepaid,{email:this.memberInfo.email,fullName:this.memberInfo.fullName,gender:this.memberInfo.gender,memberId:this.memberInfo.id,phoneCode:this.memberInfo.phoneCode,phoneNumber:this.memberInfo.phoneNumber,taxType:this.memberInfo.taxType,merchantNote:e,note:a.note,order:Object(d["a"])({},a)}),this.tryingStore=!0,t.prev=5,t.next=8,this.tryToSaveAddress();case 8:return t.next=10,this.$store.dispatch("prepaid/storeOrder",r);case 10:s=1!==r.status&&2===r.status,0===this.prepaidPrice&&(s=!1),this.handleCreateSuccess(s),t.next=17;break;case 15:t.prev=15,t.t0=t["catch"](5);case 17:return t.prev=17,this.tryingStore=!1,t.finish(17);case 20:case"end":return t.stop()}},t,this,[[5,15,17,20]])}));return function(){return t.apply(this,arguments)}}(),handleCreateSuccess:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.extraDialogVisible=!1,this.$alert("已發送".concat(e?"付款":"訂單","連結至使用人 Email"),"訂單新增成功！",{confirmButtonText:"確認",center:!0,callback:function(){t.emitStore()}})},selectPayment:function(t){this.isChildren?(this.childrenSubmitData.paymentMethod=t,"Credit"===this.childrenSubmitData.paymentMethod?this.goToExtrafields(!1):this.paymentStep=2):(this.isPrepaidAndEdit&&!this.submitData.prepaidOrderUuid&&(this.submitData.prepaidOrderUuid=this.catchPrepaidOrderUuid),this.submitDataPrepaid.prepaidId?(this.submitDataPrepaid.paymentMethod=t,"Credit"===this.submitDataPrepaid.paymentMethod?this.goToExtrafields(!1):this.paymentStep=2):(this.submitData.paymentMethod=t,"Credit"===this.submitData.paymentMethod?this.goToExtrafields(!1):this.paymentStep=2))},goToExtrafields:function(t){this.isChildren?(this.childrenSubmitData.paymentStatus=t?"PAID":"UNPAID",this.tryToCreateChildrenOrder()):(this.submitDataPrepaid.prepaidId?t?(this.submitDataPrepaid.status=1,this.submitData.paymentStatus="PAID"):(this.submitDataPrepaid.status=2,this.submitData.paymentStatus="UNPAID"):this.submitData.paymentStatus=t?"PAID":"UNPAID",this.paymentDialogVisible=!1,this.extraDialogVisible=!0,this.submitData.fullName?this.userSameAsMember=!0:this.userSameAsMember=!1)},emitStore:function(){this.$emit("store")},convertToObject:function(t){if(null!==t){var e={};return t.forEach(function(t){e[t.id]={group:1,id:t.id,Alias:"",value:"",title:t.title}}),e}},convertExtraFieldToStoreDataFromCreateMode:function(){var t=[],e=[],i=this.$refs.extrafield.defaultValue.byOrderExtrafields||{};return t=Object.keys(i).map(function(t){return i[t]}),Object(c["a"])(t).concat(e)},openTotalEdit:function(){this.totalAllShow=!0,this.addShow=!1},openAddEdit:function(){this.totalAllShow=!0,this.addShow=!0},closeAdd:function(){this.addShow=!1},closeTotalAll:function(){this.cancelToTalEdit()},saveTotalEdit:function(){this.totalAllShow=!1},cancelToTalEdit:function(){this.totalAllShow=!1},applyCoupon:function(t){this.couponInfo=t},validCoupon:function(){this.$refs.couponForm.validateField("couponCode")},resetCoupon:function(){if(this.couponInfo={},this.submitData.couponCode="",this.previousCouponCode="",this.$refs.couponCode.resetField("couponCode"),this.submitData.couponCode="",this.isEditMode){var t=this.couponItem,e=t.total,i=Object(s["a"])(t,["total"]);this.deleteCoupon=Object(d["a"])({},i,{price:e})}},addTotalEdit:function(t){if(this.isChildren){var e=Object(c["a"])(this.totalEditList);e.push(Object(d["a"])({},t)),this.totalEditList=Object(c["a"])(e)}else if(this.isEditMode)this.addMore([Object(d["a"])({},t)]);else{var i=Object(c["a"])(this.totalEditList);i.push(Object(d["a"])({},t)),this.totalEditList=Object(c["a"])(i),this.prepaidAndEdit()}},prepaidAndEdit:function(){"Prepaid"===this.submitData.paymentMethod&&(this.submitData.paymentMethod="",this.paymentWay="offline",this.isPrepaidAndEdit=!0)},scrollToTop:function(){var t=this;window.innerWidth<481&&this.$nextTick(function(){setTimeout(function(){t.$refs.drawer.$el.querySelector(".el-drawer").scrollTop=150},200)})},openAddressEdit:function(){this.addressShow=!0},closeAddress:function(){this.addressShow=!1},onSelectCity:function(){this.submitData.district=""},getDefaultAddress:function(){var t=this;if(this.memberInfo.shippingInfo&&this.memberInfo.shippingInfo[0]&&this.memberInfo.shippingInfo[0].district){var e=this.filterCities.some(function(e){return e.district.includes(t.memberInfo.shippingInfo[0].district)});if(e){var i=this.memberInfo.shippingInfo[0],a=i.city,r=i.district,s=i.address;this.submitData.city=a,this.submitData.district=r,this.submitData.address=s}}},saveHomeAddress:function(){var t=Object(l["a"])(o.a.mark(function t(){return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.addressForm.validate();case 2:this.isEditMode?this.tryToSaveOrder():this.addressShow=!1;case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tryToSaveAddress:function(){var t=Object(l["a"])(o.a.mark(function t(){var e;return o.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.enableSaveAddress){t.next=5;break}return e={address:this.submitData.address,city:this.submitData.city,district:this.submitData.district,email:"",name:"",phone:"",postcode:""},e.postcode=Object(m["g"])(this.submitData.city,this.submitData.district),t.next=5,this.$store.dispatch("member/store",{id:this.memberInfo.id,fullName:this.memberInfo.fullName,gender:this.memberInfo.gender,shippingInfo:[e]});case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}},E=T,A=E,$=i("0cf1"),V=i("2877");function L(t){this["$style"]=$["default"].locals||$["default"]}var N=Object(V["a"])(A,a,r,!1,L,null,null);e["default"]=N.exports},"8b4c":function(t,e,i){"use strict";function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=s(t);i.scrollTo({top:n(t)-e,behavior:"smooth"})}function r(t){var e=t.scrollHeight>t.clientHeight,i=window.getComputedStyle(t).overflowY,a=["scroll","auto"].includes(i);return e&&a}function s(t){return r(t)?t:s(t.parentElement)}function n(t){var e=0;if(t.offsetParent){do{e+=t.offsetTop}while(t=t.offsetParent);return e}}i.d(e,"a",function(){return a})},"99bb":function(t,e,i){t.exports=i.p+"img/staff_avatar_haku.d71bfdb4.png"},b155:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var a={personality:[{title:"粘人",name:"clingy"},{title:"膽小",name:"timid"},{title:"親人",name:"nice"},{title:"活潑",name:"lively"},{title:"怕生",name:"shy"},{title:"討厭同類",name:"hate-same"}],healthy:[{title:"關節疾病",name:"joint-disease",text:""},{title:"皮膚疾病",name:"skin-condition",text:""},{title:"過敏反應",name:"allergy",text:""},{title:"其他疾病",name:"other",text:""}],behavior:[{title:"分離焦慮症",name:"SAD",text:""},{title:"攻擊過家人",name:"attack-familly",text:""},{title:"攻擊陌生人",name:"attack-stranger",text:""},{title:"攻擊過同類",name:"attack-same",text:""},{title:"被同類咬過",name:"be-attacked",text:""}],vaccine:0}},ecd8:function(t,e,i){t.exports={slide:"OrderForm_slide_1BrL2","slide-reverse":"OrderForm_slide-reverse_1CR67",orderformSection:"OrderForm_orderformSection_AyQhJ",header:"OrderForm_header_1bx8P",title:"OrderForm_title_1R25D",infoList:"OrderForm_infoList_3SCxK",detail:"OrderForm_detail_3AhtK",footer:"OrderForm_footer_12STI",petListImg:"OrderForm_petListImg_2AmhV",pet:"OrderForm_pet_12FJA",petList:"OrderForm_petList_3Tx19",price:"OrderForm_price_1yTZb",prepaid:"OrderForm_prepaid_B1jfE",total:"OrderForm_total_3EgfK",bottom:"OrderForm_bottom_3OWbl",editOneLine:"OrderForm_editOneLine_3zzl4",titleBox:"OrderForm_titleBox_3CUGQ",box:"OrderForm_box_3c-ME",info:"OrderForm_info_29fC3",share__buttons:"OrderForm_share__buttons_6Au4Z",share__button:"OrderForm_share__button_2M8SN",share__icon:"OrderForm_share__icon_18IDa",share__label:"OrderForm_share__label_8o9bP",invoice:"OrderForm_invoice_22Vg2"}}}]);
//# sourceMappingURL=chunk-0bd33b9d.76ba854a.js.map