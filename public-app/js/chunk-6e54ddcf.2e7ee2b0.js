(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e54ddcf","chunk-6e54ddcf"],{"0ca1":function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:e.$style.write},[r("el-row",{attrs:{gutter:20}},[r("el-col",{attrs:{span:24}},[r("el-card",{staticClass:"source-info",attrs:{shadow:"never"}},[r("h6",{staticStyle:{color:"#53c2cc"}},[e._v("來源資訊")]),void 0!==e.sourceInventory?[r("div",[e._v("預約項目："+e._s(e.productName))]),r("div",[e._v("日期： "+e._s(e.sourceInventory.date))]),r("div",[e._v("時間： "+e._s(e.sourceInventory.startTime)+" -\n            "+e._s(e.sourceInventory.endTime))]),r("div",[e._v("販售狀況： "+e._s(e.sourceInventory.qty)+" /\n            "+e._s(1===e.sourceInventory.infinity?"無限":e.sourceInventory.inventory))])]:e._e(),void 0!==e.sourceOrder?[r("div",[e._v(e._s("#"+e.sourceOrder.id))]),r("div",[e._v(e._s(e._f("formatDate")(e.sourceOrder.created,"dateTime"))+" 成立訂單")]),r("div",[e._v("訂單來源："+e._s(e._f("orderSourceFilter")(e.sourceOrder.source)))]),r("div",{staticStyle:{"margin-bottom":"16px"}},[e._v(e._s(e._f("orderStatusFilter")(e.sourceOrder.status,"text")))]),r("div",[e._v("預約項目："+e._s(e.sourceOrder.productName))]),r("div",[e._v("預約時間："+e._s(e._f("formatDate")(e.sourceOrder.date))+"\n            "+e._s(e.sourceOrder.time))]),r("div",{staticStyle:{"margin-bottom":"16px"}},[e._v("訂購項目：\n            "),e._l(e.sourceOrder.params,function(t,s){return r("span",{key:t.title+"-"+s},[e._v("\n              "+e._s(t.title+"x"+t.qty+" ")+"\n            ")])})],2),r("div",[e._v("使用人姓名："+e._s(e.sourceOrder.fullName))]),r("div",[e._v("使用人電話："+e._s(e.sourceOrder.phoneCode)+"\n            "+e._s(e.sourceOrder.phoneNumber))]),r("div",[e._v("電子信箱："+e._s(e.sourceOrder.email))]),r("div",[e._v("使用人備註："+e._s(e.sourceOrder.note||"無"))])]:e._e(),void 0!==e.sourceMember?[r("div",[e._v("客戶姓名："+e._s(e.sourceMember.fullName))]),r("div",[e._v("電話："+e._s(e.sourceMember.phoneCode)+"\n            "+e._s(e.sourceMember.phoneNumber))]),r("div",[e._v("電子郵件："+e._s(e.sourceMember.email))])]:e._e(),"memberList"===e.sourceName?[r("p",[e._v("已選擇名單上 "+e._s(e.selectedMemberIds.length)+" 位客戶")])]:e._e()],2),r("p",[e._v("發送方式（複選）")])],1),r("el-checkbox-group",{on:{change:e.updateRouter},model:{value:e.router,callback:function(t){e.router=t},expression:"router"}},[r("el-col",{attrs:{span:12}},[r("el-checkbox",{staticStyle:{width:"100%"},attrs:{label:"email",border:""}},[e._v("電子郵件")])],1),r("el-col",{attrs:{span:12}},[r("el-checkbox",{staticStyle:{width:"100%"},attrs:{label:"sms",border:""}},[e._v("簡訊")])],1)],1),void 0!==e.sourceInventory?[r("el-col",{attrs:{span:24}},[r("p",[e._v("發送對象（單選）")]),r("el-radio-group",{staticStyle:{width:"100%"},model:{value:e.target,callback:function(t){e.target=t},expression:"target"}},[r("el-col",{staticClass:"no-padding-left",attrs:{span:12}},[r("el-radio",{staticStyle:{width:"100%"},attrs:{label:"all",border:""}},[e._v("全部名單")])],1),r("el-col",{staticClass:"no-padding-right",attrs:{span:12}},[r("el-radio",{staticStyle:{width:"100%"},attrs:{label:"custom",border:""}},[e._v("自訂")])],1)],1)],1),r("el-col",{directives:[{name:"show",rawName:"v-show",value:e.showCustom,expression:"showCustom"}],attrs:{span:24}},[r("p",[e._v("自訂發送對象：")]),r("el-input",{class:e.$style.search,attrs:{placeholder:"搜尋訂單：輸入使用人姓名、手機號碼或訂單編號"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.tryToFetchOrderList(t)}},model:{value:e.searchQuery,callback:function(t){e.searchQuery="string"===typeof t?t.trim():t},expression:"searchQuery"}},[r("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tryingToGetOrder,expression:"tryingToGetOrder"}],staticStyle:{width:"100%","margin-bottom":"30px","border-right":"1px solid #f6f7fa","border-left":"1px solid #f6f7fa"},attrs:{height:"370","element-loading-text":"取得訂單資訊中",data:e.orderList,"default-sort":{prop:"created",order:"descending"},"row-class-name":e.tableRowClassName},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),r("el-table-column",{attrs:{label:"#訂單編號",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("div",[e._v(e._s("#"+s.id))])]}}],null,!1,623682367)}),r("el-table-column",{attrs:{label:"使用人"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("div",[e._v(e._s(s.fullName)+" "+e._s(e._f("genderFilter")(s.gender)))]),r("div",{staticStyle:{color:"#aaaaaa"}},[e._v(e._s(s.phoneCode+" "+s.phoneNumber))])]}}],null,!1,2713470529)}),r("el-table-column",{attrs:{label:"客戶"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[e.sameAsUser(s)?[r("div",{staticStyle:{color:"#aaaaaa"}},[e._v("同使用人")])]:[r("div",[e._v(e._s(s.member.fullName)+"\n                "+e._s(e._f("genderFilter")(s.member.gender)))]),r("div",{staticStyle:{color:"#aaaaaa"}},[e._v(e._s(s.member.phoneCode+" "+s.member.phoneNumber))])]]}}],null,!1,2437789981)}),r("el-table-column",{attrs:{label:"狀態與來源",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.row;return[r("BaseStateLabel",{attrs:{state:e._f("orderStatusFilter")(s.status,"color"),text:""}},[e._v(e._s(e._f("orderStatusFilter")(s.status,"text")))]),r("br"),r("BaseStateLabel",{attrs:{state:"info",text:""}},[e._v(e._s(e._f("orderSourceFilter")(s.source)))])]}}],null,!1,3316611662)})],1)],1)]:e._e(),void 0!==e.sourceInventory||void 0!==e.sourceOrder?[r("el-col",{attrs:{span:24}},[r("p",[e._v("發送給...（複選）")])]),r("el-checkbox-group",{on:{change:e.updateSendWhoType},model:{value:e.sendWhoType,callback:function(t){e.sendWhoType=t},expression:"sendWhoType"}},[r("el-col",{attrs:{span:12}},[r("el-checkbox",{staticStyle:{width:"100%"},attrs:{label:"onlyUser",border:""}},[e._v("使用人")])],1),r("el-col",{attrs:{span:12}},[r("el-checkbox",{staticStyle:{width:"100%"},attrs:{label:"onlyBuyer",border:""}},[e._v("客戶")])],1)],1)]:e._e()],2),r("el-divider"),r("el-row",{directives:[{name:"show",rawName:"v-show",value:e.showMessageContent,expression:"showMessageContent"}]},[r("el-col",{attrs:{span:24}},[e.router.includes("email")?[r("div",[r("b",[e._v("Email 主旨：")])]),r("At",{ref:"subjectTemplate",attrs:{oneline:!0,"fixed-phrase":e.mapSubjectFixedPhrase[e.sourceName]},on:{update:e.updateSubjectTemplate}}),r("p",[e._v("預覽：")]),r("p",{staticStyle:{"margin-bottom":"50px"},domProps:{innerHTML:e._s(e.previewContent(e.previewSubjectTemplate))}})]:e._e(),r("div",[r("b",[e._v("訊息內容：")])]),r("At",{ref:"template",attrs:{"fixed-phrase":e.mapFixedPhrase[e.sourceName]},on:{update:e.updateTemplate}}),r("p",[e._v("預覽：")]),r("p",{staticStyle:{"margin-bottom":"50px"},domProps:{innerHTML:e._s(e.previewContent(e.previewTemplate))}})],2)],1),r("div",{class:e.$style.footer},[r("el-button",{on:{click:e.emitClose}},[e._v("取消")]),r("el-button",{attrs:{type:"primary",loading:e.tryingToSend,disabled:!e.showMessageContent},on:{click:e.validataSubmitData}},[e._v("確認發送")])],1)],1)},a=[],o=r("9395"),n=r("4795"),i=r.n(n),l=r("cb0c"),c=r("9161"),u=r("a315"),d=r("1b80"),m=r("7e02"),p=r("6bea"),h={components:{At:function(){return Object(u["a"])(r.e("chunk-0bde6144").then(r.bind(null,"1acc")))},BaseStateLabel:function(){return Object(u["a"])(r.e("chunk-12bed50d").then(r.bind(null,"38d1")))}},filters:{genderFilter:m["h"],orderStatusFilter:m["o"],orderPaymentMethodFilter:m["k"],orderSourceFilter:m["m"],formatDate:p["a"]},mixins:[d["c"]],props:{selectedMemberIds:{type:Array,default:function(){return[]}},selectedOrderIds:{type:Array,default:function(){return[]}},sourceName:{type:String,default:"reception"},sourceInventory:{type:Object,default:function(){}},sourceOrder:{type:Object,default:function(){}},sourceMember:{type:Object,default:function(){}},sourceMemberList:{type:Object,default:function(){}},productName:{type:String,default:""}},data:function(){return{submitData:{orderIds:[],memberIds:this.selectedMemberIds,templateContent:"",router:"sms",sendWhoType:"onlyUser",subject:""},router:["sms"],sendWhoType:["onlyUser"],mapTemplateString:{"姓名":"黃大明","訂單成立時間":" 2021/01/01 00:00 ","店家名稱":"小捲尾寵物美容","預約時間":" 2021/01/03 13:00 ","付款時間":" 2021/01/01 10:00 ","服務項目":"小捲尾美容SPA"},mapFixedPhrase:{reception:["姓名","店家名稱","服務項目","預約時間"],order:["姓名","店家名稱","服務項目","預約時間"],memberList:["姓名","店家名稱"],member:["姓名","店家名稱"]},mapSubjectFixedPhrase:{reception:["店家名稱","服務項目"],order:["店家名稱","服務項目"],memberList:["店家名稱"],member:["店家名稱"]},orderList:[],target:"all",previewSubjectTemplate:"",previewTemplate:"",tryingToSend:!1,searchQuery:"",selectedCustom:[]}},computed:{memberIds:function(){return this.selectedMember.map(function(e){return e.id})},fetchDataParams:function(){var e=this.$route.query,t=Object.assign(e,this.pageQuery),r=this.filterData,s=r.startDate,a=r.endDate,o=(r.dateType,Object(c["a"])(r,["startDate","endDate","dateType"])),n=s&&a,i=n?Object.assign(this.filterData,{startDate:Object(p["e"])(s),endDate:Object(p["e"])(a)}):o;return Object.assign(i,t)},isByOrder:function(){return"reception"===this.sourceName||"order"===this.sourceName},isByMember:function(){return"member"===this.sourceName||"memberList"===this.sourceName},showCustom:function(){return"reception"===this.sourceName&&"custom"===this.target},showMessageContent:function(){return this.isByOrder?this.router.length&&this.sendWhoType.length:!!this.router.length}},watch:{currentPage:{handler:"tryToFetchOrderList",immediate:!0}},methods:{tryToFetchOrderList:function(){var e=Object(l["a"])(i.a.mark(function e(){var t,r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("reception"===this.sourceName){e.next=2;break}return e.abrupt("return");case 2:return this.tryingToGetOrder=!0,e.next=5,this.$store.dispatch("order/fetchList",{inventoryId:this.sourceInventory.id,paymentMethod:"All",limit:0,search:this.searchQuery});case 5:t=e.sent,r=t.items,t.total,this.orderList=r,this.tryingToGetOrder=!1,this.$nextTick(function(){});case 11:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),emitClose:function(){this.$emit("close")},tryToSend:function(){var e=Object(l["a"])(i.a.mark(function e(t){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tryingToSend=!0,e.next=3,this.$store.dispatch("merchant/sendNoti",t);case 3:this.$message({message:"發送成功！",type:"success"}),this.tryingToSend=!1;case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),validataSubmitData:function(){if("custom"!==this.target||0!==this.selectedCustom.length)if(this.router.includes("email")&&""===this.previewSubjectTemplate)this.$message({message:"請填寫 Email 主旨！",type:"error"});else if(""!==this.previewTemplate){var e=Object(o["a"])({},this.submitData,{sendWhoType:this.isByMember?void 0:this.submitData.sendWhoType,mode:this.isByOrder?"byOrder":"byMember",orderIds:"all"===this.target?this.selectedOrderIds:this.selectedCustom,templateContent:this.previewTemplate,subject:this.previewSubjectTemplate});this.tryToSend(e)}else this.$message({message:"請填寫訊息內容！",type:"error"});else this.$message({message:"請選擇發送對象！",type:"error"})},getTemplate:function(){return this.$refs.template.getTemplateContent()},getSubjectTemplate:function(){return void 0===this.$refs.subjectTemplate?"":this.$refs.subjectTemplate.getTemplateContent()},updateTemplate:function(){this.previewTemplate=this.$refs.template.getTemplateContent(),this.$forceUpdate()},updateSubjectTemplate:function(){this.previewSubjectTemplate=this.$refs.subjectTemplate.getTemplateContent(),this.$forceUpdate()},tableRowClassName:function(e){var t=e.row,r=t.status,s=t.groupSize/t.usedSize;return 0===r?"order--canceled":1===s?"order--used":void 0},updateRouter:function(e){this.router=e,this.submitData.router=e[0],2===e.length&&(this.submitData.router="all")},updateSendWhoType:function(e){this.sendWhoType=e,this.submitData.sendWhoType=e[0],2===e.length&&(this.submitData.sendWhoType="all")},handleSelectionChange:function(e){this.selectedCustom=e.map(function(e){return e.id})},previewContent:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=t;return null===r?"":(Object.keys(this.mapTemplateString).forEach(function(t){r=r.replace(new RegExp("{".concat(t,"}"),"g"),e.mapTemplateString[t])}),r=r.replace(new RegExp("\n","g"),"<br>"),r)},sameAsUser:function(e){return e.member.fullName===e.fullName&&(e.member.gender===e.gender&&(e.member.phoneCode===e.phoneCode&&e.member.phoneNumber===e.phoneNumber))}}},v=h,b=r("ea18"),f=r("2877");function y(e){this["$style"]=b["default"].locals||b["default"]}var _=Object(f["a"])(v,s,a,!1,y,null,null);t["default"]=_.exports},b0ec:function(e,t,r){e.exports={slide:"NotificationWrite_slide_3J1yj","slide-reverse":"NotificationWrite_slide-reverse_1pPPW",title:"NotificationWrite_title_DizYY",footer:"NotificationWrite_footer_oxCT6",write:"NotificationWrite_write_1WfF5"}},ea18:function(e,t,r){"use strict";var s=r("b0ec"),a=r.n(s);t["default"]=a.a}}]);
//# sourceMappingURL=chunk-6e54ddcf.2e7ee2b0.js.map