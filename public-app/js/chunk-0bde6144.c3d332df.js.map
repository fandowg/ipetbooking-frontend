{"version":3,"sources":["webpack:///./src/components/At.vue?57e4","webpack:///src/components/At.vue","webpack:///./src/components/At.vue?9c14","webpack:///./src/components/At.vue?15ad","webpack:///./src/components/At.vue?46c0"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","id","staticClass","_l","text","index","key","type","plain","on","click","$event","insertButton","name","_v","_s","oneline","ref","api-key","init","Object","assign","config","setup","editor","e","keyCode","preventDefault","paste_preprocess","plugin","args","content","replace","input","onChangeText","model","value","callback","$$v","innerText","expression","onKeyUp","staticRenderFns","Atvue_type_script_lang_js_","components","Editor","lazyload_component","__webpack_require__","then","bind","props","fixedPhrase","Array","default","String","Boolean","data","inline","menubar","statusbar","toolbar","plugins","paste_as_text","gecko_spellcheck","force_br_newlines","force_p_newlines","remove_linebreaks","computed","$refs","tinymce","created","updateInnerText","mounted","_this","addLiveListener","removeElement","methods","element","_this2","parentObj","parentNode","removeChild","selection","select","getBody","collapse","$nextTick","emitUpdate","eventType","tagName","handle","event","target","call","$el","removeEventListener","addEventListener","isHTML","replaceToMark","insertContent","concat","getTemplateContent","getContent","format","getTemplateContentHTML","forEach","RegExp","replaceToBreakLine","replaceToString","replaceBreakLine","$emit","includes","components_Atvue_type_script_lang_js_","component","componentNormalizer","__webpack_exports__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_At_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_8_oneOf_1_0_node_modules_css_loader_index_js_ref_8_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_8_oneOf_1_2_node_modules_sass_loader_lib_loader_js_ref_8_oneOf_1_3_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_At_vue_vue_type_style_index_0_lang_scss___WEBPACK_IMPORTED_MODULE_0___default","n"],"mappings":"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","file":"js/chunk-0bde6144.c3d332df.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"textarea-box\"}},[_c('div',{staticClass:\"phrase\"},[_c('el-button-group',_vm._l((_vm.fixedPhrase),function(text,index){return _c('el-button',{key:index + text,attrs:{\"type\":\"primary\",\"plain\":\"\"},on:{\"click\":function($event){return _vm.insertButton(text)}}},[_c('BaseIcon',{attrs:{\"name\":\"plus\"}}),_vm._v(\" \"+_vm._s(text))],1)}),1)],1),(!_vm.oneline)?_c('Editor',{ref:\"tinymce\",staticClass:\"el-textarea__inner\",attrs:{\"api-key\":\"no-api-key\",\"init\":_vm.config},on:{\"onKeyUp\":function($event){return _vm.onChangeText($event)}},model:{value:(_vm.innerText),callback:function ($$v) {_vm.innerText=$$v},expression:\"innerText\"}}):_c('Editor',{ref:\"tinymce\",staticClass:\"el-textarea__inner oneline\",attrs:{\"api-key\":\"no-api-key\",\"init\":Object.assign({}, _vm.config,\n        {setup: function (editor) {\n          editor.on('keydown',function (e) {\n            if (e.keyCode === 13)\n              { e.preventDefault() }\n          })\n\t      }, \n        paste_preprocess: function (plugin, args) {\n          // 多行改為一行\n          args.content = args.content.replace(/\\<p\\>/g,'')\n          args.content = args.content.replace(/\\<\\/p\\>/g,'')\n        }})},on:{\"input\":function($event){return _vm.onChangeText($event)}},model:{value:(_vm.innerText),callback:function ($$v) {_vm.innerText=$$v},expression:\"innerText\"}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\nimport lazyLoadComponent from '@router/lazyload-component'\n\nexport default {\n  components:{\n    Editor: () => lazyLoadComponent(import('@tinymce/tinymce-vue')),\n  },\n  props: {\n    fixedPhrase: {\n      type: Array,\n      default: () => {\n        return []\n      },\n    },\n    content: {\n      type: String,\n      default: '',\n    },\n    oneline: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  data() {\n    return {\n      innerText: this.content,\n      config: {\n        inline: true,\n        menubar: false,\n        statusbar: false,\n        toolbar: false,\n        plugins: \"paste\",\n        paste_as_text: true,\n        \n        gecko_spellcheck : true,\n        force_br_newlines : false,\n        force_p_newlines : false,\n        remove_linebreaks: false,\n      },\n      \n    }\n  },\n  computed: {\n    editor() {\n      return this.$refs.tinymce.editor\n    },\n  },\n  created() {\n    this.updateInnerText()\n  },\n  mounted() {\n    const _this = this\n    this.addLiveListener('click', 'MARK', function (e) {\n      this.preventDefault()\n      _this.removeElement(e)\n    })\n  },\n  methods: {\n    /**\n     * 移除元素\n     *\n     * @param {element} element\n     */\n    removeElement(element) {\n      const parentObj = element.parentNode\n      parentObj.removeChild(element)\n\n      // 防止消失的模板出現在樣式預覽上面\n      this.editor.selection.select(this.editor.getBody(), true)\n      this.editor.selection.collapse(false)\n      this.$nextTick(()=>{\n        this.emitUpdate()\n      })\n    },\n    /**\n     * 新增Live事件\n     *\n     * @param {string} eventType - click, scroll ...\n     * @param {string} tagName - DIV, MARK, SPAN ...\n     * @param {function} callback - click, scroll ...\n     */\n    addLiveListener(eventType, tagName, callback) {\n      this.$el.removeEventListener(eventType, handle)\n      this.$el.addEventListener(eventType, handle)\n      function handle(event) {\n        let element = event.target\n\n        if (element && element.tagName === tagName) {\n          callback.call(event, element)\n        }\n      }\n    },\n    /**\n     * 改變文字\n     *\n     * @param {element} event\n     */\n    onChangeText(event) {\n      if (event.keyCode === 13) {\n        event.preventDefault()\n      }\n\n      this.emitUpdate()\n    },\n    updateInnerText() {\n      // 判斷是否為舊格式\n      if(!this.isHTML(this.innerText))\n        this.innerText = this.replaceToMark(this.innerText)\n    },\n    insertButton(text) {\n      this.editor.insertContent(`<mark contenteditable=\"false\">{${text}}</mark>`);\n      this.emitUpdate()\n    },\n    getTemplateContent() {\n      let content = this.editor.getContent({ format: \"text\" })\n      content = content.replace(/(\\n){3}/g,'<br>')\n      content = content.replace(/(\\n){2}/g,'<br>')\n      content = content.replace(/\\<br\\>/g,'\\n')\n      return content\n    },\n    getTemplateContentHTML() {\n      return this.editor.getContent()\n    },\n    replaceToMark(content) {\n      if (content === null) return ''\n      this.fixedPhrase.forEach((key) => {\n        content = content.replace(\n          new RegExp(`{${key}}`, 'g'),\n          `<mark contenteditable=\"false\">${key}</mark>`\n        )\n      })\n      content = this.replaceToBreakLine(content)\n      return content\n    },\n    replaceToString(content) {\n      if (content === null) return ''\n      this.fixedPhrase.forEach((key) => {\n        content = content.replace(\n          new RegExp(`<mark contenteditable=\"false\">${key}</mark>`, 'g'),\n          `{${key}}`\n        )\n      })\n      content = this.replaceBreakLine(content)\n      return content\n    },\n    replaceBreakLine(content) {\n      if (content === null) return ''\n      content = content.replace(new RegExp(`<div>`, 'g'), `\\n`)\n      content = content.replace(new RegExp(`<br>`, 'g'), `\\n`)\n      content = content.replace(new RegExp(`</div>`, 'g'), ``)\n      content = content.replace(new RegExp(`&nbsp;`, 'g'), ` `)\n      return content\n    },\n    replaceToBreakLine(content) {\n      if (content === null) return ''\n      content = content.replace(new RegExp(`\\n`, 'g'), `<p></p>`)\n      return content\n    },\n    emitUpdate() {\n      this.$emit('update')\n      // this.$forceUpdate()\n    },\n    isHTML(value) {\n      if(value){\n        return value.includes('<p>')\n      } else {\n        return false\n      }\n      \n    },\n  },\n}\n</script>\n<template>\n  <div id=\"textarea-box\">\n    <div class=\"phrase\">\n      <el-button-group>\n        <el-button\n          v-for=\"(text, index) in fixedPhrase\"\n          :key=\"index + text\"\n          type=\"primary\"\n          plain\n          @click=\"insertButton(text)\"\n          ><BaseIcon name=\"plus\" /> {{ text }}</el-button\n        >\n      </el-button-group>\n    </div>\n    <Editor v-if=\"!oneline\" ref=\"tinymce\" v-model=\"innerText\" class=\"el-textarea__inner\"  api-key=\"no-api-key\" :init=\"config\" @onKeyUp=\"onChangeText($event)\" />\n    <Editor\n      v-else\n      ref=\"tinymce\"\n      v-model=\"innerText\"\n      class=\"el-textarea__inner oneline\"\n      api-key=\"no-api-key\"\n      :init=\"{ ...config,\n        setup: (editor) => {\n          editor.on('keydown',(e) => {\n            if (e.keyCode === 13)\n              e.preventDefault()\n          })\n\t      }, \n        paste_preprocess: (plugin, args) => {\n          // 多行改為一行\n          args.content = args.content.replace(/\\<p\\>/g,'')\n          args.content = args.content.replace(/\\<\\/p\\>/g,'')\n        },\n      }\"\n      @input=\"onChangeText($event)\"\n    >\n    </Editor>\n  </div>\n</template>\n<style lang=\"scss\">\n@import '@design';\nmark {\n  background: white;\n  padding: 0.3rem 0.7rem;\n  border-radius: 3px;\n  color: $color-primary;\n  border: 1px solid $color-primary;\n  cursor: pointer;\n  margin: 0 0.25rem;\n  font-size: 100%;\n  white-space: nowrap;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  br {\n    display: none;\n  }\n  &::after {\n    content: '\\e79d';\n    font-family: element-icons !important;\n    speak: none;\n    font-style: normal;\n    font-weight: 400;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    vertical-align: baseline;\n    display: inline-block;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    color: $color-primary;\n    font-size: 14px;\n    vertical-align: text-top;\n    margin-left: 10px;\n  }\n}\n\n.phrase {\n  .el-button {\n    padding: 10px;\n    font-size: 12px;\n  }\n}\n\ndiv[contenteditable='true'] {\n  min-height: 140px;\n  line-height: 2.5;\n  overflow: hidden;\n  resize: none;\n  font-size: 12px;\n  &.oneline {\n    min-height: inherit;\n    white-space: nowrap;\n  }\n}\n\n#textarea-box {\n  position: relative;\n  .phrase {\n    margin: 15px 0;\n  }\n  :global {\n    p {\n      margin: 0;\n    }\n  }\n}\n\n.tox-notifications-container {display: none !important;}\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./At.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./At.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./At.vue?vue&type=template&id=3b12c42d&\"\nimport script from \"./At.vue?vue&type=script&lang=js&\"\nexport * from \"./At.vue?vue&type=script&lang=js&\"\nimport style0 from \"./At.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./At.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/lib/index.js??ref--8-oneOf-1-2!../../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./At.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}