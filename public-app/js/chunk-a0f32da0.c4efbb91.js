(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a0f32da0"],{"21ac":function(e,t,a){"use strict";a.d(t,"a",function(){return i});var s=a("5c96");a("a18c");function i(e,t,a){Object(s["Notification"])({title:"提示",dangerouslyUseHTMLString:!0,message:"已更新".concat(e,'!\n    <br>您可前往\n    <a href="/').concat(a,'" style="cursor: pointer;">').concat(t,"</a>\n    進行更多設定")})}},"3fa5":function(e,t,a){"use strict";a.d(t,"b",function(){return i}),a.d(t,"a",function(){return r});var s=a("5c96");function i(e){"add"===e&&Object(s["Message"])({message:"已新增",type:"success"}),"edit"===e&&Object(s["Message"])({message:"已儲存",type:"success"})}function r(){Object(s["Message"])({message:"已刪除",type:"success"})}},b062:function(e,t,a){"use strict";a.r(t);var s=function(){var e,t=this,a=t.$createElement,s=t._self._c||a;return s("div",{class:[t.$style.page,{isEmployee:"employee"===t.accessType}]},["employee"===t.accessType?s("div",{staticClass:"right-top-btn",on:{click:t.emitClose}},[s("BaseIcon",{staticClass:"right-top-btn",attrs:{name:"times","icon-style":"fal"}})],1):t._e(),"employee"===t.accessType?s("BasePageHeader",{attrs:{title:"編輯資料"}}):t._e(),s("el-tabs",{attrs:{type:"employee"!==t.accessType?"border-card":"","before-leave":t.beforeTabSwitch,stretch:""},model:{value:t.activeTab,callback:function(e){t.activeTab=e},expression:"activeTab"}},[s("el-tab-pane",{key:"0",attrs:{label:"基本資訊",name:"1"}},[s("el-form",{ref:"form",staticClass:"el-form--floating",attrs:{model:t.submitData,rules:t.submitRules,"label-position":"top","validate-on-rule-change":!1}},[s("div",{class:(e={},e["bottom-line-box"]="employee"!==t.accessType,e)},[s("el-row",{attrs:{gutter:40}},["employee"!==t.accessType?s("el-col",{attrs:{md:18}},[s("el-row",{attrs:{gutter:40,type:"flex"}},[s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"姓名",prop:"name"}},[s("el-input",{model:{value:t.submitData.name,callback:function(e){t.$set(t.submitData,"name",e)},expression:"submitData.name"}})],1)],1),t.defaultValue.userGroupIds.includes(7)?t._e():s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"帳號啟用",prop:"block"}},[s("el-switch",{attrs:{"active-text":"啟用","inactive-text":"停權","active-value":0,"inactive-value":1,disabled:0===t.defaultValue.canBlock},model:{value:t.submitData.block,callback:function(e){t.$set(t.submitData,"block",e)},expression:"submitData.block"}}),0===t.defaultValue.canBlock?s("el-alert",{staticStyle:{display:"inline","margin-left":"20px"},attrs:{title:"欲停權請先移轉隸屬此帳號的有效訂單",type:"warning",closable:!1,"show-icon":""}}):t._e()],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"職位",prop:"title"}},[s("el-input",{model:{value:t.submitData.title,callback:function(e){t.$set(t.submitData,"title",e)},expression:"submitData.title"}})],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"聯絡電話",prop:"phoneNumber"}},[s("el-input",{model:{value:t.submitData.phoneNumber,callback:function(e){t.$set(t.submitData,"phoneNumber",e)},expression:"submitData.phoneNumber"}},[s("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:t.submitData.phoneCode,callback:function(e){t.$set(t.submitData,"phoneCode",e)},expression:"submitData.phoneCode"}})],1)],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"到職日期",prop:"takeOfficeDate"}},[s("el-date-picker",{attrs:{type:"date","value-format":"yyyy-MM-dd"},model:{value:t.submitData.takeOfficeDate,callback:function(e){t.$set(t.submitData,"takeOfficeDate",e)},expression:"submitData.takeOfficeDate"}})],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"離職日期",prop:"leaveOfficeDate"}},[s("el-date-picker",{attrs:{"picker-options":t.endDatePickerOptions,type:"date","value-format":"yyyy-MM-dd"},model:{value:t.submitData.leaveOfficeDate,callback:function(e){t.$set(t.submitData,"leaveOfficeDate",e)},expression:"submitData.leaveOfficeDate"}})],1)],1)],1)],1):t._e(),"employee"!==t.accessType?s("el-col",{attrs:{md:6}},[s("el-form-item",{attrs:{prop:"avatar"}},[s("BaseUpload",{attrs:{resource:"staff",circle:"","suggest-size":"128/128"},model:{value:t.submitData.avatar,callback:function(e){t.$set(t.submitData,"avatar",e)},expression:"submitData.avatar"}})],1)],1):t._e(),"employee"===t.accessType?s("el-col",{attrs:{md:24}},[s("el-row",{staticStyle:{"padding-top":"20px"},attrs:{gutter:40}},[s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"姓名",prop:"name"}},[s("el-input",{model:{value:t.submitData.name,callback:function(e){t.$set(t.submitData,"name",e)},expression:"submitData.name"}})],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"聯絡電話",prop:"phoneNumber"}},[s("el-input",{model:{value:t.submitData.phoneNumber,callback:function(e){t.$set(t.submitData,"phoneNumber",e)},expression:"submitData.phoneNumber"}},[s("CountryCodePicker",{attrs:{slot:"prepend"},slot:"prepend",model:{value:t.submitData.phoneCode,callback:function(e){t.$set(t.submitData,"phoneCode",e)},expression:"submitData.phoneCode"}})],1)],1)],1)],1)],1):t._e()],1)],1),s("el-row",{attrs:{gutter:40,type:"flex"}},["employee"!==t.accessType?s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"Email",prop:"email"}},[s("el-input",{model:{value:t.submitData.email,callback:function(e){t.$set(t.submitData,"email",e)},expression:"submitData.email"}})],1)],1):t._e(),"employee"!==t.accessType?s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"指定權限",prop:"userGroupIds",requierd:""}},[s("el-checkbox-group",{model:{value:t.submitData.userGroupIds,callback:function(e){t.$set(t.submitData,"userGroupIds",e)},expression:"submitData.userGroupIds"}},t._l(t.userGroupList,function(e){return s("el-checkbox",{key:e.id,attrs:{label:e.id,disabled:7===e.id}},[t._v(t._s(e.title))])}),1)],1)],1):t._e(),t.isEditMode?s("el-col",{attrs:{md:24}},[t.passwordEditable?t._e():s("el-button",{attrs:{type:"text"},on:{click:function(e){t.passwordEditable=!0}}},[t._v("變更密碼")]),t.passwordEditable?s("el-button",{attrs:{type:"text"},on:{click:function(e){t.passwordEditable=!1}}},[t._v("取消變更密碼")]):t._e()],1):t._e(),s("el-col",{attrs:{md:12}},[0===t.accountId&&t.passwordEditable?s("el-form-item",{attrs:{label:"密碼",prop:"password"}},[s("el-input",{attrs:{type:t.passwordVisible?"text":"password",autocomplete:"off"},scopedSlots:t._u([{key:"append",fn:function(){return[s("el-button",{on:{click:function(e){t.passwordVisible=!t.passwordVisible}}},[s("BaseIcon",{attrs:{name:t.passwordVisible?"eye-slash":"eye"}})],1)]},proxy:!0}],null,!1,1524086181),model:{value:t.submitData.password,callback:function(e){t.$set(t.submitData,"password",e)},expression:"submitData.password"}})],1):t._e()],1),s("el-col",{attrs:{md:12}},[0===t.accountId&&t.passwordEditable?s("el-form-item",{attrs:{label:"確認密碼",prop:"passwordConfirm"}},[s("el-input",{attrs:{type:t.repasswordVisible?"text":"password",autocomplete:"off"},scopedSlots:t._u([{key:"append",fn:function(){return[s("el-button",{on:{click:function(e){t.repasswordVisible=!t.repasswordVisible}}},[s("BaseIcon",{attrs:{name:t.repasswordVisible?"eye-slash":"eye"}})],1)]},proxy:!0}],null,!1,2424628498),model:{value:t.submitData.passwordConfirm,callback:function(e){t.$set(t.submitData,"passwordConfirm",e)},expression:"submitData.passwordConfirm"}})],1):t._e()],1),"employee"!==t.accessType?s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{prop:"maxCollision"}},[s("span",{attrs:{slot:"label",for:""},slot:"label"},[t._v("可同時服務幾位顧客 "),s("el-tooltip",{attrs:{content:"這位服務人員同一時段可預約的顧客人數，如果輸入2，則同一時段可供2人預約",placement:"right"}},[s("BaseIcon",{attrs:{name:"info-circle"}})],1)],1),s("el-input",{model:{value:t.submitData.maxCollision,callback:function(e){t.$set(t.submitData,"maxCollision",e)},expression:"submitData.maxCollision"}})],1)],1):t._e(),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"證照",prop:"certificate"}},[s("el-input",{model:{value:t.submitData.certificate,callback:function(e){t.$set(t.submitData,"certificate",e)},expression:"submitData.certificate"}})],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"專長",prop:"specialty"}},[s("el-input",{model:{value:t.submitData.specialty,callback:function(e){t.$set(t.submitData,"specialty",e)},expression:"submitData.specialty"}})],1)],1),s("el-col",{attrs:{md:12}},[s("el-form-item",{attrs:{label:"介紹",prop:"description"}},[s("el-input",{attrs:{type:"textarea",autosize:{minRows:2}},model:{value:t.submitData.description,callback:function(e){t.$set(t.submitData,"description",e)},expression:"submitData.description"}})],1)],1)],1)],1)],1),"employee"!==t.accessType?s("el-tab-pane",{key:"1",attrs:{label:"服務項目",name:"2"}},[s("ScheduleStaffServiceForm",{ref:"step2",attrs:{"default-value":t.defaultValue}})],1):t._e()],1),"employee"===t.accessType?s("div",{staticClass:"bottom-btn-center"},[s("el-button",{staticClass:"is-round",attrs:{type:"primary",loading:t.tryingStore},on:{click:t.tryToStore}},[t._v("儲存變更")]),s("el-button",{staticClass:"is-round",on:{click:t.emitClose}},[t._v("取消變更")])],1):s("div",{class:[t.$style.footer,{isSchedule:"schedule"===t.accessType}]},[s("el-button",{staticClass:"is-round",on:{click:t.emitClose}},[t._v("取消")]),"1"===t.activeTab&&t.isEditMode?s("el-button",{staticClass:"is-round",attrs:{type:"primary",loading:t.tryingStore},on:{click:t.tryToStore}},[t._v("儲存")]):t._e(),"1"!==t.activeTab||t.isEditMode?t._e():s("el-button",{staticClass:"is-round",attrs:{type:"primary",loading:t.tryingStore},on:{click:t.toNext}},[t._v("下一頁")]),"2"===t.activeTab?s("el-button",{staticClass:"is-round",attrs:{type:"primary",loading:t.tryingStore},on:{click:t.tryToStore}},[t._v(t._s(t.isEditMode?"儲存":"創建"))]):t._e()],1)],1)},i=[],r=a("4795"),o=a.n(r),l=a("cb0c"),n=a("f210"),c=a("9395"),u=a("a315"),d=a("6bea"),p=a("4d77"),m=a("3fa5"),b=a("21ac"),f=function(){return{avatar:"",name:"",title:"",phoneCode:"+886",phoneNumber:"",specialty:"",certificate:"",description:"",password:"",passwordConfirm:"",takeOfficeDate:"",leaveOfficeDate:"",block:0,maxCollision:1,userGroupIds:[]}},h={components:{BaseInputFloatingLabel:function(){return Object(u["a"])(a.e("chunk-2d0b235b").then(a.bind(null,"22af")))},BaseUpload:function(){return Object(u["a"])(a.e("chunk-3559b494").then(a.bind(null,"0ac6")))},CountryCodePicker:function(){return Object(u["a"])(a.e("chunk-66428ff2").then(a.bind(null,"e05d")))},ScheduleStaffServiceForm:function(){return Object(u["a"])(a.e("chunk-22c004d0").then(a.bind(null,"5358")))}},props:{defaultValue:{type:Object,default:function(){return f()}},type:{type:String,default:"new"},accessType:{type:String,default:""},accountId:{type:Number,default:0}},data:function(){var e=this;return{tryingStore:!1,submitData:Object.assign(f(),this.defaultValue),endDatePickerOptions:{disabledDate:function(t){var a=e.submitData.takeOfficeDate instanceof Object?e.submitData.takeOfficeDate:new Date(e.submitData.takeOfficeDate),s=a.getTime()+31536e6;return t<a||t.getTime()>=s}},activeTab:"1",passwordVisible:!1,repasswordVisible:!1,passwordEditable:!1}},computed:Object(c["a"])({},p["h"],{submitRules:function(){var e=this,t="+886"===this.submitData.phoneCode;return{avatar:[{required:!0,message:"請上傳頭像",trigger:"change"}],name:[{required:!0,message:"請填寫姓名",trigger:"blur"}],email:[{required:!0,message:"請輸入 Email"},{type:"email",message:"請輸入正確的 Email 格式"}],password:[{required:!this.isEditMode,message:"請輸入密碼",trigger:"blur"},{validator:function(t,a,s){var i=/(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])|(?=.*[a-z])(?=.*[A-Z])(?=.*[$@$!%*#?&])|(?=.*[A-Z])(?=.*[0-9])(?=.*[$@$!%*#?&])|(?=.*[a-z])(?=.*[0-9])(?=.*[$@$!%*#?&]).{8,16}/;i.test(a)||s(new Error("請用 8~16 個大小寫英文字母、數字與特殊符號組合")),""!==e.submitData.passwordConfirm&&e.$refs.form.validateField("passwordConfirm"),s()},trigger:"blur"}],passwordConfirm:[{required:!0,validator:function(t,a,s){if(!a)return s(new Error("請再次輸入密碼"));var i=e.submitData.password;a!==i&&s(new Error("兩次輸入的密碼不一致")),s()},trigger:"blur"}],title:[{required:!0,message:"請填寫職位",trigger:"blur"}],phoneCode:[{required:!0,message:"請選擇電話國碼",trigger:"change"}],phoneNumber:[{required:!0,message:"請填寫聯絡電話",trigger:"blur"},{pattern:t?/^02\d{7,8}$|^09\d{8}$/:"",message:"市話號碼格式請符合 02XXXXXXXX；手機號碼格式請符合 09XXXXXXXX",trigger:"blur"}],takeOfficeDate:[{validator:function(t,a,s){e.submitData.takeOfficeDate&&e.$refs.form.validateField("leaveOfficeDate"),s()},trigger:"change"}],leaveOfficeDate:[{validator:function(t,a,s){if(e.submitData.takeOfficeDate&&a){var i=Object(d["c"])(e.submitData.takeOfficeDate)>Object(d["c"])(a);if(i)return s(new Error("不得小於到職日期"))}s()},trigger:"change"}],userGroupIds:[{required:!0,message:"請選擇權限"}],maxCollision:[{required:!0,message:"請輸入同時服務的顧客數"}]}},isEditMode:function(){return this.defaultValue.id}}),watch:{defaultValue:"updateSubmitData"},created:function(){this.$store.dispatch("merchant/fetchUserGroups"),0===this.submitData.userGroupIds.length&&(this.submitData.userGroupIds=this.submitData.userGroups?Object(n["a"])(this.submitData.userGroups.map(function(e){return e.id})):[]),this.submitData.phoneCode="+886",this.isEditMode||(this.passwordEditable=!0),0!==this.accountId&&(this.passwordEditable=!0)},mounted:function(){var e=this;this.isEditMode||setTimeout(function(){e.$refs.form.resetFields()},2e3)},methods:{tryToStore:function(){var e=Object(l["a"])(o.a.mark(function e(){var t,a,s;return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("1"!==this.activeTab){e.next=3;break}return e.next=3,this.$refs.form.validate();case 3:if("2"!==this.activeTab){e.next=6;break}return e.next=6,this.$refs.step2.validate();case 6:if(this.tryingStore=!0,e.prev=7,t={},t=this.$refs.step2?Object.assign({},this.submitData,this.$refs.step2.filterSubmitData):Object.assign({},this.submitData),this.isEditMode){e.next=24;break}if(!this.accountId){e.next=16;break}return e.next=14,this.$store.dispatch("schedule/sendLinkUser",{userId:this.accountId});case 14:a=e.sent,t.id=a.id;case 16:return e.next=18,this.$store.dispatch("schedule/storeStaff",t);case 18:s=e.sent,Object(m["b"])("add"),Object(b["a"])("排班人員","排班","schedule"),this.emitStore(s),e.next=28;break;case 24:return e.next=26,this.$store.dispatch("schedule/storeStaff",t);case 26:Object(m["b"])("edit"),this.emitStore();case 28:e.next=33;break;case 30:e.prev=30,e.t0=e["catch"](7),console.log("TCL: tryToStore -> error",e.t0);case 33:return e.prev=33,this.tryingStore=!1,e.finish(33);case 36:case"end":return e.stop()}},e,this,[[7,30,33,36]])}));return function(){return e.apply(this,arguments)}}(),emitStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.$emit("store",e),this.emitClose()},emitClose:function(){this.$emit("close"),this.$refs.form.resetFields()},updateSubmitData:function(){this.submitData=Object.assign({},this.defaultValue)},toNext:function(){var e=Object(l["a"])(o.a.mark(function e(){return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$refs.form.validate();case 2:this.activeTab="2";case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),beforeTabSwitch:function(){var e=Object(l["a"])(o.a.mark(function e(t,a){return o.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if("1"!==a){e.next=3;break}return e.next=3,this.$refs.form.validate();case 3:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()}},v=h,y=a("b8b3"),D=a("2877");function g(e){this["$style"]=y["default"].locals||y["default"]}var k=Object(D["a"])(v,s,i,!1,g,null,null);t["default"]=k.exports},b8b3:function(e,t,a){"use strict";var s=a("e5ac"),i=a.n(s);t["default"]=i.a},e5ac:function(e,t,a){e.exports={slide:"ScheduleStaffForm_slide_31iQi","slide-reverse":"ScheduleStaffForm_slide-reverse_gd5k7",page:"ScheduleStaffForm_page_13_Rn","card-wrapper":"ScheduleStaffForm_card-wrapper_3E1t0",footer:"ScheduleStaffForm_footer_3c4du"}}}]);
//# sourceMappingURL=chunk-a0f32da0.c4efbb91.js.map