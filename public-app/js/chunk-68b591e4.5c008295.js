(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-68b591e4"],{"29ee":function(t,e,a){"use strict";var i=a("5fd2"),s=a.n(i);e["default"]=s.a},"5c45":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:t.$style["edit-addition"]},[a("Info",{staticClass:"order-info",attrs:{"default-value":t.bookingOrder}}),a("el-form",{ref:"form",staticClass:"el-form-item--normal-margin el-form-item--white-bg",attrs:{model:t.submitData,rules:t.submitRules,"label-position":"top"}},[a("div",{staticClass:"order-id Jost"},[t._v("加購訂單 #"+t._s(t.defaultValue.id))]),t.fullRefundOnly?a("el-alert",{attrs:{title:"信用卡公司尚未請款完成，目前只允許整筆退款！",type:"warning","show-icon":"",closable:!1}}):t._e(),a("el-form-item",{attrs:{label:"付款方式"}},[a("el-select",{staticClass:"is-round is-border",attrs:{disabled:t.disabledPayment},on:{change:t.onChangePayment},model:{value:t.submitData.paymentMethod,callback:function(e){t.$set(t.submitData,"paymentMethod",e)},expression:"submitData.paymentMethod"}},[a("el-option",{attrs:{value:null,label:"不指定",disabled:t.isEmployee&&t.isHomeService}}),a("el-option",{attrs:{value:"Cash",label:"到店付款(現金)",disabled:t.isEmployee||t.isHomeService}}),a("el-option",{attrs:{value:"Atm",label:"線下匯款"}}),a("el-option",{attrs:{value:"StoreCredit",label:"現場刷卡",disabled:t.isEmployee||t.isHomeService}}),1===t.storeCashflowSetting?a("el-option",{attrs:{value:"Credit",label:"信用卡付款"}}):t._e(),0!==t.storeCashflowSetting?a("el-option",{attrs:{value:"Vacc",label:"ATM虛擬帳戶",border:""}}):t._e()],1)],1),"Vacc"!==t.defaultValue.paymentMethod&&"Vacc"===t.submitData.paymentMethod?a("el-form-item",{attrs:{prop:"bankType",label:"轉帳銀行"}},[a("el-select",{staticClass:"is-round is-border",model:{value:t.submitData.bankType,callback:function(e){t.$set(t.submitData,"bankType",e)},expression:"submitData.bankType"}},t._l(t.bankTypeList,function(t,e){return a("el-option",{key:"bank-"+e,attrs:{value:t.id,label:t.title}})}),1)],1):t._e(),a("el-row",{attrs:{gutter:20}},[!t.hasUnpaidItem||["Credit","Vacc"].includes(t.submitData.paymentMethod)||t.isHomeService&&t.isEmployee?t._e():a("el-col",{attrs:{span:12}},[a("el-button",{staticClass:"is-round is-fullwidth paid",attrs:{type:"primary"},on:{click:function(e){return t.updateOrderStatus(1)}}},[t._v("整筆訂單已付款")])],1),a("el-col",{attrs:{span:!t.hasUnpaidItem||["Credit","Vacc"].includes(t.submitData.paymentMethod)||t.isHomeService&&t.isEmployee?24:12}},[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{type:"danger"},on:{click:function(e){return t.updateOrderStatus(0)}}},[t._v("取消此筆訂單")])],1)],1),a("el-divider"),a("div",{staticClass:"item-wrapper"},[a("div",{staticClass:"item header"},[a("div",[t._v("加購項目")]),a("div",[t._v("訂單狀態")]),a("div",[t._v("金額")])]),t._l(t.defaultValue.addItems,function(e,i){return a("div",{key:"item-"+i,staticClass:"item"},[a("div",[t._v(t._s(e.title))]),a("div",{staticClass:"status"},[a("el-select",{staticClass:"is-round is-border",attrs:{placeholder:"訂單狀態",disabled:0===e.status||t.fullRefundOnly},model:{value:t.submitData.addItems[i].status,callback:function(e){t.$set(t.submitData.addItems[i],"status",e)},expression:"submitData.addItems[index].status"}},[a("el-option",{attrs:{value:0,label:"已取消"}}),1!==e.status?a("el-option",{attrs:{value:2,label:"未付款"}}):t._e(),0!==e.status?a("el-option",{attrs:{value:1,label:"已付款",disabled:""}}):t._e()],1)],1),a("div",{staticClass:"Jost"},[t._v("$"+t._s(e.price))])])})],2)],1),a("el-row",{staticClass:"footer",staticStyle:{"margin-top":"32px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:12,xs:24}},[a("el-button",{staticClass:"is-round is-fullwidth",on:{click:function(e){return t.$emit("close")}}},[t._v("取消編輯")])],1),a("el-col",{attrs:{span:12,xs:24}},[a("el-button",{staticClass:"is-round is-fullwidth",attrs:{loading:t.tryingToStoreOrder,type:"primary"},on:{click:t.handleStoreOrder}},[t._v("儲存變更")])],1)],1)],1)},s=[],n=a("4795"),r=a.n(n),o=a("cb0c"),l=a("9395"),u=a("a315"),d=a("0644"),c=a.n(d),f=a("6bea"),m=a("340b"),p=a("4d77"),b=a("8b4c"),h=function(t){var e=c()(t),a=e.id,i=e.orderId,s=e.paymentMethod,n=e.addItems;return{id:a,orderId:i,paymentMethod:s,addItems:n.map(function(t){return Object(l["a"])({},t,{defaultStatus:t.status})})}},v={components:{Info:function(){return Object(u["a"])(a.e("chunk-af7ea718").then(a.bind(null,"cb6f")))}},props:{defaultValue:{type:Object,default:function(){}},bookingOrder:{type:Object,default:function(){}},storeCashflowSetting:{type:Number,default:1}},data:function(){return{submitData:h(this.defaultValue),tryingToStoreOrder:!1,bankTypeList:[{id:"BOT",title:"台灣銀行"},{id:"Taishin",title:"台新"},{id:"HNCB",title:"華南"}]}},computed:Object(l["a"])({},p["b"],{submitRules:function(){return{bankType:[{required:this.isRequiredBankType,message:"請選擇轉帳銀行"}]}},hasUnpaidItem:function(){return this.defaultValue.addItems.some(function(t){return 2===t.status})},filterSubmitData:function(){var t=this.submitData.addItems.map(function(t){return{id:t.id,status:t.status}});return Object(l["a"])({},this.submitData,{addItems:t})},isPaid:function(){return 1===this.defaultValue.status},isPaidByCredit:function(){return"Credit"===this.defaultValue.paymentMethod},fullRefundOnly:function(){return this.isPaid&&this.isPaidByCredit&&1===this.defaultValue.canRefund&&0===this.defaultValue.canPartialRefund},isHomeService:function(){return"home"===this.bookingOrder.storeType},isEmployee:function(){return!!this.currentUser.scheduleItemId},showVacc:function(){var t=new Date(Object(f["a"])(new Date(this.bookingOrder.date))),e=new Date(Object(f["a"])(new Date));return Object(m["differenceInDays"])(t,e)>1},isRequiredBankType:function(){return"Vacc"===this.submitData.paymentMethod},disabledPayment:function(){return 1===this.defaultValue.status||this.isEmployee&&this.isHomeService&&!this.showVacc}}),methods:{handleStoreOrder:function(){var t=this;this.$refs.form.validate(function(e){e?t.tryToStoreOrder():t.$nextTick(function(){Object(b["a"])(t.$refs.form.$el.querySelector(".el-form-item__error"),182)})})},tryToStoreOrder:function(){var t=Object(o["a"])(r.a.mark(function t(){return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.tryingToStoreOrder=!0,t.prev=1,t.next=4,this.$store.dispatch("order/storeAdditionalOrder",this.filterSubmitData);case 4:return t.prev=4,this.tryingToStoreOrder=!1,t.finish(4);case 7:this.$emit("update");case 8:case"end":return t.stop()}},t,this,[[1,,4,7]])}));return function(){return t.apply(this,arguments)}}(),updateOrderStatus:function(t){this.submitData.addItems.forEach(function(e){0!==e.defaultStatus&&(e.status=t)})},onChangePayment:function(t){["Credit","Vacc"].includes(t)&&this.resetItemsStatus()},resetItemsStatus:function(){var t=c()(this.defaultValue),e=t.addItems;this.submitData=Object(l["a"])({},this.submitData,{addItems:e.map(function(t){return Object(l["a"])({},t,{defaultStatus:t.status})})})}}},y=v,O=a("29ee"),_=a("2877");function w(t){this["$style"]=O["default"].locals||O["default"]}var C=Object(_["a"])(y,i,s,!1,w,null,null);e["default"]=C.exports},"5fd2":function(t,e,a){t.exports={slide:"AdditionEditForm_slide_2OHsn","slide-reverse":"AdditionEditForm_slide-reverse_1iIiH","edit-addition":"AdditionEditForm_edit-addition_3i8Do","payment-methods":"AdditionEditForm_payment-methods_35rf3"}},"8b4c":function(t,e,a){"use strict";function i(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=n(t);a.scrollTo({top:r(t)-e,behavior:"smooth"})}function s(t){var e=t.scrollHeight>t.clientHeight,a=window.getComputedStyle(t).overflowY,i=["scroll","auto"].includes(a);return e&&i}function n(t){return s(t)?t:n(t.parentElement)}function r(t){var e=0;if(t.offsetParent){do{e+=t.offsetTop}while(t=t.offsetParent);return e}}a.d(e,"a",function(){return i})}}]);
//# sourceMappingURL=chunk-68b591e4.5c008295.js.map