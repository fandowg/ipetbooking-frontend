(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-29ff35d9","chunk-2d0b235b","chunk-177d8412","chunk-177d8412","chunk-177d8412"],{"22af":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-input",t._g(t._b({ref:"input",attrs:{value:t.value},on:{focus:t.onFocus,input:function(e){return t.onInput(t.value)},blur:function(e){return t.onBlur(t.value)}},scopedSlots:t._u([{key:"prepend",fn:function(){return[t._t("prepend")]},proxy:!0},{key:"append",fn:function(){return[t._t("append")]},proxy:!0},{key:"suffix",fn:function(){return[t._t("suffix")]},proxy:!0}],null,!0)},"el-input",t.$attrs,!1),t.$listeners))},s=[],o={inheritAttrs:!1,props:{value:{type:[String,Number],default:""}},data:function(){return{isFloating:!1}},watch:{value:{handler:"onBlur",immediate:!0},isFloating:{handler:"toggleFormItemClass",immediate:!0}},methods:{toggleFormItemClass:function(t){var e=this;this.$nextTick(function(){var i=e.$refs.input.$el.parentNode.previousElementSibling;i.classList.add("floating-label"),t||e.$slots.prepend?i.classList.add("is-floating"):i.classList.remove("is-floating")})},onBlur:function(t){this.isFloating=""!==t&&null!==t},onFocus:function(){this.isFloating=!0},onInput:function(t){this.isFloating=""!==t&&null!==t}}},r=o,n=i("2877"),l=Object(n["a"])(r,a,s,!1,null,null,null);e["default"]=l.exports},5602:function(t,e,i){t.exports={slide:"BaseButtonDialog_slide_1oaPh","slide-reverse":"BaseButtonDialog_slide-reverse_2oPsW",floating:"BaseButtonDialog_floating_1ftAD","floating--active":"BaseButtonDialog_floating--active_3j2JZ",floating__order2:"BaseButtonDialog_floating__order2_1fFr3",floating__wrapper:"BaseButtonDialog_floating__wrapper_2aAl-"}},"62d4":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.floating?i("div",{class:t.$style["floating__wrapper"]},[t.onlyDialog?t._e():[i("el-tooltip",{attrs:{effect:"dark",content:t.tooltipText,placement:"left"}},[i("el-button",t._b({class:t.floatingClass,attrs:{type:t.buttonType,circle:t.floating},on:{click:t.manualOpen}},"el-button",t.$attrs,!1),[i("BaseIcon",{attrs:{name:t.buttonIconName}}),t._t("trigger")],2)],1)],t.onlyButton?t._e():i("el-dialog",t._b({attrs:{visible:t.dialogVisible,title:t.title,top:"0",width:t.width,"append-to-body":"","destroy-on-close":t.destroy},on:{close:t.handleClose,opened:t.dialogOpened}},"el-dialog",t.dialogProps,!1),[t._t("default")],2)],2):i("span",[t.onlyDialog?t._e():[i("el-button",t._b({attrs:{type:t.buttonType},on:{click:t.manualOpen}},"el-button",t.$attrs,!1),[i("BaseIcon",{attrs:{name:t.buttonIconName}}),t._t("trigger")],2)],t.onlyButton?t._e():i("el-dialog",t._b({attrs:{visible:t.dialogVisible,title:t.title,top:"0",width:t.width,"append-to-body":"","destroy-on-close":t.destroy},on:{close:t.handleClose,opened:t.dialogOpened}},"el-dialog",t.dialogProps,!1),[t._t("default")],2)],2)},s=[],o=i("88d8"),r={inheritAttrs:!1,props:{floating:{type:Boolean,default:!1},title:{type:String,default:""},dialogVisible:{type:Boolean,default:!1},dialogProps:{type:Object,default:function(){}},buttonTooltip:{type:String,default:""},buttonType:{type:String,default:"primary"},buttonIconName:{type:String,default:"plus"},order:{type:String,default:"1"},onlyDialog:{type:Boolean,default:!1},onlyButton:{type:Boolean,default:!1},destroy:{type:Boolean,default:!1},width:{type:String,default:"830px"}},computed:{floatingClass:function(){return[this.$style.floating,Object(o["a"])({},this.$style["floating--active"],"plus"===this.buttonIconName&&this.dialogVisible),this.$style["floating__order".concat(this.order)]]},tooltipText:function(){return this.buttonTooltip?this.buttonTooltip:this.title}},methods:{manualOpen:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("opened")},dialogOpened:function(){this.onlyButton||this.$emit("update:dialogVisible",!0),this.$emit("dialog-opened")},handleClose:function(){this.onlyButton||this.$emit("update:dialogVisible",!1),this.$emit("closed")}}},n=r,l=i("be7b"),u=i("2877");function d(t){this["$style"]=l["default"].locals||l["default"]}var c=Object(u["a"])(n,a,s,!1,d,null,null);e["default"]=c.exports},"6c94":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Layout",[i("div",[i("div",{staticClass:"btn-top-box"},[i("span",[i("el-button",{staticClass:"is-round",attrs:{type:"primary"},on:{click:function(e){t.editDialogVisible=!0}}},[i("BaseIcon",{attrs:{name:"plus"}}),i("span",[t._v("新增")])],1)],1),i("span",[i("el-button",{staticClass:"is-round",on:{click:function(e){t.permissionDialogVisible=!0}}},[i("BaseIcon",{attrs:{name:"user-lock"}}),i("span",[t._v("管理權限表")])],1)],1)]),i("BaseTableSearch",{attrs:{"default-value":t.filterData,"hide-action":""},on:{reset:t.tryToSearchUser,tryToFetchList:t.tryToSearchUserFilter},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.fields;return[i("el-form-item",{attrs:{prop:"groupIds"}},[i("el-select",{staticStyle:{width:"300px"},attrs:{multiple:"",placeholder:"選擇帳號身份"},on:{change:t.tryToSearchUserFilter},model:{value:a.groupIds,callback:function(e){t.$set(a,"groupIds",e)},expression:"fields.groupIds"}},t._l(t.userGroupList,function(t){return i("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1)],1),i("el-form-item",{attrs:{prop:"block"}},[i("el-select",{on:{change:t.tryToSearchUserFilter},model:{value:a.block,callback:function(e){t.$set(a,"block",e)},expression:"fields.block"}},t._l(t.statusList,function(t){return i("el-option",{key:t.title,attrs:{label:t.title,value:t.value}})}),1)],1)]}}])}),i("div",{staticClass:"el-table-wrapper"},[i("el-table",{ref:"table",attrs:{data:t.userList}},[i("el-table-column",{attrs:{label:"姓名／Email","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t._v("\n      "+t._s(a.firstName)+" "+t._s(a.lastName)+"\n      "),i("div",[t._v(t._s(a.email))])]}}])}),i("el-table-column",{attrs:{label:"帳號狀態",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("div",{style:"color: "+(a.block?"#e35d5d":"#60a32f")},[t._v(t._s(a.block?"停權中":"啟用中"))])]}}])}),t._l(t.userGroupList,function(e){return i("el-table-column",{key:e.id,attrs:{width:"100",label:e.title,align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[s.groupIds.includes(e.id)?i("BaseIcon",{staticClass:"only-icon",attrs:{name:"check-circle"}}):t._e()]}}],null,!0)})}),i("el-table-column",{attrs:{align:"right",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[i("el-button",{staticClass:"is-round",staticStyle:{"font-size":"16px"},attrs:{type:"primary",plain:""},on:{click:function(e){return t.openEditDialog("edit",a)}}},[i("BaseIcon",{attrs:{name:"edit"}})],1)]}}])})],2)],1),i("BasePagination",{ref:"pagination",attrs:{"current-page":t.currentPage},on:{"update:currentPage":function(e){t.currentPage=e},"update:current-page":function(e){t.currentPage=e}}})],1),i("BaseButtonDialog",{directives:[{name:"can",rawName:"v-can:api",value:"addAdmin",expression:"'addAdmin'",arg:"api"}],attrs:{"only-dialog":"",title:"身份與權限表","dialog-visible":t.permissionDialogVisible,"dialog-props":{width:"80%"},"button-type":"info","button-icon-name":"info",order:"2",width:"1135px",floating:""},on:{"update:dialogVisible":function(e){t.permissionDialogVisible=e},"update:dialog-visible":function(e){t.permissionDialogVisible=e}}},[i("PermissionTable",{attrs:{"show-owner":""}})],1),i("BaseButtonDialog",{attrs:{"only-dialog":"",title:t.editDialogTitle,"dialog-visible":t.editDialogVisible,"dialog-props":{width:"80%"},floating:"",destroy:!0,width:"1135px"},on:{"update:dialogVisible":function(e){t.editDialogVisible=e},"update:dialog-visible":function(e){t.editDialogVisible=e},closed:t.resetEditDialog}},[i("AdminForm",{attrs:{"default-value":t.editDialogItem,visible:t.editDialogVisible},on:{close:t.closeEditDialog,store:t.updateList}})],1)],1)},s=[],o=i("4795"),r=i.n(o),n=i("cb0c"),l=i("9395"),u=i("4d77"),d=i("444f"),c=i("62d4"),p=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"form",staticClass:"el-form--floating",attrs:{model:t.submitData,rules:t.submitRules,"validate-on-rule-change":!1,"label-position":"top",autocomplete:"off"}},[i("el-row",{attrs:{gutter:10}},[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"名字",prop:"firstName",required:""}},[i("el-input",{model:{value:t.submitData.firstName,callback:function(e){t.$set(t.submitData,"firstName",e)},expression:"submitData.firstName"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"姓氏",prop:"lastName",required:""}},[i("el-input",{model:{value:t.submitData.lastName,callback:function(e){t.$set(t.submitData,"lastName",e)},expression:"submitData.lastName"}})],1)],1),i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"Email",prop:"email"}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:t.submitData.email,callback:function(e){t.$set(t.submitData,"email",e)},expression:"submitData.email"}})],1)],1),t.isEditMode?i("el-col",{attrs:{span:24}},[i("el-button",{class:t.$style.toggler,attrs:{type:"text"},on:{click:function(e){t.showPasswordField=!t.showPasswordField}}},[t._v(t._s(t.showPasswordField?"取消變更密碼":"變更密碼"))])],1):t._e(),!t.isEditMode||t.isEditMode&&t.showPasswordField?[i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"密碼",prop:"password"}},[i("el-input",{attrs:{type:t.passwordVisible?"text":"password",autocomplete:"off"},scopedSlots:t._u([{key:"append",fn:function(){return[i("el-button",{on:{click:function(e){t.passwordVisible=!t.passwordVisible}}},[i("BaseIcon",{attrs:{name:t.passwordVisible?"eye-slash":"eye"}})],1)]},proxy:!0}],null,!1,1524086181),model:{value:t.submitData.password,callback:function(e){t.$set(t.submitData,"password",e)},expression:"submitData.password"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"再次輸入密碼",prop:"passwordConfirm"}},[i("el-input",{attrs:{type:t.repasswordVisible?"text":"password",autocomplete:"off"},scopedSlots:t._u([{key:"append",fn:function(){return[i("el-button",{on:{click:function(e){t.repasswordVisible=!t.repasswordVisible}}},[i("BaseIcon",{attrs:{name:t.repasswordVisible?"eye-slash":"eye"}})],1)]},proxy:!0}],null,!1,2424628498),model:{value:t.submitData.passwordConfirm,callback:function(e){t.$set(t.submitData,"passwordConfirm",e)},expression:"submitData.passwordConfirm"}})],1)],1)]:t._e(),i("el-col",{attrs:{span:24}},[i("el-form-item",{class:t.$style["form-item--last"],attrs:{label:"所屬身份（可複選）",prop:"groupIds"}},[i("el-checkbox-group",{model:{value:t.submitData.groupIds,callback:function(e){t.$set(t.submitData,"groupIds",e)},expression:"submitData.groupIds"}},t._l(t.filterOwnerGroupList,function(e){return i("el-checkbox",{key:e.id,attrs:{label:e.id,disabled:7===e.id}},[t._v(t._s(e.title))])}),1),i("el-collapse",[i("el-collapse-item",{attrs:{title:"查看各個身份權限表"}},[i("PermissionTable")],1)],1)],1)],1),i("el-col",{attrs:{span:24}},[t.isOwner?t._e():i("el-form-item",{attrs:{label:"帳號啟用",prop:"block"}},[i("el-switch",{attrs:{"active-text":"啟用","inactive-text":"停權","active-value":0,"inactive-value":1,disabled:0===t.defaultValue.canBlock},model:{value:t.submitData.block,callback:function(e){t.$set(t.submitData,"block",e)},expression:"submitData.block"}}),0===t.defaultValue.canBlock?i("el-alert",{staticStyle:{display:"inline","margin-left":"20px"},attrs:{title:"欲停權請先移轉隸屬此帳號的有效訂單",type:"warning",closable:!1,"show-icon":""}}):t._e()],1)],1)],2)],1),i("div",{class:t.$style.footer},[i("el-button",{on:{click:t.emitClose}},[t._v("取消")]),i("el-button",{attrs:{type:"primary",loading:t.tryingStore},on:{click:t.tryToStore}},[t._v(t._s(t.isEditMode?"儲存":"創建"))])],1)],1)},f=[],m=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-table",{attrs:{data:t.permissionData}},[i("el-table-column",{attrs:{prop:"item",width:"300"}}),t._l(t.filterOwnerGroupList,function(e){return i("el-table-column",{key:e.id,attrs:{label:e.title,align:"center"},scopedSlots:t._u([{key:"default",fn:function(a){var s=a.row;return[s.groupIds.includes(e.id)?i("BaseIcon",{staticClass:"only-icon",attrs:{name:"check-circle"}}):t._e()]}}],null,!0)})})],2)},g=[],b=[{item:"操作行事曆",groupIds:[7,8,9,10]},{item:"入場報到",groupIds:[7,8,9,10,11]},{item:"操作加購",groupIds:[7,8,9,10,11]},{item:"操作訂單管理",groupIds:[7,8,9,10]},{item:"操作客戶管理",groupIds:[7,8,9,10]},{item:"操作優惠券(進階方案)",groupIds:[7,8,9,10]},{item:"操作包月方案",groupIds:[7,8,9]},{item:"操作排班",groupIds:[7,8]},{item:"操作排班人員",groupIds:[7,8]},{item:"操作管理帳號",groupIds:[7,8]},{item:"查看數據分析",groupIds:[7,8]},{item:"新增/修改分店",groupIds:[7,8]},{item:"編輯商店資訊",groupIds:[7,8]},{item:"編輯通知設定",groupIds:[7,8]},{item:"查看簡訊紀錄",groupIds:[7,8]},{item:"方案訂閱管理/訂閱付費紀錄",groupIds:[7]}],h=b,y={props:{showOwner:{type:Boolean,default:!1}},data:function(){return{permissionData:Object.freeze(h)}},computed:Object(l["a"])({},u["h"],{filterOwnerGroupList:function(){return this.showOwner?this.userGroupList:this.userGroupList.filter(function(t){return 7!==t.value})}})},v=y,w=i("2877"),_=Object(w["a"])(v,m,g,!1,null,null,null),D=_.exports,k=i("22af"),$=function(){return{firstName:"",lastName:"",email:"",password:"",passwordConfirm:"",groupIds:[],block:0}},I=7,x={components:{PermissionTable:D,BaseInputFloatingLabel:k["default"]},props:{defaultValue:{type:Object,default:function(){return $()}},visible:{type:Boolean,default:!1}},data:function(){return{tryingStore:!1,showPasswordField:!1,submitData:Object.assign($(),this.defaultValue),passwordVisible:!1,repasswordVisible:!1}},computed:Object(l["a"])({},u["h"],{isEditMode:function(){return this.defaultValue.id},isOwner:function(){return this.defaultValue.groupIds&&this.defaultValue.groupIds.includes(I)||!1},filterOwnerGroupList:function(){var t=this,e=function(t){return t===I};return this.userGroupList.filter(function(i){return t.isOwner?t.isOwner:!e(i.id)})},submitRules:function(){var t=this;return{email:[{required:!0,message:"請輸入 Email",trigger:"blur"},{validator:function(e,i,a){i&&!t.isEditMode?t.$store.dispatch("merchant/validUserEmail",i).then(function(){return a()}).catch(function(){return a(new Error("此 Email 已被註冊"))}):a()},type:"email"}],password:[{required:!this.isEditMode||this.isEditMode&&this.showPasswordField,message:"請輸入密碼",trigger:"blur"},{validator:function(e,i,a){var s=/(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])|(?=.*[a-z])(?=.*[A-Z])(?=.*[$@$!%*#?&])|(?=.*[A-Z])(?=.*[0-9])(?=.*[$@$!%*#?&])|(?=.*[a-z])(?=.*[0-9])(?=.*[$@$!%*#?&]).{8,16}/,o=t.submitData.passwordConfirm;s.test(i)||a(new Error("請用 8~16 個大小寫英文字母、數字與特殊符號組合")),""!==o&&t.$refs.form.validateField("passwordConfirm"),a()},trigger:"blur"}],passwordConfirm:[{required:!this.isEditMode||this.isEditMode&&this.showPasswordField,message:"請再次輸入密碼",trigger:"blur"},{validator:function(e,i,a){var s=t.submitData.password;i!==s?a(new Error("兩次輸入的密碼不一致")):a()},trigger:"blur"}],groupIds:[{type:"array",required:!0,message:"請至少選擇一種身份",trigger:"change"}],firstName:[{required:!0,message:"請輸入名字",trigger:"blur"}],lastName:[{required:!0,message:"請輸入姓氏",trigger:"blur"}]}}}),watch:{defaultValue:"updateSubmitData",visible:{handler:function(t){var e=this;t&&!this.isEditMode&&setTimeout(function(){e.$refs.form.resetFields()},2e3)},immediate:!0}},mounted:function(){},methods:{tryToStore:function(){var t=Object(n["a"])(r.a.mark(function t(){return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$refs.form.validate();case 2:return this.tryingStore=!0,t.prev=3,t.next=6,this.$store.dispatch("merchant/storeUser",this.submitData);case 6:this.emitStore(),t.next=11;break;case 9:t.prev=9,t.t0=t["catch"](3);case 11:return t.prev=11,this.tryingStore=!1,t.finish(11);case 14:case"end":return t.stop()}},t,this,[[3,9,11,14]])}));return function(){return t.apply(this,arguments)}}(),emitStore:function(){this.$emit("store"),this.emitClose()},emitClose:function(){this.$emit("close"),this.$refs.form.resetFields()},updateSubmitData:function(){this.submitData=Object.assign($(),this.defaultValue)}}},B=x,S=i("85a6");function V(t){this["$style"]=S["default"].locals||S["default"]}var F=Object(w["a"])(B,p,f,!1,V,null,null),O=F.exports,E=i("1b80"),T={page:{title:"商店管理帳號",meta:[{name:"description",content:"Admin List"}]},components:{Layout:d["a"],BaseButtonDialog:c["default"],AdminForm:O,PermissionTable:D},mixins:[E["c"]],data:function(){return{editDialogVisible:!1,editDialogMode:"add",editDialogItem:{},permissionDialogVisible:!1,filterData:{groupIds:[],block:""},statusList:[{value:"",title:"全部帳號狀態"},{value:0,title:"啟用中"},{value:1,title:"停權中"}],isFilterChange:!1}},computed:Object(l["a"])({},u["b"],u["h"],{editDialogTitle:function(){return"add"===this.editDialogMode?"新增管理帳號":"編輯管理帳號"}}),watch:{currentPage:{handler:"tryToSearchUser",immediate:!0},filterData:{handler:function(){this.isFilterChange=!0},deep:!0}},mounted:function(){this.$refs.table.doLayout()},methods:{openEditDialog:function(t,e){this.editDialogVisible=!0,this.editDialogMode=t,this.editDialogItem=e},closeEditDialog:function(){this.editDialogVisible=!1,this.resetEditDialog()},updateList:function(){this.tryToSearchUser(),this.closeEditDialog()},tryToSearchUserFilter:function(){var t=Object(n["a"])(r.a.mark(function t(){var e,i=this;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(1===this.currentPage){t.next=3;break}return this.currentPage=1,t.abrupt("return");case 3:return t.next=5,this.$store.dispatch("merchant/fetchUsers",Object.assign(this.filterData,this.pageQuery));case 5:e=t.sent,this.$nextTick(function(){i.$refs.pagination.updateTotal(e)}),this.isFilterChange=!1;case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),currentPageLimit:function(){var t=this.$refs.pagination.total%this.$refs.pagination.pageSize,e=this.$refs.pagination.total/this.$refs.pagination.pageSize,i=t?parseInt(e)+1:parseInt(e);this.currentPage>i&&(this.currentPage=i)},tryToSearchUser:function(){var t=Object(n["a"])(r.a.mark(function t(){var e,i=this;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.$store.dispatch("merchant/fetchUsers",Object.assign(this.filterData,this.pageQuery));case 2:e=t.sent,this.$nextTick(function(){i.$refs.pagination.updateTotal(e),i.currentPageLimit()});case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),resetEditDialog:function(){this.editDialogMode="add",this.editDialogItem={}}}},C=T,P=Object(w["a"])(C,a,s,!1,null,null,null);e["default"]=P.exports},"795f":function(t,e,i){t.exports={slide:"AdminForm_slide_TIyCD","slide-reverse":"AdminForm_slide-reverse_EjikI",toggler:"AdminForm_toggler_2axaU","form-item--last":"AdminForm_form-item--last_3wSqX",footer:"AdminForm_footer_2IHy2"}},"85a6":function(t,e,i){"use strict";var a=i("795f"),s=i.n(a);e["default"]=s.a},be7b:function(t,e,i){"use strict";var a=i("5602"),s=i.n(a);e["default"]=s.a}}]);
//# sourceMappingURL=chunk-29ff35d9.e5d3bc47.js.map