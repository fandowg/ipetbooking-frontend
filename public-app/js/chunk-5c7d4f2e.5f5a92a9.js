(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5c7d4f2e"],{"404f":function(e,t,a){"use strict";var c=a("cc2e"),n=a.n(c);t["default"]=n.a},"66dd":function(e,t,a){"use strict";a.r(t);var c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:e.$style["target-wrap"]},[[a("h4",{staticClass:"form-block-title"},[e._v("適用對象")]),a("el-row",{attrs:{type:"flex"}},[a("el-col",{attrs:{span:24,md:11}},[a("h5",{staticStyle:{"margin-top":"0"}},[a("BaseIcon",{attrs:{"icon-style":"fal",name:"user-check"}}),e._v(" 加入適用對象")],1),a("p",{staticStyle:{}},[e._v("請加入適用的標籤群組。")]),a("p",[e._v("若無設定則所有客戶皆為此優惠代碼發送的目標。")]),a("el-input",{staticClass:"search",attrs:{placeholder:"搜尋標籤群組",clearable:""},model:{value:e.searchIncludeTag,callback:function(t){e.searchIncludeTag=t},expression:"searchIncludeTag"}},[a("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),a("el-checkbox",{staticClass:"check-all",attrs:{indeterminate:e.isIndeterminate,disabled:this.submitData.excludeTag.length===e.tagList.length,border:""},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全選標籤")]),a("el-checkbox-group",{staticClass:"tag",model:{value:e.submitData.includeTag,callback:function(t){e.$set(e.submitData,"includeTag",t)},expression:"submitData.includeTag"}},e._l(e.filterIncludeTags,function(t,c){return a("el-checkbox",{key:"tag-"+c,attrs:{label:t.id,disabled:e.submitData.excludeTag.includes(t.id)}},[e._v(e._s(t.title))])}),1),a("h5",[e._v("指定客戶")]),a("el-autocomplete",{staticClass:"search",attrs:{"fetch-suggestions":e.tryToSearchIncludeMember,placeholder:"搜尋客戶"},on:{select:e.handleSelectIncludeMember},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[e._v(e._s(a.fullName+"・"+a.phoneNumber))]}}]),model:{value:e.searchIncludeMember,callback:function(t){e.searchIncludeMember=t},expression:"searchIncludeMember"}},[a("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),a("div",{staticClass:"selected-member"},[a("div",{staticClass:"header"},[e._v("客戶姓名 / 電話")]),a("div",{staticClass:"content"},e._l(e.submitData.includeMember,function(t,c){return a("div",{key:"includeMember-"+c,staticClass:"item"},[a("div",[e._v(e._s(t.fullName)+" "+e._s(t.phoneNumber||t.phone))]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleRemoveMember(c)}}},[a("BaseIcon",{attrs:{name:"times"}})],1)],1)}),0)])],1),a("el-col",{class:e.$style["vertical-divider"],attrs:{span:2}}),a("el-col",{attrs:{span:24,md:11}},[a("h5",{staticStyle:{"margin-top":"0"}},[a("BaseIcon",{attrs:{"icon-style":"fal",name:"user-times"}}),e._v(" 排除特定的對象")],1),a("p",[e._v("請選取要特別排除的標籤群組與人，如：黑名單。")]),a("p",{staticStyle:{color:"#E35D5D"}},[e._v("若選取對象和適用對象重複，會以排除對象為主。")]),a("el-input",{staticClass:"search",attrs:{placeholder:"搜尋標籤群組",clearable:""},model:{value:e.searchExcludeTag,callback:function(t){e.searchExcludeTag=t},expression:"searchExcludeTag"}},[a("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),a("el-checkbox-group",{staticClass:"tag",staticStyle:{height:"335px"},model:{value:e.submitData.excludeTag,callback:function(t){e.$set(e.submitData,"excludeTag",t)},expression:"submitData.excludeTag"}},e._l(e.filterExcludeTags,function(t,c){return a("el-checkbox",{key:"tag-"+c,attrs:{label:t.id,disabled:e.submitData.includeTag.includes(t.id)}},[e._v(e._s(t.title))])}),1),a("h5",[e._v("排除客戶")]),a("el-autocomplete",{staticClass:"search",attrs:{"fetch-suggestions":e.tryToSearchExcludeMember,placeholder:"搜尋客戶"},on:{select:e.handleSelectExcludeMember},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[e._v(e._s(a.fullName+"・"+a.phoneNumber))]}}]),model:{value:e.searchExcludeMember,callback:function(t){e.searchExcludeMember=t},expression:"searchExcludeMember"}},[a("BaseIcon",{staticClass:"el-input__icon",attrs:{slot:"prefix",name:"search"},slot:"prefix"})],1),a("div",{staticClass:"selected-member"},[a("div",{staticClass:"header"},[e._v("客戶姓名 / 電話")]),a("div",{staticClass:"content"},e._l(e.submitData.excludeMember,function(t,c){return a("div",{key:"excludeMember-"+c,staticClass:"item"},[a("div",[e._v(e._s(t.fullName)+" "+e._s(t.phoneNumber||t.phone))]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.handleRemoveMember(c,"exclude")}}},[a("BaseIcon",{attrs:{name:"times"}})],1)],1)}),0)])],1)],1)]],2)},n=[],r=a("4795"),i=a.n(r),s=a("cb0c"),l=a("f210"),u=a("9395"),o=a("9161"),d={availableTags:[],blockTags:[],availableMembers:[],blockMembers:[]},h={components:{},filters:{},props:{defaultValue:{type:Object,default:function(){}}},data:function(){var e=Object.assign({},d,this.defaultValue),t=e.availableTags,a=e.blockTags,c=e.availableMembers,n=e.blockMembers,r=Object(o["a"])(e,["availableTags","blockTags","availableMembers","blockMembers"]);return{tryingStore:!1,searchIncludeTag:"",searchExcludeTag:"",searchIncludeMember:"",searchExcludeMember:"",submitData:Object(u["a"])({},r,{includeTag:Object(l["a"])(t.map(function(e){return e.id})),excludeTag:Object(l["a"])(a.map(function(e){return e.id})),includeMember:Object(l["a"])(c),excludeMember:Object(l["a"])(n)}),tryingtryToFetchMember:!1,tagList:[],includeMemberList:[],excludeMemberList:[],checkAll:!1}},computed:{isEditMode:function(){return void 0!==this.defaultValue.id},filterIncludeMembers:function(){var e=this;return this.includeMemberList.filter(function(t){return!e.submitData.excludeMember.includes(t.id)})},filterExcludeMembers:function(){var e=this;return this.excludeMemberList.filter(function(t){return!e.submitData.includeMember.includes(t.id)})},filterIncludeTags:function(){var e=this;return""===this.searchIncludeTag?this.tagList:this.tagList.filter(function(t){return t.title.includes(e.searchIncludeTag)})},filterExcludeTags:function(){var e=this;return""===this.searchExcludeTag?this.tagList:this.tagList.filter(function(t){return t.title.includes(e.searchExcludeTag)})},isIndeterminate:function(){return this.checkAll=this.submitData.includeTag.length===this.tagList.length,0!==this.submitData.includeTag.length&&(this.submitData.includeTag.length>0&&this.submitData.includeTag.length<this.tagList.length)},filterSubmitData:function(){var e=this.submitData,t=e.includeTag,a=e.excludeTag,c=e.includeMember,n=e.excludeMember,r=(Object(o["a"])(e,["includeTag","excludeTag","includeMember","excludeMember"]),t.map(function(e){return{id:e,block:0}})),i=a.map(function(e){return{id:e,block:1}}),s=c.map(function(e){return{id:e.id,block:0}}),u=n.map(function(e){return{id:e.id,block:1}});return this.isEditMode,{tags:Object(l["a"])(r).concat(Object(l["a"])(i)),members:Object(l["a"])(s).concat(Object(l["a"])(u))}}},created:function(){this.tryToFetchTags()},methods:{tryToFetchTags:function(){var e=Object(s["a"])(i.a.mark(function e(){return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("member/fetchTags");case 2:this.tagList=e.sent;case 3:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),tryToFetchMember:function(){var e=Object(s["a"])(i.a.mark(function e(){var t,a,c=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:"",this.tryingtryToFetchMember=!0,e.next=4,this.$store.dispatch("member/fetchListByKeyword",t);case 4:return a=e.sent,this.tryingtryToFetchMember=!1,e.abrupt("return",a);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),remoteMethodLeft:function(e){this.searchMember(e)},remoteMethodRight:function(e){this.searchMember(e,"exclude")},searchMember:function(){var e=Object(s["a"])(i.a.mark(function e(t){var a,c=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(a=c.length>1&&void 0!==c[1]?c[1]:"include",""===t){e.next=7;break}return e.next=4,this.tryToFetchMember(t);case 4:this["".concat(a,"MemberList")]=e.sent,e.next=8;break;case 7:this["".concat(a,"MemberList")]=[];case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),handleCheckAllChange:function(e){var t=this;this.submitData.includeTag=e?this.tagList.filter(function(e){return!t.submitData.excludeTag.includes(e.id)}).map(function(e){return e.id}):[]},tryToSearchMember:function(){var e=Object(s["a"])(i.a.mark(function e(t,a){var c,n,r,s,l=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(c=l.length>2&&void 0!==l[2]?l[2]:"include",t){e.next=4;break}return a([]),e.abrupt("return");case 4:return e.next=6,this.tryToFetchMember(t);case 6:n=e.sent,r=this.submitData["".concat(c,"Member")].map(function(e){return e.id}),s=this.submitData["".concat("include"===c?"exclude":"include","Member")].map(function(e){return e.id}),a(n.filter(function(e){return!r.includes(e.id)&&!s.includes(e.id)}));case 10:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),tryToSearchIncludeMember:function(e,t){this.tryToSearchMember(e,t)},tryToSearchExcludeMember:function(e,t){this.tryToSearchMember(e,t,"exclude")},handleSelectMember:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"include",a=this.submitData["".concat(t,"Member")].some(function(t){return t.id===e.id});a||this.submitData["".concat(t,"Member")].push(e)},handleSelectIncludeMember:function(e){this.handleSelectMember(e)},handleSelectExcludeMember:function(e){this.handleSelectMember(e,"exclude")},handleRemoveMember:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"include";this.submitData["".concat(t,"Member")].splice(e,1)}}},b=h,m=a("404f"),f=a("2877");function p(e){this["$style"]=m["default"].locals||m["default"]}var g=Object(f["a"])(b,c,n,!1,p,null,null);t["default"]=g.exports},cc2e:function(e,t,a){e.exports={slide:"CouponTarget_slide_2yjV5","slide-reverse":"CouponTarget_slide-reverse_2gQ77","vertical-divider":"CouponTarget_vertical-divider_3Sla7","target-wrap":"CouponTarget_target-wrap_17SiG"}}}]);
//# sourceMappingURL=chunk-5c7d4f2e.5f5a92a9.js.map